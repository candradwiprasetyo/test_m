var EN = {
/*GLOBAL */
"$not.found" : "No result found, try again :)",
/* wizzard-your-avatar */

"$you.look.awesome!" : "You look awesome!",
"$with.your.new" : "With your new look, you are ready to join in all the fun in the CIAYO World.",
"$download.avatar" : "Download Avatar",
"$next" : "Next",

/* wizzard-mascot */

"$back" : "BACK",
"$select.your.mascot" : "SELECT YOUR MASCOT",
"$the.navajo.indians" : "The Navajo Indians have their spirit animals, but here in the CIAYO World, we have our mascots. Pick one to accompany you along the way!",

/* wizzard-hello */

"$ciayo.friends.welcome" : "CIAYO Friends, <br/> welcome to the CIAYO World!",
"$type.your.username" : "What is your name ?",

/* wizzard-gender */

"$ciayo.friends.welcome" : "CIAYO Friends welcome to the CIAYO World!",
"$select.your.gender" : "SELECT YOUR GENDER",
"$male" : "Male",
"$female" : "Female",

/* wizzard-create-avatar */

"$skip" : "SKIP",
"$create.your.avatar" : "CREATE YOUR AVATAR",

/* wizzard-born */

"$when.were.you" : "WHEN WERE YOU BORN?",
"$date.of.birth" : "Date of Birth",

/* welcome */

"$tap.to.register" : "Tap to register",
"$create.an.account" : "Create an account and enter the CIAYO World!",
"$register" : "Register",
"$term.policy" : "By using CIAYO, you have agreed to abide to CIAYO’s <a href=\"{{terms}}\"><b>Terms of Use</b></a> and <a href=\"{{data_policy}}\"><b>Privacy Policy.</b></a>",
"$tap.to.login" : "Tap to login",
"$login.to.your" : "Login to your CIAYO account",
"$login" : "Login",
"$forgot.password?" : "Forgot Password?",
"$password" : "Password",

/* trending */

"$trending" : "Trending",
"$posts" : "Posts",
"$people" : "People",
"$activity" : "Activity",

/* trending-place */

"$trending.place.not" : "Trending place not found",

/* trending-people */

"$trending.people.not" : "Trending people not found",

/* trending-activity */

"$trending.activity.not" : "Trending activity not found",
"$posted" : "Posted",
"$visited" : "Visited ",
"$times" : "times",

/* store */

"$open.your.inventory" : "Open your inventory and manage your knik-knacks!",
"$go.to.inventory" : "Go to inventory",
"$home" : "Home",
"$premium" : "Premium",
"$contributor" : "Contributor",
"$free" : "Free",
"$all" : "All",
"$buy.this.sticker" : "Buy this sticker",
"$most.popular" : "Most Popular",
"$see.all" : "See all",
"$premium.new" : "Premium New",
"$premium.newest" : "Premium Newest",
"$contributor.new" : "Contributor New",
"$free.new" : "Free New",
"$most.popular.premium" : "Most Popular Premium",
"$premium.category" : "Premium Category",
"$emoji" : "Emoji",
"$most.popular.contributor" : "Most Popular Contributor",
"$contributor.category" : "Contributor Category",
"$contributor.stickers" : "Contributor Stickers",
"$view.more." : "View more...",
"$search" : "Search",
"$search.result.for:" : "Search result for: ",
"$buy" : "Buy",
"$category" : "Category",
"$my.account:" : "My account:",
"$purchased" : "Purchased",
"$click.sticker.for" : "Click sticker for preview",
"$search.sticker.or.emoji" : "Search stickers or emojis",
"$my.coin" : "My coin",

/* setting */

"$congratulations!" : "Congratulations!",
"$your.account.has" : "Your account has been verified. Lets play CIAYO!",
"$go.to.timeline" : "Go to Timeline",
"$edit.account" : "Edit Account",
"$change.password" : "Change Password",
"$general.settings" : "General Settings",
"$logout" : "Logout",
"$email.address" : "Email Address",
"$verify.your.email" : "Verify your email account",
"$phone.number" : "Phone Number",
"$verify.your.phone" : "Verify your phone number",
"$notify.me.through" : "Notify me through email or phone when someone is trying to log in into my account",
"$deactive.account" : "Deactive Account",
"$when.your.account" : "When your account is deactivated, people can't search, tag, and see your CIAYO profile",
"$delete.account" : "Delete Account",
"$if.you.delete" : "If you delete your account, all your credentials and acoount information will be lost and you have to make a new account to enter CIAYO World",
"$are.you.sure.deactive" : "Are you sure you want to deactivate your account?",
"$are.you.sure.logout" : "Are you sure you want to logout?",
"$are.you.sure.delete" : "Are you sure you want to delete your account?",
"$old.password" : "Old Password",
"$your.password.needs" : "Your password needs to : ",
"$must.be.at" : "Must be at least 8 characters",
"$must.not.contain" : "Must not contain disallowed characters ( “, ‘, _, &, (, ), <, >, space, /, ¥ )",
"$new.password" : "New Password",
"$new.password.confirmation" : "New Password Confirmation",
"$your.password.do" : "Your password do not match with each other",
"$privacy.setting" : "Privacy Setting",
"$timeline.access" : "Timeline Access",
"$default.post.setting" : "Default Post Setting",
"$who.can.find" : "Who can find me",
"$who.can.add" : "Who can add me",
"$card.settings" : "Card Settings",
"$parallax.timeline.view" : "Parallax Timeline View",
"$parallax.allows.you" : "Parallax allows you to see activity images in a 3D-like prespective. If you have motion sickness, turn this off.",
"$notification.settings" : "Notification Settings",
"$connection.request" : "Friend Requests",
"$comments" : "Comments",
"$language.setting" : "Language Setting",
"$email.notifications" : "Email Notifications",
"$new.features" : "New Features",
"$verify.later" : "Verify later",
"$to.verify.your.email" : "To verify your account, please enter the One-Time PIN received via email on your registered email: ",
"$to.verify.your.phone" : "To verify your account, please enter the One-Time PIN received via SMS on your registered mobile number : ",
"$resend" : "Resend",
"$change.email" : "Change Email",
"$change.mobile.number" : "change mobile number",
"$change.phone.number" : "Change Phone Number",
"$your.email.has" : "Your email has been changed from",
"$to" : "to",
"$your.mobile.number" : "Your mobile number has been changed from",
"$language.use.in.ciayo" : "What language do you want to use in CIAYO?",

/* search */

"$view.more" : "View more",
"$search.ciayo.friends" : "Search CIAYO Friends",

/* reset-password */

"$create.a.new" : "Create a new password",
"$submit" : "Submit",
"$your.new.password" : "Your new password",
"$confirm.new.password" : "Confirm new password",

/* profile */

"$view.profile" : "view profile",
"$add.friend" : "add friend",
"$follow" : "follow",
"$full.name" : "full name",
"$place,.date.of" : "place, date of birth",
"$nationality" : "nationality",
"$no.badge.collections" : "No Badge Collections",
"$welcome.to.ciayo" : "Welcome to CIAYO",
"$no.achievement.collections" : "No Achievement Collections",
"$website" : "website",
"$my.social.media" : "my social media",
"$view.more" : "view more",
"$badges" : "Badges",
"$no.badges.here" : "No badges here. Kinda empty, huh?",
"$no.social.network" : "No Social Network Added",
"$no.website" : "No Website Added",
"$edit.profile" : "Edit Profile",
"$username" : "username",
"$title" : "title",
"$basic.info" : "Basic Info",
"$place.of.birth" : "place of birth",
"$add.badges.&" : "Add Badges & Achievements",
"$badge.collections" : "badge collections",
"$website" : "Website",
"$add.a.website" : "Add a website / blog",
"$add.social.media" : "Add Social Media Accounts",
"$more.social.media" : "More social media...",
"$no.title" : "no title",
"$first.name" : "First name",
"$middle.name" : "Middle name",
"$last.name" : "Last name",
"$optional" : "Optional",
"$search.badges" : "Search Badges",
"$your.website.address" : "Your website address",
"$request.sent" : "Friend request sent",
"$ask.for" : "Ask for",
"$place.date.birthday" : "place and date of birth",
"$let" : "Let",
"$ask.birthday" : "know why you're asking for his place and date of birth",
"$ask.email" : "know why you're asking for his email address",
"$ask.phone" : "know why you're asking for his phone number",
"$send.request" : "Send Request",

/* profile-connection */

"$profile" : "Profile",
"$overview" : "overview",
"$timeline" : "timeline",
"$connection" : "connection",
"$all.friends" : "ALL FRIENDS",
"$mutual" : "MUTUAL",

/* notification */

"$notifications" : "Notifications",
"$you.have.no.notification" : "You have no any notifications",

/* mutual-friend */

"$mutual.friends" : "Mutual Friends",
"$has.become.your" : "has become your friend",
"$request.declined" : "Request declined",
"$view.profile" : "View Profile",
"$decline" : "Decline",

/* menu */

"$my.profile" : "My Profile",
"$store" : "Store",
"$achievements" : "Achievements",
"$about.ciayo" : "About CIAYO",
"$settings" : "Settings",
"$updates" : "Updates",

/* inventory-sticker */

"$done" : "DONE",
"$delete" : "Delete",

/* inventory-home */

"$go.to.store" : "Go to Store",
"$my.sticker" : "My Stickers",
"$my.emoji" : "My Emoji",
"$sort" : "SORT",

/* inventory-history */

"$purchase.history" : "Purchase History",
"$start.date" : "Start Date",
"$end.date" : "End Date",
"$start" : "Start",
"$end" : "End",

/* friend-request */

"$you.have.no.friend.request" : "You don’t have any friend requests",
"$you.dont.have" : "You don’t have any mutual friends",
"$more.friend.request" : "More friend request",
"$invite.friends.to" : "Invite friends to CIAYO",
"$invite.friends.by" : "Invite Friends by Email",
"$invite.from.facebook" : "Invite from Facebook",
"$invite.from.gmail" : "Invite from Gmail Account",
"$use.comma.(,)" : "Use comma (,) to separate different email",
"$send.invitation" : "Send Invitation",
"$invite.from.gmail" : "Invite from Gmail accounts",
"$load.email" : "Load Email",
"$share.to.facebook" : "Share to Facebook",
"$share" : "Share",
"$search.gmail.account" : "Search Gmail Account",


/* friend-request-all */

"$friend.requests" : "Friend Requests",
"$response.to.your" : "Respond to friend request",

/* forgot-password */

"$forgot.your.password?" : "Forgot your password? Put your email address below!",
"$email" : "EMAIL",
"$phone" : "PHONE",

/* forgot-password-success */

"$your.reset.password" : "Your reset password email has been sent!",
"$please.check.your" : "Please check your email. Still can’t find it?",
"$click.here" : "click here",
"$to.resend.the" : "to resend the email",

/* edit avatar */

"$save" : "SAVE",
"$add" : "ADD",
"$edit.avatar" : "Edit Avatar",

/* create-avatar */

"$loading.." : "LOADING...",

/* achievement */

"$achievement" : "Achievement",
"$search.achievement" : "Search Achievement",
"$sort.by" : "Sort By",
"$ongoing" : "Ongoing",
"$completed" : "Completed",
"$use.as.title" : "Use as title",
"$reward:" : "Reward:",
"$share.this.achievement" : "Share this achievement",
"$achievement.detail" : "Achievement Detail",
"$sticker:" : "Sticker:",

/* achievement-search */

"$highest.to.lowest" : "Highest to lowest",
"$lowest.to.high" : "Lowest to High",
"$search.achievements" : "Search Achievements",

/* achievement-controller.js */
"$ascending(a-z)" : "Ascending (A-Z)",
"$descending(z-a)" : "Descending (Z-A)",

/* about */

"$about.us" : "About Us",
"$privacy.&.policy" : "Privacy & Policy",
"$terms.and.conditions" : "Terms and Conditions",
"$faq" : "FAQ",

/* directive */
/* trending-navbar */

"$place" : "Place",

/* timeline */

"$search.activity" : "Search Activity, Item or Places",
"$post" : "POST",
"$post.activity" : "Post Activity",
"$show.to:" : "Show to:",
"$caption" : "Caption",
"$item" : "Item",
"$with" : "with",
"$delete.all.items" : "Delete all items ?",
"$yes" : "YES",
"$no" : "NO",
"$with" : "With",
"$i'm.alone" : "I'm <br>alone",
"$this.location.is" : "This location is not available on map",
"$who.are.you.with" : "who <br>are you <br>with?",
"$where.are.you?" : "where <br>are you?",
"$it's.secret" : "It's<br>Secret",
"$be.first.cimote" : "Be the first to CIMOTE this!",
"$people.give.cimotion" : "people give CIMOTION",
"$load.more" : "load more",
"$comments .." : "comments...",
"$be.first.to.comment" : "Be the first to comment",
"$edit" : "edit",
"$delete" : "delete",
"$reply.comment" : "Reply Comment",
"$send" : "Send",
"$share.this.post" : "Share this post",
"$copy.this.post's.link" : "Copy this post’s link",
"$view.all" : "view all",
"$shares .." : "shares ..",
"$download.activity" : "Download Activity",
"$show.to:" : "Show to:",
"$turn.off.notifications" : "Turn Off Notifications",
"$turn.on.notifications" : "Turn On Notifications",
"$edit.caption" : "Edit Caption",
"$edit.with" : "Edit With",
"$delete.post" : "Delete Post",
"$view.profile" : "View profile",
"$view.post" : "View Post",
"$sticker" : "Sticker",
"$emoji" : "Emoji",
"$shop" : "Shop",

/* card */

"$write.comment" : "Write a comment",
"$read.all" : "Read all",

/* modal-confirm */

"$cancel" : "Cancel",

/* friend-connection */

"$following" : "Following",
"$unfollow" : "Unfollow",
"$follow" : "Follow",
"$followers" : "followers",
"$add.friend" : "Add friend",
"$response" : "Response",
"$friend" : "Friend",

/* util.js */

"$year" : "year",
"$month" : "month",
"$day" : "day",
"$hour" : "hour",
"$minute" : "minute",
"$second" : "second",
"$ago" : "ago",
"$just.now" : "just now",

/* drawer-factories */
/* card-with-drawer.js */

"$tag.people" : "Tag people",

/* card-place-drawer.js */

"$add.a.place" : "Add a Place",
"$edit.a.place" : "Edit a Place",

/* card-item-drawer.js */

"$add.item" : "Add Item",
"$edit.item" : "Edit Item",

/* card-comment-reply-drawer.js */

"$reply.comment" : "Reply Comment",

/* card-comment-edit-drawer.js */

"$edit.comment" : "Edit Comment",

/* card-caption-drawer.js */

"$add.a.caption" : "Add a Caption",
"$edit.caption" : "Edit Caption",

/* card-factory.js */
"$ask" : "ask ",
"$ask.with" : " about the people is with on this activity?",
"$ask.place" : " about the where abouts of this activity?",

/* card-response-place */
"$asking.place" : "asked about your location on this activity?",

/* card-response-with */
"$asking.with" : "asked about who you are with on this activity?",

/* card-response-place.js */
"$response.to.question" : "Response to a question",

/* calendar-drawer.js */

"$pick.a.date" : "Pick a date",

/* drawer-factories */ /* views */

/* search-friend.html */

"$search.friends" : "Search friends",
"$all.friends" : "All friends",
"$mutual" : "Mutual",

/* mutual-friend.html */

"$has.become.your.friend" : "has become your friend",
"$request.declined" : "Request declined",

/* card-with.html */

"$add.a.friends" : "Add a friends",

/* card-response-with.html */

"$ssh.it's.secret" : "Ssh . . . It’s a secret",
"$i'm.alone" : "I'm alone",

/* card-item.html */

"$replace" : "Replace",
"$delete" : "Delete",
"$add.an.item" : "Add an item",
"$max" : "max",
"$items" : "Items",
"$clear.all" : "Clear all",

"only me" : "Only me",
"public" : "Public",
"family" : "Family",
"friend" : "Friend",
"$new" : "new",
"$fb.error" : "Facebook share is currently unavailable, please contact your network provider or try again later."

};
var ID = {
/*GLOBAL */
"$not.found" : "Hasil pencarian tidak ditemukan, coba lagi ya :)",
/* wizzard-your-avatar */

"$you.look.awesome!" : "Kamu terlihat keren!",
"$with.your.new" : "Dengan tampilan barumu, kamu siap bergabung di kesenangan dunia CIAYO.",
"$download.avatar" : "Download Avatar",
"$next" : "Lanjut",

/* wizzard-mascot */

"$back" : "KEMBALI",
"$select.your.mascot" : "PILIH MASCOT",
"$the.navajo.indians" : "The Navajo Indians have their spirit animals, but here in the CIAYO World, we have our mascots. Pick one to accompany you along the way!",

/* wizzard-hello */

"$ciayo.friends.welcome" : "CIAYO Friends, <br/> Selamat datang di CIAYO World!",
"$type.your.username" : "Isi nama kamu",

/* wizzard-gender */

"$select.your.gender" : "Pilih Kamu yang mana",
"$male" : "Laki-laki",
"$female" : "Perempuan",

/* wizzard-create-avatar */

"$skip" : "LEWATI",
"$create.your.avatar" : "BIKIN AVATAR KAMU",

/* wizzard-born */

"$when.were.you" : "KAPAN KAMU LAHIR?",
"$date.of.birth" : "Tanggal Lahir",

/* welcome */

"$tap.to.register" : "Tap untuk mendaftar",
"$create.an.account" : "Buat akun CIAYO baru dan mulai bereksplorasi",
"$register" : "Daftar",
"$term.policy" : "Dengan mengeklik Mendaftar, Kamu telah setuju dengan <a href=\"{{terms}}\">Persyaratan</a> kami, dan berarti kamu telah membaca <a href=\"{{data_policy}}\">Kebijakan Data</a> kami",
"$tap.to.login" : "Tap untuk login",
"$login.to.your" : "Masuk ke akun CIAYO kamu",
"$login" : "Login",
"$forgot.password?" : "Lupa password?",
"$password" : "Password",

/* trending */

"$trending" : "Trending",
"$posts" : "Posts",
"$people" : "Orang",
"$activity" : "Activity",

/* trending-place */

"$trending.place.not" : "Trending place tidak ditemukan",

/* trending-people */

"$trending.people.not" : "Trending people tidak ditemukan",

/* trending-activity */

"$trending.activity.not" : "Trending activity tidak ditemukan",
"$posted" : "Diposting",
"$visited" : "Dikunjungi ",
"$times" : "kali",

/* store */

"$open.your.inventory" : "Open your inventory and manage your knik-knacks!",
"$go.to.inventory" : "Pergi ke inventory",
"$home" : "Beranda",
"$premium" : "Premium",
"$contributor" : "Kontributor",
"$free" : "Gratis",
"$all" : "Semua",
"$buy.this.sticker" : "Beli Sticker",
"$most.popular" : "Paling Populer",
"$see.all" : "Lihat Semua",
"$premium.new" : "Koleksi Premium Baru",
"$premium.newest" : "Premium Terbaru",
"$contributor.new" : "Koleksi Kontributor Baru",
"$free.new" : "Koleksi Gratis",
"$most.popular.premium" : "Paling populer premium",
"$premium.category" : "Kategori Premium",
"$emoji" : "Emoji",
"$most.popular.contributor" : "Paling populer kontributor",
"$contributor.category" : "Kategori Kontributor",
"$contributor.stickers" : "Kontributor Stiker",
"$view.more." : "Lihat lainnya...",
"$search" : "Cari",
"$search.result.for:" : "Cari hasil untuk: ",
"$buy" : "Beli",
"$category" : "Kategori",
"$my.account:" : "Akun saya:",
"$purchased" : "Dibeli",
"$click.sticker.for" : "Klik Sticker kalau mau lihat",
"$search.sticker.or.emoji" : "Cari Sticker atau Emoji",
"$my.coin" : "Koin saya",

/* setting */

"$congratulations!" : "Yeay!",
"$your.account.has" : "Akun Kamu sudah siap. Saatnya kita main CIAYO!",
"$go.to.timeline" : "Ke Timeline",
"$edit.account" : "Edit Akun",
"$change.password" : "Ganti Kata Sandi",
"$general.settings" : "Pengaturan Umum",
"$logout" : "Logout",
"$email.address" : "Alamat Email",
"$verify.your.email" : "Verifikasi email",
"$phone.number" : "Nomor telepon",
"$verify.your.phone" : "Verifikasi nomor telepon",
"$notify.me.through" : "Tampilkan notifikasi ke email atau telepon saya jika ada yang login ke akun saya.",
"$deactive.account" : "Nonaktifkan Akun",
"$when.your.account" : "Ketika akun Kamu dinonaktifkan, orang-orang tidak bisa mengirim pesan, menemukan, dan tag kamu di CIAYO.",
"$delete.account" : "Hapus akun",
"$if.you.delete" : "Ketika akun Kamu dihapus, orang-orang tidak bisa mengirim pesan, menemukan, dan tag kamu di CIAYO.",
"$are.you.sure.deactive" : "Yakin nih, mau menonaktifkan akun?",
"$are.you.sure.logout" : "Kamu yakin mau logout?",
"$are.you.sure.delete" : "Yakin nih, mau menghapus akun?",
"$old.password" : "Kata sandi lama",
"$your.password.needs" : "Your password needs to : ",
"$must.be.at" : "Minimal 8 karakter",
"$must.not.contain" : "Tidak boleh memasukkan karakter ini <br/> ( \" , ', _ , & , ( , ) , < , > , space , / , \ )",
"$new.password" : "Kata sandi baru",
"$new.password.confirmation" : "Konfirmasi kata sandi baru",
"$your.password.do" : "Your password do not match with each other",
"$privacy.setting" : "Pengaturan Privasi",
"$timeline.access" : "Akses timeline",
"$default.post.setting" : "Default Post Setting",
"$who.can.find" : "Siapa yang bisa temukan saya",
"$who.can.add" : "Siapa yang dapat menambahkan saya?",
"$card.settings" : "Pengaturan Card",
"$parallax.timeline.view" : "Tampilan Parallax di Timeline",
"$parallax.allows.you" : "Parallax memungkinkan kamu untuk melihat gambar activity dalam perspektif seperti 3D",
"$notification.settings" : "Pengaturan Notifikasi",
"$connection.request" : "Permintaan teman",
"$comments" : "Komentar",
"$language.setting" : "Pengaturan Bahasa",
"$email.notifications" : "Notifikasi Email",
"$new.features" : "Fitur baru",
"$verify.later" : "Verifikasi nanti",
"$to.verify.your.email" : "Untuk verifikasi akun Kamu, silakan masukkan One-time PIN yang diterima melalui email yang sudah terdaftar: ",
"$to.verify.your.phone" : "Untuk verifikasi akun, silahkan masukan PIN yang telah dikirim via SMS pada nomor ponsel yang terdaftar : ",
"$resend" : "Kirim Ulang",
"$change.email" : "Ganti email",
"$change.mobile.number" : "Ganti nomor seluler",
"$change.phone.number" : "Ganti nomor seluler",
"$your.email.has" : "Email kamu telah diubah dari",
"$to" : "ke",
"$your.mobile.number" : "Nomor selular kamu telah diubah dari",
"$language.use.in.ciayo" : "Bahasa apa yang mau Kamu gunakan di CIAYO?",

/* search */

"$view.more" : "Lihat lainnya",
"$search.ciayo.friends" : "Cari CIAYO Friends",

/* reset-password */

"$create.a.new" : "Buat kata sandi baru",
"$submit" : "Submit",
"$your.new.password" : "Kata sandi baru",
"$confirm.new.password" : "Konfirmasi kata sandi baru",

/* profile */

"$view.profile" : "lihat profile",
"$add.friend" : "tambah teman",
"$follow" : "follow",
"$full.name" : "Nama Lengkap",
"$place,.date.of" : "Tempat, Tanggal Lahir",
"$nationality" : "Kebangsaan",
"$no.badge.collections" : "Tidak punya koleksi badge",
"$welcome.to.ciayo" : "Selamat datang di CIAYO",
"$no.achievement.collections" : "Tidak punya koleksi achievement",
"$website" : "Situs web",
"$my.social.media" : "Sosial media saya",
"$view.more" : "lihat lainnya",
"$badges" : "Badges",
"$no.badges.here" : "Tidak punya koleksi badge",
"$no.social.network" : "Tidak ada sosial media",
"$no.website" : "Tidak ada situs web",
"$edit.profile" : "Edit Profil",
"$username" : "username",
"$title" : "titel",
"$basic.info" : "Info dasar",
"$place.of.birth" : "Tempat Lahir",
"$add.badges.&" : "Badge & Achievement",
"$badge.collections" : "koleksi badge",
"$website" : "Situs web",
"$add.a.website" : "Tambahkan situs web / blog",
"$add.social.media" : "Tambahkan akun",
"$more.social.media" : "sosial media lainnya...",
"$no.title" : "no title",
"$first.name" : "Nama depan",
"$middle.name" : "Nama tengah",
"$last.name" : "Nama belakang",
"$optional" : "Optional",
"$search.badges" : "Cari Badges",
"$your.website.address" : "Situs web kamu",
"$request.sent" : "Permintaan terkirim",
"$ask.for" : "Tanyakan",
"$place.date.birthday" : "tempat dan tanggal lahir",
"$let" : "Beri tahu",
"$ask.birthday" : "kenapa kamu menanyakan tempat dan tanggal lahirnya",
"$ask.email" : "kenapa kamu menanyakan alamat emailnya",
"$ask.phone" : "kenapa kamu menanyakan nomor teleponnya",
"$send.request" : "Kirim Permintaan",

/* profile-connection */

"$profile" : "Profil",
"$overview" : "overview",
"$timeline" : "timeline",
"$connection" : "koneksi",
"$all.friends" : "SEMUA TEMAN",
"$mutual" : "MUTUAL",

/* notification */

"$notifications" : "Notifikasi",
"$you.have.no.notification" : "Maaf, Kamu tidak memiliki notifikasi",

/* mutual-friend */

"$mutual.friends" : "Teman yang sama",
"$has.become.your" : "telah menjadi teman kamu",
"$request.declined" : "Request declined",
"$view.profile" : "Lihat Profil",
"$decline" : "Decline",

/* menu */

"$my.profile" : "Profil saya",
"$store" : "Store",
"$achievements" : "Achievements",
"$about.ciayo" : "Tentang CIAYO",
"$settings" : "Pengaturan",
"$updates" : "Updates",

/* inventory-sticker */

"$done" : "SELESAI",
"$delete" : "Hapus",

/* inventory-home */

"$go.to.store" : "Pergi ke Store",
"$my.sticker" : "Stiker saya",
"$my.emoji" : "Emoji saya",
"$sort" : "URUTKAN",

/* inventory-history */

"$purchase.history" : "Riwayat Pembelian",
"$start.date" : "Tanggal mulai",
"$end.date" : "Tanggal berakhir",
"$start" : "Mulai",
"$end" : "Berakhir",

/* friend-request */

"$you.have.no.friend.request" : "Maaf, Kamu tidak memiliki permintaan teman",
"$you.dont.have" : "Kamu tidak memiliki teman yang sama",
"$more.friend.request" : "Permintaan teman lainnya",
"$invite.friends.to" : "Undang teman ke CIAYO",
"$invite.friends.by" : "Undang teman lewat Email",
"$invite.from.facebook" : "Undang teman dari Facebook",
"$invite.from.gmail" : "Undang teman dari akun Gmail",
"$use.comma.(,)" : "Use comma (,) to separate different email",
"$send.invitation" : "Kirim undangan",
"$load.email" : "Load Email",
"$share.to.facebook" : "Bagikan ke Facebook",
"$share" : "Bagikan",
"$search.gmail.account" : "Cari akun Gmail",


/* friend-request-all */

"$friend.requests" : "Permintaan teman",
"$response.to.your" : "Terima permintaan teman",

/* forgot-password */

"$forgot.your.password?" : "Forgot your password? Put your email address below!",
"$email" : "EMAIL",
"$phone" : "PHONE",

/* forgot-password-success */

"$your.reset.password" : "Your reset password email has been sent!",
"$please.check.your" : "Please check your email. Still can’t find it?",
"$click.here" : "click here",
"$to.resend.the" : "to resend the email",

/* edit avatar */

"$save" : "SIMPAN",
"$add" : "TAMBAH",
"$edit.avatar" : "Edit Avatar",

/* create-avatar */

"$loading.." : "LOADING...",

/* achievement */

"$achievement" : "Achievement",
"$search.achievement" : "Cari Achievement",
"$sort.by" : "Urutkan",
"$ongoing" : "Berlangsung",
"$completed" : "Lengkap",
"$use.as.title" : "Gunakan sebagai title",
"$reward:" : "Hadiah:",
"$share.this.achievement" : "Bagikan Achievement ini",
"$achievement.detail" : "Detail Achievement",
"$sticker:" : "Stiker:",

/* achievement-search */

"$highest.to.lowest" : "Tertinggi ke Terendah",
"$lowest.to.high" : "Terendah ke Tertinggi",
"$search.achievements" : "Cari Achievements",

/* achievement-controller.js */
"$ascending(a-z)" : "Diurutkan (A - Z)",
"$descending(z-a)" : "Diurutkan (Z - A)",

/* about */

"$about.us" : "Tentang kami",
"$privacy.&.policy" : "Kebijakan Kerahasiaan",
"$terms.and.conditions" : "Ketentuan dan Kondisi",
"$faq" : "FAQ",

/* directive */
/* trending-navbar */

"$place" : "Tempat",

/* timeline */

"$search.activity" : "Cari Activity, Item atau Places",
"$post" : "POST",
"$post.activity" : "Post Activity",
"$show.to:" : "Yang bisa lihat:",
"$caption" : "Caption",
"$item" : "Item",
"$with" : "dengan",
"$delete.all.items" : "Hapus semua item ?",
"$yes" : "YA",
"$no" : "TIDAK",
"$with" : "Dengan",
"$i'm.alone" : "Sendiri",
"$this.location.is" : "This location is not available on map",
"$who.are.you.with" : "dengan <br>siapa <br>kamu?",
"$where.are.you?" : "dimana <br>kamu?",
"$it's.secret" : "Rahasia",
"$be.first.cimote" : "Jadi yang pertama kasih CIMOTE",
"$people.give.cimotion" : "orang kasih CIMOTIONS",
"$load.more" : "lihat lagi",
"$comments .." : "komentar...",
"$be.first.to.comment" : "Jadi yang pertama kasih komen",
"$edit" : "edit",
"$delete" : "hapus",
"$reply.comment" : "Komen balasan",
"$send" : "Kirim",
"$share.this.post" : "Bagikan posting ini",
"$copy.this.post's.link" : "Salin link post",
"$view.all" : "lihat semua",
"$shares .." : "bagikan ..",
"$download.activity" : "Download Activity",
"$turn.off.notifications" : "Matikan notifikasi",
"$turn.on.notifications" : "Hidupkan notifikasi",
"$edit.caption" : "Edit Caption",
"$edit.with" : "Edit With",
"$delete.post" : "Hapus Post",
"$view.profile" : "Lihat profil",
"$view.post" : "Lihat Post",
"$sticker" : "Stiker",
"$emoji" : "Emoji",
"$shop" : "Shop",

/* card */

"$write.comment" : "Tulis komen",
"$read.all" : "Baca semua",

/* modal-confirm */

"$cancel" : "Batal",

/* friend-connection */

"$following" : "Mengikuti",
"$unfollow" : "Tidak Mengikuti",
"$follow" : "Ikuti",
"$followers" : "Pengikut",
"$add.friend" : "Tambah teman",
"$response" : "Terima Permintaan",
"$friend" : "Teman",

/* util.js */

"$year" : "tahun",
"$month" : "bulan",
"$day" : "hari",
"$hour" : "jam",
"$minute" : "menit",
"$second" : "detik",
"$ago" : "yang lalu",
"$just.now" : "baru saja",

/* drawer-factories */
/* card-with-drawer.js */

"$tag.people" : "Tag seseorang",

/* card-place-drawer.js */

"$add.a.place" : "Tambahkan Place",
"$edit.a.place" : "Edit Place",

/* card-item-drawer.js */

"$add.item" : "Tambahkan Item",
"$edit.item" : "Edit Item",

/* card-comment-reply-drawer.js */

"$reply.comment" : "Komen balasan",

/* card-comment-edit-drawer.js */

"$edit.comment" : "Edit Comment",

/* card-caption-drawer.js */

"$add.a.caption" : "Tambahkan Caption",
"$edit.caption" : "Edit Caption",

/* card-factory.js */
"$ask" : "tanya ",
"$ask.with" : " dengan siapa di activity ini?",
"$ask.place" : " dimana di activity ini?",

/* card-response-place */
"$asking.place" : "bertanya dimana kamu di activity ini?",

/* card-response-with */
"$asking.with" : "bertanya dengan siapa kamu di activity ini?",

/* card-response-place.js */
"$response.to.question" : "Tanggapi pertanyaan",

/* calendar-drawer.js */

"$pick.a.date" : "Pilih tanggal",

/* drawer-factories */ /* views */

/* search-friend.html */

"$search.friends" : "Cari teman",
"$all.friends" : "Semua teman",
"$mutual" : "Mutual",

/* mutual-friend.html */

"$has.become.your.friend" : "telah menjadi teman kamu",
"$request.declined" : "Permintan ditolak",

/* card-with.html */

"$add.a.friends" : "Tambahkan teman",

/* card-response-with.html */

"$ssh.it's.secret" : "Ssh . . . rahasia",
"$i'm.alone" : "Sendiri",

/* card-item.html */

"$replace" : "Ganti",
"$delete" : "Hapus",
"$add.an.item" : "Tambahkan item",
"$max" : "maks",
"$items" : "Item",
"$clear.all" : "Hapus semua",

"only me" : "Hanya Saya",
"public" : "Publik",
"family" : "Keluarga",
"friend" : "Teman",
"$new" : "baru",
"$fb.error" : "Facebook share saat ini tidak dapat diakses, silahkan hubungi penyedia layanan jaringan anda atau cobalah beberapa saat lagi."

};
(function() {
	'use strict';	

	angular.module('app', [
		//Angular
		'ui.router','ngCookies','ngSanitize','pascalprecht.translate','angulartics','angulartics.google.analytics',
		//Kelompokkan module per kategori ya
		//DIRECTIVE GLOBAL
		'CiayoNavbar','CiayoModal','CiayoUtil', 'TrendingNavbar','CiayoDrawer',
		//DIRECTIVE PARTIAL
		'CiayoTimeline','CiayoCard', 'CiayoFriendConnection','btford.socket-io'
	])
	.config(config)
	.run(run);
	
	config.$inject = ['$stateProvider','$urlRouterProvider','$locationProvider','$translateProvider','$cookiesProvider'];
	function config($stateProvider, $urlRouterProvider, $locationProvider, $translateProvider, $cookiesProvider){
		if(!$cookiesProvider.defaults.expires){
			var date = new Date();
			date.setDate(date.getDate() + 7);
			$cookiesProvider.defaults.expires = date;
		}

		$locationProvider.html5Mode(!DEVELOPMENT);
		// Translate
		$translateProvider.translations('en', EN)
		$translateProvider.translations('id', ID)
		$translateProvider.useSanitizeValueStrategy('escapeParameters')
		$translateProvider.preferredLanguage('id');
		// Remove Hashtag
		// $locationProvider.html5Mode(true);
		// Default Route
		$urlRouterProvider.when('', '/', ['$state', function($state){
			$state.go('/');
		}]);
		// Redirect to 404
		$urlRouterProvider.otherwise("/404");
		// Set Routing
		$stateProvider
			.state('404', {
				url: '/404',
				template: '<h1 style="text-align: center">404 Page not Found</h1>'
			})
			.state('/', {
				url: '/',
				templateUrl: 'timeline.html',
				authenticate: true
			})
			.state('timeline', {
				url: '/timeline',
				templateUrl: 'timeline.html',
				controller: 'TimelineController',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('detail-page', {
				url: '/detail-page/:post_code',
				templateUrl: 'detail-page.html',
				controller: 'DetailPageController',
				controllerAs: 'vm',
				authenticate: false
			})
			.state('welcome', {
				url: '/welcome',
				templateUrl: 'welcome.html',
				controller: 'WelcomeController',
				controllerAs: 'vm',
				authenticate: false
			})
			.state('popcon', {
				url: '/popcon',
				templateUrl: 'welcome.html',
				controller: 'WelcomeController',
				controllerAs: 'vm',
				authenticate: false
			})
			.state('forgot-password', {
				url: '/forgot-password',
				templateUrl: 'forgot-password.html',
				controller: 'WelcomeController',
				controllerAs: 'vm',
				authenticate: false
			})
			.state('forgot-password-success', {
				url: '/forgot-password',
				templateUrl: 'forgot-password-success.html',
				controller: 'WelcomeController',
				controllerAs: 'vm',
				authenticate: false
			})
			.state('reset-password', {
				url: '/reset-password/:token',
				templateUrl: 'reset-password.html',
				controller: 'WelcomeController',
				controllerAs: 'vm',
				authenticate: false
			})
			.state('create-avatar', {
				abstract: true,
				url: '/create-avatar',
				templateUrl: 'create-avatar.html',
				controller: 'CreateAvatarController',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('create-avatar.gender', {
				url: '',
				templateUrl: 'wizzard-gender.html',
				authenticate: true
			})
			.state('create-avatar.name', {
				url: '',
				templateUrl: 'wizzard-hello.html',
				authenticate: true
			})
			.state('create-avatar.born', {
				url: '',
				templateUrl: 'wizzard-born.html',
				authenticate: true
			})
			.state('create-avatar.avatar', {
				url: '',
				templateUrl: 'wizzard-create-avatar.html',
				authenticate: true
			})
			.state('create-avatar.mascot', {
				url: '',
				templateUrl: 'wizzard-mascot.html',
				authenticate: true
			})
			.state('download-avatar', {
				url: '/download-avatar',
				templateUrl: 'download-avatar.html',
				controller: 'DownloadAvatarController',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('sample',{
				url:'/sample',
				templateUrl:'sample.html',
				controller:'SampleController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('search',{
				url:'/search',
				templateUrl:'search.html',
				controller:'SearchController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('friend-request',{
				url:'/friend-request',
				templateUrl:'friend-request.html',
				controller:'FriendRequestController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('friend-request-all',{
				url:'/friend-request-all',
				templateUrl:'friend-request-all.html',
				controller:'FriendRequestAllController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('notification',{
				url:'/notification',
				templateUrl:'notification.html',
				controller:'NotificationController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('menu',{
				url:'/menu',
				templateUrl:'menu.html',
				controller:'MenuController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('trending',{
				url:'/trending',
				templateUrl:'trending.html',
				controller:'TrendingController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('trending-people',{
				url:'/trending-people',
				templateUrl:'trending-people.html',
				controller:'TrendingPeopleController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('trending-activity',{
				url:'/trending-activity',
				templateUrl:'trending-activity.html',
				controller:'TrendingActivityController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('trending-place',{
				url:'/trending-place',
				templateUrl:'trending-place.html',
				controller:'TrendingPlaceController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('edit-avatar',{
				url:'/edit-avatar',
				templateUrl:'edit-avatar.html',
				controller: 'EditAvatar',
				controllerAs:'vm',
				authenticate: true
			})
			.state('profile',{
				url:'/profile/:username',
				templateUrl:'profile.html',
				controller:'ProfileController',
				controllerAs:'vm',
				authenticate: true,
			})
			.state('profile-connection',{
				url:'/profile-connection/:username',
				templateUrl:'profile-connection.html',
				controller:'ProfileConnectionController',
				controllerAs:'vm',
				authenticate: true,
			})
			.state('achievement',{
				url:'/achievement',
				templateUrl:'achievement.html',
				controller:'AchievementController',
				controllerAs:'vm',
				authenticate: true,
			})
			.state('mutual-friend', {
				url: '/mutual-friend/',
				params: {
						user_id: null,
						username: null,
						hiddenParam: 'YES'
				},
				templateUrl: 'mutual-friend.html',
				controller: 'MutualFriendController',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('store',{
				abstract: true,
				url:'/store',
				templateUrl:'store.html',
				controller: 'StoreController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('store.home', {
				url: '',
				templateUrl: 'store.home.html',
				authenticate: true
			})
			.state('store.premium', {
				url: '/premium',
				templateUrl: 'store.premium.html',
				authenticate: true
			})
			.state('store.contributor', {
				url: '/contributor',
				templateUrl: 'store.contributor.html',
				authenticate: true
			})
			.state('store.free', {
				url: '/free',
				templateUrl: 'store.free.html',
				authenticate: true
			})
			.state('store.all', {
				url: '/all',
				templateUrl: 'store.all.html',
				authenticate: true
			})
			.state('store.emoji', {
				url: '/emoji',
				templateUrl: 'store.emoji.html',
				authenticate: true
			})
			.state('inventory',{
				abstract: true,
				url:'/inventory',
				templateUrl:'inventory.html',
				controller:'InventoryController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('inventory.home', {
				url: '',
				templateUrl: 'inventory-home.html',
				authenticate: true
			})
			.state('inventory.sticker', {
				url: '/sticker',
				templateUrl: 'inventory-sticker.html',
				authenticate: true
			})
			.state('inventory.emoji', {
				url: '/emoji',
				templateUrl: 'inventory-emoji.html',
				authenticate: true
			})
			.state('inventory.history', {
				url: '/history',
				templateUrl: 'inventory-history.html',
				authenticate: true
			})
			.state('setting',{
				url:'/setting',
				templateUrl:'setting.html',
				controller: 'SettingController',
				controllerAs:'vm',
				authenticate: true
			})
			.state('about',{
				url:'/about',
				templateUrl:'about.html',
				controller: 'AboutController',
				controllerAs:'vm',
				authenticate: false
			})
			.state('delete-account', {
				url: '/account/:menu/:token',
				templateUrl: 'setting.html',
				controller: 'SettingController',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('result-invite-gmail', {
				url: '/result-invite-gmail',
				templateUrl: 'result-invite-gmail.html',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('invite-gmail', {
				url: '/invite-gmail',
				templateUrl: 'invite-gmail.html',
				controllerAs: 'vm',
				authenticate: true
			})
			.state('update', {
				url: '/update',
				templateUrl: 'update.html',
				controller: 'UpdateController',
				controllerAs: 'vm',
				authenticate: true
			})
			// .state('ciayo', {
			// 	url: '/:ciayo',
			// 	template: '<h1>404 Page not Found</h1>'
			// })
			// .state('profile-public', {
			// 	url: '/:username',
			// 	templateUrl: 'profile.html',
			// 	controller: 'ProfileController',
			// 	controllerAs: 'vm',
			// 	authenticate: true
			// })
			.state('profile-public', {
				url: '/:username',
				templateUrl: 'profile-template.html',
				controllerProvider: function (AuthService) {

					var ctrl = '';
					if (AuthService.IsAuth()) {
						ctrl = "ProfileController";
					} else {
						ctrl = "ProfilePublicController";
					}
					return ctrl;

				},
				controllerAs: 'vm',
				authenticate: false
			});
		;
	}

	run.$inject = ['$rootScope', '$state', '$cookieStore', 'AuthService', 'languageFactory'];
	function run($rootScope, $state, $cookieStore, AuthService, languageFactory) {
		// Validate Login & Authentication User
		$rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams){
			$("html, body").removeAttr("style");
			$(window).scrollTop(0);
			if(toParams.username == 'index.html'){
				window.location = '/';
			}
			if(toState.authenticate) {
				if(!AuthService.IsAuth()){
					$state.transitionTo('welcome');
					event.preventDefault();
				}

				if(!$cookieStore.get('profile') && !(toState.name == 'create-avatar.name' || toState.name == 'create-avatar.born' || toState.name == 'create-avatar.gender' || toState.name == 'create-avatar.avatar' || toState.name == 'create-avatar.download' || toState.name == 'create-avatar.mascot' || toState.name == 'download-avatar' || toState.name == 'welcome')){
					$state.transitionTo('create-avatar.name');
					event.preventDefault();
				}
			}
				languageFactory.getLanguage();
				// DI BAWAH INI NANTI DIATURNYA
				// if(!$cookieStore.get('profile') && !(toState.name == 'create-avatar' || toState.name == 'download-avatar' || toState.name == 'welcome')){
				// 	$state.transitionTo('create-avatar');
				// 	event.preventDefault();
				// }
			// }
		});
	}
})();;
const cCardParallaxComponent = React.createClass({
	displayName: 'cCardParallaxComponent',

	max_degree: 4,
	handleOrientation: function (event) {
		var x = event.beta,
		    y = event.gamma,
		    batas = [20, 25, 65],
		    orientation = window.orientation,
		    //1^,2<,3|,4>
		diffx = 0,
		    diffy = 0;
		if (orientation === 0) {
			//0 normal [20 50][-15 15]
			x = x < batas[1] ? batas[1] : x;
			x = x > batas[2] ? batas[2] : x;
			y = y < -batas[0] ? -batas[0] : y;
			y = y > batas[0] ? batas[0] : y;
			diffx = x - batas[2] + (batas[2] - batas[1]) / 2;diffy = y;
		} else if (orientation === 90) {
			//90 miring ke kiri [-15 15] [-50 -20]
			x = x < -batas[0] ? -batas[0] : x;
			x = x > batas[0] ? batas[0] : x;
			y = y < -batas[2] ? -batas[2] : y;
			y = y > -batas[1] ? -batas[1] : y;
			diffy = x;diffx = (y + ((batas[2] - batas[1]) / 2 + batas[1])) * -1;
		} else if (orientation === 180) {
			//180 dibalik [-50 -20] [15 -15]
			x = x < -batas[2] ? -batas[2] : x;
			x = x > -batas[1] ? -batas[1] : x;
			y = y < -batas[0] ? -batas[0] : y;
			y = y > batas[0] ? batas[0] : y;
			diffx = (x + ((batas[2] - batas[1]) / 2 + batas[1])) * -1;diffy = -y;
		} else if (orientation === -90) {
			//-90 kanan [15 -15] [20 50]
			x = x < -batas[0] ? -batas[0] : x;
			x = x > batas[0] ? batas[0] : x;
			y = y < batas[1] ? batas[1] : y;
			y = y > batas[2] ? batas[2] : y;
			diffy = -x;diffx = y - ((batas[2] - batas[1]) / 2 + batas[1]);
		}
		this.setState({
			pos: {
				x: diffy / 40 + 0.5,
				y: diffx / 40 + 0.5
			}
		});
	},
	propTypes: {},
	mixins: [],
	getInitialState: function () {
		return {
			pos: { x: 0, y: 0 }
		};
	},
	getDefaultProps: function () {},
	componentDidMount: function () {
		window.addEventListener('deviceorientation', this.handleOrientation);
	},
	render: function () {
		var me = this;
		var parallax = me.props.parallax;
		var _html = React.createElement(
			'div',
			{ style: { 'padding-top': '36%', 'overflow': 'hidden' } },
			React.createElement(
				'div',
				{ className: 'loader' },
				' '
			),
			React.createElement('img', { src: 'assets/img/timeline/card-template.png', className: 'parallax-dummy' })
		);
		if (parallax != undefined && parallax.loaded) {
			var wrapper_class = {};
			if (parallax.parallax_setting == true) {
				wrapper_class = {
					'transform': 'rotateX(' + this.state.pos.y * this.max_degree + 'deg) rotateY(' + this.state.pos.x * this.max_degree + 'deg)',
					'-webkit-transform': 'rotateX(' + this.state.pos.y * this.max_degree + 'deg) rotateY(' + this.state.pos.x * this.max_degree + 'deg)',
					'-moz-transform': 'rotateX(' + this.state.pos.y * this.max_degree + 'deg) rotateY(' + this.state.pos.x * this.max_degree + 'deg)'
				};
			}
			_html = null;
			_html = React.createElement(
				'div',
				{ className: 'parallax', ref: 'nv' },
				React.createElement(
					'div',
					{ className: 'parallax-wrapper', style: wrapper_class },
					parallax.layer_list.map(function (image) {
						var _return = React.createElement('div', {
							className: 'parallax-layer',
							style: {
								'background-image': 'url(' + image.url + ')',
								'transform': 'translate3d(-50%,-50%,' + image.z + 'px) scale(' + image.scale + ',' + image.scale + ') rotateZ(' + image.rotation + 'deg)',
								'top': image.y * 1.2 + 50 + '%', 'left': image.x * 1.2 + 50 + '%'
							}
						});
						return _return;
					}),
					React.createElement('img', { src: 'assets/img/timeline/card-template.png', className: 'parallax-dummy' })
				)
			);
		}
		return _html;
	}
});
;
(function() {
'use strict';

	angular
		.module('app')
		.service('AchievementService', AchievementService);

	AchievementService.$inject = ['CiayoService'];
	function AchievementService(CiayoService) {
		this.getData = getData;
		// this.getOnProgress = getOnProgress;
		// this.getCompleted = getCompleted;
		this.getDetail = getDetail;
		this.setTitle = setTitle;
		this.shareFB = shareFB;

		function getData(url, data, callback) {
			var c = {
				data: data
			}; 
			CiayoService.Api(url, c, function(response){
				callback(returnData(response));
			});
		}

		function getDetail(id, callback) {
			var c = {
				data: {
					"id_achievement": id
				}
			};

			CiayoService.Api('achievement/detail', c, function(response) {
				callback(returnData(response));
			});
		}

		function shareFB(token, uid, id_achievement, id, callback) {
			var c = {
				data: {
					'access_token': token,
					'uid':uid,
					'id_achievement':id_achievement,
					'id':id
				}
			};
			CiayoService.Api('facebook/share/achievement', c, function (response) {
				callback(returnData(response));
			});
		}

		function setTitle(title, callback) {
			var c = {
				data: {
					updated_filter: [
						{
							filter_id: 520,
							filter_value: title
						}
					],
					type: 2
				}
			}

			CiayoService.Api('users/filter/update',c,function(response){
				callback(returnData(response));
			});
		} 

		function returnData(response) {
			if(response.status == 200) {
				var data = response.data.c.data;
			} else {
				var data = {
					error: true,
					error_code: response.status,
					message: response.statusText
				};
			}
			return data;
		}
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('AuthInterceptor', AuthInterceptor);

	AuthInterceptor.$inject = ['$q', '$location'];
	function AuthInterceptor($q, $location) {
		return {
			request: function(config) {
				//console.log(config);
				var token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI0MjMiLCJpc3MiOiJodHRwOlwvXC9hcGkuY2lheW8uZGNjXC9sb2dpbiIsImlhdCI6MTQ2MTU1OTYxOSwiZXhwIjoxNDYyMTY0NDE5LCJuYmYiOjE0NjE1NTk2MTksImp0aSI6ImE3NDliYzQyMGJiZjA2M2I5ZTZlMjE3OWNkZmYxYjQ2In0.cRfXTTipBl76kJPAu0UQ1uO5TKQo8WSVpXTLoWOez08';
				config.headers = config.headers || {};
				config.headers.Authorization = 'Bearer '+token;
				//config.headers['Content-Type'] = 'application/x-www-form-urlencoded';
				return config;
			},
			responseError: function(response) {
				if(response.status === 401) {
					// redirect to some page
					// remove any stale tokens
					return $q.reject(response);
				} else {
					return $q.reject(response);
				}
			}
		};
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('AuthService', AuthService);

	AuthService.$inject = ['$http', '$cookieStore', '$rootScope', 'CiayoService','welcomeConnector', '$q'];
	function AuthService($http, $cookieStore, $rootScope, CiayoService, welcomeConnector, $q) {
		var service = {
			Register:Register,
			Login:Login,
			ForgotPassword:ForgotPassword,
			Logout:Logout,
			IsAuth:IsAuth,
			finishProfile:finishProfile
		};
		
		return service;

		////////////////
		
		// Fungsi untuk register
		function Register(type, email, phone, pass, info, ref) {
			return welcomeConnector.register(type, email, phone, pass, info, ref).then(
				function(data){
					return data;
				}
			);
			// CiayoService.Api('register', c, function(response) {
			// 	var response = response.data.c;
			// 	// cek error yah
			// 	if(!response.data.error){
			// 		setAuth(response.token, response.data.content.user_id, '', '');
			// 		callback(response.data);
			// 	} else {
			// 		callback(response.data);
			// 	}
			// });
		}
		
		// Fungsi untuk login
		function Login(type, email, phone, pass) {
			return welcomeConnector.login(type, email, phone, pass).then(
				function(data){
					if(data.content){
						$cookieStore.put('gender', data.content.gender);
						$cookieStore.put('profile', data.content.profile_completed);
					}
					return data;
				}
			);
			// Send Req
			// CiayoService.Api('login', c, function(response) {
			// 	if(response.data) {
			// 		var response = response.data.c;
			// 		// cek error dulu disini
			// 		if(!response.data.error){
			// 			//console.log(response);
			// 			setAuth(response.token, response.data.content.user_id, response.data.content.gender, response.data.content.profile_completed);
			// 			callback(response.data);
			// 		} else {
			// 			callback(response.data);
			// 		}
			// 	} else {
			// 		callback(response);
			// 	}
			// });
		}

		function ForgotPassword(type, email, phone) {
			return welcomeConnector.forgotPassword(type, email, phone).then(
				function(data){
					return data;
				}
			);
		}
		
		// Fungsi untuk logout dan hapus cookie user
		function Logout() {
			var c = {
				data: ''
			};
			CiayoService.Api('logout', c, function(response) {
				var response = response.data.c;
				console.log(response);
			});
		}
		
		function finishProfile(){
			$cookieStore.put('profile', true);
		}
		// Fungsi untuk mengecek apakah user tsb sudah login apa belum
		function IsAuth() {
			if($cookieStore.get('token')){
				return true;
			} else {
				
			}
			return false;
		}
	}
	
})();;
(function() {
'use strict';

	angular
		.module('app')
		.service('AvatarService', AvatarService);

	AvatarService.$inject = ['CiayoService'];
	function AvatarService(CiayoService) {
		this.setGender = setGender;
		this.setName = setName;
		this.setAvatar = setAvatar;
		this.setMascot = setMascot;
		this.getAvatarDefault = getAvatarDefault;
		this.getAvatarInit = getAvatarInit;
		this.getAvatarUser = getAvatarUser;
		this.getMascot = getMascot;
		
		////////////////
		function setGender(gender, callback) {
			var c = {
				data: {
					filter_value: gender
				}
			};
			CiayoService.Api('users/filter/saveGender', c, function(response){
				callback(returnData(response));
			});
		}

		function setName(name, callback) {
			var c = {
				data: {
					screen_name: name
				}
			}
			CiayoService.Api('users/screen/name', c, function(response){
				callback(returnData(response));
			});
		}

		function setAvatar(bg, ava, callback) {
			CiayoService.Api(AVATAR_API_SERVER+'users/background', bg, function(response){
				if(response.status == 200){
					if(!response.data.c.data.error){
						CiayoService.Api(AVATAR_API_SERVER+'users/filter/update', ava, function(response){
							callback(returnData(response));
						}, true);
					} else {
							var data = {
								error: true,
								message: response.data.c.data.message
							};
					}
				} else {
					var data = {
						error: true,
						error_code: response.status,
						message: response.statusText
					};
					callback(data);
				}
			}, true);
		}

		function setMascot(id, callback) {
			var c = {
				data: {
					media_id_mascot: id
				}
			};
			CiayoService.Api('users/mascot', c, function(response){
				callback(returnData(response));
			});
		}

		function getAvatarInit(gender, callback) {
			var c = {
				data: {
					user_gender: gender
				}
			};
			CiayoService.Api(AVATAR_API_SERVER+'avatar/init', c, function(response){
				callback(returnData(response));
			}, true);
		}

		function getAvatarDefault(gender, callback) {
			var c = {
				data: {
					user_gender: gender
				}
			};
			CiayoService.Api(AVATAR_API_SERVER+'avatar/defaultAvatars', c, function(response){
				callback(returnData(response));
			}, true);
		}

		function getAvatarUser(callback) {
			var c = {
				data: {
					avatar_type: 'avatar_3'
				}
			};
			CiayoService.Api(AVATAR_API_SERVER+'users/download/avatar', c, function(response){
				callback(returnData(response));
			}, true);
		}

		function getMascot(callback) {
			var c = {
				data: ''
			};
			CiayoService.Api('mascot', c, function(response){
				callback(returnData(response));
			});
		}

		function returnData(response) {
			if(response.status == 200) {
				var data = response.data.c.data;
			} else {
				var data = {
					error: true,
					error_code: response.status,
					message: response.statusText
				};
			}
			return data;
		}
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('CiayoService', CiayoService);

	CiayoService.$inject = ['$http', '$cookieStore', '$state', '$q'];

	function CiayoService($http, $cookieStore, $state, $q) {

		//$http.defaults.useXDomain = true;
		// Setting CORS 
		//$http.defaults.useXDomain = true
		var service = {
			Api: Api,
			get: get
				// Socket:Socket
		};

		return service;

		////////////////

		// Fungsi untuk req ke API
		function Api(_url, c, callback, force_url) {
			// URL API

			//var url = 'http://api.ciayo.dcc/'+url;
			var url = API_SERVER + _url;
			if (force_url) {
				url = _url;
			}
			//var url = 'https://apibete.ciayo.com/'+url;
			//var url = 'http://192.168.35.245:8000/'+url;
			//			var url = 'http://192.168.35.56:8000/'+url;

			// C JSON Object
			if ($cookieStore.get('language')) {
				var lang = $cookieStore.get('language');
			} else {
				var lang = 2;
			}
			var c = c;
			angular.extend(c, {
				timestamp: Date.now(),
				app: SCREEN_TYPE,
				screen_type: SCREEN_TYPE,
				image_type: '',
				latitude: '-6.225652',
				longitude: '106.74576',
				language: lang
			});
			//c.timestamp = Date.now();
			//			c.app = 'Web';
			//			c.screen_type = 'Web';
			//			c.language = 1;
			//			c.image_type = '';
			//			c.latitude = '-6.225652';
			//			c.longitude = '106.74576';
			if (!Date.now) {
				Date.now = function () {
					return new Date().getTime();
				}
			}

			// Set Data
			var json = angular.toJson(c);
			json = encodeURIComponent(json);
			var data = 'c=' + json;

			// get token
			var token = $cookieStore.get('token') || '';
			var header = {};
			if (token) {
				header = {
					"Content-Type": "application/x-www-form-urlencoded",
					"Authorization": 'Bearer ' + token
				};
			} else {
				header = {
					"Content-Type": "application/x-www-form-urlencoded"
				};
			}
			var log_data = {
					url: url,
					request: data,
					response: {}
				}
				// Req with $http
			$http({
					method: 'POST',
					url: url,
					data: data,
					headers: header
				})
				.then(function (response) {
					//console.log(response);
					var data = response.data.c.data;
					if (data.message == 'token_invalid' || data.message == 'token_not_provided') {
						$state.transitionTo('welcome');
						$cookieStore.remove('token');
					}
					var ok = 0;
					log_data.response = response.status;
					if (response.status == 200) {
						var data = response.data.c.data;
						if (data.token != null) {
							$cookieStore.put('token', data.token);
						}

						if (data.error != undefined) {
							ok = 1;
						} else {
							if (data.message == 'token_invalid') {
								$cookieStore.remove('token');
								$cookieStore.remove('user_id');
								$cookieStore.remove('gender');
								$state.transitionTo('welcome');
								ok = -1;
							}
						}
					} else {
						var data = response.data.c.data;

					}
					if (ok == 1) {
						callback(response); //log(log_data);
					} else
					if (ok == 0) {
						callback(response);
						log(log_data);
					}
				}, function (response) {
					if (_url == 'users/info') {
						var data = response.data;
						if (data['c'] != undefined)
							if (c.data.username == '' && data.c.data.message == 'user_not_found') {
								$cookieStore.remove('token', token);
								$cookieStore.remove('gender', gender);
								$cookieStore.remove('profile', profile);
								return;
							}
					}
					// Kenapa ini di tambah ?
					// if(response.data==undefined || !response.data){
					// 	$state.transitionTo('welcome');
					// 	$cookieStore.remove('token');
					// 	return;
					// }
					console.log(response);
					if (response.data) {
						var data = response.data.c.data;
						if (data.message == 'token_invalid' || data.message == 'token_not_provided') {
							// $state.transitionTo('welcome');
							$cookieStore.remove('token');
							//$state.reload();
						}
						log(log_data);
					}
					callback(response);
				});

			function log(log_data) {
				//				$http({
				//					method: 'POST',
				////					url: 'https://beta.ciayo.com/ciayo-errorlog/errorlog.php',
				//					url:'http://localhost/test.php',
				//					data:JSON.stringify(log_data),
				//				}).then(function successCallback(response) { }, function errorCallback(response) { });
				$.post('https://fr-logs.ciayo.com/errorlog.php', log_data);

			}
		}

		function get(_url, data, force_url) {
			var deferred = $q.defer();
			if (!Date.now) {
				Date.now = function () {
					return new Date().getTime();
				}
			}

			var url = (force_url ? '' : API_SERVER) + _url;

			var c = {
				data: data || {},
				timestamp: Date.now(),
				app: SCREEN_TYPE,
				screen_type: SCREEN_TYPE,
				image_type: '',
				latitude: '-6.225652',
				longitude: '106.74576',
				language: $cookieStore.get('language') || 2

			};

			// Set Data
			var json = angular.toJson(c);
			var data = 'c=' + encodeURIComponent(json);;

			// get token
			var token = $cookieStore.get('token') || '';
			var header = {
				"Content-Type": "application/x-www-form-urlencoded"
			};
			if (token) {
				angular.extend(header, {
					"Authorization": 'Bearer ' + token
				});
			}
			var log_data = {
					url: url,
					request: data,
					response: {}
				}
				// Req with $http
			$http({
					method: 'POST',
					url: url,
					data: data,
					headers: header
				})
				.then(function (response) {
					var data = response.data.c.data;
					var ok = 0;
					log_data.response = response.status;
					if (response.status == 200) {
						var data = response.data.c.data;
						if (data.message == 'token_invalid' || data.message == 'token_not_provided') {
							$state.transitionTo('welcome');
							$cookieStore.remove('token');
							$cookieStore.remove('user_id');
							$cookieStore.remove('gender');
							$state.transitionTo('welcome');
							return;
						} else
						if (response.data.c.token != null) {
							console.log('ini masuk kah ??');
							$cookieStore.put('token', response.data.c.token);
						}
						deferred.resolve(data);
					} else {
						deferred.reject(response);
						(response);
						log(log_data);
					}
				}, function (response) {
					if (_url == 'users/info') {
						var data = response.data;
						if (data['c'] != undefined)
							if (c.data.username == '' && data.c.data.message == 'user_not_found') {
								$cookieStore.remove('token', token);
								$cookieStore.remove('user_id', gender);
								$cookieStore.remove('gender', profile);
								return;
							}
					}
					if (response.data) {
						var data = response.data.c.data;
						if (data.message == 'token_invalid' || data.message == 'token_not_provided') {
							$cookieStore.remove('token');
							$cookieStore.remove('user_id');
							$cookieStore.remove('gender');
							//$state.reload();
						}
						log(log_data);
					}
					deferred.reject(response);
				});

			function log(log_data) {
				$.post('https://fr-logs.ciayo.com/errorlog.php', log_data);

			}
			return deferred.promise;
		}
		// function Socket(){
		// 	var ioSocket = io.connect("https://apidev.ciayo.com/");
		// 	//var ioSocket = io.connect("http://192.168.204.28:8080/");

		// 	var socket = socketFactory({ioSocket:ioSocket});
		// 	return socket;
		// }
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('ConnectionService', ConnectionService);

	ConnectionService.$inject = ['$http', '$cookieStore', '$rootScope', 'CiayoService'];
	function ConnectionService($http, $cookieStore, $rootScope, CiayoService) {
		var service = {
			requestFollow:requestFollow,
			requestCreate:requestCreate,
			requestLoad:requestLoad,
			requestConfirm:requestConfirm,
			requestDelete:requestDelete,
			userBlock:userBlock,
			userUnblock:userUnblock,
			blocklist:blocklist,
		};
		
		return service;
		
		function requestFollow(user_id,follow,callback,errCallback){
			var c={
				data:{
					user_id:user_id,
					follow:follow
				}
			};
			CiayoService.Api('users/follow', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
		function requestCreate(friend_id,category_id,callback,errCallback){
			var c={
				data:{
					friend_id:friend_id,
					category_id:category_id
				}
			};
			CiayoService.Api('users/relation/create', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		function requestLoad(limit,offset,callback,errCallback){
			var c={
				data:{
					limit:limit,
					offset:offset
				}
			};
			CiayoService.Api('users/relation', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		function requestConfirm(user_relation_id,callback,errCallback){
			var c={
				data:{
					"user_relation_id": user_relation_id,
				}
			};
			CiayoService.Api('users/relation/confirm', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		function requestDelete(friend_id,callback,errCallback){
			var c={
				data:{
					"friend_id": friend_id,
				}
			};
			CiayoService.Api('users/relation/reject', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
		function userBlock(user_id,callback,errCallback){
			var c={
				data:{
					"user_id": user_id,
				}
			};
			CiayoService.Api('users/block', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		function userUnblock(user_id,callback,errCallback){
			var c={
				data:{
					"user_id": user_id,
				}
			};
			CiayoService.Api('users/unblock', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
		function blocklist(callback,errCallback){
			var c={
				data:{ }
			};
			CiayoService.Api('users/block/list', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('ItemService', ItemService);

	ItemService.$inject = ['$http', '$cookieStore', '$rootScope', 'CiayoService'];
	function ItemService($http, $cookieStore, $rootScope, CiayoService) {
		var service = {
			list:list,
		};
		
		return service;
		
		function list(keyword,item_category_id,limit,offset,callback,errCallback){
			item_category_id=null;limit=20;offset=0;
			var c = {
				data: {
					"keyword": keyword,
					"item_category_id": item_category_id,
					"limit": limit,
					"offset": offset
				}
			};
			CiayoService.Api('item', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
	}
})();;
(function () {
	'use strict';
	/*globals angular:false */
	angular
		.module('app')
		.service('listService',listService );
	function listService(){
		var me = this;
		angular.extend(me,{
			isActive:false,
			maxSize:0,
			top:0,
			list:[],
			selectedIndex:0,
			prev:prev,
			next:next
		})
		function prev(el,height,search_view){
			if(this.selectedIndex>0){
				this.selectedIndex--;
				if( this.top >= this.selectedIndex )
				{
					this.top = this.selectedIndex;
					angular.element(el).scrollTop(this.top*height);
				}
			}
		}
		function next(el,height,search_view) {
			if(this.selectedIndex+1 < this.list.length){
				this.selectedIndex++;
				if(this.selectedIndex >= this.top+search_view){
					this.top = this.selectedIndex+1 - (search_view);if(this.top<0){this.top=0;}
					angular.element(el).scrollTop(this.top*height);
				}
			}
		}
		this.reset = function () {
			this.list = [];
			this.selectedIndex = 0;
			this.top = 0;
		}
		this.getSelectedItem = function () {
			return this.list[this.selectedIndex];
		}
		this.setSelectedIndex=function(selectedIndex,el,height){
			this.selectedIndex = selectedIndex;
			this.top = Math.floor(angular.element(el).scrollTop()/height);
		}
		this.isEmpty=function(){
			return this.list.length==0;
		}
	}
}());;
(function() {
'use strict';

	angular
		.module('app')
		.factory('ProfileService', ProfileService);

	ProfileService.$inject = ['$http', '$cookieStore', '$rootScope', 'CiayoService'];
	function ProfileService($http, $cookieStore, $rootScope, CiayoService) {
		var service = {
			requestFollow:requestFollow,
			searchUser:searchUser,
		};
		
		return service;
		//http://192.168.35.56:8000/login
		//{"data":{"email":"miftarockavanka@gmail.com","password":"superadmi","latitude":"32","longitude":"32"}}
		// {"data":{"user_id":"1"}}
		function requestFollow(user_id,callback,errCallback){
			var c={
				data:{
					user_id:user_id
				}
			};
			CiayoService.Api('user/info', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		function searchUser(keyword,limit,offset,callback,errCallback){
			var c={
				data:{
					keyword:keyword,
					limit:limit,
					offset:offset
				}
			};
			CiayoService.Api('search/user/name', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('TourService', TourService);

	TourService.$inject = ['$cookieStore'];

	function TourService($cookieStore) {

		return {
		 	tourCreateAvatar:tourCreateAvatar,
		 	tourSearchActivity:tourSearchActivity,
		 	tourSelectActivity:tourSelectActivity,
		 	tourCreatePost:tourCreatePost
		}

		
		function initTour(page, step_information){
			

			if($cookieStore.get('end_tour_'+page)==true)
				return false;

			if ($.fn.itour) {

				$('body').itour({
					CSSClass:'anyClassName',				//Assign for tour a unique class name to change the display styles of the tour.
					startStep:1,							//Step from which the tour begins
					tourMapPos:'right',						//Tour Map Position 
					tourTitle:'Tour Title Default',			//Tour title
					tourMapVisible:false,					//Specifies to show or hide the map of the tour at the start of the tour
					spacing:5,								//Indent highlighting around the element
					overlayClickable:false,					//This parameter enables or disables the click event for overlying layer
					stepNumbersVisible:true,				//Shows the total number of steps and the current step number
					lang: {									//Default language settings
						cancelText:	'Cancel Tour',			//The text in the cancel tour button
						hideText: 'Hide Tour Map',			//The text in the hidden tour map button 
						tourMapText:'•••',					//The text in the show tour button
						tourMapTitle: 'Tour Map',			//Title of Tour map button
						nextTextDefault:'Next',				//The text in the Next Button
						prevTextDefault:'Prev',				//The text in the Prev Button
						endText:'End Tour'					//sets the text for the close button in the last step of the tour
					},
					steps:step_information,
					create: function(){},					//Triggered when the itour is created
					end: function(){ $cookieStore.put('end_tour_'+page,true)},						//Triggered when the tour came to the end, or was interrupted.
				});
			}
		}

		// Create Avatar
		function tourCreateAvatar(){
			return; // temporary disable

			var EN = {
			    "title1"           	: "Zoom In/Out", 
			    "content1"        	: "Use this for zoom in or zoom out your avatar", 
			    "title2"           	: "What You Have on Your Head", 
			    "content2"        	: "You can customize what you would look like inside Ciayo world", 
			    "title3"           	: "How You Look Like on Mirror?",
			    "content3"        	: "Use this carefully and maybe you can save you precious face forever", 
			    "title4"           	: "Should I Explain?",
			    "content4"        	: "If you donâ€™t know what is it, hurry up and go to meet your doctor !"
			}

			var ID = {
			    "title1"           	: "Perbesar/Perkecil",
			    "content1"        	: "Gunakan kaca pembesar untuk memperbesar atau memperkecil avatarmu",
			    "title2"           	: "Seperti apa bentuk wajahmu",
			    "content2"        	: "Kamu bisa menyesuaikan penampilanmu di dunia Ciayo",
			    "title3"           	: "Bagaimana penampilanmu terlihat di cermin?",
			    "content3"        	: "Gunakan fitur ini hati-hati dan mungkin kamu akan menyimpan wajah berhargamu selamanya",
			    "title4"           	: "Apa perlu penjelasan dariku?",
			    "content4"        	: "Jika kamu tidak tau apa ini, ayo tanyakan kami !"
			}

			var lang = ($cookieStore.get('language')==1) ? EN : ID;

			var step = [{
					image:'',							//Path to image file
					title:lang['title1'],				//Name of step
					content:lang['content1'],		//Description of step
					contentPosition:'blr',				//Position of message
					name:'avatar-zoom',					//Unique Name (<div data-name="uniqueName"></div>) of highlighted element or .className (<div class="className"></div>) or #idValue (<div id="idValue"></div>)
					disable:false,						//Block access to element
					overlayOpacity:0.5,					//For each step, you can specify the different opacity values of the overlay layer.
					event:'next',						//An event that you need to do to go to the next step
					nextText:'Next',					//The text in the Next Button
					prevText:'Prev',					//The text in the Prev Button
					trigger:false,						//An event which is generated on the selected element, in the transition from step to step
					before:function(){},				//Triggered before the start of step
					during:function(){},				//Triggered after the onset of step
					after:function(){}					//Triggered After completion of the step, but before proceeding to the next
				},
				{
					title:lang['title2'],
					content:lang['content2'],
					contentPosition:'bcc',
					name:'select-element',
					event:'next',
					nextText:'Next',
					trigger:false
				},
				{
					title:lang['title3'],
					content:lang['content3'],
					contentPosition:'bcc',
					name:'select-element-type',
					event:'next',
					nextText:'Next',
					trigger:false
				},
				{
					title:lang['title4'],
					content:lang['content4'],
					contentPosition:'brl',
					name:'select-variant-color',
					event:'next',
					nextText:'DONE',
					trigger:false,
					prevText:'',
				}];

			initTour('create_avatar',step);

		}


		// Search Activity
		function tourSearchActivity(){
			return; // temporary disable

			var EN = {
			    "title1"           	: "Choose Activity",
			    "content1"        	: "Choose this one please, hey câ€™mon just klik here",
			}

			var ID = {
			    "title1"           	: "Pilih Activity",
			    "content1"        	: "Pilih satu activity, ayo pilih disini",
			}

			var lang = ($cookieStore.get('language')==1) ? EN : ID;
			var step = [{
					image:'',							
					title:lang['title1'],				
					content:lang['content1'],		
					contentPosition:'rcc',				
					name:'.c-tml-lpct',					
					disable:false,						
					overlayOpacity:0.5,					
					event:'click',						
					nextText:'Next',					
					prevText:'Prev',					
					trigger:false,						
					before:function(){},				
					during:function(){},				
					after:function(){}			
				}];
			initTour('search_activity',step);
		}

		// Select Activity
		function tourSelectActivity(){
			
			return false;

			var EN = {
			    "title1"           	: "Choose Activity",
			    "content1"        	: "Choose this one please, hey c’mon just klik here",
			}

			var ID = {
			    "title1"           	: "Choose Activity",
			    "content1"        	: "Choose this one please, hey c’mon just klik here",
			}

			var lang = ($cookieStore.get('language')==1) ? EN : ID;
			
			var step = [{
					image:'',							
					title:lang['title1'],				
					content:lang['content1'],		
					contentPosition:'rcc',				
					name:'search-activity',					
					disable:false,						
					overlayOpacity:0.5,					
					event:'next',						
					nextText:'Next',					
					prevText:'Prev',					
					trigger:false,						
					before:function(){},				
					during:function(){$cookieStore.put('end_tour_select_activity',true)},				
					after:function(){}			
				}];

			initTour('select_activity', step);

			
		}

		//  Create Post
		function tourCreatePost(){
			return; // temporary disable

			//$('body').itour('destroy');
			//if($cookieStore.get('end_tour_create_post')==true)
			//	return false;

			var EN = {
			    "title1"           	: "Caption",
			    "content1"        	: "This word will appears on your post",
			    "title2"			: "Mood",
			    "content2"			: "How do you feel? Express your feeling now !",
			    "title3"			: "Add Item",
			    "content3"			: "Tell your friends,  Kasih tau teman Kamu Item apa aja yang lagi digunakan saat melakukan Activity ini.",
			    "title4"			: "Tag Friends",
			    "content4"			: "Kamu sedang melakukan Activity bersama teman? Tag mereka ya.",
			    "title5"			: "Place",
			    "content5"			: "Check-in lokasi kamu saat melakukan Activity ini.",
			    "title6"			: "Post",
			    "content6"			: "Kalo udah selesai, klik Post!",
			}

			var ID = {
			    "title1"           	: "Caption",
			    "content1"        	: "Kalimat ini akan muncul di postinganmu",
			    "title2"			: "Mood",
			    "content2"			: "Kasih tau mood kamu saat melakukan activity ini.",
			    "title3"			: "Tambah Item",
			    "content3"			: "Kasih tau teman kamu item apa aja yang lagi digunakan saat melakukan activity ini.",
			    "title4"			: "Tag Teman-Temanmu",
			    "content4"			: "Kamu sedang melakukan activity bersama teman? Tag mereka ya.",
			    "title5"			: "Place",
			    "content5"			: "Masukan lokasi kamu saat melakukan activity ini.",
			    "title6"			: "Post",
			    "content6"			: "Kalo udah selesai, klik post yuk!",
			}

			var lang = ($cookieStore.get('language')==1) ? EN : EN;
			
			var step = [{						
					title:lang['title1'],				
					content:lang['content1'],		
					contentPosition:'rcc',				
					name:'input-caption',					
					disable:true,						
					overlayOpacity:0.3,					
					event:'next',						
					nextText:'Next',					
					prevText:'Prev',					
					trigger:false								
				},
				{
					title:lang['title2'],
					content:lang['content2'],
					contentPosition:'rcc',
					name:'select-mood',
					disable:true,	
					event:'next',
					nextText:'Next',
					trigger:false
				},
				{
					title:lang['title3'],
					content:lang['content3'],
					contentPosition:'tcc',
					disable:true,	
					name:'item-0',
					event:'next',
					nextText:'Next',
					trigger:false
				},
				{
					title:lang['title4'],
					content:lang['content4'],
					contentPosition:'tcc',
					name:'with-user',
					disable:true,	
					event:'next',
					nextText:'Next',
					trigger:false,
					prevText:'',
				},
				{
					title:lang['title5'],
					content:lang['content5'],
					contentPosition:'tcc',
					name:'add-place',
					disable:true,	
					event:'next',
					nextText:'Next',
					trigger:false
				},
				{
					title:lang['title6'],
					content:lang['content6'],
					contentPosition:'tcc',
					name:'.post-btn',
					event:'next',
					nextText:'DONE',
					trigger:false,
					prevText:'',
					disable:true
				}];

			initTour('create_post', step);

			
		}


	}
})();





;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardCommentFactory', cardCommentFactory);
	cardCommentFactory.$inject = ['$rootScope', 'modalFactory', 'CiayoService','cardCommentEditDrawer','cardCommentReplyDrawer','cardStickerFactory','timelineConnector'];

	function cardCommentFactory($rootScope, modalFactory, CiayoService,cardCommentEditDrawer,cardCommentReplyDrawer,cardStickerFactory,timelineConnector) {

		function factory(post_id,enable_comment,type) {
			var vm = this;
			angular.extend(vm, {
				load: load,
				list: [],
				create:create,
				sendSticker:sendSticker,
				sendEmoji:sendEmoji,
				sticker: new cardStickerFactory()
			});
			var _super = {};
			angular.extend(_super,{
				loadComment:load,
				createComment:create,
				editComment:editComment,
				deleteComment:deleteComment
			})
			init();
			function init() {
				angular.extend(vm, {
					search:'',
					count: 0,
					list: []
				});
				load(0,null,type!='detail'?1:null);
			}
			function load(offset, parent_comment,limit) {
				timelineConnector.commentGet(post_id,parent_comment?parent_comment.id:null,offset,limit || 10)
					.then(function(data){
					if (data.error==false) {
						if(parent_comment){//reply
							if(offset==0){parent_comment.reply.list=[];}
							var list = data.content.list_comment;
							angular.forEach(list, function (value, key) {
								if (value) {
									parent_comment.reply.list.unshift(new Comment(value,_super));
								}
								parent_comment.reply.count = data.meta.total;
							});
						}else{//create
							if(offset==0){vm.list=[];}
							var list = data.content.list_comment;
							angular.forEach(list, function (value, key) {
								if (value) {
									vm.list.unshift(new Comment(value,_super));
								}
							});
							vm.count = data.meta.total;
							setTimeout(function () { $(window).trigger("resize.card-tab"); }, 1);
						}
					} else {
						modalFactory.message(data.message);
					}
				});
			}
			function create(parent_comment) {
				if(enable_comment==false || post_id==1){
					modalFactory.message('Comment disabled');return;
				}
				if((parent_comment ?parent_comment.reply.search:vm.search)==''){
					// modalFactory.message('Pesan harus ')
					return;
				}
				timelineConnector.commentCreate(
					post_id,
					parent_comment ?parent_comment.reply.search:vm.search,
					parent_comment ? parent_comment.id : null
				).then(function(data){
						if(data.error==false){
							if(parent_comment){//EDIT
								angular.forEach(data.content.data,function(value,key){
									parent_comment.reply.list.push(new Comment(value,_super));
								});
								parent_comment.reply.count+=data.content.data.length;
								
							}else{//CREATE
								angular.forEach(data.content.data,function(value,key){
									vm.list.push(new Comment(value,_super));
								});
								vm.count+=data.content.data.length;
								
							}
							setTimeout(function () { $(window).trigger("resize.card-tab"); }, 1);
						}
				});
				if(parent_comment){
					parent_comment.reply.search='';
				}else{
					vm.search = '';
				}
			}
			
			function sendSticker(sticker,parent_comment){
				//id,image,image_detail,name,shortcode,shortcode_format
				if(parent_comment){
					parent_comment.reply.search += sticker.shortcode_format;
				}else{
					vm.search+=sticker.shortcode_format;
				}
				create(parent_comment);
				vm.sticker.setOpen(false);
			}
			function sendEmoji(emoji,parent_comment){
				if(parent_comment){
					parent_comment.reply.search += emoji.shortcode_format;
				}else{
					vm.search+=emoji.shortcode_format;
				}
				
			}
			
			function editComment(comment,parent_comment,card){
				cardCommentEditDrawer.open(comment.message,card,function(data){
					var message = data.message;
					if(comment.message != message){
						timelineConnector.commentUpdate(comment.id,message).then(function(data){
							if(data.error==false){
								comment.message = data.content.content;
								comment.updated_at = data.content.updated_at;
								comment.entities = data.content.entities_message;
								comment.parse_message = comment.parseMessage(comment.message,comment.entities);
							}else{
								modalFactory.message(data.message);
							}
						});
					}
					
				})
			}
			function deleteComment(comment,parent_comment){
				var index = -1;
				timelineConnector.commentDelete(comment.id).then(function(data){
					if(data.error==false){
						//if nested comment
						if(parent_comment){
							index = parent_comment.reply.list.indexOf(comment);
							parent_comment.reply.list.splice(index,1);
							parent_comment.reply.count--;
						}else{//if comment (parent)
							index = vm.list.indexOf(comment);
							vm.list.splice(index,1);
							vm.count--;
						}
						setTimeout(function () { $(window).trigger("resize.card-tab"); }, 1);
					}
				});
				
				
			}
		}
		function Comment(args,_super) {
			var vm = this;
			angular.extend(vm, {
				toggleMenuOpen:toggleMenuOpen,
				like:like,
				editComment:editComment,
				deleteComment:deleteComment,
				createReply:createReply,
				editReply:editReply,
				deleteReply:deleteReply,
				replyComment:replyComment,
				parseMessage:parseMessage
			});
			init();
			function init() {
				angular.extend(vm, {
					id: '',
					message: '',
					entities: [],
					created_at: null,
					updated_at: null,
					action: {
						value: 0,//-1->dislike,0->neutral,1->like
						like_count: 0,
						dislike_count: 0
					},
					user: {
						id: null,
						username: '',
						user_display_name: '',
						avatar: {
							background: '',
							full_body: '',
							face: '',
							cropped: ''
						},
					},
					reply: {
						search:'',
						count: 0,
						list: []
					},
				isMenuOpen:false
				});
				transform();
			}
			function transform() {
				vm.id = args.id_comment;
				vm.message = args.content;
				vm.entities = args.entities_message;
				vm.created_at = args.created_at;
				vm.updated_at = args.updated_at;
				//ACTION
				vm.action.value = args.like;
				vm.action.like_count = args.like_count;
				vm.action.dislike_count = args.dislike_count;
				//USER
				vm.user.id = args.user_id;
				vm.user.username = args.username;
				vm.user.user_display_name = args.user_display_name;
				//USER AVATAR
				vm.user.avatar.background = args.user_avatar.background_avatar;
				vm.user.avatar.avatar = args.user_avatar.avatar;
				vm.user.avatar.cropped = args.user_avatar.avatar_crop;
				//REPLY
				vm.reply.count = args.reply_count;
				vm.parse_message = parseMessage(vm.message,vm.entities);
			}
			//parse entities message
			function parseMessage(message,entities) {
				if(message==undefined)return '';
				var out=vm.message.trim();
				var sticker_count = 0;
				if(entities!=undefined){
					if(entities.length==1){
						if(entities[0].shortcode_format==out){
							entities[0].type='sticker';
						}
					}
					var already_parse_sticker = false;
					angular.forEach(entities,parse);
				}
				return out;
				function parse(value,key){
					if(value.type=='sticker'){
						if(already_parse_sticker==true){
							return;
						}else{
							already_parse_sticker = true;
						}
					}
					var _out = out.split(value.shortcode_format);
					if(_out.length>1){
						var last = _out.splice(1,_out.length-1).join(value.shortcode_format);
						_out[1] = last;
					}
					out = _out.join('<img '+(value.type=='sticker'?'width="100" height="100"':'width="20" height="20"')+' src=\"'+value.media_url+'\">');
				}
			}
			function toggleMenuOpen(value){
				vm.isMenuOpen = !vm.isMenuOpen;
			}
			function like(value){
				var me = this;
				timelineConnector.commentLike(vm.id,value).then(function(data){
					if(data.error==false){
						vm.action.value = value;
						vm.action.like_count = data.content.like_count;
						vm.action.dislike_count = data.content.dislike_count;
					}else{
						modalFactory.message(data.message);
					}
				});
			}
			function editComment(card){
				_super.editComment(this,null,card);
			}
			function deleteComment(){
				_super.deleteComment(this);
			}
			function createReply(){
				_super.createComment(this);
			}
			function editReply(comment,card){
				_super.editComment(comment,this,card);
			}
			function deleteReply(comment){
				_super.deleteComment(comment,this);
			}
			function replyComment(card){
				_super.loadComment(0,this);
				cardCommentReplyDrawer.open(this,card,function(){
					
				});
			}
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardFactory', cardFactory);
	cardFactory.$inject = ['$rootScope','$cookieStore','$sce','$filter','modalFactory',
		'cardParallaxFactory', 'cardCommentFactory', 'cardReactionFactory', 'cardSharingFactory',
		'cardCaptionDrawer', 'cardWithDrawer', 'cardDetailDrawer', 'friendConnectionFactory','drawerFactory','timelineConnector'
	];

	function cardFactory($rootScope,$cookieStore,$sce,$filter,modalFactory,
		cardParallaxFactory, cardCommentFactory, cardReactionFactory, cardSharingFactory,
		cardCaptionDrawer, cardWithDrawer, cardDetailDrawer, friendConnectionFactory,drawerFactory,timelineConnector
	) {

		function factory(card, _super,type) {
			var vm = this;
			angular.extend(vm, {
				drawer:drawerFactory,
				setState: setState,
				setLayer: setLayer,
				openDrawer: openDrawer,
				changePermission: changePermission,
				setSubscribe: setSubscribe,
				editCaption: editCaption,
				editWith: editWith,
				deletePrompt: deletePrompt,
				downloadImage: downloadImage,
				askWith: askWith,
				askPlace: askPlace
			});

			init();

			function init() {
				var load = false;
				angular.extend(vm, {
					id:'',
					code:'',
					detail_link:'',
					created_at:null,
					loading_count: 0,
					layer: {
						type: 0, //0->not active, 1->item, 2->with, 3->place
						data: null,
						index: 0
					},
					state: 0, //0->comment,1->share,2->download,3->menu,4->c-button
					title: '',
					image_download: '',
					image_preview:'',
					login: _super.user,
					user: {
						id: null,
						username: '',
						user_display_name: '',
						avatar: {
							background: '',
							full_body: '',
							face: '',
							cropped: ''
						},
						mood: {
							id: 0,
							text: ''
						},
						status: {
							self: true,
							follow: false,
							friend: {
								add: false,
								addStatus: false,
								approve: false
							}
						},
						user_list_button: null
					},
					subscribe: true,
					parallax: null,
					caption: '',
					item: {
						type: 0, //-1->empty,0->filled
						list: []
					},
					with: {
						type: 1, //-1->empty,0->filled,2->alone
						count: 0,
						list: []
					},
					place: {
						type: 1, //-1->empty,1->secret
						data: null
					},
					permission: {
						value: 0,
						list: _super.permission
					},
					link:{'twitter':'','pinterest':''},
					download_link:$sce.trustAsResourceUrl(API_SERVER+'post/download/card'),
					download_data:'',
					is_static:false,is_loading:false,
					reaction: new cardReactionFactory(card.post_id, load),
					comment: new cardCommentFactory(card.post_id,card.enable_comment,type || null),
					sharing: new cardSharingFactory(card.post_id,card)
				});
				transform();

			}

			function transform() {
				vm.id = card.post_id;
				vm.code = card.post_code;
				vm.detail_link = $sce.trustAsResourceUrl(window.location.href+'detail-page/'+card.post_code);
				vm.is_static = true;//navigator.userAgent.search('UCBrowser')!=-1;
				vm.created_at = card.created_at;
				//title
				vm.title = card.activity_detail.activity_title;
				vm.image_download = card.generated_image_url;
				vm.image_preview = card.activity_detail.preview;
				if(vm.image_preview==undefined){
					vm.is_loading = vm.image_preview!=undefined;
					downloadImage();
				}
				//user_info
				vm.user.id = card.user_id;
				vm.user.username = card.username;
				vm.user.user_display_name = card.user_display_name;
				//user_avatar
				vm.user.avatar.background = card.user_avatar.full_body.background_avatar;
				vm.user.avatar.full_body = card.user_avatar.full_body.avatar;
				if(card.user_avatar)
				vm.user.avatar.face = card.user_avatar.face;
				vm.user.avatar.cropped = card.user_avatar.full_body.avatar_crop;
				//mood_id
				if (card.activity_detail.mood) {
					vm.user.mood.id = card.activity_detail.mood.id;
					vm.user.mood.text = card.activity_detail.mood.text;
				}

				//user_status
				if (card.user_status) {
					vm.user.status.self = false;
					vm.user.status.follow = card.user_status.follow;
					vm.user.status.friend.add = card.user_status.friend.add;
					vm.user.status.friend.addstatus = card.user_status.friend.addstatus;
					vm.user.status.friend.approve = card.user_status.friend.approve;

					var value = {
						user_id: null,
						username: null,
						status: {
							friend: {
								add: null,
								addstatus: null,
								approve: null
							},
							follow: null
						}
					};

					// struktur data default api
					value.user_id = card.user_id;
					value.username = card.username;
					value.status.friend.add = card.user_status.friend.add;
					value.status.friend.addstatus = card.user_status.friend.addstatus;
					value.status.friend.approve = card.user_status.friend.approve;
					value.status.follow = card.user_status.follow;


					value.icon_action_response = false;
					value.open_action = false;
					value.ci_star = false;
					value.ci_check = false;

					if (card.user_status.friend.add == false) {
						value.icon_addfriend = true;
						value.name_addfriend = true;
						value.icon_self = 0;
						value.name_self = 0;


					} else {

						if (card.user_status.friend.addstatus == false) {
							if (card.user_status.friend.approve == true) {
								value.icon_addfriend = false;
								value.name_addfriend = false;
								value.icon_self = 0;
								value.name_self = 0;

							} else {
								value.icon_addfriend = true;
								value.name_addfriend = true;
								value.icon_self = 1;
								value.name_self = 1;

								value.ci_star = true;
							}
						} else {
							value.icon_addfriend = false;
							value.name_addfriend = false;
							value.icon_self = 0;
							value.name_self = 0;
							value.ci_check = true;
						}
					}

					if (card.user_status.friend.approve == false) {
						value.checklist_addfriend = true;
					} else {
						value.checklist_addfriend = false;
					}

					if (card.user_status.follow == false) {
						value.icon_follow = true;
						value.name_follow = true;
						value.checklist_follow = true;
					} else {
						value.icon_follow = false;
						value.name_follow = false;
					}


					var friend_connection = new friendConnectionFactory(value);
					vm.user.user_list_button = (friend_connection);


				}
				//parallax
				card.activity_detail.face = vm.user.avatar.face;
				card.activity_detail.back_hair = card.user_avatar.back_hair;
				card.activity_detail.parallax_setting = _super.parallax_setting;
				vm.parallax = new cardParallaxFactory(card.activity_detail);
				//caption
				vm.caption = card.activity_detail.caption;
				//item
				vm.item.type = card.items_detail.items.length == 0 ? -1 : 0;
				angular.forEach(card.items_detail.items, function (value, key) {
					vm.item.list.push({
						id: value.item_id,
						name: value.name,
						type: value.type,
						image: {
							thumbnail: value.image,
							detail: value.image_detail
						}
					})
				});
				//with
				vm.with.type = card.with_detail.with_status.value;
				vm.with.count = card.with_detail.with_user_count;
				//place
				vm.place.type = card.place_detail.place_status.value;
				if (card.place_detail.place) {
					vm.place.data = {
						id: card.place_detail.place.place_id,
						name: card.place_detail.place.place_name,
						address: card.place_detail.place.place_address,
						position: {
							lat: card.place_detail.place.place_lat,
							long: card.place_detail.place.place_long
						},
						image: {
							thumbnail: card.place_detail.place.place_image,
							detail: card.place_detail.place.place_image_detail
						}
					}
				}
				//permission
				angular.forEach(vm.permission.list, function (value, key) {
					if (value.id == card.permission.group)
						vm.permission.data = value;
				});
				//link
				vm.link.twitter = card.activity_detail.share.twitter;
				vm.link.pinterest = card.activity_detail.share.pinterest;
				var token = $cookieStore.get('token');
				vm.download_data = '{"data":{"token":"'+token+'","post_id":"'+card.post_id+'"},"timestamp":1468376374025,"app":"Web","screen_type":"Web","image_type":"","latitude":"-6.225652","longitude":"106.74576","language":1}';
				if(vm.image_download!=undefined){
					vm.link.pinterest = vm.link.pinterest.replace('[IMAGE_PINTEREST]',vm.image_download);
				}
				parseTitle();
				preloadImage()
				if(vm.id==1){
					setState(1)
				}
			}
			function preloadImage(){
				vm.loading_image = true;
				var img = new Image();
				img.src = vm.image_preview;
				img.onload = function(){
					vm.loading_image = false;
					$rootScope.$apply();
				}
			}
			function parseTitle() {
				if (vm.title == undefined) {
					vm.title = '';
				} else {
					vm.title = vm.title
						.replace('[USERNAME]', '<span class="name">' + vm.user.user_display_name + '</span>')
						.replace('[MOOD_TEXT]',
							vm.user.mood.id ?
							(vm.user.mood.text + ' ' +
								(vm.user.mood.id == 2 ? '<i class="ci-mood-happy"></i>' :
									vm.user.mood.id == 3 ? '<i class="ci-mood-sad"></i>' : '')
							) : '')
				}
			}

			function setState(state) {
				vm.state = state;
				if (vm.image_download == null) {
					downloadImage();
				}
				setTimeout(function () {
					$(window).trigger("resize.card-tab")
				}, 1);
			}

			function setLayer(type, data, index) {
				vm.layer.type = type;
				vm.layer.data = data;
				vm.layer.index = type == 1 ? index : 0;
				if(type==2){
					loadWith(function () {});
				}
			}

			function openDrawer() {
				vm.comment = new cardCommentFactory(card.post_id,card.enable_comment,'detail');
				cardDetailDrawer.open(this, function () {
					vm.comment = new cardCommentFactory(card.post_id,card.enable_comment,null);
				});
			}

			function changePermission() {
				timelineConnector.cardPermissionUpdate(card.post_id,vm.permission.data.id)
				.then(function(data){
					modalFactory.message(data.message);
				},function(response){
					
				});
			}

			function setSubscribe() {
				if(vm.subscribe){
					timelineConnector.cardUnsubscribe(card.post_id).then(function(data){
						vm.subscribe = false;
						modalFactory.message(data.message);
					},function(){
						
					})
				}else{
					timelineConnector.cardSubscribe(card.post_id).then(function(data){
						vm.subscribe = true;
						modalFactory.message(data.message);
					},function(){
						
					})
				}
			}

			function loadWith(callback) {
				timelineConnector.withGet(card.post_id).then(function(data){
						vm.with.list = [];
						if (data.error == false) {
							angular.forEach(data.content.data, function (value, key) {
								vm.with.list.push({
									id: value.user_id,
									user_name: value.username,
									user_display_name: value.user_display_name,
									avatar: {
										background: value.user_avatar_detail.background_avatar,
										full_body: value.user_avatar_detail.avatar,
										face: '',
										cropped: value.user_avatar_cropped.avatar
									},
								})
							});
							if (callback) {
								callback(data);
							}
						}else{
							
						}
				},function(response){
					
				});
			}

			function editCaption() {
				cardCaptionDrawer.open(
					'ADD',
					vm.caption, vm.parallax,
					function (data) {
						if (vm.caption != data.caption) {	timelineConnector.captionUpdate(card.post_id,data.caption,false)
							.then(function(data2){
								if (data2.error == false) {
									vm.caption = data.caption;
								}
								modalFactory.message(data2.message);
							},function(response){
							
						});
						}
					});
			}

			function editWith() {
				var old_data = vm.with.list;
				loadWith(function () {
					cardWithDrawer.open(
						'EDIT',
						vm.with.list,
						function (data,edited) {
							if (edited) {
								saveWith(data.withs);
							}
							if(data.withs.length==0){
								vm.with.type=-1;
							}else{
								vm.with.type=0;
							}
						}
					);
				});
			}

			function saveWith(_list) {
				var list = [];
				angular.forEach(_list, function (value, key) {
					list.push({
						id: value.id,
						username: value.user_name
					});
				});
				timelineConnector.withUpdate(card.post_id,list).then(function(data){
						if (data.error == false) {
							vm.with.list = _list;
							vm.with.count=_list.length;
							modalFactory.message(data.message);
						} else {
							modalFactory.message(data.message);
						}
				},function(response){
					
				});
			}

			function deletePrompt() {
				var me = this;
				timelineConnector.cardDelete(card.post_id).then(function(data){
					_super.deleteCard(me);
					modalFactory.message(data.message);
				},function(response){
					
				})
			}

			function downloadImage() {
				vm.is_loading = true;
				timelineConnector.cardGenerateImage(card.post_id)
					.then(function(data){
					if(data.error==false){
						vm.image_download = data.content.card_media_id;
						vm.image_preview = data.content.preview_media_id;
						vm.link.pinterest = vm.link.pinterest.replace('[IMAGE_PINTEREST]',vm.image_download);
						setTimeout(function () {
							$(window).trigger("resize.card-tab")
						}, 1);
						vm.is_loading=false;
						preloadImage();
					}
				},function(response){});
			}

			function askWith() {
				if(card.post_id==1){modalFactory.message('Asking disabled');return;}
				if(vm.user.id==vm.login.id)return;
				modalFactory.confirm(
					$filter('translate')('$ask') + vm.user.user_display_name + $filter('translate')('$ask.with'),
					function (data) {
						if (data.result) {
							timelineConnector.cardAsk(card.post_id,'ask_with')
								.then(function(data){},function(response){});
						}
					}
				);
			}

			function askPlace() {
				if(card.post_id==1){modalFactory.message('Asking disabled');return;}
				if(vm.user.id==vm.login.id)return;
				modalFactory.confirm(
					$filter('translate')('$ask') + vm.user.user_display_name + $filter('translate')('$ask.place'),
					function (data) {
						if (data.result) {
							timelineConnector.cardAsk(card.post_id,'ask_place')
								.then(function(data){},function(response){});
						}
					}
				);
			}
		}

		return factory;
	}
	function Card(){
		var card = this;
		
		angular.extend(card,{
			id:0,
			created_at:0,
			code:'',
			item:{
				type:-1, // -1->empty, 0->filled
				list:[]
			},
			with:{
				type:-1, // -1->asking, 0->filled, 1->secret, 2->alone
				length:0,
				list:[]
			},
			place:{
				type:-1, // -1->asking
				data:null
			}
		});
	}
	function User(){
		var user = this;
		
		angular.extend(user,{
			id:0,
			created_at:0,
			name:'',
			display_name:'',
			avatar:{
				'background':'',
				'full':'',
				'face':'',
				'cropped':''
			},
			status:{
				self:true,
				follow:false,
				friend:{
					add:false,
					add_status:false,
					approve:false
				},
				
			}
		});
	}
	function Place(){
		var place = null;
		angular.extend(place,{
			id:0,
			name:'',
			address:'',
			latitude:0,
			longitude:0,
			image:{
				thumbnail:'',
				detail:''
			}
		});
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardParallaxFactory', cardParallaxFactory);
	cardParallaxFactory.$inject = ['$rootScope', 'modalFactory'];

	function cardParallaxFactory($rootScope, modalFactory) {
		var const_layer = [
			[10, 0.99],//0
			[0, 1],//1
			//[-50,1.06],//1
			[-200, 1.23],//2
			//[-300,1.33],//3
			[-400, 1.44],//3
			//[-500,1.56],//5
			[-600, 1.75]//4
		];
		function factory(activity_detail) {
			var me = this;
			angular.extend(me, {
				loaded: false,
				should_update: false,
				parallax_setting:false,
				layer_list: []
			});
			init();
			function init() {
				transform(activity_detail);
			}
			function transform(activity_detail) {
				var activity_layer = 0;
				me.loaded = false;
				me.layer_list = [];
				if(activity_detail.parallax_setting)
					me.parallax_setting = activity_detail.parallax_setting;
				//find activity_layer
				angular.forEach(activity_detail.image, function (image, key) {
					if (image.type == 'activity') { activity_layer = image.layer; }
				});
				//background
				angular.forEach(activity_detail.image, function (image, key) {
					if(image.type!='background')return;
					if (image.url && image.url != '') {
						me.layer_list.push({
							x: 0, y: 0,
							z: const_layer[image.layer][0],
							rotation: 0,
							scale: const_layer[image.layer][1],
							url: image.url
						});
					}
				});
				//back hair(activity +1)
				if (activity_detail.back_hair) {
					var obj = {
						z: const_layer[activity_layer][0] + 1,
						rotation: activity_detail.avatar_rotation,
						scale: const_layer[activity_layer][1] * activity_detail.avatar_size / 100,
						url: activity_detail.back_hair
					};
					obj.x = activity_detail.avatar_position.x * const_layer[activity_layer][1];
					obj.y = activity_detail.avatar_position.y * const_layer[activity_layer][1];
					me.layer_list.push(obj);
				}
				//activity
				angular.forEach(activity_detail.image, function (image, key) {
					if(image.type!='activity')return;
					if (image.url && image.url != '') {
						me.layer_list.push({
							x: 0, y: 0,
							z: const_layer[image.layer][0]+2,
							rotation: 0,
							scale: const_layer[image.layer][1],
							url: image.url
						});
					}
				});
				//head
				if (activity_detail.face) {
					var obj = {
						z: const_layer[activity_layer][0] + 3,
						rotation: activity_detail.avatar_rotation,
						scale: const_layer[activity_layer][1] * activity_detail.avatar_size / 100,
						url: activity_detail.face
					};
					obj.x = activity_detail.avatar_position.x * const_layer[activity_layer][1];
					obj.y = activity_detail.avatar_position.y * const_layer[activity_layer][1];
					me.layer_list.push(obj);
				}
				//foreground
				angular.forEach(activity_detail.image, function (image, key) {
					if(image.type!='foreground')return;
					if (image.url && image.url != '') {
						me.layer_list.push({
							x: 0, y: 0,
							z: const_layer[image.layer][0]+4,
							rotation: 0,
							scale: const_layer[image.layer][1],
							url: image.url
						});
					}
				});
				//bubble
				imageLoader(me.layer_list, function () {
					me.loaded = true;
					me.should_update = true;
					$rootScope.$apply();
				})
			}

		}
		function imageLoader(image_list, callback) {
			var ready = false;
			var image_count = 0;
			angular.forEach(image_list, function (value, key) {
				var img = new Image();
				img.src = value.url;
				img.onload = updateCount;
			});
			function updateCount() {
				image_count++;
				if (image_count >= image_list.length) {
					callback();
				}
			}
		}
		return factory;
	}
})();
;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardReactionFactory', cardReactionFactory);
	cardReactionFactory.$inject = ['$rootScope', 'modalFactory', 'CiayoService', 'cardReactionDrawer','timelineConnector'];

	function cardReactionFactory($rootScope, modalFactory, CiayoService, cardReactionDrawer,timelineConnector) {
		function factory(post_id) {
			var reaction = this;
			angular.extend(reaction, {
				setOpen: setOpen,
				react: react,
				openModal: openModal,
				setIndex: setIndex
			});
			init();
			function init() {
				angular.extend(reaction, {
					isOpen: false,
					animate: 0,
					count: 0,
					most_react: 0,
					text: '',
					user_react: 0,
					list: {},
					index: 0
				});
				load();
			}
			function load() {
				timelineConnector.reactionGet(post_id).then(function(data){
					var data = data.content;
					transform(data);
					setTimeout(function () { $(window).trigger("resize.card-tab"); }, 1);
				},function(response){
					
				});
			}
			function transform(data) {
				reaction.most_react = data.rate_detail.detail.most ? data.rate_detail.detail.most.rate : 0;
				reaction.text = data.rate_detail.detail.text || '';
				reaction.user_react = data.rate_detail.user_react ? data.rate_detail.user_react.rate : 0;
				reaction.count = 0;
				angular.forEach(data.rate_count, function (value, key) {
					var user_list = [];
					angular.forEach(value.users, function (value2, key2) {
						user_list.push({
							id: value2.id,
							username: value2.username,
							user_display_name: value2.display_name,
							avatar: {
								background: value2.avatar.background_avatar,
								full_body: value2.avatar.avatar,
								face: '',
								cropped: value2.avatar.avatar_crop
							},
						});
					});
					reaction.list[key.split('_').pop()] = { count: value.count, user_list: user_list };
					reaction.count += user_list.length;
				});
			}
			function setOpen(value) {
				if (value == undefined) value = false;
				reaction.isOpen = value;
			}
			function react(value, $event) {
				if(post_id==1){modalFactory.message('Reaction disabled');return;}
				if (reaction.animate != 0) { return; }
				var _col = angular.element($event.currentTarget);
				var _reaction = _col.find('div._reaction');
				reaction.animate = value;
				angular.element(_reaction).on('animationiteration webkitAnimationIteration', function () {
					reaction.animate = 0;
					reaction.setOpen(false);
					angular.element(_reaction).off('animationiteration webkitAnimationIteration');
					$rootScope.$apply(function () { });
				});
				timelineConnector.reactionCreate(post_id,value).then(function(data){
						load();
				},function(response){
					
				});
			}
			function openModal() {
				if (reaction.count > 0) {
					cardReactionDrawer.open(reaction);
				}
			}
			function setIndex(index) {
				reaction.index = index;
			}
		};
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardSharingFactory', cardSharingFactory);
	cardSharingFactory.$inject = ['$rootScope', 'modalFactory', 'facebookFactory','timelineConnector','$filter'];

	function cardSharingFactory($rootScope, modalFactory, facebookFactory,timelineConnector,$filter) {
		function factory(post_id,card) {
			var sharing = this;
			angular.extend(sharing, {
				is_sharing:false,
				shareFB: shareFB,
				share:share,
			});
			init();
			function init() {
				angular.extend(sharing, {
					count: 0,
					user_list: []
				});
				load();
			}
			function load() {
				timelineConnector.shareGet(post_id).then(function(data){
					var data = data.content;
					transform(data);
					sharing.is_sharing = false;
					setTimeout(function () { $(window).trigger("resize.card-tab"); }, 1);
				},function(response){
					
				});
			}
			function transform(data) {
				sharing.count = data.list_post_share.length;
				sharing.user_list = [];
				angular.forEach(data.list_post_share, function (value, key) {
					var data=
						{
							user : {
							id: value.user_id,
							username: value.user_name,
							user_display_name: value.user_display_name,
							avatar: {
								background: value.user_avatar.background_avatar,
								full_body: value.user_avatar.avatar,
								face: '',
								cropped: value.user_avatar.avatar_crop
							},
						},
						share: value.lists
						};
					sharing.user_list.push(data);
				});
			}
			function shareFB() {
				var access_token = '';
				var uid = '';
				if(sharing.is_sharing==true){return;}
				sharing.is_sharing = true;
//				timelineConnector.shareFbImageGet(post_id).then(function(data){
//					if(data.error==false){
//						FB.ui({
//							method: 'share',
//							display: 'iframe',
//							type: 'photo',
//							caption: data.content.caption,
//							redirect_uri: data.content.redirect_uri,
//							description: data.content.description,
//							name: data.content.name,
//							href: data.content.href,
//							picture: data.content.picture
//						}, function(response){
//							share('facebook')
//						});
//					}else{
//					}
//					sharing.is_sharing = false;
//				},function(response){
//					sharing.is_sharing = false;
//				});
				
				facebookFactory.getToken(function (data) {
					if(data==undefined || data.accessToken==undefined){
						modalFactory.message($filter('translate')('$fb.error'));
						sharing.is_sharing=false;
						return;
					}
					timelineConnector.shareFbApi(data.uid,data.accessToken,post_id)
					.then(function (response) {
						sharing.is_sharing=false;
						if (response.status == 200) {
							var data = response.data.c.data;
							if (data.error == false) {
								modalFactory.message(data.message);
								load();
							}
						} else {
							sharing.is_sharing=false;
						}
					})
				},function(response){
					
				});


			}
			function share(to){
				timelineConnector.shareCreate(post_id,to).then(function(data){
					if (data.error == false) {
						load();
						sharing.is_sharing = false;
					} else {
						errCallback(response);
						sharing.is_sharing = false;
					}
				},function(response){
					
				});
			}
		}
		return factory
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardStickerFactory', cardStickerFactory);
	cardStickerFactory.$inject = ['$rootScope', 'CiayoService'];

	function cardStickerFactory($rootScope, CiayoService) {
		
		var factory = function(){
			var _factory = this;
			angular.extend(_factory,{
				isOpen:false,
				index:0,
				collectionIndex:0,
				emojiCollection:null,
				stickerCollection:null,
				setOpen:setOpen,
				setIndex:setIndex,
				setCollectionIndex:setCollectionIndex,
				getUserEmojiCollection:getUserEmojiCollection,
				getUserStickerCollection:getUserStickerCollection,
				getUserEmojiDetail:getUserEmojiDetail,
				getUserStickerDetail:getUserStickerDetail
			})
			
		
		
		function setOpen(value,index){
			_factory.isOpen = value;
			if(index>=0){
				setTimeout(function(){$('body').scrollTop($('#cm-card_'+index).offset().top+$('#cm-card_'+index).height()-$( window ).height())},0);
			}else
			if(index==-1){
				setTimeout(function(){$('.cm-panel-global .cm-panel-content').scrollTop($(this).height())},0);
			}
			
			if(value){
				getUserEmojiCollection(0,20,function(){
//					setIndex(0);
				},function(){
					
				});
				getUserStickerCollection(0,20,function(){
					setIndex(0);
				},function(){
					
				});
				
			}
		}
		function setIndex(value, id){
			_factory.index=value;
			setCollectionIndex(0);

			if(value==0){
				var objDiv = document.getElementById("cm-card_"+id);
				//objDiv.scrollTop = objDiv.scrollHeight;
			}

		}
		function setCollectionIndex(value){
			_factory.collectionIndex=value;
			if(_factory.index==0){
				if(_factory.stickerCollection.length>0)
					_factory.getUserStickerDetail(_factory.stickerCollection[_factory.collectionIndex]);
			}else{
				if(_factory.emojiCollection.length>0)
					_factory.getUserEmojiDetail(_factory.emojiCollection[_factory.collectionIndex])
			}
		}
		function getUserEmojiCollection(offset, limit,callback, errCallback) {
			if(_factory.emojiCollection!=null){
				callback();
				return;
			}
			var c={
				data:{
					offset:offset,
					limit:limit
				}
			};
			CiayoService.Api('user/emoji/collection', c, function(response) {
				var ok=false;
				if(response.status==200) {
					var data=response.data.c.data;
					if(data.error==false){
						ok=true;
					}
				}
				if(ok){
					_factory.emojiCollection=data.content.emoji_collection;
					callback();
				} else {
					errCallback(response);
				}
			});
		}
		function getUserStickerCollection(offset, limit,callback, errCallback) {
			if(_factory.stickerCollection!=null){
				callback();
				return;
			}
			var c={
				data:{
					offset:offset,
					limit:limit
				}
			};
			CiayoService.Api('user/sticker/collection', c, function(response) {
				var ok=false;
				if(response.status==200) {
					var data=response.data.c.data;
					if(data.error==false){
						ok=true;
					}
				}
				if(ok){
					_factory.stickerCollection=data.content.sticker_collection;
					callback();
				} else {
					errCallback(response);
				}
			});
		}
		function getUserEmojiDetail(collection) {
			var index = _factory.emojiCollection.indexOf(collection);
			var c={
				data:{
					collection_id:collection.id,
				}
			};
			CiayoService.Api('user/emoji/collection/detail', c, function(response) {
				var ok=false;
				if(response.status==200) {
					var data=response.data.c.data;
					if(data.error==false){
						ok=true;
					}
				}
				if(ok){
					_factory.emojiCollection[index].detail=data.content.emoji_collection;
				}else{
				}
			});
		}
		function getUserStickerDetail(collection) {
			var index = _factory.stickerCollection.indexOf(collection);
			var c={
				data:{
					collection_id:collection.id,
				}
			};
			CiayoService.Api('user/sticker/collection/detail', c, function(response) {
				var ok=false;
				if(response.status==200) {
					var data=response.data.c.data;
					if(data.error==false){
						ok=true;
					}
				}
				if(ok){
					_factory.stickerCollection[index].detail=data.content.sticker_collection;
				}else{
					
				}
			});
		}
		};
		return factory;
	}
})();;
	(function () {
		'use strict';

		angular
			.module('app')
			.factory('detailPageFactory', detailPageFactory);
		detailPageFactory.$inject = ['$rootScope', 'modalFactory', 'CiayoService', 'cardFactory', '$cookieStore', '$stateParams'];

		function detailPageFactory($rootScope, modalFactory, CiayoService, cardFactory, $cookieStore, $stateParams) {
			var post_code = $stateParams.post_code;
			var _super = {
				permission: [],
				deleteCard: deleteCard,
				user: {
					id: null,
					username: '',
					user_display_name: '',
					avatar: {
						background: '',
						full_body: '',
						face: '',
						cropped: ''
					},
				},
				parallax_setting: true
			}
			var factory = {
				type: '',
				card: [],
				getCardList: getCardList,
				
				loading: false,
				isloading: false,
				init: init,
				_super: _super
			};


			function init() {
				_super.parallax_setting = false;
				getCardList(true);
//				loadPermission(
//					function () {
//						getSettings(function (response) {
//							var data = response.data.c.data;
//							if (data.error == false) {
//								var content = data.content;
								//content.list_setting.general_setting.card_setting.parallax_view;
								//getUserInfo();
//							}
//						}, function () {
//							getUserInfo();
//						});
//					}
//				);
			}
			
			function getCardList(start) {
				var c = {
					data: {
						"post_code": post_code,
					}
				}
				var url = $cookieStore.get('token')?'post/detail':'public/timeline/detail';
				CiayoService.Api(url, c, function (response) {
					var ok=false;
					if (response.status == 200) {
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if (ok) {
						var tmp = (data.content);
						tmp.frame = false;
						factory.card = new cardFactory(tmp, _super);
						factory.isloading = false;
						factory.loading = false;
					} else {
						//...
					}
				});
			}

			function getSettings(callback, errCallback) {
				var c = {
					data: {}
				};
				CiayoService.Api('settings', c, function (response) {
					if (response.status == 200) {
						callback(response);
					} else {
						callback(response);
					}
				});
			}

			function loadPermission(callback) {
				if (_super.permission.length != 0) {
					callback();
					return;
				}
				var c = {
					data: {}
				}
				CiayoService.Api('post/attributes', c, function (response) {
					var ok = false;
					var data = null;
					if (response.status == 200) {
						data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if (ok) {
						_super.permission.list = [];
						_super.permission = data.content.post_category;
						angular.forEach(_super.permission, function (value, key) {
							value.icon = value.name.toLocaleLowerCase().replace(' ', '-');
						});
						callback();
					} else {

					}
				});
			}

			function deleteCard(card) {
				
			}

			function getUserInfo() {
				var username = '';
				var ok = false;
				var c = {
					data: {
						"username": username
					}
				}
				CiayoService.Api('public/users/info', c, function (response) {
					if (response.status == 200) {
						var data = response.data.c.data;
						if (data.error == false) {
							var card = data.content;
							//user_info
							_super.user.id = card.user_id;
							//user_avatar
							_super.user.avatar.background = card.users_avatar.background_avatar;
							_super.user.avatar.full_body = card.users_avatar.avatar;
							_super.user.avatar.cropped = card.users_avatar.avatar_crop;
							getCardList(true);
						}
					}

				});
			}

			
			return factory;
		}
	})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('drawerFactory', drawerFactory);
	drawerFactory.$inject = ['$rootScope', 'CiayoService'];

	function drawerFactory($rootScope, CiayoService) {
		
		var factory = {
			drawer_class:'',
			isOpen:'',
			template:'',
			title:'',
			data:null,
			setState:setState
		};
		function setState(value){
			if(value){
				factory.isOpen='-open';
				$(".cm").addClass("-locked");
			}else{
				$(".cm").removeClass("-locked")
				factory.isOpen='';
				factory.template='';
				factory.title='';
				factory.data=null;
				factory.drawer_class='';
			}
		}
		return factory;
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('facebookFactory', facebookFactory);

	facebookFactory.$inject = ['$window','$q'];
	function facebookFactory($window,$q) {
		var factory = {
			init:init,
			getToken:getToken
		};
		init();
		return factory;
		
		function getToken(callback){
			var defer = $q.defer();
			var _return = {
				accessToken:null,
				uid:null,
				status:-1
			};
			if(window['FB']){
				loginStatus()
				.then(function(data){//sudah login
					_return.status = data.status;
					_return.accessToken = data.access_token;
					_return.uid = data.uid;
					defer.resolve(_return);
					callback(_return);
				},function(){
					login()
					.then(function(){
						loginStatus()
						.then(function(data){
							_return.status = data.status;
							_return.accessToken = data.access_token;
							_return.uid = data.uid;
							defer.resolve(_return);
							callback(_return);
						},function(){
							callback(_return);
						})
					},function(){
						callback(_return);
					});
				});
			}else{
				callback(_return);
			}
		}
		
		function init() {
			$window.fbAsyncInit = function() {
				if(window['FB']==undefined)return;
				FB.init({ 
					appId: 1757098051179810,
					status: true, 
					cookie: true, 
					xfbml: true,
					version: 'v2.4'
				});
			};
			$window.fbAsyncInit();
		}
		//FB API
		function login(){
			var deferred = $q.defer();
			FB.login(
				function(response) {
					if (response.authResponse) {//fetch information
						FB.api('/me', function(response) {//get user info
							deferred.resolve();
						});
					} else {//cancel login
						deferred.reject();
					}
				},{
					scope: 'publish_actions, public_profile, user_friends, email'
				}
			);
			return deferred.promise;
		}
		function loginStatus(){
			var deferred = $q.defer();
			FB.getLoginStatus(function(response) {
				if (response.status === 'connected') {
					// the user is logged in and has authenticated your
					// app, and response.authResponse supplies
					// the user's ID, a valid access token, a signed
					// request, and the time the access token 
					// and signed request each expire
					var uid = response.authResponse.userID;
					var access_token = response.authResponse.accessToken;
					deferred.resolve({uid:uid,access_token:access_token,status:1});
				} else if (response.status === 'not_authorized') {
					// the user is logged in to Facebook, 
					// but has not authenticated your app
					deferred.reject({uid:null,access_token:null,status:-1});
				} else {
					// the user isn't logged in to Facebook.
					deferred.reject({uid:null,access_token:null,status:-2})
				}
			});
			return deferred.promise;
		}
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('friendConnectionFactory', friendConnectionFactory);
	friendConnectionFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', 'mutualFriendDrawer', 'drawerFactory'];

	function friendConnectionFactory($rootScope, modalFactory,CiayoService, mutualFriendDrawer, drawerFactory) {
		var factory =  function (_user){
			var user = this;
			angular.extend(user,{
				// id:'',
				// username:'',
				// display_name:'',
				// full_name:'',
				showFrame:showFrame,
				closeFrame:closeFrame,
				action_addfriend:action_addfriend,
				cancel_friend_request:cancel_friend_request,
				action_response:action_response,
				closeActionResponse:closeActionResponse,
				action_response_accept:action_response_accept,
				action_response_delete:action_response_delete,
				action_follow:action_follow,
				action_unfollow:action_unfollow,
				getMutualFriend:getMutualFriend,
				setState:setState

			});
			init();
			function init(){
				// vm.id = user.user_id ||'';
				// vm.username = user.username || '';
				// vm.full_name = user.full_name || '';
				// vm.display_name = user.display_name || '';
				angular.extend(user,_user);
			}

			function setState(){
				drawerFactory.setState();
			}

			function showFrame(){
				$rootScope.$broadcast(
				"cButton",{})
				user.frame = true;
			}
			$rootScope.$on('cButton',function(){
				user.frame=false;
			})
			function closeFrame(){
				user.frame = false;
			}

			// add friend
			function action_addfriend(user){
				//alert(user_id+'_'+id);
				var user_id = user.user_id;
				//console.log(user_id);
				
				var ok = false;
				var c = {
					data: {
						"friend_id": user_id
					}
				}

				CiayoService.Api('users/relation/create', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;

						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						console.log(response);
						user.icon_addfriend = false;
						user.name_addfriend = false;
						user.ci_check = true;

						user.icon_follow = false;
						user.name_follow = false;
					}else{
						//...
					}
				});
			}

			// cancel friend request
			function cancel_friend_request(user){


				var user_id = user.user_id;
				
				var ok = false;
				var c = {
					data: {
						"friend_id": user_id
					}
				}

				CiayoService.Api('users/relation/cancel', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;

						console.log('sukses');
						user.icon_addfriend = true;
						user.name_addfriend = true;
						user.icon_self = 0;
						user.name_self = 0;
						user.ci_star = false;
						user.icon_action_response = false;
					}
					
				});
				
			}

			// Action response (accept or reject)
			function action_response(user){
				
				user.icon_action_response = true;
				
			}

			// click outside action-response
			function closeActionResponse(user){
				//alert("test");
				user.icon_action_response = false;
			}

			// action response accpet
			function action_response_accept(user){
				//alert(user_id+'_'+id);
				var user_id = user.user_id;
				//console.log(user_id);
				
				var ok = false;
				var c = {
					data: {
						"user_relation_id": user_id
					}
				}

				CiayoService.Api('users/relation/confirm', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;

						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						user.icon_addfriend = false;
						user.name_addfriend = false;
						user.checklist_addfriend = false;
						user.icon_follow = false;
						user.name_follow = false;
						user.icon_action_response = false;
						user.status.friend.approve=true;
						user.hide_approve = true;
					}else{
						//...
					}
				});
			}

			// action response delete
			function action_response_delete(user){
				//alert(user_id+'_'+id);
				var user_id = user.user_id;
				//console.log(user_id);
				
				var ok = false;
				var c = {
					data: {
						"friend_id": user_id
					}
				}

				CiayoService.Api('users/relation/reject', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;

						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						user.icon_addfriend = true;
						user.name_addfriend = true;
						user.icon_self = 0;
						user.name_self = 0;
						user.ci_star = false;
						user.icon_action_response = false;
					}else{
						//...
					}
				});
			}	

			// action follow
			function action_follow(user){
				//alert(user_id+'_'+id);
				var user_id = user.user_id;
				
				var ok = false;
				var c = {
					data: {
						user_id:user_id,
						follow:true
					}
				}

				CiayoService.Api('users/follow', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;

						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						user.icon_follow = false;
						user.name_follow = false;
					}else{
						//...
					}
				});
			}

			// action unfollow
			function action_unfollow(user){
				//alert(user_id+'_'+id);
				//alert(user_id+'_'+id);
				var user_id = user.user_id;
				
				var ok = false;
				var c = {
					data: {
						user_id:user_id,
						follow:false
					}
				}

				CiayoService.Api('users/follow', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;

						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						user.icon_follow = true;
						user.name_follow = true;
					}else{
						//...
					}
				});
			}		

		}

		function getMutualFriend(user_id, username){
			mutualFriendDrawer.open(user_id, username);
		}
		
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('friendRequestAllFactory', friendRequestAllFactory);
	friendRequestAllFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state', 'mutualFriendDrawer', 'navbarFactory', '$cookieStore'];

	function friendRequestAllFactory($rootScope,modalFactory, CiayoService, $state, mutualFriendDrawer, navbarFactory, $cookieStore) {
		var factory = {
			type:'user',
			fr_list:[],
			getFrList:getFrList,
			countFr:'',
			view_user:view_user,
			action_accept:action_accept,
			action_decline:action_decline,
			fr_start:false,
			load_more: false,
			loading: false,
			isloading:false,
			init:init,
			accept:false,
			decline:false,
			getMutualFriend:getMutualFriend
		};

		function init(){
			factory.fr_list = [];
			getFrList()
		}

		function getFrListNext(limit, offset){
			
				var offset = offset + 10;

				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('users/relation', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						var tmp_next=(data.content.data);
						
						if(tmp_next.length==0){
							factory.load_more = false;
						}else{
							factory.load_more = true;
						}		


					}else{
						//...
					}
				});

				factory.loading = false;
			
		}


		function getFrList(start){
			
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;

				if(start){
					factory.fr_list = [];
				}

				var offset = factory.fr_list.length;
				var limit = 10;

				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('users/relation', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.countFr = response.data.c.data.meta.total;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						//console.log(countFr);
						
						var tmp=(data.content.data);
						//console.log(tmp);
						angular.forEach(tmp,function(value,key){
							if(value){
								value.accept = false;
								value.decline = false;
								
								//console.log(friend_connection);
								factory.fr_list.push(value);	
							}
							

							
						});

						factory.fr_start = true;
						factory.isloading = false;
						getFrListNext(limit, offset);

					}else{
						//...
					}
				});
			}
		}

		function view_user(friend){
			$state.go('profile', {user: friend.username});
		}

		function action_accept(friend){
			

			var c={
				data:{
					"user_relation_id": friend.list_user.user_id
				}
			};

			CiayoService.Api('users/relation/confirm', c, function(response) {
				if(response.status==200){
					//console.log(friend);
					friend.accept = true;
					friend.decline = false;
				}else{
					console.log(response);
				}
				
			});

		}

		function action_decline(friend){
			var c={
				data:{
					"friend_id": friend.list_user.user_id
				}
			};

			CiayoService.Api('users/relation/reject', c, function(response) {
				if(response.status==200){
					//console.log(friend);
					friend.accept = false;
					friend.decline = true;
				}else{
					console.log(response);
				}
				
			});
		}

		function getMutualFriend(user_id, username){
			mutualFriendDrawer.open(user_id, username);
		}

		//socket confirm request friend		
		var socket = navbarFactory.Socket();
		//console.log(socket);
		socket.emit('set_userid', $cookieStore.get('user_id'));
        socket.on('nf003', function(data){ 
         	factory.fr_list = [];
         	factory.fr_start = false;
         	factory.load_more = false;
         	getFrList(true);
        });

        //socket add friend
        socket.on('nf002', function(data){ 
         	factory.fr_list = [];
         	factory.fr_start = false;
         	factory.load_more = false;
         	getFrList(true);
        });


		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('friendRequestFactory', friendRequestFactory);
	friendRequestFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state', 'mutualFriendDrawer', 'navbarFactory', '$cookieStore'];

	function friendRequestFactory($rootScope,modalFactory, CiayoService, $state, mutualFriendDrawer, navbarFactory, $cookieStore) {
		var factory = {
			type:'user',
			fr_list:[],
			// email_list:
			// 		  [{
			// 	        address: 'candradwiprasetyo@gmail.com', value: 'false'
			// 	      },
			// 	      {
			// 	        address: 'selubungers@gmail.com', value: 'false'
			// 	      },
			// 	      {
			// 	        address: 'diahwidhilestari@gmail.com', value: 'false'
			// 	      },
			// 	      {
			// 	        address: 'melon.candra@yahoo.com', value: 'false'
			// 	      }],
			email_list:[],
			email:'',
			getFrList:getFrList,
			countFr:'',
			view_user:view_user,
			action_accept:action_accept,
			action_decline:action_decline,
			fr_start:false,
			actionSendInvitation:actionSendInvitation,
			actionSendInvitationGmail:actionSendInvitationGmail,
			open_modal_item1:open_modal_item1,
			close_modal_item1:close_modal_item1,
			open_modal_item2:open_modal_item2,
			close_modal_item2:close_modal_item2,
			open_modal_item3:open_modal_item3,
			close_modal_item3:close_modal_item3,
			modal_item1: false,
			modal_item2:false,
			item2_load:false,
			getMutualFriend:getMutualFriend,
			i_email: '',
			load_email:load_email,
			start_load_email:false,
			i_search:'',
			i_description: 'There’s a distortion in time and space, and I got teleported into the CIAYO World! It’s fun here, tho. Join in!'
		};

		function load_email(){
			factory.item2_load = true;
			factory.start_load_email = true;
		}

		function open_modal_item1(){
			factory.i_email = '';
			factory.modal_item1 = true;
		}

		function open_modal_item2(){
			
			if(factory.start_load_email==true){
				factory.modal_item2 = true;
			}else{
				factory.modal_item2 = true;
				var config = {
			      	'client_id': '788891428909-o4a2s2hht5jud5at66crv1je57f9198i.apps.googleusercontent.com',
			      	'scope': 'https://www.google.com/m8/feeds'
			    };
			    gapi.auth.authorize(config, function() {
			       	fetch(gapi.auth.getToken());
			    });
			}
		}

		function fetch(token) {
		    $.ajax({
			    url: "https://www.google.com/m8/feeds/contacts/default/full?access_token=" + token.access_token + "&alt=json",
			    dataType: "jsonp",
			    success:function(data) {
			    	factory.modal_item2 = true;   
			        //console.log(JSON.stringify(data));
			  		var data_json = data;
			        //console.log(data_json);
					var entry_data = data_json.feed.entry;

					factory.email_name = data_json.feed.author.name;
					
					 for(var i=0; i<entry_data.length; i++){
					 	if(entry_data[i].gd$email){
					 		var email = entry_data[i].gd$email[0].address;

					 		factory.email_list.push({address: email});

					 		
					 	}
					 }	     

					 

			    }
			});
		}

		function open_modal_item3(){
			factory.modal_item3 = true;
		}

		function close_modal_item1(){
			factory.modal_item1 = false;
		}
		function close_modal_item2(){
			factory.modal_item2 = false;
		}

		function close_modal_item3(){
			factory.modal_item3 = false;
		}

		function actionSendInvitationGmail(){

			//console.log(factory.i_email);
			var jml = 0;
			var error = 0;
			for(var i=0; i<factory.email_list.length; i++){
				if(factory.email_list[i].value==true){
					jml++;
					var ok = false;
						var c = {
							data: {
								"email": factory.email_list[i].address
							}
						}
					CiayoService.Api('users/invite', c, function(response) {
						if(response.status==200){
							var data = response.data.c.data;

							
							//modalFactory.message(data.message.email[0]);
							
							if (data.error == false) {
								
							}else{
								error++;
							}
						}
						if(ok){
							console.log(data.message);
						}else{
							//...
						}
					});
				}
			}


			if(jml==0){
				modalFactory.message('Please select email');			
			}else{
				factory.modal_item2 = false;
				if(error==0){
					modalFactory.message("Your invitation has been sent");
				}else{
					modalFactory.message("Sent invitation error");
				}
			}
		}

		function actionSendInvitation(){

			if(factory.i_email){
				modalFactory.message(factory.i_email);

				var email_all = factory.i_email;

				var email = email_all.split(',');

				var error = 0;
				for(var i=0; i<email.length; i++){

					//console.log(email[i]);
					var ok = false;
						var c = {
							data: {
								"email": email[i]
							}
						}
					CiayoService.Api('users/invite', c, function(response) {
						if(response.status==200){
							var data = response.data.c.data;

							
							//modalFactory.message(data.message.email[0]);
							
							if (data.error == false) {
								
							}else{
								error++;
							}
						}
						if(ok){
							console.log(data.message);
						}else{
							//...
						}
					});
				}

				if(error==0){
					modalFactory.message("Your invitation has been sent");
				}else{
					modalFactory.message("Sent invitation error");
				}
				factory.modal_item1 = false;

			}else{
				modalFactory.message('Please fill email');
			}
			
		}

		function getFrList(){
			
				factory.fr_list=[];

				var offset = factory.fr_list.length;
				var limit = 3;

				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('users/relation', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.countFr = response.data.c.data.meta.total;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						//console.log(countFr);
						
						var tmp=(data.content.data);
						//console.log(tmp);
						angular.forEach(tmp,function(value,key){
							
							value.accept = false;
							value.decline = false;
							
							//console.log(friend_connection);
							factory.fr_list.push(value);

							
						});

						factory.fr_start = true;

					}else{
						//...
					}
				});
			
		}

		function view_user(friend){
			$state.go('profile', {user: friend.username});
		}

		function action_accept(friend){
			

			var c={
				data:{
					"user_relation_id": friend.list_user.user_id
				}
			};

			CiayoService.Api('users/relation/confirm', c, function(response) {
				if(response.status==200){
					//console.log(friend);
					friend.accept = true;
					friend.decline = false;

					$rootScope.$broadcast( "user.friend_request",'data');	

				}else{
					console.log(response);
				}
				
			});

		}

		function action_decline(friend){
			var c={
				data:{
					"friend_id": friend.list_user.user_id
				}
			};

			CiayoService.Api('users/relation/reject', c, function(response) {
				if(response.status==200){
					//console.log(friend);
					friend.accept = false;
					friend.decline = true;

					$rootScope.$broadcast( "user.friend_request",'data');	
				}else{
					console.log(response);
				}
				
			});
		}

		function getMutualFriend(user_id, username){
			mutualFriendDrawer.open(user_id, username);
		}

		//socket confirm request friend		
		var socket = navbarFactory.Socket();
		//console.log(socket);
		socket.emit('set_userid', $cookieStore.get('user_id'));
		
        socket.on('nf003', function(data){ 
         	factory.fr_list = [];
         	factory.fr_start = false;
         	getFrList(true);
        });

        //socket add friend
        socket.on('nf002', function(data){ 
         	factory.fr_list = [];
         	factory.fr_start = false;
         	getFrList(true);
        });


		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('globalFactory', globalFactory);
	globalFactory.$inject = ['$rootScope', 'CiayoService', 'listService'];

	function globalFactory($rootScope, CiayoService, listService) {
		//achievement, card detail, modal
		var factory = {
			data:null,
			init:init
		};

		function init(){
			console.log('Global sukses');
		}
		
		return factory;
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.factory('languageFactory', languageFactory);

	languageFactory.$inject = ['CiayoService', '$stateParams', '$filter', '$cookieStore', '$translate', 'modalFactory'];

	function languageFactory(CiayoService, $stateParams, $filter, $cookieStore, $translate, modalFactory) {
		var factory = {
			getLanguage:getLanguage,
			changeLanguage:changeLanguage
		}

		function getLanguage() {
			var c={data:{}};
            CiayoService.Api('language', c, function(response) {
                var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.current_language = data.content.language;
					modalFactory.log('language: '+factory.current_language,'info');
					var lang_code = ['','en', 'id'];
					$translate.use(lang_code[factory.current_language]);
					$cookieStore.put('language', factory.current_language);
				} else {

				}
            });
		}
		function changeLanguage(language_id, callback) {
			var c={
				data:{
					language_id: language_id
				}
			};
            CiayoService.Api('language', c, function(response) {
                var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.current_language = data.content.language;
					modalFactory.log('language: '+factory.current_language,'info');
					var lang_code = ['','en', 'id'];
					$translate.use(lang_code[factory.current_language]);
					$cookieStore.put('language', factory.current_language);
					callback(factory.current_language);
				} else {

				}
            });
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('menuFactory', menuFactory);
	menuFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state'];

	function menuFactory($rootScope,modalFactory, CiayoService, $state) {
		var factory = {
			userBasicInfo:userBasicInfo
		};

		function userBasicInfo() {
			
			var c = {
				data : {
					username:''
				}
			};
			CiayoService.Api('users/info', c, function(response) {
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					
					factory.menu_avatar = data.content.users_avatar.avatar_crop;
					factory.menu_background_avatar = data.content.users_avatar.background_avatar;		

					//console.log(factory.menu_avatar);
				} else {

				}
			});
			
		}
		

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('modalFactory', modalFactory);
	modalFactory.$inject = ['$rootScope', 'CiayoService', 'listService', 'AchievementService'];

	function modalFactory($rootScope, CiayoService, listService, AchievementService) {
		//achievement, card detail, modal
		var factory = {
			data:null,
			modal_class:'',
			isOpen:'',
			template:'',
			title:'',
			callback:angular.noop(),
			setState:setState,
			message: message,
			confirm:confirm,
			log: log,
			popup_achievement:popup_achievement
		};
		/**
		Show alert
		*/
		function message(message) {
			factory.data={};
			factory.data.message=message;
			factory.modal_class='';
			factory.template=DIRECTIVES_VIEW+'modal-message.html';
			
			$rootScope.$broadcast('modal.open',{});
		}
		function confirm(message,callback){
			factory.data={};
			factory.data.message=message;
			factory.modal_class='cm-modal -dialog';
			factory.template = DIRECTIVES_VIEW+'modal-confirm.html';
			factory.tFnc = function(){callback({result:true})};
			factory.fFnc = function(){callback({result:false})};
			$rootScope.$broadcast('modal.open',{})
		}

		

		function setState(value){
			if(value){
				$("html, body").css({"overflow": "hidden"});
				factory.isOpen='-open';
			}else{
				$("html, body").removeAttr("style");
				factory.isOpen='';
				factory.template='';
				factory.title='';
				factory.data=null;
				factory.modal_class='';
			}
		}
		
		/**
		 * Show log (ONLY DEVELOPER)
		 * Note : in production set environment DEVELOPMENT to false
		 */
		function log(message, type) {
			if (DEVELOPMENT)
				switch (type) {
					case 'warn': console.warn(message);
					break;
					case 'error': console.error(message);
					break;
					case 'info': console.info(message);
					break;
					case 'log': console.log(message);
					break;
					default: console.log(message);
					break;
				}
		}

		function popup_achievement(id){
			AchievementService.getDetail(id, function(data){
				console.log(data);
				factory.data={};
				factory.detail=data.content;
				factory.modal_class='cm-modal -dialog';
				factory.template = DIRECTIVES_VIEW+'modal-popup-achivement.html';
				//factory.tFnc = function(){callback({result:true})};
				//factory.fFnc = function(){callback({result:false})};
				$rootScope.$broadcast('modal.open',{})
			},function(response){
			 	console.log(response);
			 });
		}

		function popup_achievement_old(id){
			AchievementService.getDetail(id, function(data){
				//console.log(response);
				var itemDetail=data.content;
				//var itemDetail.date_get = date.getDate()+'/'+(date.getMonth()+1)+'/'+date.getFullYear();
				
				$rootScope.$broadcast(
					'modal.open',
					{
						'template':'app/directives/views/popup-achievement.html',
						'data':{
							itemDetail:itemDetail,
							shareFB:function(id_achievement,id){
								facebookFactory.getToken(function (data) {
									//alert(data.accessToken);
									access_token = data.accessToken;
									uid = data.uid;


									AchievementService.shareFB(access_token, uid, id_achievement,id, function (response) {
										var data = response.data.c.data;
										if(data.error==false){
											//closeDetail();
											message(data.message);
											//vm.isFB = false;
										}
									}, function () {

									});
								});
								//console.log(id_achievement+'_'+id);
							},
							useAsTitle: function(id){
								var updated_filter = [{"filter_id":520,"filter_value" : id}];
								SettingService.updateUserFilter(updated_filter, '2').then(function(data) {
									
									message(data.message);
								});

							}
						}
					}
				);
			 },function(response){
			 	console.log(response);
			 });
		}

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('mutualFriendFactory', mutualFriendFactory);
	mutualFriendFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state', '$stateParams'];

	function mutualFriendFactory($rootScope,modalFactory, CiayoService, $state, $stateParams) {
		var factory = {
			type:'user',
			user_id:'',
			username:'',
			mutual_friend_list:[],
			getMutualFriendList:getMutualFriendList,
			action_accept:action_accept,
			action_decline:action_decline,
			mutual_start:false,
			load_more: false,
			loading: false,
			isloading:false,
			accept: false,
			decline: false,
			init: init
		};
		function init(){
			factory.accept = false;
			factory.decline = false;
			factory.mutual_friend_list = [];
		}

		function getMutualFriendListNext(limit, offset){
				
				var offset = offset + 10;

				var ok = false;
				var c = {
					data: {
						"user_id": factory.user_id,
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('users/friend/mutual', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						var tmp_next=(data.content.list_user);
						
						if(tmp_next.length==0){
							factory.load_more = false;
						}else{
							factory.load_more = true;
						}		


					}else{
						//...
					}
				});

				factory.loading = false;
				factory.loader_drawer = false;
			
		}


		function getMutualFriendList(start){
			
			//alert($stateParams.user_id);

			getUserInfo();
			
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;

				if(start){
					factory.mutual_friend_list = [];
				}
				var offset = factory.mutual_friend_list.length;
				var limit = 10;

				var ok = false;
				var c = {
					data: {
						"user_id": factory.user_id,
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('users/friend/mutual', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						//console.log(countFr);
						
						var tmp=(data.content.list_user);
						//console.log(tmp);
						angular.forEach(tmp,function(value,key){
							
							value.accept = false;
							value.decline = false;
							
							//console.log(friend_connection);
							factory.mutual_friend_list.push(value);

							
						});

						factory.mutual_start = true;
						factory.isloading = false;
						getMutualFriendListNext(limit, offset);

					}else{
						//...
					}
				});
			}
		}

		function getUserInfo(){

			var user_id = factory.user_id;//$stateParams.user_id;
			var username = factory.username;//$stateParams.username;
			//alert(user_id);

			var ok = false;
			var c = {
				data: {
					"username": username
				}
			}
			CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						//console.log(data);
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(gender_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.username_parent 			= 	username;
						factory.user_id_parent 				= 	user_id;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
						factory.status 						=   data.content.status;
						console.log(factory.status);
						if(data.content.status.friend.add==true){
							

							if(data.content.status.friend.approve==true){
								factory.approve = true;
								factory.accept = true;
							}else{
								factory.approve = false;
								factory.accept = false;
							}

						}else{
							factory.approve = false;
							factory.accept = false;
						}

					}
				});
			
				
		}

		function view_user(friend){
			$state.go('profile', {user: friend.username});
		}

		function action_accept(user_id){
			
			console.log(user_id);
			var c={
				data:{
					"user_relation_id": user_id
				}
			};

			CiayoService.Api('users/relation/confirm', c, function(response) {
				if(response.status==200){
					//console.log(friend);
					factory.accept = true;
					factory.decline = false;
				}else{
					console.log(response);
				}
				
			});

		}

		function action_decline(user_id){
			console.log(user_id);

			var c={
				data:{
					"friend_id": user_id
				}
			};

			CiayoService.Api('users/relation/reject', c, function(response) {
				if(response.status==200){
					//console.log(friend);
					factory.accept = false;
					factory.decline = true;
				}else{
					console.log(response);
				}
				
			});
		}

		


		return factory;
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.factory('navbarFactory', navbarFactory);

	navbarFactory.$inject = ['$http', '$cookieStore', '$rootScope', 'CiayoService', 'socketFactory'];
	function navbarFactory($http, $cookieStore, $rootScope, CiayoService, socketFactory) {
		var service = {
			listNotification:listNotification,
			listFriendRequest:listFriendRequest,
			requestMarkAllNotification:requestMarkAllNotification,
			Socket:Socket
		};
		
		return service;

		function requestMarkAllNotification(callback,errCallback){
			var c={
				data:{	}
			};
			CiayoService.Api('notification/read/all', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}
		
		function listNotification(type, limit, offset, callback,errCallback){
			var c = {
				data: {
					"type": type,
					"limit": limit,
					"offset": offset,
					"order_by": 'created_at'
				}
			}
			CiayoService.Api('notification', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}

		function listFriendRequest(limit, offset, callback,errCallback){
			var c = {
				data: {
					"limit": limit,
					"offset": offset
				}
			}
			CiayoService.Api('users/relation', c, function(response) {
				if(response.status==200){
					callback(response);
				} else {
					errCallback(response);
				}
			});
		}

		function Socket(){
			if(SOCKET_API_SERVER){
				var ioSocket = io.connect(SOCKET_API_SERVER);
			}else{
				var ioSocket = io.connect('https://apidev.ciayo.com/');
			}
			
			var socket = socketFactory({ioSocket:ioSocket});
			return socket;
		}
		
		
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('notificationFactory', notificationFactory);
	notificationFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state', 'navbarFactory', '$cookieStore','cardResponseWith','cardResponsePlace','timelineFactory','cardDetailDrawer','cardFactory'];

	function notificationFactory($rootScope,modalFactory, CiayoService, $state, navbarFactory, $cookieStore,cardResponseWith,cardResponsePlace,timelineFactory,cardDetailDrawer,cardFactory) {
		var factory = {
			type:'user',
			notification_list:[],
			getNotificationList:getNotificationList,
			load_more: false,
			loading: false,
			isloading:false,
			view_notification:view_notification,
			notification_start: false,
			isRetinaDisplay:isRetinaDisplay,
			mark_all_notification:mark_all_notification,
			init:init
		};

		function mark_all_notification(){
			navbarFactory.requestMarkAllNotification (function(response){
				//console.log(response);

				angular.forEach(factory.notification_list,function(value,key){
					factory.notification_list[key].read_at = 1;
				});
		

			},function(response){
				//console.log(response);
			});
		}

		 function isRetinaDisplay() {
		 	
             	if (window.devicePixelRatio >= 2) {
					return 'retina';
				} else {
					return 'non retina';
				}
        }
	
		function getNotificationListNext(start, limit, offset){
			
		
				if(start){
					factory.notification_list=[];
				}

				offset = offset + 10;
			
				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset,
						"order_by": 'created_at'
					}
				}
				CiayoService.Api('notification', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						//factory.notification_list = factory.notification_list.concat(data.content.list_user);

						var tmp_next=(data.content.list_notification);
						factory.loading = false;
						if(tmp_next.length==0){
							factory.load_more = false;
						}else{
							factory.load_more = true;
						}		

					}else{
						//...
					}
				});

			
			
		}


		function getNotificationList(start){
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
			
				if(start){
					factory.notification_list=[];
				}
			
				var offset = factory.notification_list.length;
				var limit = 10;

				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset,
						"order_by": 'created_at'
					}
				}
				CiayoService.Api('notification', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){
						//factory.notification_list = factory.notification_list.concat(data.content.list_user);
						var tmp=(data.content.list_notification);
						//console.log(tmp);
						angular.forEach(tmp,function(value,key){
							
							value.frame = false;
							value.read_at = 1;
							
							//console.log(friend_connection);
							factory.notification_list.push(value);
							
						});
						factory.notification_start = true;
						factory.isloading = false;
						factory.loading = false;
						//getNotificationListNext(false, limit, offset);
						if (data.meta.current_page<data.meta.last_page) {
							factory.load_more = true;
						} else {
							factory.load_more = false;
						}
					}else{
						//...
					}
				});
			}
		}

		function view_notification(notification){
			
			var post_id = notification.post_id;
			var read_at_real = notification.read_at;
			var notification_id = notification.notification_id;
			var type = notification.type;
			var username = notification.username;
			var post_code = notification.post_code;
			var from_name = notification.from_user_display_name;

			if(read_at_real==null){
				var read_at = Number(new Date());

				var c = {
					data: {
						"notification_id": notification_id,
						"type" : type,
						"read_at" : read_at
					}
				}
				CiayoService.Api('notification/read', c, function(response) {
					if(response.status==200){

						notification.read_at = 1;

						
						if(type=="friend_request" || type == "follow_request" || type == "added_friend"){
							$state.go('profile', {username: username});
						}else if(type=="ask_with"){
							cardResponseWith.open();
						}else if(type=="ask_place"){
							cardResponsePlace.open();
							//modalFactory.placeCard(post_code);
						}else{
//							$state.go('detail-page', {post_id: post_code});
							var c = {
								data: {
									"post_code": post_code,
								}
							}
							timelineConnector.cardGet(post_code).then(function(data){
									cardDetailDrawer.open(new cardFactory(data.content,timelineFactory._super,'detail'),function(){
										
									});
							},function(response){
								
							});
						}
					}
					
				});
				$rootScope.$broadcast( "user.notification",'data');	

			}else{
				
				if(type=="friend_request" || type == "follow_request" || type == "added_friend"){
					$state.go('profile', {username: username});
				}else if(type=="ask_with"){
					cardResponseWith.open(post_code,from_name);
				}else if(type=="ask_place"){
					cardResponsePlace.open(post_code,from_name);
				}else{
					var c = {
								data: {
									"post_code": post_code,
								}
							}
							CiayoService.Api('post/detail', c, function (response) {
								var data = response.data.c.data;
								if(data.error==false){
									cardDetailDrawer.open(new cardFactory(data.content,timelineFactory._super,'detail'),function(){
									
									});
								}
							});
				}
			}

		}

		function init(){

				var c={
	                data:{
	                    username:''
	                }
	            };
	            CiayoService.Api('users/info', c, function(response) {
	                var data=response.data.c.data;
					factory.token_user_id = data.content.user_id;
					run_socket();
	            });
			 
		}

		function run_socket(){
			// socket commend				
			var socket = navbarFactory.Socket();
			//console.log(socket);
			socket.emit('set_userid', factory.token_user_id);
			socket.on('nf004', function(data){  
				factory.notification_list = [];
				factory.notification_start = false;
				factory.load_more = false;
	         	getNotificationList(true);
	        });

	        //socket like
	        socket.on('nf005', function(data){  
	         	factory.notification_list = [];
	         	factory.notification_start = false;
				factory.load_more = false;
	         	getNotificationList(true);
	        });
			//socket ask response
	        socket.on('ant001', function(data){  
	         	factory.notification_list = [];
	         	factory.notification_start = false;
				factory.load_more = false;
	         	getNotificationList(true);
	        });

	        //socket confirm request friend
	        socket.on('nf003', function(data){ 
	         	factory.notification_list = [];
	         	factory.notification_start = false;
				factory.load_more = false;
	         	getNotificationList(true);
	        });

	        //socket add friend
	        socket.on('nf002', function(data){ 
	         	factory.notification_list = [];
	         	factory.notification_start = false;
				factory.load_more = false;
	         	getNotificationList(true);
	        });
	    }

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('postFactory', postFactory);
	postFactory.$inject = [
		'$rootScope','$filter','modalFactory', 'CiayoService','cardParallaxFactory',
		'cardCaptionDrawer','cardItemDrawer','cardWithDrawer','cardPlaceDrawer','timelineConnector'
	];

	function postFactory(
		$rootScope,$filter,modalFactory, CiayoService,cardParallaxFactory,
		cardCaptionDrawer,cardItemDrawer,cardWithDrawer,cardPlaceDrawer,timelineConnector
		) {
		var factory = {
			parallax_setting:false,
			allowedState : ['none','post','item','with','place','caption'],
			state:'',
			reset:reset,
			caption:'',
			activity: {
				search: '',
				data:null,
				parallax:null,
				list: [],
				isEmpty:false
			},
			mood:{
				data:null,
				list: []
			},
			permission:{
				data:null,
				list: []
			},
			items:[],
			withs:[],
			place:null,
			tmp:null,
			hide_parallax:false,
			//FUNCTION
			init:init,
			setState:setState,
			isPostActive:isPostActive,
			resetActivities:resetActivities,
			//API+FUNCTIONAL
//			postAttributes:postAttributes,
			searchActivity:searchActivity,
			selectActivity:selectActivity,
			selectMood:selectMood,
			setCaption:setCaption,
			setItem:setItem,
			setWith:setWith,
			setPlace:setPlace,
			save:save
		};
		
		function init(){
			reset();
			postAttributes(function(){
				getSettings(function(){
					reset();
				},function(){reset();});
			},function(){
				
			});
			
		}
		function setState(state){
			if(factory.allowedState.indexOf(state)!=-1){
				factory.state = state;
			}else{
				modalFactory.log('state '+state+' not found','error');
			}
		}
		function isPostActive(){
			var index = factory.allowedState.indexOf(factory.state);
			return !(index==-1 || index==0);
		}
		
		function reset(){
			factory.caption='';
			factory.activity.search='';
			factory.activity.data=null;
			factory.activity.parallax=null;
			resetActivities();
			factory.mood.data=factory.mood.list[0];
			factory.permission.data = factory.permission.list[0];
			angular.forEach(factory.permission.list,function(value,key){
				if(value.id==0)
					factory.permission.data = value;
			})
			factory.items=cardItemDrawer.getInitData();
			factory.withs=[];
			factory.place=null;
			factory.loadingActivity=false;
			factory.activity.isEmpty=false;
		}
		function resetActivities(){
			factory.activity.list=[];
		}
		//API+FUNCTIONAL
		function postAttributes(callback, errCallback) {
			if (factory.permission.list.length!=0 && factory.mood.list.length!=0) {
				callback();
				return;
			}
			var c = {
				data: {}
			}
			CiayoService.Api('post/attributes', c, function (response) {
				var ok = false;
				var data = null;
				if (response.status == 200) {
					data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if (ok) {
					factory.permission.list=[];
					factory.permission.list = data.content.post_category;
					angular.forEach(factory.permission.list, function (value, key) {
						value.icon = value.name.toLocaleLowerCase().replace(' ', '-');
					});
					factory.mood.list.list=[];
					factory.mood.list = data.content.post_moods;
					angular.forEach(factory.mood.list,function(value,key){
						value.icon = 
							value.name.toLowerCase()=='normal'?
							'ci-mood-normal':
							'ci-mood-'+value.name.toLocaleLowerCase().replace(' ','-');
					});
					callback();
				} else {
					errCallback(response);
				}
			});
		}
		function getSettings(callback, errCallback) {
			var c={
					data:{
					}
			};
			CiayoService.Api('settings', c, function(response) {
					if(response.status==200) {
						var data = response.data.c.data;
						if(data.error==false){
							factory.parallax_setting = data.content.list_setting.general_setting.card_setting.parallax_view;
							callback(response);
						}else{
							modalFactory(data.message);
						}
					} else {
							errCallback(response);
					}
			});
	}
		function searchActivity(from){
			var keyword=factory.activity.search;
			if(keyword=='' || factory.activity.data!=undefined){return;}
			factory.activity.list=[];
			factory.loadingActivity=true;
			
			factory.activity.isEmpty=false;
			timelineConnector.activityGet(keyword).then(function(data){
				if(data.content.list_activity.length==0 && from==undefined){
					factory.activity.isEmpty=true;
				}else{
					factory.activity.list=data.content.list_activity;
				}
				factory.loadingActivity=false;
			},function(){
				
			});
		}
		function selectActivity(activity){
			var ok=false;
			var search_data = activity;
			var c = {
				data: {
					"activity_id": search_data.activity_id
				}
			};
			factory.activity.search=search_data.activity_name;
			factory.activity.data={};
			factory.activity.loading=true;
			factory.activity.parallax=null;
			timelineConnector.activityDetail(search_data.activity_id).then(function(data){
				factory.activity.loading=false;
				if(data.error==false){
					factory.activity.data=data.content;
					factory.activity.data.parallax_setting=false;//factory.parallax_setting;
					if(factory.activity.data.avatar_url){
						factory.activity.data.face = factory.activity.data.avatar_url.normal;
					}
					factory.activity.data.caption_bubble=false;
					factory.activity.parallax = new cardParallaxFactory(factory.activity.data);
					
				}else{
					factory.activity.data=null;
					modalFactory.message(data.message);
				}
			},function(response){
				
			});
			factory.activity.list=[];
		}
		function selectMood(mood){
			var const_mood =['normal','happy','sad'];
			factory.mood.data=mood;
			if(factory.activity.data.avatar_url){
				factory.activity.data.face = factory.activity.data.avatar_url[const_mood[mood.mood_id-1].toLowerCase()];
				factory.activity.parallax = new cardParallaxFactory(factory.activity.data);
			}
			
		}
		function setCaption(){
			factory.hide_parallax=true;
			cardCaptionDrawer.open(
				'ADD',
				factory.caption,factory.activity.parallax,
				function(data){
					factory.caption = data.caption;
					factory.hide_parallax=false;
			});
		}
		function setItem(index){
			cardItemDrawer.open(
				'ADD',
				factory.items,
				index,
				function(data){
					factory.index = index;
					factory.items = data.items;
				}
			)
		}
		function setWith(){
			cardWithDrawer.open(
				'ADD',
				factory.withs,
				function(data){
					factory.withs = data.withs;
				}
			);
		}
		function setPlace(){
			cardPlaceDrawer.open(
				'ADD',
				factory.place,
				function(data){
					factory.place = data.place;
				}
			);
		}
		function save(callback){
			if(factory.activity.loading || factory.activity.data==undefined || factory.activity.data.activity_id==undefined){
				modalFactory.message('Please wait');
				return false;
			}
			var _items=[],_users=[];
			angular.forEach(factory.items,function(value,key){
				if(value){
					_items.push({'id':value.item_id,'type':value.item_type});
				}
			});
			angular.forEach(factory.withs,function(value,key){
				_users.push({'id':value.id,'username':value.user_name});
			});
			timelineConnector.cardCreate(
				factory.activity.data.activity_id,
				factory.mood.data.mood_id,
				factory.place?factory.place.id:null,
				factory.permission.data.id,
				factory.caption,
				false,
				_items,
				_users
			).then(function(data){
				callback(data.content);
				reset();
			},function(response){
				
			});
			return true;
		}
			
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('profileConnectionFactory', profileConnectionFactory);
	profileConnectionFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', 'friendConnectionFactory', '$cookieStore', '$stateParams'];

	function profileConnectionFactory($rootScope,modalFactory, CiayoService, friendConnectionFactory, $cookieStore, $stateParams) {
		var factory = {
			type:'',
			user_list:[],
			mutual_list:[],
			getFriendList:getFriendList,
			getFriendListNext:getFriendListNext,
			getMutualList:getMutualList,
			load_more:false,
			loading: false,
			isloading:false,
			load_more_mutual:false,
			loading_mutual: false,
			isloading_mutual:false,
			redirect_page:redirect_page,
			tab_active:'friend',
			get_profile:get_profile,
			user_friend_id: '',
			data_profile: []
		};

		function get_profile(){

			factory.user_list=[];

			if($stateParams.username){
				var ok = false;
				var c = {
					data: {
						"username": $stateParams.username
					}
				}

				CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.user_friend_id = data.content.user_id;
						getFriendList(true);
						getMutualList(true);

						//factory.data_profile = data.content;

						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(display_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
					}
					
				});

				factory.myprofile = false;

			}else{

				var ok = false;
				var c = {
					data: {
						"username": ''
					}
				}

				CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.user_friend_id = '';
						getFriendList(true);
						getMutualList(true);

						//factory.data_profile = data.content;

						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(display_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
					}
					
				});

				
				factory.myprofile = true;


			}

			
			//var user_friend_id = ($stateParams.username) ? '999' : $cookieStore.get('user_id');
			
		}

		function getFriendListNext(keyword, start, limit, offset, api, type){
			
			
				if(start){
					factory.user_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api, type);
			
		}

		function getMutualListNext(keyword, start, limit, offset, api, type){
			
			
				if(start){
					factory.mutual_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api, type);
			
		}

		function getFriendList(start){
			
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
				var keyword = '';
				
					if(start){
						factory.user_list=[];
					}
					
					var offset = factory.user_list.length;
					var limit = 10;
					
					getApi(keyword, start, limit, offset, 'search/friend/name', 'friend');
					getFriendListNext(keyword, false, limit, offset, 'search/friend/name', 'friend');
				
			}
			
		}

		function getMutualList(start){
			
			if(!factory.isloading_mutual){
				factory.isloading_mutual = true;
				factory.loading_mutual = true;
				var keyword = '';
				
					if(start){
						factory.mutual_list=[];
					}
					
					var offset = factory.mutual_list.length;
					var limit = 10;
					
					getApi(keyword, start, limit, offset, 'users/friend/mutual', 'mutual');
					getMutualListNext(keyword, false, limit, offset, 'users/friend/mutual', 'mutual');
				
			}
			
		}

		function getApi(keyword, start, limit, offset, api, type){
			var ok = false;

			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);
					var tmp=(data.content.list_user);

					if(type=='friend'){
						factory.count_friend_list = data.meta.total;
					}else{
						factory.count_mutual_list = data.meta.total;
					}

					//console.log(tmp.length);
					angular.forEach(tmp,function(value,key){
						
						value.frame = false;
						if($cookieStore.get('user_id')==tmp[key].user_id){
							value.button_self = true;
						}else{
							value.button_self = false;
						}
								
						value.icon_action_response = false;
						value.open_action = false;
						value.ci_star = false;
						value.ci_check = false;
						
						if(tmp[key].status.friend.add==false){
							value.icon_addfriend = true;
							value.name_addfriend = true;
							value.icon_self = 0;
							value.name_self = 0;
							
							
						}else{
							
							if(tmp[key].status.friend.addstatus==false){
								if(tmp[key].status.friend.approve==true){
									value.icon_addfriend = false;
									value.name_addfriend = false;
									value.icon_self = 0;
									value.name_self = 0;
									
								}else{
									value.icon_addfriend = true;
									value.name_addfriend = true;
									value.icon_self = 1;
									value.name_self = 1;
									
									value.ci_star = true;
								}
							}else{
								value.icon_addfriend = false;
								value.name_addfriend = false;
								value.icon_self = 0;
								value.name_self = 0;
								value.ci_check = true;
							}
						}

						if(tmp[key].status.friend.approve==false){
							value.checklist_addfriend = true;
						}else{
							value.checklist_addfriend = false;
						}

						if(tmp[key].status.follow==false){
							value.icon_follow = true;
							value.name_follow = true;
							value.checklist_follow = true;
						}else{
							value.icon_follow = false;
							value.name_follow = false;
						}
						
						var friend_connection = new friendConnectionFactory(value);
						//console.log(friend_connection);
						if(type=='friend'){
							factory.user_list.push(friend_connection);
						}else{
							factory.mutual_list.push(friend_connection);
						}

					});
					if(type=='friend'){
						factory.isloading = false;
					}else{
						factory.isloading_mutual = false;
					}
					//factory.load_more = true;
					//factory.loading = false;
					
					
				}else{
					//...
				}
			});
			
		}

		function getApiNext(keyword, start, limit, offset, api, type){
			var ok = false;
			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);

					var tmp_next=(data.content.list_user);

					
					if(tmp_next.length==0){
						if(type=='friend'){
							factory.load_more = false;
						}else{
							factory.load_more_mutual = false;
						}
					}else{
						if(type=='friend'){
							factory.load_more = true;
						}else{
							factory.load_more_mutual = true;
						}
					}	
				}else{
					//...
				}
			});

			if(type=='friend'){
				factory.loading = false;
			}else{
				factory.loading_mutual = false;
			}

				
		}

		function redirect_page(page){
			factory.tab_active = page;
		}

		function getSearchFriend(username){
			searchFriendDrawer.open(username);
		}

		return factory;
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.factory('profileFactory', profileFactory);

	profileFactory.$inject = ['$state', 'modalFactory','$stateParams','CiayoService', 'friendConnectionFactory', '$cookieStore', 'searchFriendDrawer', '$rootScope', 'settingConnector'];

	function profileFactory($state, modalFactory,$stateParams,CiayoService, friendConnectionFactory, $cookieStore, searchFriendDrawer, $rootScope, settingConnector) {
		var factory = {
			userBasicInfo:userBasicInfo,
			listTitle:listTitle,
			editFilter:editFilter,
			editUsername:editUsername,
			editWebsite:editWebsite,
			saveWebsite:saveWebsite,
			removeWebsite:removeWebsite,
			saveNameTitle:saveNameTitle,
			listPrefix:listPrefix,
			settingHide:settingHide,
			showEmail:showEmail,
			showPhone:showPhone,
			showBirthday:showBirthday,
			showNationality:showNationality,
			listAchievement:listAchievement,
			listBadge:listBadge,
			showAchievement:showAchievement,
			showBadge:showBadge,
			pickAchievement:pickAchievement,
			pickBadge:pickBadge,
			removeAchievement:removeAchievement,
			removeBadge:removeBadge,
			saveChoiceAchievement:saveChoiceAchievement,
			saveChoiceBadge:saveChoiceBadge,
			listChoiceAchievement:listChoiceAchievement,
			listChoiceBadge:listChoiceBadge,
			choiceAchievementSave:choiceAchievementSave,
			choiceBadgeSave:choiceBadgeSave,
			getDetailAchievement:getDetailAchievement,
			seeAllAchievement:seeAllAchievement,
			closeDetail:closeDetail,
			openSearchAchievement:openSearchAchievement,
			gotoTab:gotoTab,
			state:1,
			profileContent:profileContent,
			saveMediaSocial:saveMediaSocial,
			saveMoreSocialMedia:saveMoreSocialMedia,
			listSocialMedia:listSocialMedia,
			deleteSocialMedia:deleteSocialMedia,
			editMediaSocial:editMediaSocial,
			cancelRequest:cancelRequest,
			sendRequest:sendRequest,
			reset:reset,
			follow,
			addfriend,
			approvefriend,
			info: {
				data:[],
				list:[]
			},
			title: {
				list: []
			},
			choice_achievement: [],
			choice_badge: [],
			pick_achievement: [],
			pick_badge: [],
			slot1: [],
			slot2: [],
			type:'',
			user_list:[],
			mutual_list:[],
			getFriendList:getFriendList,
			getFriendListNext:getFriendListNext,
			getMutualList:getMutualList,
			load_more:false,
			loading: false,
			isloading:false,
			load_more_mutual:false,
			loading_mutual: false,
			isloading_mutual:false,
			redirect_page:redirect_page,
			tab_active:'friend',
			get_profile:get_profile,
			user_friend_id: '',
			data_profile: [],
			getSearchFriend:getSearchFriend,
			goto_back:goto_back,
			getBanner:getBanner
		}

		function getBanner(){

			var c = {
				data: {
					type: "profile"
				}
			}

			CiayoService.Api('users/banner', c, function(response) {
                var data=response.data.c.data.content.image;
                factory.banner = data;
				setTimeout(function(){
					$('.c-banner').children("ul").parallax({
						clipRelativeInput: false,
						originX: 0.0,
						originY: 1.0,
						frictionY: 0.0,
					});
				}, 1000)
                //console.log(data);
            });
			
		}

		factory.edit_list_website = [];

		function userBasicInfo() {
			//setTimeout(function(){
				factory.load_info = false;
				var c = {
					data : {
						username:$stateParams.username
					}
				};
				CiayoService.Api('users/info', c, function(response) {
					var ok = false;
					var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						//console.log(data);
						modalFactory.log(data,'info');
						var info=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						get_profile();
						settingHide();
						factory.info.list=[];
						factory.info.list = data.content.users_info;
						factory.username = $stateParams.username;
						factory.user_id = data.content.user_id;

						factory.status_follow = data.content.status.follow;
						factory.status_approve = data.content.status.friend.approve;
						factory.status_add = data.content.status.friend.add;
						factory.status_addstatus = data.content.status.friend.addstatus;
						factory.profile_avatar = data.content.users_avatar.avatar;

						factory.info.data=[];
						angular.forEach(factory.info.list, function(value,key) {
							factory.info.data[value.filter_id] = value;
						})

						if(factory.username) {
							try {
								factory.email = data.content.email;
							}catch(err){}
							try {
								factory.phone = data.content.phone;
							}catch(err){}
							
							try {
								factory.place_of_birth = factory.info.data[7].value+', ';
								factory.edit_place_birth = factory.info.data[7].value;
							}catch(err){}
							try {
								var timestamp = factory.info.data[6].value;
								var date = new Date(timestamp * 1000);
								if($cookieStore.get('language')==1) {
									var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
								}
								if($cookieStore.get('language')==2) {
									var months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
								}
								factory.date_of_birth = date.getDate() + " " + months[date.getMonth()] + " " + date.getFullYear();

								var _date = parseInt(date.getDate());
								if(_date<10) {
									_date = "0" + date.getDate();
								}
								var _mounth = parseInt(date.getMonth())+1;
								if(_mounth<10) {
									_mounth = "0" + (parseInt(date.getMonth())+1);
								}
								var newdate = _date + "/" + _mounth + "/" + date.getFullYear();
								$('#inputDate').val(newdate);
							}catch(err){}
						}

						try {
							factory.first_name = factory.info.data[2].value
							factory.edit_first_name = factory.first_name
						}catch(err){factory.first_name=''}
						try {
							factory.middle_name = factory.info.data[3].value
							factory.edit_middle_name = factory.middle_name
						}catch(err){factory.middle_name=''}
						try {
							factory.last_name = factory.info.data[4].value
							factory.edit_last_name = factory.last_name
						}catch(err){factory.last_name=''}
						try {factory.profile_name = factory.info.data[5].value}catch(err){}
						try {factory.edit_profile_name = factory.info.data[5].value}catch(err){}
						
						try {factory.pinterest = 'http://pinterest.com/'+factory.info.data[501].value}catch(err){factory.pinterest = false}
						try {factory.facebook = 'http://facebook.com/'+factory.info.data[480].value;factory.facebook_account=factory.facebook}catch(err){ factory.facebook = false}
						try {factory.twitter = 'http://twitter.com/'+factory.info.data[481].value;factory.twitter_account=factory.twitter}catch(err){ factory.twitter = false}
						try {factory.instagram = 'http://instagram.com/'+factory.info.data[482].value;factory.instagram_account=factory.instagram}catch(err){factory.instagram = false}
						try {factory.path = 'http://path.com/'+factory.info.data[500].value;factory.path_account=factory.path}catch(err){factory.path = false}

						factory.socialType = [];
						if(!factory.facebook) factory.socialType.push({name: 'Facebook', value: 'facebook'});
						if(!factory.twitter) factory.socialType.push({name: 'Twitter', value: 'twitter'});
						if(!factory.instagram) factory.socialType.push({name: 'Instagram', value: 'instagram'});
						if(!factory.pinterest) factory.socialType.push({name: 'Pinterest', value: 'pinterest'});
						if(!factory.path) factory.socialType.push({name: 'Path', value: 'path-01'});
						try {factory.select_social_media = factory.socialType[0].value}catch(err){}
						if(factory.facebook&&factory.twitter&&factory.instagram&&factory.pinterest&&factory.path) {
							factory.all_social_media = true;
						} else {
							factory.all_social_media = false;
						}
						try {factory.title = factory.info.data[520].value;factory.edit_title=factory.title;factory._title=true}catch(err){factory.title='no title';factory.edit_title='no title'}
						
						try {factory.nationality = factory.info.data[8].value;factory.edit_nationality=String(factory.nationality)}catch(err){factory.nationality=''}
						try {
		                	factory.website = factory.info.data[37].value.split(',');
		                	factory.list_website = [];
		                	for(var i=0 ; i<factory.website.length ; i++) {
			                	var val=factory.website[i].split('//');
								if(val[1] != undefined) {
									var value = val[1];
								} else {
									var value = val[0];
								}
								factory.list_website.push({"name":value});
							}
							factory.edit_list_website = [];
							angular.forEach(factory.list_website,function(value,key){
								factory.edit_list_website.push({"name":value.name});

							});
						}catch(err){factory.website = '';factory.list_website = []}
						factory.load_info = true;
					} else {
						modalFactory.message(data.message);
						window.history.back();
					}
				});
			//},500);
		}

		function reset() {
			factory.username='';
			factory.first_name='';
			factory.middle_name='';
			factory.last_name='';
			factory.profile_name='';
			factory.profile_avatar='';
			factory.place_of_birth='';
			factory.date_of_birth='';
			factory.title='no title';
			factory.date_of_birth='';
			factory.email='';
			factory.phone='';
			factory.nationality='';
			factory.website='';
		}

		function getSetting() {
			var c={
                data:{
                    username:$stateParams.username
                }
            };
            CiayoService.Api('users/info', c, function(response) {
                var data=response.data.c.data;
				factory.user_id = data.content.user_id;
            });
		}

		getSetting();

		function settingHide() {
			factory.place_of_birth='';
			factory.date_of_birth='';
			factory.email = '';
			factory.phone = '';
			var c={
                data:{
                }
            };
            CiayoService.Api('settings', c, function(response) {
            	var data = response.data.c.data;
                var setting = data.content.list_setting;
				var general = setting.general_setting;
				var email_setting = general.email_setting;
				var edit_account = setting.edit_account;
				var edit_basic_info = setting.edit_basic_info;

				if(!factory.username) {
					try{factory.email = edit_account.email_address.value}catch(err){}
					try{factory.phone = edit_account.phone_number.value}catch(err){}

					factory.edit_email = factory.email;
					factory.edit_phone = factory.phone;

					try{factory.place_of_birth = edit_basic_info.place_of_birth.value}catch(err){}
					if(factory.place_of_birth!=null) {
						factory.place_of_birth = edit_basic_info.place_of_birth.value+', ';
						factory.edit_place_birth = edit_basic_info.place_of_birth.value;
					} else {
						factory.place_of_birth = '';
						factory.edit_place_birth = '';
					}
					
					var timestamp = edit_basic_info.date_of_birth.value;
					var date = new Date(timestamp * 1000);
					if($cookieStore.get('language')==1) {
						var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
					}
					if($cookieStore.get('language')==2) {
						var months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
					}
					factory.date_of_birth = date.getDate() + " " + months[date.getMonth()] + " " + date.getFullYear();

					var _date = parseInt(date.getDate());
					if(_date<10) {
						_date = "0" + date.getDate();
					}
					var _mounth = parseInt(date.getMonth())+1;
					if(_mounth<10) {
						_mounth = "0" + (parseInt(date.getMonth())+1);
					}
					var newdate = _date + "/" + _mounth + "/" + date.getFullYear();
					$('#inputDate').val(newdate);
				}

				factory.show_email = edit_account.show_email.value;
				factory.show_phone = edit_account.show_phone.value;
				//factory.show_birthday = edit_account.show_birthday.value;
				//factory.show_nationality = edit_account.show_nationality.value;
            });
		}

		function showEmail() {
			var value=(factory.show_email)?1:0;
			settingConnector.setPreference(value, 'show_email').then(function(data) {
			
			},function(response){
				
			})
		}

		function showPhone() {
			var value=(factory.show_phone)?1:0;
			settingConnector.setPreference(value, 'show_phone').then(function(data) {
			
			},function(response){
				
			})
		}

		function showBirthday() {
			var value=(factory.show_birthday)?1:0;
			settingConnector.setPreference(value, 'show_birthday').then(function(data) {
			
			},function(response){
				
			})
		}

		function showNationality() {
			var value=(factory.show_nationality)?1:0;
			settingConnector.setPreference(value, 'show_nationality').then(function(data) {
			
			},function(response){
				
			})
		}

		function cancelRequest() {
			$('.cm-modal.-ask-personal-info.-placendate.-dialog').removeClass('-open');
			$('.cm-modal.-ask-personal-info.-email.-dialog').removeClass('-open');
			$('.cm-modal.-ask-personal-info.-phone.-dialog').removeClass('-open');
		}

		function sendRequest(type) {
			$('.cm-modal.-ask-personal-info.-placendate.-dialog').removeClass('-open');
			$('.cm-modal.-ask-personal-info.-email.-dialog').removeClass('-open');
			$('.cm-modal.-ask-personal-info.-phone.-dialog').removeClass('-open');
		}

		function listTitle() {
			var c={
				data:{
					tittle:true
				}
			};
			CiayoService.Api('users/achievement/all', c, function(response) {
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.list_title = data.content.data;
				} else {

				}
			});
		}

		function saveNameTitle() {
			var updated_filter = [{"filter_id":520,"filter_value" : factory.edit_title}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
                var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					//modalFactory.message(data.message);
				} else {
					//modalFactory.message(data.message);
				}
            });
		}

		function editUsername() {
			if(factory.profile_name!=factory.edit_profile_name) {
				var c={
	                data:{
	                    screen_name:factory.edit_profile_name
	                }
	            };
	            CiayoService.Api('users/screen/name', c, function(response) {
	            	var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						//modalFactory.message(data.message);
						factory.profile_name = factory.edit_profile_name;
					} else {
						//modalFactory.message(data.message);
					}
	            });
	        }
            var value = factory.edit_title;
			var c={
                data:{
                    value:value
                }
            };
            CiayoService.Api('users/filter/update/achievement', c, function(response) {
            	var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.title = factory.edit_title;
            		factory._title = true;
					//modalFactory.message(data.message);
				} else {
					//modalFactory.message(data.message);
				}
            });
		}

		function editFilter() {
			//alert();
			if(!factory.edit_first_name) factory.edit_first_name = "-";
			if(!factory.edit_middle_name) factory.edit_middle_name = "-";
			if(!factory.edit_last_name) factory.edit_last_name = "-";
			var updated_filter = [{"filter_id":2,"filter_value" : factory.edit_first_name},{"filter_id":3,"filter_value" : factory.edit_middle_name},{"filter_id":4,"filter_value" : factory.edit_last_name},{"filter_id":6,"filter_value" : angular.element('#timestamp').val()},{"filter_id":7,"filter_value" : factory.edit_place_birth},{"filter_id":37,"filter_value" : factory.edit_website},{"filter_id":8,"filter_value" : factory.edit_nationality}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
            	var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					factory.first_name = factory.edit_first_name;
					factory.middle_name = factory.edit_middle_name;
					factory.last_name = factory.edit_last_name;
					userBasicInfo();
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		function editWebsite() {
			factory.edit_list_website.push({"name":factory.edit_website});
			factory.edit_website = '';
		}

		function removeWebsite(id) {
			for(var i = 0; i < factory.edit_list_website.length; i++) {
				if(factory.edit_list_website[i]['name']==id) {
			    	delete factory.edit_list_website[i];
			    }
			}
			factory.temp_list_website = factory.edit_list_website;
			factory.edit_list_website = [];
			angular.forEach(factory.temp_list_website,function(value,key){
				factory.edit_list_website.push({"name":value.name});
			});
		}

		factory.website_value = '';

		function saveWebsite() {
			if(factory.edit_website) editWebsite();
			var id = 1;
			angular.forEach(factory.edit_list_website,function(value,key){
				if(id==1) {
					factory.website_value = value.name;
				} else {
					factory.website_value += ","+value.name;
				}
				id++;
			});
			factory.website_value = factory.website_value.replace('undefined',' ');
			if(!factory.website_value) {
				factory.website_value = ' ';
			}
			console.log(factory.website_value);
			var updated_filter = [{"filter_id":37,"filter_value" : factory.website_value}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
            	var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					factory.list_website = [];
					angular.forEach(factory.edit_list_website,function(value,key){
						factory.list_website.push({"name":value.name});
					});
					$(".cm").removeClass("-locked");
        			$(".cm-panel.-edit-profile-website").removeClass("-open");
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		factory.achievement_sort = 'true';

		function listAchievement(){
			factory.open_list_choice_achievement = true;
			factory.open_list_choice_badge = false;
			if($stateParams.username) {
				var user_id = factory.user_friend_id;
			} else {
				var user_id = null;
			}
			var c={
				data:{
					orderType:'name',
					orderBy:'asc',
					limit:50,
					offset:0,
					search:factory.keyword_choice_achievement,
					user_id:user_id
				}
			};
			CiayoService.Api('achievement/completed', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('list choice achievement');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.list_choice_achievement = data.content.data;
					factory.achievement_count = 0;
					angular.forEach(factory.list_choice_achievement,function(value,key){
						if(value.percent==100) factory.achievement_count++;
					});
				} else {
					
				}
			});
		}

		function listBadge(){
			factory.open_list_choice_achievement = false;
			factory.open_list_choice_badge = true;
			var c={
				data:{
					orderType:'name',
					orderBy:'asc',
					limit:10,
					offset:0,
					search:factory.keyword_choice_badge
				}
			};
			CiayoService.Api('badge', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('list badge');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.list_choice_badge = data.content.data;
				} else {
					
				}
			});
		}

		factory.slot1[1]=null;
		factory.slot1[2]=null;
		factory.slot1[3]=null;
		factory.slot1[4]=null;
		factory.slot1[5]=null;
		factory.slot1[6]=null;
		factory.slot1[7]=null;
		factory.slot1[8]=null;
		factory.slot1[9]=null;
		factory.slot1[10]=null;
		factory.slot1[11]=null;
		factory.slot1[12]=null;

		factory.slot2[1]=null;
		factory.slot2[2]=null;
		factory.slot2[3]=null;
		factory.slot2[4]=null;
		factory.slot2[5]=null;
		factory.slot2[6]=null;
		factory.slot2[7]=null;
		factory.slot2[8]=null;
		factory.slot2[9]=null;
		factory.slot2[10]=null;
		factory.slot2[11]=null;
		factory.slot2[12]=null;

		function showAchievement(slot) {
			factory.choice_type = 'Achievements';
			listAchievement();
			factory.slot_achievement = slot;
		}

		function showBadge(slot) {
			factory.choice_type = 'Badges';
			factory.slot_badge = slot;
		}

		function pickAchievement(slot,id,image) {
			factory.choice_achievement[id] = '';
			factory.pick_achievement[factory.slot1[slot]] = '';
			factory.pick_achievement[id] = id;
			factory.choice_achievement[slot] = image;
			factory.slot1[slot] = id;
			$(".cm").removeClass("-locked");
        	$(".cm-panel.-edit-profile-search-achievement").removeClass("-open");
		}

		function pickBadge(slot,id,image) {
			factory.choice_badge[id] = '';
			factory.pick_badge[factory.slot2[slot]] = '';
			factory.pick_badge[id] = id;
			factory.choice_badge[slot] = image;
			factory.slot2[slot] = id;
			$(".cm").removeClass("-locked");
        	$(".cm-panel.-edit-profile-search-achievement").removeClass("-open");
		}

		function removeAchievement(id) {
			factory.choice_achievement[id] = '';
			factory.pick_achievement[factory.slot1[id]] = '';
			factory.slot1[id] = null;
		}

		function removeBadge(id) {
			factory.choice_badge[id] = '';
			factory.pick_badge[factory.slot2[id]] = '';
			factory.slot2[id] = null;
		}

		function saveChoiceAchievement() {
			var user_threshold_achievement = [];
			for(var i=1;i<=12;i++) {
				if(factory.slot1[i]!=null) {
					user_threshold_achievement.push({"threshod_id":factory.slot1[i],"order":i});
				}
			}
			var user_threshold_badge = [];
			for(var i=1;i<=12;i++) {
				if(factory.slot2[i]!=null) {
					user_threshold_badge.push({"threshod_id":factory.slot2[i],"order":i});
				}
			}
			choiceAchievementSave(user_threshold_achievement);
			choiceBadgeSave(user_threshold_badge);
		}

		listChoiceBadge();

		function choiceAchievementSave(user_threshold) {
			user_threshold = JSON.stringify(user_threshold);
			user_threshold = user_threshold.replace('[]','[{"threshod_id":"1","order":"100"}]');
			user_threshold = JSON.parse(user_threshold);
			var c={
				data:{
					user_threshold:user_threshold
				}
			};
			CiayoService.Api('users/achievement/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('save choice achievement');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					//factory.data_choice_achievement = user_threshold;
					listChoiceAchievement();
				} else {
					//modalFactory.message(data.message);
				}
			});
		}

		function saveChoiceBadge() {
			var user_threshold = [];
			if(user_threshold.length) {
				for(var i=1;i<=12;i++) {
					if(factory.slot2[i]!=null) {
						user_threshold.push({"threshod_id":factory.slot2[i],"order":i});
					}
				}
				choiceBadgeSave(user_threshold);
			}
		}

		function choiceBadgeSave(user_threshold) {
			user_threshold = JSON.stringify(user_threshold);
			user_threshold = user_threshold.replace('[]','[{"threshod_id":"1","order":"100"}]');
			user_threshold = JSON.parse(user_threshold);
			var c={
				data:{
					type: "badge",
					user_threshold:user_threshold
				}
			};
			CiayoService.Api('users/achievement/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('save choice badge');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					//factory.data_choice_badge = user_threshold;
					listChoiceBadge();
				} else {
					//modalFactory.message(data.message);
				}
			});
		}

		function listChoiceAchievement() {
			if($stateParams.username) {
				var user_id = factory.user_friend_id;
			} else {
				var user_id = null;
			}
			var c={
				data:{
					user_id:user_id
				}
			};
			CiayoService.Api('users/achievement/choice', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.data_choice_achievement = data.content.data;
					var tab = factory.data_choice_achievement.length/4;
					var no = 1;
					factory.choice_achievement_tab = [];
					factory.choice_achievement_tab.push({"no":no});
					no++;
					if(factory.data_choice_achievement.length>4) {
						factory.choice_achievement_tab.push({"no":no});
					}
					no++;
					if(factory.data_choice_achievement.length>8) {
						factory.choice_achievement_tab.push({"no":no});
					}
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function listChoiceBadge() {
			if($stateParams.username) {
				var user_id = factory.user_friend_id;
			} else {
				var user_id = null;
			}
			var c={
				data:{
					type: "badge",
					user_id:user_id
				}
			};
			CiayoService.Api('users/achievement/choice', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.data_choice_badge = data.content.data;
					var tab = factory.data_choice_badge.length/4;
					var no = 1;
					factory.choice_badge_tab = [];
					if(factory.data_choice_badge.length>4){
						for(var i=0;i<tab;i++) {
							factory.choice_badge_tab.push({"no":no});
							no++;
						}
					}
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function getDetailAchievement(id) {
			factory.achievement_detail = null;
			$('.cm').addClass('-locked');
        	$('.cm-achievement').addClass('-open');
        	var c = {
				data: {
					"id_achievement": id,
					"user_id": factory.user_id
				}
			};

			CiayoService.Api('achievement/detail', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('detail achievement');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.achievement_detail = data.content;
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function openSearchAchievement() {
			$('.cm-achievement ._title button').fadeOut('fast');
        	$('#searchbox').slideDown('fast');
		}

		function gotoTab(no) {
			factory.select_tab = no;
			no = (no-1)*326;
			$('#content_achievement').animate({scrollTop: no},200);
		}

		function closeDetail() {
			$('.cm').removeClass('-locked');
        	$('.cm-achievement').removeClass('-open');
		}

		function seeAllAchievement() {
			factory.seeall = true
			$('.cm-profile-content ._achievement').css('max-height','none');
			$('.cm-profile-content ._badge ._content, .cm-profile-content ._achievement ._content').css('max-height','none');
		}

		function listSocialMedia() {
            var c={data:{}};
            CiayoService.Api('users/sosmed', c, function(response) {
                var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.list_social_media = [];
					angular.forEach(data.content.data[0],function(value,key){
						factory.list_social_media[value.filter_id]=value;
					});
					modalFactory.log('list social media');
					modalFactory.log(data);
				} else {
					modalFactory.log(data.message);
				}
            });
            if(factory.facebook&&factory.twitter&&factory.instagram&&factory.pinterest&&factory.path) {
				factory.all_social_media = true;
			} else {
				factory.all_social_media = false;
			}
        }

        listSocialMedia();

        function saveMoreSocialMedia() {
        	var filter_id = null;
			var filter_value = null;
			var type = null;

			if(factory.select_social_media=='facebook') {
				filter_id = 480;
				factory.facebook = 'http://facebook.com/'+factory.add_more_social_media;
				factory.facebook_account = factory.add_more_social_media;
				type = 0;
			}
			if(factory.select_social_media=='twitter') {
				filter_id = 481;
				factory.twitter = 'http://twitter.com/'+factory.add_more_social_media;
				factory.twitter_account = factory.add_more_social_media;
				type = 1;
			}
			if(factory.select_social_media=='instagram') {
				filter_id = 482;
				factory.instagram = 'http://instagram.com/'+factory.add_more_social_media;
				factory.instagram_account = factory.add_more_social_media;
				type = 2;
			}
			if(factory.select_social_media=='bbm') {
				filter_id = 483;
				factory.bbm = factory.add_more_social_media;
				factory.bbm_acount = factory.add_more_social_media;
				type = 3;
			}
			if(factory.select_social_media=='whatsup') {
				filter_id = 484;
				factory.whatsup = factory.add_more_social_media;
				factory.whatsup_account = factory.add_more_social_media;
				type = 4;
			}
			if(factory.select_social_media=='skype') {
				filter_id = 485;
				factory.skype = factory.add_more_social_media;
				factory.skype_account = factory.add_more_social_media;
				type = 5;
			}
			if(factory.select_social_media=='googleplus') {
				filter_id = 486;
				factory.googleplus = factory.add_more_social_media;
				factory.googleplus_account = factory.add_more_social_media;
				type = 6;
			}
			if(factory.select_social_media=='path-01') {
				filter_id = 500;
				factory.path = 'http://path.com/'+factory.add_more_social_media;
				factory.path_account = factory.add_more_social_media;
				type = 7;
			}
			if(factory.select_social_media=='pinterest') {
				filter_id = 501;
				factory.pinterest = 'http://pinterest.com/'+factory.add_more_social_media;
				factory.pinterest_account = factory.add_more_social_media;
				type = 8;
			}
			filter_value = factory.add_more_social_media;
			var val=filter_value.split('.com/');
			if(val[1] != undefined) {
				var value = val[1];
			} else {
				var value = val[0];
			}

			var c = {
				data:{
					type:type,
					value:value
				}
			};
			CiayoService.Api('users/sosmed/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					showModal(data.message);
					for(var i = 0; i < factory.socialType.length; i++) {
						if(factory.socialType[i]['value']==factory.select_social_media) {
					    	delete factory.socialType[i];
					    }
					}
					factory.tempSocialType = factory.socialType;
					factory.socialType = [];
					angular.forEach(factory.tempSocialType,function(value,key){
						factory.socialType.push({"name":value.name,"value":value.value});
					});

					try {factory.select_social_media = factory.socialType[0].value}catch(err){}
					factory.add_more_social_media = '';
					listSocialMedia();
				} else {
					showModal(data.message);
				}
            });
        }

		function saveMediaSocial(id) {
			var filter_id = null;
			var filter_value = null;
			var type = null;
			if(id=='facebook') {
				filter_id = 480;
				filter_value = factory.facebook_account;
				factory.facebook = factory.facebook_account;
				type = 0;
			}
			if(id=='twitter') {
				filter_id = 481;
				filter_value = factory.twitter_account;
				factory.twitter = factory.twitter_account;
				type = 1;
			}
			if(id=='instagram') {
				filter_id = 482;
				filter_value = factory.instagram_account;
				factory.instagram = factory.instagram_account;
				type = 2;
			}
			if(id=='bbm') {
				filter_id = 483;
				filter_value = factory.bbm_account;
				factory.bbm = factory.bbm_account;
				type = 3;
			}
			if(id=='whatsup') {
				filter_id = 484;
				filter_value = factory.whatsup_account;
				factory.whatsup = factory.whatsup_account;
				type = 4;
			}
			if(id=='skype') {
				filter_id = 485;
				filter_value = factory.skype_account;
				factory.skype = factory.skype_account;
				type = 5;
			}
			if(id=='googleplus') {
				filter_id = 486;
				filter_value = factory.googleplus_account;
				factory.googleplus = factory.googleplus_account;
				type = 6;
			}
			if(id=='path-01') {
				filter_id = 500;
				filter_value = factory.path_account;
				factory.path = factory.path_account;
				type = 7;
			}
			if(id=='pinterest') {
				filter_id = 501;
				filter_value = factory.pinterest_account;
				factory.pinterest = factory.pinterest_account;
				type = 8;
			}
			var val=filter_value.split('.com/');
			if(val[1] != undefined) {
				var value = val[1];
			} else {
				var value = val[0];
			}

			var c = {
				data:{
					type:type,
					value:value
				}
			};
			CiayoService.Api('users/sosmed/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					for(var i = 0; i < factory.socialType.length; i++) {
						if(factory.socialType[i]['value']==id) {
					    	delete factory.socialType[i];
					    }
					}
					factory.tempSocialType = factory.socialType;
					factory.socialType = [];
					angular.forEach(factory.tempSocialType,function(value,key){
						factory.socialType.push({"name":value.name,"value":value.value});
					});

					try {factory.select_social_media = factory.socialType[0].value}catch(err){}
					listSocialMedia();
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		function deleteSocialMedia(type,id) {
			if(id!=undefined) {
				var c={
	                data:{
	                    id:id
	                }
	            };
	            CiayoService.Api('users/sosmed/delete', c, function(response) {
	                var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						//modalFactory.message(data.message);
						if(type=='facebook') {
							factory.facebook = null;
							$('#facebook').removeClass('-add');
						}
						if(type=='twitter') {
							factory.twitter = null;
							$('#twitter').removeClass('-add');
						}
						if(type=='instagram') {
							factory.instagram = null;
							$('#instagram').removeClass('-add');
						}
						if(type=='bbm') {
							factory.bbm = null;
							$('#bbm').removeClass('-add');
						}
						if(type=='whatsup') {
							factory.whatsup = null;
							$('#whatsup').removeClass('-add');
						}
						if(type=='skype') {
							factory.skype = null;
							$('#skype').removeClass('-add');
						}
						if(type=='googleplus') {
							factory.googleplus = null;
							$('#googleplus').removeClass('-add');
						}
						if(type=='path-01') {
							factory.path = null;
							$('#path').removeClass('-add');
						}
						if(type=='pinterest') {
							factory.pinterest = null;
							$('#pinterest').removeClass('-add');
						}

						factory.socialType = [];
						if(!factory.facebook) factory.socialType.push({name: 'Facebook', value: 'facebook'});
						if(!factory.twitter) factory.socialType.push({name: 'Twitter', value: 'twitter'});
						if(!factory.instagram) factory.socialType.push({name: 'Instagram', value: 'instagram'});
						if(!factory.pinterest) factory.socialType.push({name: 'Pinterest', value: 'pinterest'});
						if(!factory.path) factory.socialType.push({name: 'Path', value: 'path-01'});
						try {factory.select_social_media = factory.socialType[0].value}catch(err){}

						listSocialMedia();
					} else {
						modalFactory.message(data.message);
					}
	            });
	        }
		}

		function editMediaSocial(type,id) {
			if(id!=undefined) {
				if(type=='facebook') {
					var value=factory.facebook_account;
					factory.facebook = 'http://facebook.com/'+value;
				}
				if(type=='twitter') {
					var value=factory.twitter_account;
					factory.twitter = 'http://twitter.com/'+value;
				}
				if(type=='instagram') {
					var value=factory.instagram_account;
					factory.instagram = 'http://instagram.com/'+value;
				}
				if(type=='bbm') {
					var value=factory.bbm_account;
				}
				if(type=='whatsup') {
					var value=factory.whatsup_account;
				}
				if(type=='skype') {
					var value=factory.skype_account;
				}
				if(type=='googleplus') {
					var value=factory.googleplus_account;
				}
				if(type=='path-01') {
					var value=factory.path_account;
					factory.path = 'http://path.com/'+value;
				}
				if(type=='pinterest') {
					var value=factory.pinterest_account;
					factory.pinterest = 'http://pinterest.com/'+value;
				}

				var val=value.split('.com/');
				if(val[1] != undefined) {
					var value = val[1];
				} else {
					var value = val[0];
				}

				if(type=='facebook') {
					factory.facebook = 'http://facebook.com/'+value;
				}
				if(type=='twitter') {
					factory.twitter = 'http://twitter.com/'+value;
				}
				if(type=='instagram') {
					factory.instagram = 'http://instagram.com/'+value;
				}
				if(type=='path-01') {
					factory.path = 'http://path.com/'+value;
				}
				if(type=='pinterest') {
					factory.pinterest = 'http://pinterest.com/'+value;
				}

				var c={
	                data:{
	                    id:id,
	                    value:value
	                }
	            };
	            CiayoService.Api('users/sosmed/update', c, function(response) {
	                var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						modalFactory.message(data.message);
						listSocialMedia();
					} else {
						modalFactory.message(data.message);
					}
	            });
	        }
		}

		function showModal(message) {
			factory.modal_info=message;
			$('.-info').addClass('-open');
		}

		function follow() {
			var follow = factory.status_follow?false:true;
			var c={
				data:{
					user_id:factory.user_id,
					follow:follow
				}
			};
			CiayoService.Api('users/follow', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					factory.status_follow = !factory.status_follow;
				} else {
					modalFactory.message(data.message);
				}
			});
		}

		function addfriend() {
			var c={
				data:{
					"friend_id": factory.user_id
				}
			};
			CiayoService.Api('users/relation/create', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.status_add = true;
					factory.status_addstatus = true;
					factory.status_follow = true;
					modalFactory.message(data.message);
				} else {
					modalFactory.message(data.message);
				}
			});
		}

		function approvefriend() {
			if(!factory.status_approve) {
				if(factory.status_add&&factory.status_addstatus) {
					var c={
						data:{
							friend_id:factory.user_id
						}
					};
					CiayoService.Api('users/relation/cancel', c, function(response) {
						var ok = false;
		                var data = null;
						if(response.status==200) {
							data = response.data.c.data;
							modalFactory.log(data,'info');
							if(data.error == false) {
								ok = true;
							}
						}
						if(ok) {
							factory.status_approve = false;
	                		factory.status_add = false;
	                		factory.status_follow = false;
	                		factory.status_addstatus = false;
							modalFactory.message(data.message);
						} else {
							modalFactory.message(data.message);
						}
					});
				} else {
					var c={
						data:{
							user_relation_id:factory.user_id
						}
					};
					CiayoService.Api('users/relation/confirm', c, function(response) {
						var ok = false;
		                var data = null;
						if(response.status==200) {
							data = response.data.c.data;
							modalFactory.log(data,'info');
							if(data.error == false) {
								ok = true;
							}
						}
						if(ok) {
							factory.status_approve = true;
	                		factory.status_add = true;
	                		factory.status_follow = true;
							modalFactory.message(data.message);
						} else {
							modalFactory.message(data.message);
						}
					});
				}
			}
		}

		factory.overview_content = true;

		function profileContent(id) {

			factory.state = id;
			if(id == 4) {
				listAchievement();
				listBadge();
			}
			/*
			var $inner = $("._profile-inner-content");
			id--;	
	        $inner.animate({
	            left: "-"+id+"00%"
	        },200);
	        */
		}

		function listPrefix() {
			var c={
                data:{
                    limit:500,
                    offset:0
                }
            };
            CiayoService.Api('users/setting/prefix_phone_number', c, function(response) {
                factory.list_prefix = response.data.c.data.content.list_prefix_phone_number;
            });
		}

		function get_profile(){

			factory.user_list=[];

			if($stateParams.username){
				var ok = false;
				var c = {
					data: {
						"username": $stateParams.username
					}
				}

				CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.user_friend_id = data.content.user_id;
						getFriendList(true);
						getMutualList(true);

						//factory.data_profile = data.content;

						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(display_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
					}
					
				});

				factory.myprofile = false;

			}else{

				var ok = false;
				var c = {
					data: {
						"username": ''
					}
				}

				CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.user_friend_id = '';
						getFriendList(true);
						getMutualList(true);

						//factory.data_profile = data.content;

						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(display_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
					}
					
				});

				
				factory.myprofile = true;


			}

			
			//var user_friend_id = ($stateParams.username) ? '999' : $cookieStore.get('user_id');
			
		}

		function getFriendListNext(keyword, start, limit, offset, api, type){
			
			
				if(start){
					factory.user_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api, type);
			
		}

		function getMutualListNext(keyword, start, limit, offset, api, type){
			
			
				if(start){
					factory.mutual_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api, type);
			
		}

		function getFriendList(start){
			
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
				var keyword = '';
				
					if(start){
						factory.user_list=[];
					}
					
					var offset = factory.user_list.length;
					var limit = 10;
					
					getApi(keyword, start, limit, offset, 'search/friend/name', 'friend');
					getFriendListNext(keyword, false, limit, offset, 'search/friend/name', 'friend');
				
			}
			
		}

		function getMutualList(start){
			
			if(!factory.isloading_mutual){
				factory.isloading_mutual = true;
				factory.loading_mutual = true;
				var keyword = '';
				
					if(start){
						factory.mutual_list=[];
					}
					
					var offset = factory.mutual_list.length;
					var limit = 10;
					
					getApi(keyword, start, limit, offset, 'users/friend/mutual', 'mutual');
					getMutualListNext(keyword, false, limit, offset, 'users/friend/mutual', 'mutual');
				
			}
			
		}

		function getApi(keyword, start, limit, offset, api, type){
			var ok = false;

			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);
					var tmp=(data.content.list_user);

					if(type=='friend'){
						factory.count_friend_list = data.meta.total;
					}else{
						factory.count_mutual_list = data.meta.total;
					}

					//console.log(tmp.length);
					angular.forEach(tmp,function(value,key){
						
						value.frame = false;
						if($cookieStore.get('user_id')==tmp[key].user_id){
							value.button_self = true;
						}else{
							value.button_self = false;
						}
								
						value.icon_action_response = false;
						value.open_action = false;
						value.ci_star = false;
						value.ci_check = false;
						
						if(tmp[key].status.friend.add==false){
							value.icon_addfriend = true;
							value.name_addfriend = true;
							value.icon_self = 0;
							value.name_self = 0;
							
							
						}else{
							
							if(tmp[key].status.friend.addstatus==false){
								if(tmp[key].status.friend.approve==true){
									value.icon_addfriend = false;
									value.name_addfriend = false;
									value.icon_self = 0;
									value.name_self = 0;
									
								}else{
									value.icon_addfriend = true;
									value.name_addfriend = true;
									value.icon_self = 1;
									value.name_self = 1;
									
									value.ci_star = true;
								}
							}else{
								value.icon_addfriend = false;
								value.name_addfriend = false;
								value.icon_self = 0;
								value.name_self = 0;
								value.ci_check = true;
							}
						}

						if(tmp[key].status.friend.approve==false){
							value.checklist_addfriend = true;
						}else{
							value.checklist_addfriend = false;
						}

						if(tmp[key].status.follow==false){
							value.icon_follow = true;
							value.name_follow = true;
							value.checklist_follow = true;
						}else{
							value.icon_follow = false;
							value.name_follow = false;
						}
						
						var friend_connection = new friendConnectionFactory(value);
						//console.log(friend_connection);
						if(type=='friend'){
							factory.user_list.push(friend_connection);
						}else{
							factory.mutual_list.push(friend_connection);
						}

					});
					if(type=='friend'){
						factory.isloading = false;
					}else{
						factory.isloading_mutual = false;
					}
					//factory.load_more = true;
					//factory.loading = false;
					
					
				}else{
					//...
				}
			});
			
		}

		function getApiNext(keyword, start, limit, offset, api, type){
			var ok = false;
			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);

					var tmp_next=(data.content.list_user);

					
					if(tmp_next.length==0){
						if(type=='friend'){
							factory.load_more = false;
						}else{
							factory.load_more_mutual = false;
						}
					}else{
						if(type=='friend'){
							factory.load_more = true;
						}else{
							factory.load_more_mutual = true;
						}
					}	
				}else{
					//...
				}
			});

			if(type=='friend'){
				factory.loading = false;
			}else{
				factory.loading_mutual = false;
			}

				
		}

		function redirect_page(page){
			factory.tab_active = page;
		}

		function getSearchFriend(user_id){
			searchFriendDrawer.open(user_id);
		}

		function goto_back(){
			if($rootScope.backState == 'avatar'){
				$rootScope.backState = '';
				$state.go('menu');
			} else {
				window.history.back();
			}
		}

		return factory;
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.factory('profilePublicFactory', profilePublicFactory);

	profilePublicFactory.$inject = ['profilePublicConnector', '$state', 'modalFactory','$stateParams','CiayoService', 'friendConnectionFactory', '$cookieStore', 'searchFriendDrawer', '$rootScope'];

	function profilePublicFactory(profilePublicConnector, $state, modalFactory,$stateParams,CiayoService, friendConnectionFactory, $cookieStore, searchFriendDrawer, $rootScope) {
		var factory = {
			userBasicInfo:userBasicInfo,
			editFilter:editFilter,
			editUsername:editUsername,
			editWebsite:editWebsite,
			saveWebsite:saveWebsite,
			removeWebsite:removeWebsite,
			saveNameTitle:saveNameTitle,
			listPrefix:listPrefix,
			listAchievement:listAchievement,
			listBadge:listBadge,
			showAchievement:showAchievement,
			showBadge:showBadge,
			pickAchievement:pickAchievement,
			pickBadge:pickBadge,
			removeAchievement:removeAchievement,
			removeBadge:removeBadge,
			saveChoiceAchievement:saveChoiceAchievement,
			saveChoiceBadge:saveChoiceBadge,
			listChoiceAchievement:listChoiceAchievement,
			listChoiceBadge:listChoiceBadge,
			choiceAchievementSave:choiceAchievementSave,
			choiceBadgeSave:choiceBadgeSave,
			getDetailAchievement:getDetailAchievement,
			seeAllAchievement:seeAllAchievement,
			closeDetail:closeDetail,
			openSearchAchievement:openSearchAchievement,
			gotoTab:gotoTab,
			state:1,
			profileContent:profileContent,
			saveMediaSocial:saveMediaSocial,
			saveMoreSocialMedia:saveMoreSocialMedia,
			deleteSocialMedia:deleteSocialMedia,
			editMediaSocial:editMediaSocial,
			reset:reset,
			follow,
			addfriend,
			approvefriend,
			info: {
				data:[],
				list:[]
			},
			title: {
				list: []
			},
			choice_achievement: [],
			choice_badge: [],
			pick_achievement: [],
			pick_badge: [],
			slot1: [],
			slot2: [],
			type:'',
			user_list:[],
			mutual_list:[],
			redirect_page:redirect_page,
			tab_active:'friend',
			get_profile:get_profile,
			user_friend_id: '',
			data_profile: [],
			getSearchFriend:getSearchFriend,
			goto_back:goto_back,
			getBanner:getBanner,
			login_public
		}

		function login_public(){
			//$cookieStore.put('pp01', $stateParams.username);
			$state.go('welcome');
		}


		function getBanner(){

			var c = {
				data: {
					type: "profile"
				}
			}

			CiayoService.Api('users/banner', c, function(response) {
                var data=response.data.c.data.content.image;
                factory.banner = data;
				setTimeout(function(){
					$('.c-banner').children("ul").parallax({
						clipRelativeInput: false,
						originX: 0.0,
						originY: 1.0,
						frictionY: 0.0,
					});
				}, 1000)
                //console.log(data);
            });
			
		}

		function userBasicInfo() {
			reset();
			//setTimeout(function(){
				factory.load_info = false;
				
				var username = $stateParams.username;
				profilePublicConnector.userBasicInfo(username).then(function(data){	

					if(data.error==false) {
						//console.log(data);
						factory.info.list=[];
						factory.info.list = data.content.users_info;
						factory.username = $stateParams.username;
						factory.user_id = data.content.user_id;

						//factory.status_follow = data.content.status.follow;
						//factory.status_approve = data.content.status.friend.approve;
						//factory.status_add = data.content.status.friend.add;
						//factory.status_addstatus = data.content.status.friend.addstatus;
						factory.profile_avatar = data.content.users_avatar.avatar;
						factory.email = data.content.email;
						factory.phone = data.content.phone;
						factory.info.data=[];

						angular.forEach(factory.info.list, function(value,key) {
							factory.info.data[value.filter_id] = value;
						})

						try {
							factory.country_name = factory.info.data[8].value
						}catch(err){factory.country_name=''}
						try {
							factory.title_name = factory.info.data[520].value
						}catch(err){factory.title_name='no title'}
						try {
							factory.first_name = factory.info.data[2].value
							factory.edit_first_name = factory.first_name
						}catch(err){factory.first_name=''}
						try {
							factory.middle_name = factory.info.data[3].value
							factory.edit_middle_name = factory.middle_name
						}catch(err){factory.middle_name=''}
						try {
							factory.last_name = factory.info.data[4].value
							factory.edit_last_name = factory.last_name
						}catch(err){factory.last_name=''}
						try {factory.profile_name = factory.info.data[5].value}catch(err){}
						try {factory.edit_profile_name = factory.info.data[5].value}catch(err){}
						try {
							factory.place_of_birth = factory.info.data[7].value+', '
							factory.edit_place_birth = factory.info.data[7].value
						}catch(err){factory.place_of_birth=''}
						try {factory.pinterest = 'http://pinterest.com/'+factory.info.data[501].value}catch(err){factory.pinterest = false}
						try {factory.facebook = 'http://facebook.com/'+factory.info.data[480].value;factory.facebook_account=factory.facebook}catch(err){ factory.facebook = false}
						try {factory.twitter = 'http://twitter.com/'+factory.info.data[481].value;factory.twitter_account=factory.twitter}catch(err){ factory.twitter = false}
						try {factory.instagram = 'http://instagram.com/'+factory.info.data[482].value;factory.instagram_account=factory.instagram}catch(err){factory.instagram = false}
						try {factory.path = 'http://path.com/'+factory.info.data[500].value;factory.path_account=factory.path}catch(err){factory.path = false}

						factory.socialType = [];
						if(!factory.facebook) factory.socialType.push({name: 'Facebook', value: 'facebook'});
						if(!factory.twitter) factory.socialType.push({name: 'Twitter', value: 'twitter'});
						if(!factory.instagram) factory.socialType.push({name: 'Instagram', value: 'instagram'});
						if(!factory.pinterest) factory.socialType.push({name: 'Pinterest', value: 'pinterest'});
						if(!factory.path) factory.socialType.push({name: 'Path', value: 'path-01'});
						try {factory.select_social_media = factory.socialType[0].value}catch(err){}
						if(factory.facebook&&factory.twitter&&factory.instagram&&factory.pinterest&&factory.path) {
							factory.all_social_media = true;
						} else {
							factory.all_social_media = false;
						}
						try {factory.title = factory.info.data[520].value;factory.edit_title=factory.title;factory._title=true}catch(err){factory.title='no title';factory.edit_title='no title'}
						try {
							var timestamp = factory.info.data[6].value;
							var date = new Date(timestamp * 1000);
							if($cookieStore.get('language')==1) {
								var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
							}
							if($cookieStore.get('language')==2) {
								var months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
							}
							factory.date_of_birth = date.getDate() + " " + months[date.getMonth()] + " " + date.getFullYear();
							var _date = parseInt(date.getDate());
							if(_date<10) {
								_date = "0" + date.getDate();
							}
							var _mounth = parseInt(date.getMonth())+1;
							if(_mounth<10) {
								_mounth = "0" + (parseInt(date.getMonth())+1);
							}
							var newdate = _date + "/" + _mounth + "/" + date.getFullYear();
							$('#inputDate').val(newdate);
						}catch(err){}
						try {factory.nationality = factory.info.data[8].value;factory.edit_nationality=String(factory.nationality)}catch(err){factory.nationality=''}
						try {
		                	factory.website = factory.info.data[37].value.split(',');
		                	factory.list_website = [];
		                	for(var i=0 ; i<factory.website.length ; i++) {
			                	var val=factory.website[i].split('//');
								if(val[1] != undefined) {
									var value = val[1];
								} else {
									var value = val[0];
								}
								factory.list_website.push({"name":value});
							}
							factory.edit_list_website = [];
							angular.forEach(factory.list_website,function(value,key){
								factory.edit_list_website.push({"name":value.name});

							});
						}catch(err){factory.website = '';factory.list_website = []}
						factory.load_info = true;

						get_profile();
						//console.log('sukses');


					} else {
						modalFactory.message(data.message);
						$state.go('welcome');
					}
				});
			//},500);
		}

		function reset() {
			factory.first_name='';
			factory.middle_name='';
			factory.last_name='';
			factory.profile_name='';
			factory.profile_avatar='';
			factory.place_of_birth='';
			factory.title='no title';
			factory.date_of_birth='';
			factory.nationality='';
			factory.website='';
		}

		function getSetting() {
			var username = $stateParams.username;
			profilePublicConnector.userBasicInfo(username).then(function(data){	
				factory.user_id = data.content.user_id;
            });
		}

		getSetting();

		
		function saveNameTitle() {
			var updated_filter = [{"filter_id":520,"filter_value" : factory.edit_title}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
                var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		function editUsername() {
			if(factory.profile_name!=factory.edit_profile_name) {
				var c={
	                data:{
	                    screen_name:factory.edit_profile_name
	                }
	            };
	            CiayoService.Api('users/screen/name', c, function(response) {
	            	var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						modalFactory.message(data.message);
						//factory.profile_name = factory.edit_profile_name;
					} else {
						//modalFactory.message(data.message);
					}
	            });
	        }
            var updated_filter = [{"filter_id":520,"filter_value" : factory.edit_title}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
            	var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.title = factory.edit_title;
            		factory._title = true;
					modalFactory.message(data.message);
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		function editFilter() {
			//alert();
			if(!factory.edit_first_name) factory.edit_first_name = "-";
			if(!factory.edit_middle_name) factory.edit_middle_name = "-";
			if(!factory.edit_last_name) factory.edit_last_name = "-";
			var updated_filter = [{"filter_id":2,"filter_value" : factory.edit_first_name},{"filter_id":3,"filter_value" : factory.edit_middle_name},{"filter_id":4,"filter_value" : factory.edit_last_name},{"filter_id":6,"filter_value" : angular.element('#timestamp').val()},{"filter_id":7,"filter_value" : factory.edit_place_birth},{"filter_id":37,"filter_value" : factory.edit_website},{"filter_id":8,"filter_value" : factory.edit_nationality}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
            	var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					factory.first_name = factory.edit_first_name;
					factory.middle_name = factory.edit_middle_name;
					factory.last_name = factory.edit_last_name;
					userBasicInfo();
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		function editWebsite() {
			factory.edit_list_website.push({"name":factory.edit_website});
			factory.edit_website = '';
		}

		function removeWebsite(id) {
			for(var i = 0; i < factory.edit_list_website.length; i++) {
				if(factory.edit_list_website[i]['name']==id) {
			    	delete factory.edit_list_website[i];
			    }
			}
			factory.temp_list_website = factory.edit_list_website;
			factory.edit_list_website = [];
			angular.forEach(factory.temp_list_website,function(value,key){
				factory.edit_list_website.push({"name":value.name});
			});
		}

		factory.website_value = '';

		function saveWebsite() {
			var id = 1;
			angular.forEach(factory.edit_list_website,function(value,key){
				if(id==1) {
					factory.website_value = value.name;
				} else {
					factory.website_value += ","+value.name;
				}
				id++;
			});
			factory.website_value = factory.website_value.replace('undefined',' ');
			if(!factory.website_value) {
				factory.website_value = ' ';
			}
			//console.log(factory.website_value);
			var updated_filter = [{"filter_id":37,"filter_value" : factory.website_value}];
			var c={
                data:{
                    updated_filter:updated_filter,
                    type:2
                }
            };
            CiayoService.Api('users/filter/update', c, function(response) {
            	var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					factory.list_website = [];
					angular.forEach(factory.edit_list_website,function(value,key){
						factory.list_website.push({"name":value.name});
					});
					$(".cm").removeClass("-locked");
        			$(".cm-panel.-edit-profile-website").removeClass("-open");
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		factory.achievement_sort = 'true';

		function listAchievement(){
			if($stateParams.username) {
				var user_id = factory.user_friend_id;
			} else {
				var user_id = null;
			}
			var c={
				data:{
					orderType:'name',
					orderBy:'asc',
					limit:50,
					offset:0,
					search:factory.keyword_choice_achievement,
					user_id:user_id
				}
			};
			CiayoService.Api('achievement/completed', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('list choice achievement');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.list_choice_achievement = data.content.data;
					factory.achievement_count = 0;
					angular.forEach(factory.list_choice_achievement,function(value,key){
						if(value.percent==100) factory.achievement_count++;
					});
				} else {
					
				}
			});
		}

		function listBadge(){
			var c={
				data:{
					orderType:'name',
					orderBy:'asc',
					limit:10,
					offset:0,
					search:factory.keyword_choice_badge
				}
			};
			CiayoService.Api('badge', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('list badge');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.list_choice_badge = data.content.data;
				} else {
					
				}
			});
		}

		factory.slot1[1]=null;
		factory.slot1[2]=null;
		factory.slot1[3]=null;
		factory.slot1[4]=null;
		factory.slot1[5]=null;
		factory.slot1[6]=null;

		factory.slot2[1]=null;
		factory.slot2[2]=null;
		factory.slot2[3]=null;
		factory.slot2[4]=null;
		factory.slot2[5]=null;
		factory.slot2[6]=null;

		function showAchievement(slot) {
			factory.choice_type = 'Achievements';
			listAchievement();
			factory.slot_achievement = slot;
		}

		function showBadge(slot) {
			factory.choice_type = 'Badges';
			factory.slot_badge = slot;
		}

		function pickAchievement(slot,id,image) {
			factory.choice_achievement[id] = '';
			factory.pick_achievement[factory.slot1[slot]] = '';
			factory.pick_achievement[id] = id;
			factory.choice_achievement[slot] = image;
			factory.slot1[slot] = id;
			$(".cm").removeClass("-locked");
        	$(".cm-panel.-edit-profile-search-achievement").removeClass("-open");
		}

		function pickBadge(slot,id,image) {
			factory.choice_badge[id] = '';
			factory.pick_badge[factory.slot2[slot]] = '';
			factory.pick_badge[id] = id;
			factory.choice_badge[slot] = image;
			factory.slot2[slot] = id;
			$(".cm").removeClass("-locked");
        	$(".cm-panel.-edit-profile-search-achievement").removeClass("-open");
		}

		function removeAchievement(id) {
			factory.choice_achievement[id] = '';
			factory.pick_achievement[factory.slot1[id]] = '';
			factory.slot1[id] = null;
		}

		function removeBadge(id) {
			factory.choice_badge[id] = '';
			factory.pick_badge[factory.slot2[id]] = '';
			factory.slot2[id] = null;
		}

		function saveChoiceAchievement() {
			var user_threshold_achievement = [];
			for(var i=1;i<=6;i++) {
				if(factory.slot1[i]!=null) {
					user_threshold_achievement.push({"threshod_id":factory.slot1[i],"order":i});
				}
			}
			var user_threshold_badge = [];
			for(var i=1;i<=6;i++) {
				if(factory.slot2[i]!=null) {
					user_threshold_badge.push({"threshod_id":factory.slot2[i],"order":i});
				}
			}
			choiceAchievementSave(user_threshold_achievement);
			choiceBadgeSave(user_threshold_badge);
		}

		//listChoiceBadge();

		function choiceAchievementSave(user_threshold) {
			user_threshold = JSON.stringify(user_threshold);
			user_threshold = user_threshold.replace('[]','[{"threshod_id":"1","order":"100"}]');
			user_threshold = JSON.parse(user_threshold);
			var c={
				data:{
					user_threshold:user_threshold
				}
			};
			CiayoService.Api('users/achievement/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('save choice achievement');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					//factory.data_choice_achievement = user_threshold;
					listChoiceAchievement();
				} else {
					//modalFactory.message(data.message);
				}
			});
		}

		function saveChoiceBadge() {
			var user_threshold = [];
			if(user_threshold.length) {
				for(var i=1;i<=6;i++) {
					if(factory.slot2[i]!=null) {
						user_threshold.push({"threshod_id":factory.slot2[i],"order":i});
					}
				}
				choiceBadgeSave(user_threshold);
			}
		}

		function choiceBadgeSave(user_threshold) {
			user_threshold = JSON.stringify(user_threshold);
			user_threshold = user_threshold.replace('[]','[{"threshod_id":"1","order":"100"}]');
			user_threshold = JSON.parse(user_threshold);
			var c={
				data:{
					type: "badge",
					user_threshold:user_threshold
				}
			};
			CiayoService.Api('users/achievement/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('save choice badge');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					//factory.data_choice_badge = user_threshold;
					listChoiceBadge();
				} else {
					//modalFactory.message(data.message);
				}
			});
		}

		function listChoiceAchievement() {
			
			var type = '';
			profilePublicConnector.listChoiceAchievement($stateParams.username, type).then(function(data){
				
				if(data.error==false) {
					modalFactory.log(data.message);
					factory.data_choice_achievement = data.content.data;
					var tab = factory.data_choice_achievement.length/4;
					var no = 1;
					factory.choice_achievement_tab = [];
					factory.choice_achievement_tab.push({"no":no});
					no++;
					if(factory.data_choice_achievement.length>4) {
						factory.choice_achievement_tab.push({"no":no});
					}
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function listChoiceBadge() {

			var type = 'badge';

			profilePublicConnector.listChoiceAchievement($stateParams.username, type).then(function(data){
				
				if(data.error==false) {
					modalFactory.log(data.message);
					factory.data_choice_badge = data.content.data;
					var tab = factory.data_choice_badge.length/4;
					var no = 1;
					factory.choice_badge_tab = [];
					if(factory.data_choice_badge.length>4){
						for(var i=0;i<tab;i++) {
							factory.choice_badge_tab.push({"no":no});
							no++;
						}
					}
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function getDetailAchievement(id) {
			factory.achievement_detail = null;
			$('.cm').addClass('-locked');
        	$('.cm-achievement').addClass('-open');
        	var c = {
				data: {
					"id_achievement": id
				}
			};

			CiayoService.Api('achievement/detail', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					modalFactory.log('detail achievement');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.achievement_detail = data.content;
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function openSearchAchievement() {
			$('.cm-achievement ._title button').fadeOut('fast');
        	$('#searchbox').slideDown('fast');
		}

		function gotoTab(no) {
			factory.select_tab = no;
			no = (no-1)*326;
			$('#content_achievement').animate({scrollTop: no},200);
		}

		function closeDetail() {
			$('.cm').removeClass('-locked');
        	$('.cm-achievement').removeClass('-open');
		}

		function seeAllAchievement() {
			factory.seeall = true
			$('.cm-profile-content ._achievement').css('max-height','none');
			$('.cm-profile-content ._badge ._content, .cm-profile-content ._achievement ._content').css('max-height','none');
		}

        function saveMoreSocialMedia() {
        	var filter_id = null;
			var filter_value = null;
			var type = null;

			if(factory.select_social_media=='facebook') {
				filter_id = 480;
				factory.facebook = 'http://facebook.com/'+factory.add_more_social_media;
				factory.facebook_account = factory.add_more_social_media;
				type = 0;
			}
			if(factory.select_social_media=='twitter') {
				filter_id = 481;
				factory.twitter = 'http://twitter.com/'+factory.add_more_social_media;
				factory.twitter_account = factory.add_more_social_media;
				type = 1;
			}
			if(factory.select_social_media=='instagram') {
				filter_id = 482;
				factory.instagram = 'http://instagram.com/'+factory.add_more_social_media;
				factory.instagram_account = factory.add_more_social_media;
				type = 2;
			}
			if(factory.select_social_media=='bbm') {
				filter_id = 483;
				factory.bbm = factory.add_more_social_media;
				factory.bbm_acount = factory.add_more_social_media;
				type = 3;
			}
			if(factory.select_social_media=='whatsup') {
				filter_id = 484;
				factory.whatsup = factory.add_more_social_media;
				factory.whatsup_account = factory.add_more_social_media;
				type = 4;
			}
			if(factory.select_social_media=='skype') {
				filter_id = 485;
				factory.skype = factory.add_more_social_media;
				factory.skype_account = factory.add_more_social_media;
				type = 5;
			}
			if(factory.select_social_media=='googleplus') {
				filter_id = 486;
				factory.googleplus = factory.add_more_social_media;
				factory.googleplus_account = factory.add_more_social_media;
				type = 6;
			}
			if(factory.select_social_media=='path-01') {
				filter_id = 500;
				factory.path = 'http://path.com/'+factory.add_more_social_media;
				factory.path_account = factory.add_more_social_media;
				type = 7;
			}
			if(factory.select_social_media=='pinterest') {
				filter_id = 501;
				factory.pinterest = 'http://pinterest.com/'+factory.add_more_social_media;
				factory.pinterest_account = factory.add_more_social_media;
				type = 8;
			}
			filter_value = factory.add_more_social_media;
			var val=filter_value.split('.com/');
			if(val[1] != undefined) {
				var value = val[1];
			} else {
				var value = val[0];
			}

			var c = {
				data:{
					type:type,
					value:value
				}
			};
			CiayoService.Api('users/sosmed/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					showModal(data.message);
					for(var i = 0; i < factory.socialType.length; i++) {
						if(factory.socialType[i]['value']==factory.select_social_media) {
					    	delete factory.socialType[i];
					    }
					}
					factory.tempSocialType = factory.socialType;
					factory.socialType = [];
					angular.forEach(factory.tempSocialType,function(value,key){
						factory.socialType.push({"name":value.name,"value":value.value});
					});

					try {factory.select_social_media = factory.socialType[0].value}catch(err){}
					factory.add_more_social_media = '';
					listSocialMedia();
				} else {
					showModal(data.message);
				}
            });
        }

		function saveMediaSocial(id) {
			var filter_id = null;
			var filter_value = null;
			var type = null;
			if(id=='facebook') {
				filter_id = 480;
				filter_value = factory.facebook_account;
				factory.facebook = factory.facebook_account;
				type = 0;
			}
			if(id=='twitter') {
				filter_id = 481;
				filter_value = factory.twitter_account;
				factory.twitter = factory.twitter_account;
				type = 1;
			}
			if(id=='instagram') {
				filter_id = 482;
				filter_value = factory.instagram_account;
				factory.instagram = factory.instagram_account;
				type = 2;
			}
			if(id=='bbm') {
				filter_id = 483;
				filter_value = factory.bbm_account;
				factory.bbm = factory.bbm_account;
				type = 3;
			}
			if(id=='whatsup') {
				filter_id = 484;
				filter_value = factory.whatsup_account;
				factory.whatsup = factory.whatsup_account;
				type = 4;
			}
			if(id=='skype') {
				filter_id = 485;
				filter_value = factory.skype_account;
				factory.skype = factory.skype_account;
				type = 5;
			}
			if(id=='googleplus') {
				filter_id = 486;
				filter_value = factory.googleplus_account;
				factory.googleplus = factory.googleplus_account;
				type = 6;
			}
			if(id=='path-01') {
				filter_id = 500;
				filter_value = factory.path_account;
				factory.path = factory.path_account;
				type = 7;
			}
			if(id=='pinterest') {
				filter_id = 501;
				filter_value = factory.pinterest_account;
				factory.pinterest = factory.pinterest_account;
				type = 8;
			}
			var val=filter_value.split('.com/');
			if(val[1] != undefined) {
				var value = val[1];
			} else {
				var value = val[0];
			}

			var c = {
				data:{
					type:type,
					value:value
				}
			};
			CiayoService.Api('users/sosmed/save', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					for(var i = 0; i < factory.socialType.length; i++) {
						if(factory.socialType[i]['value']==id) {
					    	delete factory.socialType[i];
					    }
					}
					factory.tempSocialType = factory.socialType;
					factory.socialType = [];
					angular.forEach(factory.tempSocialType,function(value,key){
						factory.socialType.push({"name":value.name,"value":value.value});
					});

					try {factory.select_social_media = factory.socialType[0].value}catch(err){}
					listSocialMedia();
				} else {
					modalFactory.message(data.message);
				}
            });
		}

		function deleteSocialMedia(type,id) {
			if(id!=undefined) {
				var c={
	                data:{
	                    id:id
	                }
	            };
	            CiayoService.Api('users/sosmed/delete', c, function(response) {
	                var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						//modalFactory.message(data.message);
						if(type=='facebook') {
							factory.facebook = null;
							$('#facebook').removeClass('-add');
						}
						if(type=='twitter') {
							factory.twitter = null;
							$('#twitter').removeClass('-add');
						}
						if(type=='instagram') {
							factory.instagram = null;
							$('#instagram').removeClass('-add');
						}
						if(type=='bbm') {
							factory.bbm = null;
							$('#bbm').removeClass('-add');
						}
						if(type=='whatsup') {
							factory.whatsup = null;
							$('#whatsup').removeClass('-add');
						}
						if(type=='skype') {
							factory.skype = null;
							$('#skype').removeClass('-add');
						}
						if(type=='googleplus') {
							factory.googleplus = null;
							$('#googleplus').removeClass('-add');
						}
						if(type=='path-01') {
							factory.path = null;
							$('#path').removeClass('-add');
						}
						if(type=='pinterest') {
							factory.pinterest = null;
							$('#pinterest').removeClass('-add');
						}

						factory.socialType = [];
						if(!factory.facebook) factory.socialType.push({name: 'Facebook', value: 'facebook'});
						if(!factory.twitter) factory.socialType.push({name: 'Twitter', value: 'twitter'});
						if(!factory.instagram) factory.socialType.push({name: 'Instagram', value: 'instagram'});
						if(!factory.pinterest) factory.socialType.push({name: 'Pinterest', value: 'pinterest'});
						if(!factory.path) factory.socialType.push({name: 'Path', value: 'path-01'});
						try {factory.select_social_media = factory.socialType[0].value}catch(err){}

						listSocialMedia();
					} else {
						modalFactory.message(data.message);
					}
	            });
	        }
		}

		function editMediaSocial(type,id) {
			if(id!=undefined) {
				if(type=='facebook') {
					var value=factory.facebook_account;
					factory.facebook = 'http://facebook.com/'+value;
				}
				if(type=='twitter') {
					var value=factory.twitter_account;
					factory.twitter = 'http://twitter.com/'+value;
				}
				if(type=='instagram') {
					var value=factory.instagram_account;
					factory.instagram = 'http://instagram.com/'+value;
				}
				if(type=='bbm') {
					var value=factory.bbm_account;
				}
				if(type=='whatsup') {
					var value=factory.whatsup_account;
				}
				if(type=='skype') {
					var value=factory.skype_account;
				}
				if(type=='googleplus') {
					var value=factory.googleplus_account;
				}
				if(type=='path-01') {
					var value=factory.path_account;
					factory.path = 'http://path.com/'+value;
				}
				if(type=='pinterest') {
					var value=factory.pinterest_account;
					factory.pinterest = 'http://pinterest.com/'+value;
				}

				var val=value.split('.com/');
				if(val[1] != undefined) {
					var value = val[1];
				} else {
					var value = val[0];
				}

				if(type=='facebook') {
					factory.facebook = 'http://facebook.com/'+value;
				}
				if(type=='twitter') {
					factory.twitter = 'http://twitter.com/'+value;
				}
				if(type=='instagram') {
					factory.instagram = 'http://instagram.com/'+value;
				}
				if(type=='path-01') {
					factory.path = 'http://path.com/'+value;
				}
				if(type=='pinterest') {
					factory.pinterest = 'http://pinterest.com/'+value;
				}

				var c={
	                data:{
	                    id:id,
	                    value:value
	                }
	            };
	            CiayoService.Api('users/sosmed/update', c, function(response) {
	                var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						modalFactory.message(data.message);
						listSocialMedia();
					} else {
						modalFactory.message(data.message);
					}
	            });
	        }
		}

		function showModal(message) {
			factory.modal_info=message;
			$('.-info').addClass('-open');
		}

		function follow() {
			var follow = factory.status_follow?false:true;
			var c={
				data:{
					user_id:factory.user_id,
					follow:follow
				}
			};
			CiayoService.Api('users/follow', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.message(data.message);
					factory.status_follow = !factory.status_follow;
				} else {
					modalFactory.message(data.message);
				}
			});
		}

		function addfriend() {
			var c={
				data:{
					"friend_id": factory.user_id
				}
			};
			CiayoService.Api('users/relation/create', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					factory.status_add = true;
					factory.status_addstatus = true;
					factory.status_follow = true;
					modalFactory.message(data.message);
				} else {
					modalFactory.message(data.message);
				}
			});
		}

		function approvefriend() {
			if(!factory.status_approve) {
				if(factory.status_add&&factory.status_addstatus) {
					var c={
						data:{
							friend_id:factory.user_id
						}
					};
					CiayoService.Api('users/relation/cancel', c, function(response) {
						var ok = false;
		                var data = null;
						if(response.status==200) {
							data = response.data.c.data;
							modalFactory.log(data,'info');
							if(data.error == false) {
								ok = true;
							}
						}
						if(ok) {
							factory.status_approve = false;
	                		factory.status_add = false;
	                		factory.status_follow = false;
	                		factory.status_addstatus = false;
							modalFactory.message(data.message);
						} else {
							modalFactory.message(data.message);
						}
					});
				} else {
					var c={
						data:{
							user_relation_id:factory.user_id
						}
					};
					CiayoService.Api('users/relation/confirm', c, function(response) {
						var ok = false;
		                var data = null;
						if(response.status==200) {
							data = response.data.c.data;
							modalFactory.log(data,'info');
							if(data.error == false) {
								ok = true;
							}
						}
						if(ok) {
							factory.status_approve = true;
	                		factory.status_add = true;
	                		factory.status_follow = true;
							modalFactory.message(data.message);
						} else {
							modalFactory.message(data.message);
						}
					});
				}
			}
		}

		factory.overview_content = true;

		function profileContent(id) {

			factory.state = id;
			
		}

		function listPrefix() {
			var c={
                data:{
                    limit:500,
                    offset:0
                }
            };
            CiayoService.Api('users/setting/prefix_phone_number', c, function(response) {
                factory.list_prefix = response.data.c.data.content.list_prefix_phone_number;
            });
		}

		function get_profile(){


			factory.user_list=[];

			if($stateParams.username){
				var ok = false;
				var username = $stateParams.username;
				profilePublicConnector.userBasicInfo(username).then(function(data){	
					if(data.error==false){
						
						factory.user_friend_id = data.content.user_id;
						//console.log(factory.user_friend_id);
						listChoiceBadge();
						listChoiceAchievement();
						//factory.data_profile = data.content;

						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(display_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
					}
					
				});

				factory.myprofile = false;

			}else{

				var ok = false;
				var c = {
					data: {
						"username": ''
					}
				}

				CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.user_friend_id = '';
						

						//factory.data_profile = data.content;

						var tmp=[];//(data.content.users_info);
						angular.forEach(data.content.users_info,function(value_new,key){
							tmp[value_new.filter_id]=value_new;
						});

						var full_name = 
						(tmp[2]==undefined?'':tmp[2].value)+ ' ' +
						(tmp[3]==undefined?'':tmp[3].value)+ ' ' +
						(tmp[4]==undefined?'':tmp[4].value);

						var display_name = tmp[5].value;
						var gender_name = (tmp[1].value=='1') ? 'Male' : 'Female';

						//console.log(display_name);
						
						factory.background_avatar_parent	= 	data.content.users_avatar.background_avatar;
						factory.avatar_parent				= 	data.content.users_avatar.avatar;
						factory.user_display_name_parent 	= 	display_name;
						factory.user_full_name_parent 		= 	full_name;
						factory.gender_name_parent 			= 	gender_name;
					}
					
				});

				
				factory.myprofile = true;


			}

			
			//var user_friend_id = ($stateParams.username) ? '999' : $cookieStore.get('user_id');
			
		}

		
		

		function getApi(keyword, start, limit, offset, api, type){
			var ok = false;

			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);
					var tmp=(data.content.list_user);

					if(type=='friend'){
						factory.count_friend_list = data.meta.total;
					}else{
						factory.count_mutual_list = data.meta.total;
					}

					//console.log(tmp.length);
					angular.forEach(tmp,function(value,key){
						
						value.frame = false;
						if($cookieStore.get('user_id')==tmp[key].user_id){
							value.button_self = true;
						}else{
							value.button_self = false;
						}
								
						value.icon_action_response = false;
						value.open_action = false;
						value.ci_star = false;
						value.ci_check = false;
						
						if(tmp[key].status.friend.add==false){
							value.icon_addfriend = true;
							value.name_addfriend = true;
							value.icon_self = 0;
							value.name_self = 0;
							
							
						}else{
							
							if(tmp[key].status.friend.addstatus==false){
								if(tmp[key].status.friend.approve==true){
									value.icon_addfriend = false;
									value.name_addfriend = false;
									value.icon_self = 0;
									value.name_self = 0;
									
								}else{
									value.icon_addfriend = true;
									value.name_addfriend = true;
									value.icon_self = 1;
									value.name_self = 1;
									
									value.ci_star = true;
								}
							}else{
								value.icon_addfriend = false;
								value.name_addfriend = false;
								value.icon_self = 0;
								value.name_self = 0;
								value.ci_check = true;
							}
						}

						if(tmp[key].status.friend.approve==false){
							value.checklist_addfriend = true;
						}else{
							value.checklist_addfriend = false;
						}

						if(tmp[key].status.follow==false){
							value.icon_follow = true;
							value.name_follow = true;
							value.checklist_follow = true;
						}else{
							value.icon_follow = false;
							value.name_follow = false;
						}
						
						var friend_connection = new friendConnectionFactory(value);
						//console.log(friend_connection);
						if(type=='friend'){
							factory.user_list.push(friend_connection);
						}else{
							factory.mutual_list.push(friend_connection);
						}

					});
					if(type=='friend'){
						factory.isloading = false;
					}else{
						factory.isloading_mutual = false;
					}
					//factory.load_more = true;
					//factory.loading = false;
					
					
				}else{
					//...
				}
			});
			
		}

		function getApiNext(keyword, start, limit, offset, api, type){
			var ok = false;
			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);

					var tmp_next=(data.content.list_user);

					
					if(tmp_next.length==0){
						if(type=='friend'){
							factory.load_more = false;
						}else{
							factory.load_more_mutual = false;
						}
					}else{
						if(type=='friend'){
							factory.load_more = true;
						}else{
							factory.load_more_mutual = true;
						}
					}	
				}else{
					//...
				}
			});

			if(type=='friend'){
				factory.loading = false;
			}else{
				factory.loading_mutual = false;
			}

				
		}

		function redirect_page(page){
			factory.tab_active = page;
		}

		function getSearchFriend(user_id){
			searchFriendDrawer.open(user_id);
		}

		function goto_back(){
			if($rootScope.backState == 'avatar'){
				$rootScope.backState = '';
				$state.go('menu');
			} else {
				window.history.back();
			}
		}

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('searchFactory', searchFactory);
	searchFactory.$inject = ['$rootScope','$filter','modalFactory', 'CiayoService', 'friendConnectionFactory', '$cookieStore'];

	function searchFactory($rootScope,$filter,modalFactory, CiayoService, friendConnectionFactory, $cookieStore) {
		var factory = {
			user_list:[],
			getUserList:getUserList,
			load_more:false,
			loading: false,
			isloading:false,
			clearSearch:clearSearch,
			isEmpty:false
		};


		function clearSearch(){
			factory.search_text = '';
			factory.user_list = [];
			factory.load_more = false;
		}

		function getUserListNext(keyword, start, limit, offset, api){
			
			if(keyword){
				if(start){
					factory.user_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api);

			}else{
				factory.user_list=[];
			}
			
		}

		function getUserList(start){

			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
				var keyword = factory.search_text;
				if(keyword){
					if(start){
						factory.user_list=[];
					}
					
					var offset = factory.user_list.length;
					var limit = 10;

					getApi(keyword, start, limit, offset, 'search/user/name');
					getUserListNext(keyword, false, limit, offset, 'search/user/name');

				}else{
					factory.user_list=[];
					factory.isloading = false;
					factory.loading = false;
					factory.load_more = false;
				}
			}
			
		}


		function getApi(keyword, start, limit, offset, api){
			var ok = false;
			var c = {
				data: {
					"keyword": keyword,
					"limit": limit,
					"offset": offset
				}
			}
			factory.isEmpty=false;
			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);
					var tmp=(data.content.list_user);

					factory.count_friend_list = data.meta.total;

					//console.log(tmp.length);
					angular.forEach(tmp,function(value,key){
						
						value.frame = false;
						if($cookieStore.get('user_id')==tmp[key].user_id){
							value.button_self = true;
						}else{
							value.button_self = false;
						}
								
						value.icon_action_response = false;
						value.open_action = false;
						value.ci_star = false;
						value.ci_check = false;
						
						if(tmp[key].status.friend.add==false){
							value.icon_addfriend = true;
							value.name_addfriend = true;
							value.icon_self = 0;
							value.name_self = 0;
							
							
						}else{
							
							if(tmp[key].status.friend.addstatus==false){
								if(tmp[key].status.friend.approve==true){
									value.icon_addfriend = false;
									value.name_addfriend = false;
									value.icon_self = 0;
									value.name_self = 0;
									
								}else{
									value.icon_addfriend = true;
									value.name_addfriend = true;
									value.icon_self = 1;
									value.name_self = 1;
									
									value.ci_star = true;
								}
							}else{
								value.icon_addfriend = false;
								value.name_addfriend = false;
								value.icon_self = 0;
								value.name_self = 0;
								value.ci_check = true;
							}
						}

						/*if(tmp[key].status.self.add==true){
							value.icon_self = 1;
							value.name_self = 1;
						}else{
							value.icon_self = 0;
							value.name_self = 0;
						}*/

						if(tmp[key].status.friend.approve==false){
							value.checklist_addfriend = true;
						}else{
							value.checklist_addfriend = false;
						}

						if(tmp[key].status.follow==false){
							value.icon_follow = true;
							value.name_follow = true;
							value.checklist_follow = true;
						}else{
							value.icon_follow = false;
							value.name_follow = false;
						}
						
						var friend_connection = new friendConnectionFactory(value);
						//console.log(friend_connection);
						factory.user_list.push(friend_connection);

					});
					factory.isloading = false;
					//factory.load_more = true;
					//factory.loading = false;
					factory.isEmpty=tmp.length==0;
					
				}else{
					//...
				}
			});
		}

		function getApiNext(keyword, start, limit, offset, api){
			var ok = false;
			var c = {
				data: {
					"keyword": keyword,
					"limit": limit,
					"offset": offset
				}
			}

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);

					var tmp_next=(data.content.list_user);
					factory.loading = false;
					if(tmp_next.length==0){
						factory.load_more = false;
					}else{
						factory.load_more = true;
					}		

				}else{
					//...
				}
			});
		}

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('searchFriendFactory', searchFriendFactory);
	searchFriendFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', 'friendConnectionFactory', '$cookieStore', '$stateParams'];

	function searchFriendFactory($rootScope,modalFactory, CiayoService, friendConnectionFactory, $cookieStore, $stateParams) {
		var factory = {
			type:'user',
			user_list:[],
			mutual_list:[],
			getFriendList:getFriendList,
			getFriendListNext:getFriendListNext,
			getMutualList:getMutualList,
			load_more:false,
			loading: false,
			isloading:false,
			load_more_mutual:false,
			loading_mutual: false,
			isloading_mutual:false,
			redirect_page:redirect_page,
			tab_active:'friend',
			get_profile:get_profile,
			user_friend_id: '',
			init
		};

		function init(){
			factory.load_more = false;
			factory.loading = false;
			factory.isloading = false;
			factory.load_more_mutual = false;
			factory.loading_mutual = false;
			factory.isloading_mutual = false;
			factory.user_list = [];
			factory.mutual_list = [];
		}

		function get_profile(){

			factory.user_list=[];

			if($stateParams.username){
				var ok = false;
				var c = {
					data: {
						"username": $stateParams.username
					}
				}

				CiayoService.Api('users/info', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						factory.user_friend_id = data.content.user_id;
						getFriendList(true);
						getMutualList(true);
					}
					
				});

				factory.myprofile = false;

			}else{
				factory.user_friend_id = '';
				getFriendList(true);
				getMutualList(true);
				factory.myprofile = true;
			}

			
			//var user_friend_id = ($stateParams.username) ? '999' : $cookieStore.get('user_id');
			
		}

		function getFriendListNext(keyword, start, limit, offset, api, type){
			
			
				if(start){
					factory.user_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api, type);
			
		}

		function getMutualListNext(keyword, start, limit, offset, api, type){
			
			
				if(start){
					factory.mutual_list=[];
				}

				offset = offset + 10;

				getApiNext(keyword, start, limit, offset, api, type);
			
		}

		function getFriendList(start){
			
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
				
				if(factory.tab_active=='friend'){
					var keyword = factory.search_text;
				}else{
					var keyword = '';
				}
				
					if(start){
						factory.user_list=[];
					}
					
					var offset = factory.user_list.length;
					var limit = 10;
					
					getApi(keyword, start, limit, offset, 'search/friend/name', 'friend');
					getFriendListNext(keyword, false, limit, offset, 'search/friend/name', 'friend');
				
			}
			
		}

		function getMutualList(start){
			
			if(!factory.isloading_mutual){
				factory.isloading_mutual = true;
				factory.loading_mutual = true;
				
				if(factory.tab_active=='mutual'){
					var keyword = factory.search_text;
				}else{
					var keyword = '';
				}
				
					if(start){
						factory.mutual_list=[];
					}
					
					var offset = factory.mutual_list.length;
					var limit = 10;
					
					getApi(keyword, start, limit, offset, 'users/friend/mutual', 'mutual');
					getMutualListNext(keyword, false, limit, offset, 'users/friend/mutual', 'mutual');
				
			}
			
		}

		function getApi(keyword, start, limit, offset, api, type){
			var ok = false;

			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			//console.log(c);

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);
					var tmp=(data.content.list_user);

					if(type=='friend'){
						factory.count_friend_list = data.meta.total;
					}else{
						factory.count_mutual_list = data.meta.total;
					}

					//console.log(tmp.length);
					angular.forEach(tmp,function(value,key){
						
						value.frame = false;
						if($cookieStore.get('user_id')==tmp[key].user_id){
							value.button_self = true;
						}else{
							value.button_self = false;
						}
								
						value.icon_action_response = false;
						value.open_action = false;
						value.ci_star = false;
						value.ci_check = false;
						
						if(tmp[key].status.friend.add==false){
							value.icon_addfriend = true;
							value.name_addfriend = true;
							value.icon_self = 0;
							value.name_self = 0;
							
							
						}else{
							
							if(tmp[key].status.friend.addstatus==false){
								if(tmp[key].status.friend.approve==true){
									value.icon_addfriend = false;
									value.name_addfriend = false;
									value.icon_self = 0;
									value.name_self = 0;
									
								}else{
									value.icon_addfriend = true;
									value.name_addfriend = true;
									value.icon_self = 1;
									value.name_self = 1;
									
									value.ci_star = true;
								}
							}else{
								value.icon_addfriend = false;
								value.name_addfriend = false;
								value.icon_self = 0;
								value.name_self = 0;
								value.ci_check = true;
							}
						}

						if(tmp[key].status.friend.approve==false){
							value.checklist_addfriend = true;
						}else{
							value.checklist_addfriend = false;
						}

						if(tmp[key].status.follow==false){
							value.icon_follow = true;
							value.name_follow = true;
							value.checklist_follow = true;
						}else{
							value.icon_follow = false;
							value.name_follow = false;
						}
						
						var friend_connection = new friendConnectionFactory(value);
						//console.log(friend_connection);
						if(type=='friend'){
							factory.user_list.push(friend_connection);
						}else{
							factory.mutual_list.push(friend_connection);
						}

					});
					if(type=='friend'){
						factory.isloading = false;
					}else{
						factory.isloading_mutual = false;
					}
					//factory.load_more = true;
					//factory.loading = false;
					
					
				}else{
					//...
				}
			});
			
		}

		function getApiNext(keyword, start, limit, offset, api, type){
			var ok = false;
			if($stateParams.username){
				var c = {
					data: {
						"user_id": factory.user_friend_id,
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}else{
				var c = {
					data: {
						"keyword": keyword,
						"limit": limit,
						"offset": offset
					}
				}
			}

			CiayoService.Api(api, c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					//factory.user_list = factory.user_list.concat(data.content.list_user);

					var tmp_next=(data.content.list_user);

					
					if(tmp_next.length==0){
						if(type=='friend'){
							factory.load_more = false;
						}else{
							factory.load_more_mutual = false;
						}
					}else{
						if(type=='friend'){
							factory.load_more = true;
						}else{
							factory.load_more_mutual = true;
						}
					}	
				}else{
					//...
				}
			});

			if(type=='friend'){
				factory.loading = false;
			}else{
				factory.loading_mutual = false;
			}

				
		}

		function redirect_page(page){
			factory.tab_active = page;
		}

		function getSearchFriend(username){
			searchFriendDrawer.open(username);
		}

		return factory;
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.factory('settingFactory', settingFactory);

	settingFactory.$inject = ['$cookieStore', '$rootScope', '$state', '$stateParams', 'modalFactory', 'CiayoService', 'languageFactory', 'settingConnector'];

	function settingFactory($cookieStore, $rootScope, $state, $stateParams, modalFactory, CiayoService, languageFactory, settingConnector) {
		function factory(){
			var factory = this;
			angular.extend(factory,{
			info: {
				data:[],
				list:[]
			},
			prefix: {
				list:[]
			},
			edit_prefix:'',
			resend_count_email:0,
			resend_count_phone:0,
			load_setting:false,
			timeline_privacy:'Public',
			default_post_privacy:'Public',
			who_can_find_privacy:'Public',
			who_can_add_me_privacy:'Public',
			userBasicInfo:userBasicInfo,
			verifyAccount:verifyAccount,
			resendCodeEmail:resendCodeEmail,
			resendCodePhone:resendCodePhone,
			editEmail:editEmail,
			editPhone:editPhone,
			showEmail:showEmail,
			showPhone:showPhone,
			generalSettings:generalSettings,
			listPrefixPhone:listPrefixPhone,
			changePassword:changePassword,
			changePreference:changePreference,
			saveEditAccount:saveEditAccount,
			changeLanguage:changeLanguage,
			logout:logout,

			userDeactive:userDeactive,
			deleteConfirm:deleteConfirm,
			userDelete:userDelete,
			validatePass:validatePass,
			showTooltip:showTooltip,
			pasteCode:pasteCode,
			sendCode:sendCode,
			loginNotification:loginNotification,
			changeEmailShow:changeEmailShow,
			showModal:showModal
		});

		function userBasicInfo(username) {
			settingConnector.userInfo(username).then(function(data){
				if(data.error==false){
					factory.info.list=[];
					factory.info.list = data.content.users_info;
					angular.forEach(factory.info.list, function(value,key) {
						factory.info.data[value.filter_name] = value;
					})
					factory.load_info = true;
					callback();
				}else{
					modalFactory.message(data.message);
				}
			},function(response){
				
			})
		}

        function pasteCode(event) {
            var item = event.clipboardData.items[0];
            item.getAsString(function (data) {
                var code = data;
                code_1.value = code.charAt(0);
                code_2.value = code.charAt(1);
                code_3.value = code.charAt(2);
                code_4.value = code.charAt(3);
                factory.code_1 = code.charAt(0);
                factory.code_2 = code.charAt(1);
                factory.code_3 = code.charAt(2);
                factory.code_4 = code.charAt(3);
                verifyAccount();
            });
        }

        function sendCode() {
            if(code_1.value && code_2.value && code_3.value && code_4.value) {
                verifyAccount();
            }
        }

        function verifyAccount() {
        	var confirmation_code = factory.code_1 + "" + factory.code_2 + "" + factory.code_3 + "" + factory.code_4;
        	settingConnector.verifyAccount(confirmation_code).then(function(data) {
				$('.cm-setting-wrp').hide();
				$('.-account-verification').fadeOut('slow', function(){
					$('.-account-verification-success').fadeIn('slow');
				});
			},function(response){
				modalFactory.message(data.message);
			})
        }

        function resendCodeEmail() {
        	factory.resend_email_proccess=true;
        	factory.resend_count_email++;
        	var c={
                data:{
                    email:factory.email_address
                }
            };
            CiayoService.Api('settings/sendingverify/email', c, function(response) {
                var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					factory.resend_email_proccess=false;
					showModal(data.message);
				} else {
					factory.resend_email_proccess=false;
					showModal(data.message);
				}
            })
        }

        function resendCodePhone(type) {
        	if(!factory.send_code_phone) {
	        	factory.resend_phone_proccess=true;
	        	if(type) { 
	        		factory.resend_count_phone++;
	        	} else {
	        		factory.send_code_phone = true;
	        	}
	        	var phone_number = factory.prefix_phone+'-'+factory.phone;
	        	phone_number = phone_number.replace('+','');
	        	var c={
	                data:{
	                    phone_number:phone_number
	                }
	            };
	            CiayoService.Api('settings/sendingverify/phone', c, function(response) {
	                var ok = false;
	                var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						if(data.error == false) {
							ok = true
						}
					}
					if(ok) {
						factory.resend_phone_proccess=false;
						if(type) showModal(data.message);
					} else {
						factory.resend_phone_proccess=false;
						if(type) showModal(data.message);
					}
	            })
	        }
        }

		function editEmail() {
			factory.change_email_proccess = true;
			var c = {
				data : {
					email:factory.edit_email_address
				}
			};
			CiayoService.Api('settings/email', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					factory.change_email_succsess = true;
					factory.old_email_address = factory.email_address;
					factory.email_address = factory.edit_email_address;
					$(".-setting-mobile-number-changed").addClass("-open");
					factory.change_email_proccess = false;
				} else {
					factory.change_email_succsess = false;
					factory.change_email_failed = data.message;
					$(".-setting-mobile-number-changed").addClass("-open");
					factory.change_email_proccess = false;
				}
			});
		}

		function editPhone() {
			factory.change_phone_proccess = true;
			var c = {
				data : {
					phone_number:factory.edit_prefix+'-'+factory.edit_phone
				}
			};
			CiayoService.Api('settings/phone', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					factory.change_phone_proccess = false;
					factory.change_phone_succsess = true;
					factory.old_prefix = factory.prefix_phone;
					factory.new_prefix = factory.edit_prefix;
					factory.old_phone = factory.phone;
					factory.phone_number = factory.edit_phone;
					$(".-setting-mobile-number-changed").addClass("-open");
				} else {
					factory.change_phone_proccess = false;
					factory.change_phone_succsess = false;
					factory.change_phone_failed = data.message;
					$(".-setting-mobile-number-changed").addClass("-open");
				}
			});
		}

		function showEmail() {
			var value=(factory.show_email)?1:0;
			settingConnector.setPreference(value, 'show_email').then(function(data) {
			
			},function(response){
				
			})
		}

		function showPhone() {
			var value=(factory.show_phone)?1:0;
			settingConnector.setPreference(value, 'show_phone').then(function(data) {
			
			},function(response){
				
			})
		}

		function saveEditAccount() {
			var c = {
				data : {
					email:factory.email_address
				}
			};
			CiayoService.Api('settings/email', c, function(response) {
				var data = null;
				data = response.data.c.data;
				modalFactory.log(data,'info');
			});
			var phone_number = factory.prefix_phone.replace('+','')+'-'+factory.phone_number;
			var c = {
				data : {
					phone_number:phone_number
				}
			};
			CiayoService.Api('settings/phone', c, function(response) {
				var data = null;
				data = response.data.c.data;
				modalFactory.log(data,'info');
			});
			showModal('success change profile settings');
		}

		function generalSettings() {
	    	//$('.loader-wrp').show();
			setTimeout(function(){
				var c = {
					data : {
					}
				};
				CiayoService.Api('settings', c, function(response) {
					var ok = false;
					var data = null;
					var general_settings = null;
					var edit_account = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						if(data.error == false) {
							ok = true
						}
					}
					if(ok) {
						general_settings = data.content.list_setting.general_setting;

						factory.parallax_view_timeline = general_settings.card_setting.parallax_view;
						factory.comment = general_settings.notification_setting.comment;
						factory.connection_request = general_settings.notification_setting.connection_request;
						factory.notification_tone = general_settings.notification_setting.notifications_tone;
						factory.reset_password = general_settings.email_setting.reset_password;
						factory.login_failed = general_settings.email_setting.login_failed;
						factory.deactive_account = general_settings.email_setting.deactive_account;
						factory.delete_account = general_settings.email_setting.delete_account;
						factory.new_features = general_settings.email_setting.new_features;
						factory.language = String(general_settings.languages_setting.lang.value);

						edit_account = data.content.list_setting.edit_account;

						factory.login_notification = edit_account.login_notification.value;
						factory.email_address = edit_account.email_address.value;
						factory.edit_email_address = factory.email_address;
						factory.verify_status = edit_account.verified;
						factory.prefix_phone = edit_account.phone_number.code;
						if(factory.prefix_phone==null) factory.prefix_phone='';
						try{factory.phone_number = parseInt(edit_account.phone_number.number.replace('-',''))}catch(err){}
						try{factory.phone = parseInt(edit_account.phone_number.number.replace('-',''))}catch(err){}

						factory.email_tmp = factory.email_address;
						factory.phone_tmp = factory.phone_number;

						factory.show_email = data.content.list_setting.edit_account.show_email.value;
						factory.show_phone = data.content.list_setting.edit_account.show_phone.value;

						listPrefixPhone();
						factory.load_setting=true;
						// $('.loader-wrp').fadeOut('slow');
						// $('.-setting').css('margin-left','20px');
						// $('.-setting').show().animate({'margin-left':'0','opacity':'1'});
					} else {
						
					}
				});
			}, 500);
		}

		function listPrefixPhone() {
            var c={
                data:{
                    limit:500,
                    offset:0
                }
            };
            CiayoService.Api('users/setting/prefix_phone_number', c, function(response) {
                var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;

					modalFactory.log(data,'info');

					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					factory.prefix.list = data.content.list_prefix_phone_number;
				} else {

				}
            });
        }

        function userDeactive() {
        	var c = {
				data : {
					deactive:true
				}
			};
			CiayoService.Api('settings/deactive', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;

					modalFactory.log(data,'info');

					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					showModal(data.message);
				} else {
					showModal(data.message);
				}
			});
        }

        function deleteConfirm() {
        	var c = {
				data : {
				}
			};
			CiayoService.Api('settings/deleteconfirm', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;

					modalFactory.log(data,'info');

					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					showModal(data.message);
				} else {
					showModal(data.message);
				}
			});
        }

        function userDelete() {
        	var c = {
				data : {
					delete_token:$stateParams.token
				}
			};
			CiayoService.Api('settings/delete', c, function(response) {
				var ok = false;
                var data = null;
				if(response.status==200) {
					data = response.data.c.data;

					modalFactory.log(data,'info');

					if(data.error == false) {
						ok = true
					}
				}
				if(ok) {
					showModal(data.message);
					$cookieStore.remove('token');
                    $state.go('welcome');
				} else {
					showModal(data.message);
				}
			});
        }

        if($stateParams.menu=='delete' && $stateParams.token) {
        	alert($stateParams.token);
            userDelete();
        }

        function changePassword() {
        	settingConnector.changePassword(factory.old_password, factory.new_password, factory.confirm_new_password)
        	.then(function(data) {
        		modalFactory.message(data.message);
        	}, function(response) {
        		//modalFactory.message(data.message);
        	})
        }

        function loginNotification(){
        	var value=(factory.login_notification)?1:0;
        	modalFactory.log(value,'info');
        }

        function changeLanguage(){
        	var language = factory.language;
        	$cookieStore.put('language', language);
        	factory.language = null;
        	languageFactory.changeLanguage(parseInt(language), function(language) {
        		factory.language = String(language);
        	});
        }

        function validatePass(id){
        	//factory.password_valid=false;
        	if(id == 'old_password') {
                var pass = factory.old_password;
                if (pass.length > 7) {
		            if (pass&&pass.match(/^[A-Za-z\d\!\@\#\$\%\^\*\{\[\}\}\:\;\,\.\?\+\-\_\=\~\']{8,}$/)) {
		                factory.old_password_valid=true;
		                $('.old_password').removeClass('error');
		            } else {
		                factory.old_password_valid=false;
		            }
		        } else {
		        	factory.old_password_valid=false;
		        }
            } 
            if(id == 'new_password') {
                var pass = factory.new_password;
                if (pass.length > 7) {
		            if (pass&&pass.match(/^[A-Za-z\d\!\@\#\$\%\^\*\{\[\}\}\:\;\,\.\?\+\-\_\=\~\']{8,}$/)) {
		                factory.new_password_valid=true;
		                $('.new_password').removeClass('error');
		            } else {
		                factory.new_password_valid=false;
		            }
		        } else {
		        	factory.new_password_valid=false;
		        }
            }
            if(id == 'confirm_new_password') {
                var pass = factory.confirm_new_password;
                if (pass.length > 7) {
		            if (pass&&pass.match(/^[A-Za-z\d\!\@\#\$\%\^\*\{\[\}\}\:\;\,\.\?\+\-\_\=\~\']{8,}$/)) {
		                factory.confirm_new_password_valid=true;
		                $('.confirm_new_password').removeClass('error');
		            } else {
		                factory.confirm_new_password_valid=false;
		            }
		        } else {
		        	factory.confirm_new_password_valid=false;
		        }
                if(factory.new_password==factory.confirm_new_password) {
        			factory.password_not_match=false;
        		}
            }
        }

        function showTooltip(type,id) {
        	if(type == 'old_password') {
                var tooltip = $('#tooltip_old_password');
            } 
            if(type == 'new_password') {
                var tooltip = $('#tooltip_new_password');
            }
            if(type == 'confirm_new_password') {
            	var tooltip = $('#tooltip_confirm_new_password');
            }
        	if(id){
        		tooltip.slideDown('fast');
        	} else {
        		tooltip.slideUp('fast');
        		if(factory.old_password&&!factory.old_password_valid){
        			$('.old_password').addClass('error');
        		}
        		if(factory.new_password&&factory.old_password&&!factory.new_password_valid){
        			$('.new_password').addClass('error');
        		}
        		if(factory.confirm_new_password&&!factory.confirm_new_password_valid){
        			$('.confirm_new_password').addClass('error');
        		}
        	}
        }

        function changePreference(type,val) {
			var value = (val)?1:0;
			settingConnector.setPreference(value, type).then(function(data) {
			
			},function(response){
				
			})
        }

		function logout() {
			settingConnector.logout().then(function(data) {
				$cookieStore.remove('token');
                $state.go('welcome');
			},function(response){
				$cookieStore.remove('token');
            	$state.go('welcome');
			})
		}

		function changeEmailShow() {
			$("._change-content").slideDown('fast');
		}

		function showModal(message) {
			factory.modal_info=message;
			$('.-info').addClass('-open');
		}
		}
		return factory;
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.factory('storeFactory', storeFactory);

	storeFactory.$inject = ['$cookieStore','$filter', '$rootScope', '$state', '$stateParams', 'modalFactory', 'CiayoService'];

	function storeFactory($cookieStore,$filter, $rootScope, $state, $stateParams, modalFactory, CiayoService) {
		var factory = {
			loadFeatures:loadFeatures,
			bannerHome:bannerHome,
			bannerPremium:bannerPremium,
			bannerContributor:bannerContributor,
			bannerFree:bannerFree,
			loadCategory:loadCategory,
			loadList:loadList,
			loadEmoji:loadEmoji,
			viewDetail:viewDetail,
			loadBalance:loadBalance,
			getAllSticker:getAllSticker,
			buySticker:buySticker,
			search:search,
			searchItem:searchItem,
			showAll:showAll,
			previewSticker:previewSticker,
			stickerClickOutside:stickerClickOutside,
			loadMore:loadMore,
			loadMoreFree:loadMoreFree,

			storeTab:storeTab,
			closeDetailDrawer:closeDetailDrawer,
			closeSeeAllDrawer:closeSeeAllDrawer,
			closeSearchDrawer:closeSearchDrawer,
			menu:1,
			goto_back:goto_back,
			list_is_loading :{},
			list_is_full:{}
		};

		function loadFeatures() {
			var c = {
				data: {
					offset: "0",
					limit: "3"
				}
			}
			CiayoService.Api('ciayoproducts/banner', c, function(response){
				var ok = false;
								var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listFeatured = response.data.c.data.content.list_store_banner;
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function bannerHome(callback) {
			var c = {
				data: {
					page: 1,
					offset: 0,
					limit: 3
				}
			}
			CiayoService.Api('ciayoproducts/banner', c, function(response){
				var ok = false;
								var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					if(!factory.listBannerHome) {
						modalFactory.log(data.message);
						factory.listBannerHome = response.data.c.data.content.list_store_banner;
						callback();
					}
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function bannerPremium(callback) {
			var c = {
				data: {
					page: 2,
					offset: 0,
					limit: 3
				}
			}
			CiayoService.Api('ciayoproducts/banner', c, function(response){
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listBannerPremium = response.data.c.data.content.list_store_banner;
					callback();
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function bannerContributor(callback) {
			var c = {
				data: {
					page: 3,
					offset: 0,
					limit: 3
				}
			}
			CiayoService.Api('ciayoproducts/banner', c, function(response){
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listBannerContributor = response.data.c.data.content.list_store_banner;
					callback();
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function bannerFree(callback) {
			var c = {
				data: {
					page: 4,
					offset: 0,
					limit: 3
				}
			}
			CiayoService.Api('ciayoproducts/banner', c, function(response){
				var ok = false;
								var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listBannerFree = response.data.c.data.content.list_store_banner;
					callback();
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		factory.listAll = [];
		function loadList(type,order, status, offset, limit, cat, keyword, load_more) {
			if(factory.list_is_loading[cat+'-'+order+'-'+status]==true ||
				 factory.full){
				return;
			}
			factory.list_is_loading[cat+'-'+order+'-'+status]=true;
			var c = {
				"category_id": cat,
				"keyword": keyword,
				"user": "",
				"order": order,
				"status": status,
				"offset": offset,
				"limit": limit
			};
			factory.isLoadingMore = true;
			CiayoService.Api('ciayoproducts/sticker', c, function(response){
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
					if(!data.content.data.length){
						factory.noDataAll = true;
					}
				}
				if(ok) {
					factory.list_is_loading[cat+'-'+order+'-'+status]=false;
					modalFactory.log(data.message);
					var data = response.data.c.data.content.data;
					if(type=='popular') {
						if(load_more) {
							if(data.length) {
								factory.listPopular = factory.listPopular.concat(data);
								factory.listSeeAll = factory.listPopular;
							} else {
								factory.full = true;
								factory.load_more = false;
							}
						} else {
							factory.listPopular = data;
						}
						factory.popular_order = order;
						factory.popular_status = status;
						factory.popular_offset = offset;
						factory.popular_limit = limit;
						factory.popular_cat = cat;
					}
					if(type=='premium') {
						if(load_more) {
							if(data.length) {
								factory.listPremium = factory.listPremium.concat(data);
								factory.listSeeAll = factory.listPremium;
							} else {
								factory.full = true;
								factory.load_more = false;
							}
						} else {
							factory.listPremium = data;
						}
						factory.premium_order = order;
						factory.premium_status = status;
						factory.premium_offset = offset;
						factory.premium_limit = limit;
						factory.premium_cat = cat;
					}
					if(type=='contributor') {
						if(load_more) {
							if(data.length) {
								factory.listContributor = factory.listContributor.concat(data);
								factory.listSeeAll = factory.listContributor;
							} else {
								factory.full = true;
								factory.load_more = false;
							}
						} else {
							factory.listContributor = data;
						}
						factory.contributor_order = order;
						factory.contributor_status = status;
						factory.contributor_offset = offset;
						factory.contributor_limit = limit;
						factory.contributor_cat = cat;
					}
					if(type=='free') {
						if(load_more) {
							if(data.length) {
								factory.listFree = factory.listFree.concat(data);
								factory.listSeeAll = factory.listFree;
							} else {
								factory.full = true;
								factory.full_free = true;
								factory.load_more = false;
							}
						} else {
							factory.listFree = data;
						}
						factory.free_order = order;
						factory.free_status = status;
						factory.free_offset = offset;
						factory.free_limit = limit;
						factory.free_cat = cat;

					}
					if(type=='all') {
						if(load_more) {
							factory.listAll = factory.listAll.concat(data);
							factory.listSeeAll = factory.listAll;
						} else {
							factory.listAll = data;
						}
					}
					factory.isLoadingMore = false;
					factory.load_more = false;
				} else {
					modalFactory.log(data.message);
				}
			});

		}

		function loadMore() {
			factory.load_more = true;
			factory.offset = parseInt(factory.offset)+5;
			if(factory.type=='emoji') {
				loadEmoji(factory.offset, factory.limit, 'load_more');
			} else {
				loadList(factory.type, factory.order, factory.status, factory.offset, factory.limit, factory.cat, '', 'load_more');
			}
		}

		factory.offset_free = 0;

		function loadMoreFree() {
			factory.load_more = true;
			factory.offset_free = parseInt(factory.offset_free)+5;
			loadList('free','0','2',factory.offset_free,'5','0', '', 'load_more');
		}

		function loadCategory() {
			var c = {
				data: {
					offset: "0",
					limit: "3"
				}
			}
			CiayoService.Api('ciayoproducts/category', c, function(response){
				var ok = false;
				var data = null;
				if(response.status==200) {
					modalFactory.log('list category');
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listCategory = response.data.c.data.content.list_category_ciayo_product;
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function loadListCategory() {
			if(type == 'premium'){
				var order1 = 0;
				var order2 = 1;
			} else {
				var order1 = 2;
				var order2 = 0;
			}

		}

		function loadEmoji(offset,limit,load_more) {
			var c = {
				data: {
					offset: offset,
					limit: limit
				}
			}
			CiayoService.Api('ciayoproducts/emoji', c, function(response){
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log('list emoji');
					modalFactory.log(data.message);
					var data = response.data.c.data.content.list_emoji;
					if(load_more) {
						if(data.length) {
							factory.listEmoji = factory.listEmoji.concat(data);
							factory.listSeeAll = factory.listEmoji;
						} else {
							factory.full = true;
						}
					} else {
						factory.listEmoji = data;
					}
					factory.emoji_offset = offset;
					factory.emoji_limit = limit;
					factory.load_more = false;
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function viewDetail(id, type) {
			//closeSearchDrawer();
			factory.type = type;
			factory.item_detail_load = false;
			$('.loader-wrp').show();
			$('body').addClass('-locked');
			$(".-sticker-detail").addClass("-open");
			var c = {
				data: {
					product_id: id
				}
			};
			if(type=='emoji') {
				CiayoService.Api('ciayoproducts/emoji/detail', c, function(response){
					var ok = false;
					var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						modalFactory.log('view detail');
						modalFactory.log(data.message);
						factory.itemDetail = response.data.c.data.content;
						factory.item_detail_load = true;
					} else {
						modalFactory.log(data.message);
					}
				});
			} else {
				CiayoService.Api('ciayoproducts/sticker/detail', c, function(response){
					var ok = false;
									var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						modalFactory.log('view detail');
						modalFactory.log(data.message);
						factory.itemDetail = response.data.c.data.content;
						factory.item_detail_load = true;
					} else {
						modalFactory.log(data.message);
					}
				});
			}
		}

		function closeDetailDrawer() {
			$(".-sticker-detail").removeClass("-open");
			$('body').removeClass('-locked');
		}

		function closeSearchDrawer() {
			$(".-sticker-search").removeClass("-open");
			$('body').removeClass('-locked');
			factory.listSearchItem=[];
		}

		function closeSeeAllDrawer() {
			$(".-sticker-all").removeClass("-open");
			$('body').removeClass('-locked');
			factory.listSeeAll=[];
		}

		function loadBalance() {
			var c = {
				data:{}
			};
			CiayoService.Api('user/coin/balance', c, function(response){
				modalFactory.log('caps');
				modalFactory.log(response.data.c.data.content);
				var data = response.data.c.data.content;
				factory.caps = data.cash;
				factory.cans = data.coin;
			});
		}

		function buySticker(){
			if(!factory.itemDetail.bought){
				var c = {
					data: {
						product_id: factory.itemDetail.product_id,
						price: factory.itemDetail.price_1,
						price_type: 'price_1'
					}
				};

				CiayoService.Api('ciayoproducts/buy', c, function(response){
					var ok = false;
									var data = null;
					if(response.status==200) {
						data = response.data.c.data;
						modalFactory.log(data,'info');
						var title=[];
						if(data.error == false) {
							ok = true;
						}
					}
					if(ok) {
						modalFactory.log(data.message);
						modalFactory.message(data.message);
						closeDetailDrawer();
						loadBalance();
					} else {
						modalFactory.log(data.message);
						modalFactory.message(data.message);
						closeDetailDrawer();
					}
				});
			}
		}

		function searchItem() {
			factory.item_search_load = false;
			$('.loader-wrp').show();
			$('body').addClass('-locked');
			if(factory.keyword) {
				search('0','0','0','18','0',factory.keyword);
			}
		}

		function search(order, status, offset, limit, cat, keyword){
			var c = {
				"category_id": cat,
				"keyword": keyword,
				"user": "",
				"order": order,
				"status": status,
				"offset": offset,
				"limit": limit
			};
			CiayoService.Api('ciayoproducts/sticker', c, function(response){
				var ok = false;
								var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listSearchItem = response.data.c.data.content.data;
					factory.item_search_load = true;
					if(factory.listSearchItem.length>0){
						$(".-sticker-search").addClass("-open");
					}else{
						modalFactory.message($filter('translate')('$not.found'));
					}
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function getAllSticker(category_id, keyword, offset, limit){
			factory.item_all_load = false;
			var c = {
				"category_id": category_id,
				"keyword": keyword,
				"offset": offset,
				"limit": limit
			};
			CiayoService.Api('ciayoproducts/sticker', c, function(response){
				var ok = false;
								var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					modalFactory.log('all sticker');
					modalFactory.log(data,'info');
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					modalFactory.log(data.message);
					factory.listAllItem = response.data.c.data.content.data;
					factory.item_all_load = true;
				} else {
					modalFactory.log(data.message);
				}
			});
		}

		function showAll(title,type) {
			factory.full = false;
			factory.offset = 0;
			factory.see_all_title = title;
			$(".-sticker-all").addClass("-open");
			$('body').addClass('-locked');
			if(type==1) {
				factory.listSeeAll = factory.listPopular;
				factory.type = 'popular';
				factory.order = factory.popular_order;
				factory.status = factory.popular_status;
				factory.offset = factory.popular_offset;
				factory.limit = factory.popular_limit;
				factory.cat = factory.popular_cat;
			}
			if(type==2) {
				factory.listSeeAll = factory.listPremium;
				factory.type = 'premium';
				factory.order = factory.premium_order;
				factory.status = factory.premium_status;
				factory.offset = factory.premium_offset;
				factory.limit = factory.premium_limit;
				factory.cat = factory.premium_cat;
			}
			if(type==3) {
				factory.listSeeAll = factory.listContributor;
				factory.type = 'contributor';
				factory.order = factory.contributor_order;
				factory.status = factory.contributor_status;
				factory.offset = factory.contributor_offset;
				factory.limit = factory.contributor_limit;
				factory.cat = factory.contributor_cat;
			}
			if(type==4) {
				factory.listSeeAll = factory.listFree;
				factory.type = 'free';
				factory.order = factory.free_order;
				factory.status = factory.free_status;
				factory.offset = factory.free_offset;
				factory.limit = factory.free_limit;
				factory.cat = factory.free_cat;
			}
			if(type==5) {
				factory.listSeeAll = factory.listAll;
				factory.type = 'all';
			}
			if(type==6) {
				factory.listSeeAll = factory.listEmoji;
				factory.type = 'emoji';
				factory.offset = factory.emoji_offset;
				factory.limit = factory.emoji_limit;
			}
		}

		function storeTab(id) {
			if(id==5) {
				getAllSticker(null, null, 20, 0);
			}
			factory.menu_open = id;
			factory.menu = id;
			var $inner = $(".store-inner-content");
			$inner.animate({
					left: "-"+(id-1)+"00%"
			},200);
		}

		factory.sticker = [];
		factory.toogle_sticker = [];
		function previewSticker($event,id) {
			if(factory.current_id!=id) {
				factory.toogle_sticker[factory.current_id] = false;
			}
			if(!factory.toogle_sticker[id]) {
				factory.toogle_sticker[id] = true;
				angular.element('.stickeritem').addClass('inactive');
				angular.element($event.target).removeClass('inactive');
				angular.element($event.target).addClass('active');
				factory.current_id = id;
			} else {
				factory.toogle_sticker[id] = false;
				angular.element('.stickeritem').removeClass('inactive');
				angular.element('.stickeritem').removeClass('active');
			}
			
		}

		function stickerClickOutside(){
			angular.element('.stickeritem').removeClass('inactive');
			angular.element('.stickeritem').removeClass('active');
		}

		function goto_back(){
			window.history.back();
		}

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('timelineFactory', timelineFactory);
	timelineFactory.$inject = ['$rootScope', 'modalFactory', 'CiayoService', 'cardFactory', '$cookieStore', '$stateParams','timelineConnector','socketFactory'];

	function timelineFactory($rootScope, modalFactory, CiayoService, cardFactory, $cookieStore, $stateParams,timelineConnector,socketFactory) {
		var _super = {
			permission: [],
			deleteCard: deleteCard,
			user: {
				id: null,
				username: '',
				user_display_name: '',
				avatar: {
					background: '',
					full_body: '',
					face: '',
					cropped: ''
				},
			},
			parallax_setting: true
		}
		
		var factory = {
			type: '',
			card_list: [],
			getCardList: getCardList,
			load_more: false,
			loading: true,
			isloading: false,
			loading_count: [],
			clearSearch: clearSearch,
			init: init,
			insert: insert,
			_super: _super,
			new_post_count:0,
			new_post_loading:false,
			new_post_paused:false,
			new_post_timer:null,
			newPostLoad:newPostLoad
		};


		function init() {
			factory.loading_count = [{}];
			loadPermission(
				function () {
					getSettings(function (response) {
						var data = response.data.c.data;
						if (data.error == false) {
							var content = data.content;
							_super.parallax_setting = content.list_setting.general_setting.card_setting.parallax_view;
							getUserInfo();
						}
					}, function () {
						getUserInfo();
					});
				}
			);
		}
		
		function clearSearch() {
			factory.search_text = '';
			factory.card_list = [];
			factory.load_more = false;
		}

		function getCardList(start) {
			if(!factory.loading && !factory.load_more){
				return;
			}
			if (!factory.isloading) {
				factory.isloading = true;
				factory.loading = true;

				if (start) {
					factory.card_list = [];
				}


				var offset = factory.card_list.length;
				var limit = 3;
				var username= null;
				var pointer_id=null;
				if (factory.type == 'profile') {
					username= $stateParams.username;
				} else if (factory.type == 'trending') {
					if (offset >= 8) {limit = 2;}
					
				}
				if(offset>0){
					pointer_id = factory.card_list[offset-1].id;
				}
				
				timelineConnector.timelineGet(factory.type,limit,offset,pointer_id,username)
					.then(function(data){
					if (data.error == false) {
						if (factory.type == 'trending') {
							var tmp = (data.content.trending);
						} else {
							var tmp = (data.content.posts);
						}
						angular.forEach(tmp, function (value, key) {

							value.frame = false;
							var card = new cardFactory(value, _super);
							factory.card_list.push(card);

						});
						factory.isloading = false;
						factory.loading = false;

						if (factory.type == 'trending') {
							if (offset >= 8) {
								factory.load_more = false;
							} else {
//								if (data.meta.current_page < data.meta.last_page) {
									factory.load_more = true;
//								} else {
//									factory.load_more = false;
//								}
							}

						} else {

							if (data.meta.current_page < data.meta.last_page) {
								factory.load_more = true;
							} else {
								factory.load_more = false;
							}
						}
						if (start == true) {
							factory.loading_count.pop();
						}
					} else {
						//...
					}
				}, function(){
						
					});
			}
		}

		function getSettings(callback, errCallback) {
			var c = {
				data: {}
			};
			CiayoService.Api('settings', c, function (response) {
				if (response.status == 200) {
					callback(response);
				} else {
					callback(response);
				}
			});
		}

		function loadPermission(callback) {
			if (_super.permission.length != 0) {
				callback();
				return;
			}
			timelineConnector.postAttributesGet().then(function(data){
				if(data.error==false){
					_super.permission.list = [];
					_super.permission = data.content.post_category;
					angular.forEach(_super.permission, function (value, key) {
						value.icon = value.name.toLocaleLowerCase().replace(' ', '-');
					});
					callback();
				}else{
					modalFactory.message(data.message);
				}
			},function(response){
				
			})
		}

		function deleteCard(card) {
			var index = factory.card_list.indexOf(card);
			if (index != -1) {
				factory.card_list.splice(index, 1);
			}
		}

		function getUserInfo() {
			var username = ''; //$stateParams.username?$stateParams.username:'';
			var ok = false;
			var c = {
				data: {
					"username": username
				}
			}
			CiayoService.Api('users/info', c, function (response) {
				if (response.status == 200) {
					var data = response.data.c.data;
					if (data.error == false) {
						var card = data.content;
						//user_info
						_super.user.id = card.user_id;
						//user_avatar
						_super.user.avatar.background = card.users_avatar.background_avatar;
						_super.user.avatar.full_body = card.users_avatar.avatar;
						_super.user.avatar.cropped = card.users_avatar.avatar_crop;
						getCardList(true);
						runSocket();
						newPostPause();
					}
				}

			});
		}

		function insert(value) {
			var card = new cardFactory(value, _super);
			factory.card_list.unshift(card);
		}
		
		function runSocket(){
			var ioSocket = io.connect(SOCKET_API_SERVER);
			var socket = socketFactory({ioSocket:ioSocket});
			socket.emit('set_userid', _super.user.id);
			socket.on('np001',onNewPost);
		}
		function onNewPost(data){
			factory.new_post_count++;
		}
		function newPostLoad(){
			newPostPause();
			factory.new_post_loading=true;
			timelineConnector.timelineGet('timeline',factory.new_post_count,0,null,'',true)
				.then(function(data){
				var tmp = (data.content.posts).reverse();
				angular.forEach(tmp, function (value, key) {
					value.frame = false;
					var card = new cardFactory(value, _super);
					factory.card_list.unshift(card);
				});
				factory.new_post_loading = false;
			},function(response){
				
			})
			factory.new_post_count=0;
		}
		function newPostPause(){
			factory.new_post_paused=true;
			clearTimeout(factory.new_post_timer);
			factory.new_post_timer = setTimeout(newPostResume, 30000);
		}
		function newPostResume(){
			factory.new_post_paused = false;
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('trendingActivityFactory', trendingActivityFactory);
	trendingActivityFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state', 'cardParallaxFactory'];

	function trendingActivityFactory($rootScope,modalFactory, CiayoService, $state, cardParallaxFactory) {
		var factory = {
			trending_activity_list:[],
			getTrendingActivityList:getTrendingActivityList,
			getTrendingActivityList_next:getTrendingActivityList_next,
			trending_activity_start: false,
			load_more:false,
			loading: true,
			isloading:false,
			
		};

		function getTrendingActivityList_next(){
			
				var offset = factory.trending_activity_list.length; 
				var limit = 3;

				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('activity/trending', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						//console.log(countFr);
						
						var tmp_next=(data.content.trending);
						console.log(tmp_next);

						if(tmp_next.length==0){
							factory.load_more = false;
						}else{
							factory.load_more = true;
						}		

					}else{
						//...
					}
				});
			
		}

		function getTrendingActivityList(start){
			if(!factory.loading && !factory.load_more){
				return;
			}
			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
				factory.trending_activity_start = false;
				factory.load_more = false;
				if(start){
					factory.trending_activity_list=[];
				}

				var offset = factory.trending_activity_list.length;
				var limit = 3;

				var ok = false;
				var c = {
					data: {
						"limit": limit,
						"offset": offset
					}
				}
				CiayoService.Api('activity/trending', c, function(response) {
					if(response.status==200){
						var data = response.data.c.data;
						if (data.error == false) {
							ok = true;
						}
					}
					if(ok){

						//console.log(countFr);
						
						var tmp=(data.content.trending);
						//console.log(tmp);
						if(start){
							factory.count = 1;
						}else{
							factory.count = (factory.count) ? factory.count : 1;
						}

						angular.forEach(tmp,function(value,key){
							value.trending_activity_number = factory.count;
							if((value.trending_activity_number+'').length==1){
								value.trending_activity_number = "0"+value.trending_activity_number;
							}

							tmp[key].activity_detail.face = (tmp[key].user_avatar) ? tmp[key].user_avatar.face: '';
							tmp[key].activity_detail.parallax_setting=true;
							value.parallax = new cardParallaxFactory(tmp[key].activity_detail);


							factory.trending_activity_list.push(value);
							
							factory.count++;
						});

						factory.isloading = false;
						factory.loading = false;

						if(offset >= 8){
							factory.load_more = false;
						}else{
							getTrendingActivityList_next();
						}

						factory.trending_activity_start = true;

					}else{
						//...
					}
				});
			}
		}
		

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('trendingPeopleFactory', trendingPeopleFactory);
	trendingPeopleFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state', 'friendConnectionFactory', '$cookieStore'];

	function trendingPeopleFactory($rootScope,modalFactory, CiayoService, $state, friendConnectionFactory, $cookieStore) {
		var factory = {
			trending_people_list:[],
			getTrendingPeopleList:getTrendingPeopleList,
			trending_people_start:false
		};

		function getTrendingPeopleList(start){
				
				//if(start){
					factory.trending_people_start=false;
					factory.trending_people_list=[];
				//}
					var offset = 0;
					var limit = 20;

					var ok = false;
					var c = {
						data: {
							"limit": limit,
							"offset": offset
						}
					}
					// CiayoService.Api('users/trending', c, function(response) {
					// 	if(response.status==200){
					// 		var data = response.data.c.data;
					// 		if (data.error == false) {
					// 			ok = true;
					// 		}
					// 	}
					// 	if(ok){

					// 		//console.log(countFr);
							
					// 		var tmp=(data.content.trending);
					// 		//console.log(tmp);
					// 		factory.count = 1;
					// 		angular.forEach(tmp,function(value,key){
					// 			value.trending_people_number = factory.count;
					// 			if((value.trending_people_number+'').length==1){
					// 				value.trending_people_number = "0"+value.trending_people_number;
					// 			}
					// 			factory.trending_people_list.push(value);
								
					// 			factory.count++;
					// 		});

					// 		factory.trending_people_start = true;

					// 	}else{
					// 		//...
					// 	}
					// });

					CiayoService.Api('users/trending', c, function(response) {
						if(response.status==200){
							var data = response.data.c.data;
							if (data.error == false) {
								ok = true;
							}
						}
						if(ok){
							//factory.user_list = factory.user_list.concat(data.content.list_user);
							var tmp=(data.content.trending);
							console.log(tmp.length);
							factory.count = 1;
							angular.forEach(tmp,function(value,key){

								value.trending_people_number = factory.count;
					 			if((value.trending_people_number+'').length==1){
					 				value.trending_people_number = "0"+value.trending_people_number;
					 			}
								
								value.frame = false;
								if($cookieStore.get('user_id')==tmp[key].user_id){
									value.button_self = true;
								}else{
									value.button_self = false;
								}
										
								value.icon_action_response = false;
								value.open_action = false;
								value.ci_star = false;
								value.ci_check = false;
								
								if(tmp[key].status.friend.add==false){
									value.icon_addfriend = true;
									value.name_addfriend = true;
									value.icon_self = 0;
									value.name_self = 0;
									
									
								}else{
									
									if(tmp[key].status.friend.addstatus==false){
										if(tmp[key].status.friend.approve==true){
											value.icon_addfriend = false;
											value.name_addfriend = false;
											value.icon_self = 0;
											value.name_self = 0;
											
										}else{
											value.icon_addfriend = true;
											value.name_addfriend = true;
											value.icon_self = 1;
											value.name_self = 1;
											
											value.ci_star = true;
										}
									}else{
										value.icon_addfriend = false;
										value.name_addfriend = false;
										value.icon_self = 0;
										value.name_self = 0;
										value.ci_check = true;
									}
								}

								/*if(tmp[key].status.self.add==true){
									value.icon_self = 1;
									value.name_self = 1;
								}else{
									value.icon_self = 0;
									value.name_self = 0;
								}*/

								if(tmp[key].status.friend.approve==false){
									value.checklist_addfriend = true;
								}else{
									value.checklist_addfriend = false;
								}

								if(tmp[key].status.follow==false){
									value.icon_follow = true;
									value.name_follow = true;
									value.checklist_follow = true;
								}else{
									value.icon_follow = false;
									value.name_follow = false;
								}
								
								var friend_connection = new friendConnectionFactory(value);
								//console.log(friend_connection);
								factory.trending_people_list.push(friend_connection);

								factory.count++;

							});

							factory.trending_people_start = true;
							
							
						}else{
							//...
						}
					});
				
		}
		

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('trendingPlaceFactory', trendingPlaceFactory);
	trendingPlaceFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', '$state'];

	function trendingPlaceFactory($rootScope,modalFactory, CiayoService, $state) {
		var factory = {
			trending_place_list:[],
			getTrendingPlaceList:getTrendingPlaceList,
			trending_place_start:false
		};

		function getTrendingPlaceList(start){
				
					factory.trending_place_start = false;
					factory.trending_place_list=[];

					var offset = 0;
					var limit = 20;

					var ok = false;
					var c = {
						data: {
							"limit": limit,
							"offset": offset
						}
					}
					CiayoService.Api('place/trending', c, function(response) {
						if(response.status==200){
							var data = response.data.c.data;
							if (data.error == false) {
								ok = true;
							}
						}
						if(ok){

							//console.log(countFr);
							
							var tmp=(data.content.trending);
							//console.log(tmp);
							factory.count = 1;
							angular.forEach(tmp,function(value,key){
								value.trending_place_number = factory.count;
								if((value.trending_place_number+'').length==1){
									value.trending_place_number = "0"+value.trending_place_number;
								}
								factory.trending_place_list.push(value);
								
								factory.count++;
							});

							factory.trending_place_start = true;

						}else{
							//...
						}
					});
				
		}
		

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('trendingPostFactory', trendingPostFactory);
	trendingPostFactory.$inject = ['$rootScope','modalFactory', 'CiayoService', 'cardFactory', '$cookieStore'];

	function trendingPostFactory($rootScope,modalFactory, CiayoService, cardFactory, $cookieStore) {
		var factory = {
			type:'',
			card_list:[],
			getCardList:getCardList,
			load_more:false,
			loading: false,
			isloading:false,
			clearSearch:clearSearch
		};

		//factory.load_more = false;
		function getUrlFromType(){
			if(factory.type=='trending'){
				return {url:TIMELINE_API_SERVER+'post/trending',force_url:true}
			}
		}
		function clearSearch(){
			factory.search_text = '';
			factory.card_list = [];
			factory.load_more = false;
		}

		function getCardList(start){

			if(!factory.isloading){
				factory.isloading = true;
				factory.loading = true;
				
				if(start){
					factory.card_list=[];
				}

				var offset = factory.card_list.length;
				var limit = 3;
				var offset = 3;

					if(offset<=9){

						if(offset >= 8){
			 				limit = 2;
			 			}
					timelineConnector.timelineGet('trending',limit,offset,null)
					.then(function(data){
							
							if(data.error == false){
								if(factory.type=='trending'){
									var tmp=(data.content.trending);
								}else{
									var tmp=(data.content.posts);
								}
								angular.forEach(tmp,function(value,key){
									
									value.frame = false;
									
									var card = new cardFactory(value);
									factory.card_list.push(card);

								});
								factory.isloading = false;
								if(offset<=9){
									factory.load_more=true;
								}else{
									factory.load_more=false;
								}
//								getCardListNext( false, limit, offset);
							}else{
								//...
							}
						}, true);
					}else{
						factory.isloading = false;
					}

				
			}
			
		}

		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('profilePublicConnector', profilePublicConnector);
	profilePublicConnector.$inject = ['CiayoService','$q','modalFactory'];

	function profilePublicConnector(CiayoService,$q,modalFactory) {
		var factory ={
			getTimeline:getTimeline,
			userBasicInfo:userBasicInfo,
			listChoiceAchievement:listChoiceAchievement
		}
		return factory;
		
		//TIMELINE
		function getTimeline(type,limit,offset,pointer_id){
			var deferred = $q.defer();
			var url = type=='profile'?'timeline/user':type=='trending'?'post/trending':'timeline'
			var data = {limit:limit,offset:offset,pointer_id:pointer_id}
			CiayoService.get(TIMELINE_API_SERVER + url, data,true).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(){
				deferred.reject(response);
			});
			return deferred.promise;
		}

		function userBasicInfo(username){
			var deferred = $q.defer();
			var url = 'public/users/info';
			var data = {username:username}
			CiayoService.get(API_SERVER + url, data,true).then(function (data) {
				deferred.resolve(data);
			},function(){
				deferred.reject(response);
			});
			return deferred.promise;
		}

		function listChoiceAchievement(username, type){
			var deferred = $q.defer();
			var url = 'public/users/achievement/choice';
			var data = {username:username, type:type}
			CiayoService.get(API_SERVER + url, data,true).then(function (data) {
				deferred.resolve(data);
			},function(){
				deferred.reject(response);
			});
			return deferred.promise;
		}

		
		
	}
})();
;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('settingConnector', settingConnector);
	settingConnector.$inject = ['CiayoService', '$q', 'modalFactory'];

	function settingConnector(CiayoService, $q, modalFactory) {
		var factory = {
			userInfo:userInfo,
			verifyAccount:verifyAccount,
			sendVerifyEmail:sendVerifyEmail,
			sendVerifyPhone:sendVerifyPhone,
			editEmail:editEmail,
			editPhone:editPhone,
			setPreference:setPreference,
			generalSettings:generalSettings,
			listPrefixPhone:listPrefixPhone,
			userDeactive:userDeactive,
			deleteConfirm:deleteConfirm,
			userDelete:userDelete,
			changePassword:changePassword,
			logout:logout
		}

		return factory;

		function userInfo(username) {
			var data = {username:username}
			return CiayoService.get('users/info', data).then(function(data) {
				if(data.error == true){
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function verifyAccount(confirmation_code) {
			var data = {confirmation_code:confirmation_code}
			return CiayoService.get('settings/verify', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function sendVerifyEmail(email) {
			var data = {email:email} 
			return CiayoService.get('settings/sendingverify/email', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function sendVerifyPhone(phone_number) {
			var data = {phone_number:phone_number}
			return CiayoService.get('settings/sendingverify/phone', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function editEmail(email) {
			var data = {email:email}
			return CiayoService.get('settings/email', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}


		function editPhone(phone_number) {
			var data = {phone_number:phone_number}
			return CiayoService.get('settings/phone', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
			return deferred.promise;
		}

		function setPreference(value, type) {
			var value = value?1:0;
			var data = {value:value,type:type}
			return CiayoService.get('settings/preference', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function generalSettings() {
			var data = {}
			return CiayoService.get('settings', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function listPrefixPhone(limit, offset) {
			var data = {limit:limit, offset:offset}
			return CiayoService.get('users/setting/prefix_phone_number', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function userDeactive() {
			var data = {deactive:true}
			return CiayoService.get('settings/deactive', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function deleteConfirm() {
			var data = {}
			return CiayoService.get('settings/deleteconfirm', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function userDelete(token) {
			var data = {token:token}
			return CiayoService.get('settings/delete', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function changePassword(old_password, new_password, confirm_new_password) {
			var data = {old_password:old_password, new_password:new_password, confirm_new_password:confirm_new_password}
			return CiayoService.get('settings/password', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}

		function logout() {
			var data = {}
			return CiayoService.get('logout', data).then(function(data) {
				if(data.error == true) {
					modalFactory.message(data.message);
				}
				return data;
			});
		}
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('timelineConnector', timelineConnector);
	timelineConnector.$inject = ['CiayoService','$q','modalFactory'];

	function timelineConnector(CiayoService,$q,modalFactory) {
		var factory ={
			//GLOBAL
			postAttributesGet:postAttributesGet,
			//TIMELINE
			timelineGet:timelineGet,
			//ACTIVITY
			activityGet:activityGet,
			activityDetail:activityDetail,
			//CARD
			cardGet:cardGet,
			cardCreate:cardCreate,
			cardDelete:cardDelete,
			cardAsk:cardAsk,
			cardResponse:cardResponse,
			cardGenerateImage:cardGenerateImage,
			captionUpdate:captionUpdate,
			//CARD-WITH
			withGet:withGet,
			withUpdate:withUpdate,
			//CARD-PLACE
			placeGet:placeGet,
			placeUpdate:placeUpdate,
			//CARD-REACTION
			reactionGet:reactionGet,
			reactionCreate:reactionCreate,
			//CARD-COMMENT
			commentGet:commentGet,
			commentCreate:commentCreate,
			commentUpdate:commentUpdate,
			commentDelete:commentDelete,
			commentLike:commentLike,
			//CARD-SHARING
			shareGet:shareGet,
			shareFbApi:shareFbApi,
			shareCreate:shareCreate,
			shareFbImageGet:shareFbImageGet,
			//CARD-OPTION
			cardSubscribe:cardSubscribe,
			cardUnsubscribe:cardUnsubscribe,
			cardPermissionUpdate:cardPermissionUpdate
		}
		return factory;
		
		//GLOBAL
		function postAttributesGet() {
			var data = {}
			return CiayoService.get('post/attributes', data).then(function (data) {
				if(data.error==true){
					modalFactory.message(data.message);
				}
				return data;
			},function(response){return response});
		}
		//TIMELINE
		function timelineGet(type,limit,offset,pointer_id,username,isrefresh){
			var url =
				(type=='profile'?'timeline/user':type=='trending'?'post/trending':'timeline');
			var data = {limit:limit,offset:offset,pointer_id:pointer_id};
			if(username!=undefined){
				data.username = username;
			}
			if(isrefresh==true){
				data.isrefresh=isrefresh;
			}
			return CiayoService.get(TIMELINE_API_SERVER + url, data,true).then(function (data) {
				if(data.error==true){
					modalFactory.message(data.message);
				}
				return data;
			},function(response){return response;});
		}
		//ACTIVITY
		function activityGet(keyword){
			var deferred = $q.defer();
			var data = {keyword:keyword,limit:20,offset:0}
			CiayoService.get('activity', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function activityDetail(activity_id){
			var deferred = $q.defer();
			var data = {activity_id:activity_id}
			CiayoService.get('activity/detail', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		//CARD
		function cardGet(post_code){
			var deferred = $q.defer();
			var data = {post_code:post_code}
			CiayoService.get('post/detail', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardCreate(activity_id, mood_id, place_id, post_category, caption, bubble, items, with_users){
			var deferred = $q.defer();
			var data = {activity_id:activity_id,mood_id:mood_id,place_id:place_id,post_category:post_category,caption:caption,bubble:bubble,items:items,with_users:with_users}
			CiayoService.get('post/create', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardDelete(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id}
			CiayoService.get('post/delete', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardAsk(post_id,type){
			var deferred = $q.defer();
			var data = {post_id:post_id,type:type}
			CiayoService.get('post/ask', data).then(function (data) {
				modalFactory.message(data.message);
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardResponse(post_id,type,value){
			var deferred = $q.defer();
			var data = {post_id:post_id,type:type,value:value}
			CiayoService.get('post/response', data).then(function (data) {
				modalFactory.message(data.message);
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardGenerateImage(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id}
			CiayoService.get('post/create/images', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function captionUpdate(post_id,post_caption,bubble){
			var deferred = $q.defer();
			var data = {post_id:post_id,post_caption:post_caption,bubble:bubble}
			CiayoService.get('post/caption', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		//CARD ITEM
		//CARD-WITH
		function withGet(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id}
			CiayoService.get('post/with/detail', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function withUpdate(post_id,with_users){
			var deferred = $q.defer();
			var data = {post_id:post_id,with_users:with_users}
			CiayoService.get('post/with', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		//CARD-PLACE
		function placeGet(keyword){
			var deferred = $q.defer();
			var data = {keyword:keyword}
			CiayoService.get('place', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function placeUpdate(post_id,place_id){
			var deferred = $q.defer();
			var data = {post_id:post_id,place_id:place_id}
			CiayoService.get('post/place', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		//CARD-REACTION
		function reactionCreate(post_id,emotion){
			var deferred = $q.defer();
			var data = {post_id:post_id,emotion:emotion};
			CiayoService.get('post/emotion', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function reactionGet(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id};
			CiayoService.get('post/emotion/detail', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		//CARD-COMMENT
		function commentGet(post_id,parent_id,offset,limit){
			var deferred = $q.defer();
			var data = {post_id:post_id,parent_id:parent_id,offset:offset,limit:limit}
			CiayoService.get('post/comment/list', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function commentCreate(post_id,content,parent_id){
			var deferred = $q.defer();
			var data = {post_id:post_id,content:content,parent_id:parent_id}
			CiayoService.get('post/comment', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function commentUpdate(comment_id,content){
			var deferred = $q.defer();
			var data = {comment_id:comment_id,content:content};
			CiayoService.get('post/comment/edit', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function commentDelete(comment_id){
			var deferred = $q.defer();
			var data = {comment_id:comment_id};
			CiayoService.get('post/comment/delete', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function commentLike(comment_id,value){
			var deferred = $q.defer();
			var data = {comment_id:comment_id,value:value};
			CiayoService.get('post/comment/like', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		//CARD-SHARING
		function shareGet(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id};
			CiayoService.get('sosmed/share/list', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
//					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function shareFbApi(uid,access_token,post_id) {
			var data = {uid:uid,access_token:access_token,post_id:post_id};
			return CiayoService.get('facebook/share/post', data).then(function (data) {
				if(data.error==true){
					modalFactory.message(data.message);
				}
				return data;
			},function(response){return response});
		}
		function shareCreate(post_id,to){
			var target=null;
				if(to=='facebook'){
					target=0;
				}else
				if(to=='pinterest'){
					target=2;
				}else
				if(to=='twitter'){
					target=1;
				}else{
					return;
				}
			var deferred = $q.defer();
			var data = {post_id:post_id,message:to,target:target};
			CiayoService.get('sosmed/share/save', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function shareFbImageGet(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id}
			CiayoService.get('post/create/sharefb', data).then(function (data) {
				deferred.resolve(data);
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		
		//CARD-OPTION
		function cardSubscribe(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id}
			CiayoService.get('post/subscribe', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardUnsubscribe(post_id){
			var deferred = $q.defer();
			var data = {post_id:post_id}
			CiayoService.get('post/unsubscribe', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
		function cardPermissionUpdate(post_id,post_category){
			var deferred = $q.defer();
			var data = {post_id:post_id,'post_category':post_category};
			CiayoService.get('post/permission', data).then(function (data) {
				if(data.error==false){
					deferred.resolve(data);
				}else{
					modalFactory.message(data.message);
				}
				
			},function(response){
				deferred.reject(response);
			});
			return deferred.promise;
		}
	}
})();
;
(function() {
'use strict';

  angular
    .module('app')
    .factory('welcomeConnector', welcomeConnector);

  welcomeConnector.$inject = ['CiayoService'];
  function welcomeConnector(CiayoService) {
    var welcomeConnector = {
      register: register,
      login: login,
      forgotPassword: forgotPassword,
      resetPassword: resetPassword
    };

    return welcomeConnector;

    ////////////////

    function register(type, email, phone, pass, info, ref) {
      if(type==="email") {
        var data = {
          email: email,
          password: pass,
          info: info,
          referral_id: ref
        }
      } else {
        var data = {
          phone: phone,
          password: pass,
          info: info,
          referral_id: ref
        }
      }

      return CiayoService.get('register', data).then(
        function(data){
          return data;
        },
        function(response){
          return response;
        }
      );
    }
    
    function login(type, email, phone, pass) {
      if(type==="email") {
        var data = {
          email: email,
          password: pass
        }
      } else {
        var data = {
          phone: phone,
          password: pass
        }
      }

      return CiayoService.get('login', data).then(
        function(data){
          return data;
        },
        function(response){
          return response;
        }
      );
    }
    
    function forgotPassword(type, email, phone) { 
      if(type==="email") {
        var data = {
          email: email
        }
      } else {
        var data = {
          phone: phone
        }
      }

      return CiayoService.get('password', data).then(
        function(data){
          return data;
        },
        function(response){
          return response;
        }
      );
    }
    
    function resetPassword() { }
  }
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('AboutController', AboutController);

	AboutController.$inject = ['CiayoService','$cookieStore'];
	function AboutController(CiayoService, $cookieStore) {
		var vm = this;

		vm.getPage = getPage;
		vm.closePanel = closePanel;

		function getPage(id) {
			$(".cm").addClass("-locked")
			$(".cm-panel.-privacy-policy").addClass("-open")
			vm.page = null;
			var lang_id = $cookieStore.get('language');
			var c = {
				data: {
					page_id: id,
					language_id: lang_id
				}
			};
			CiayoService.Api('page/detail', c, function(response){
				if(response.status == 200){
					vm.page = response.data.c.data.content;
				} else {
					alert('error');
				}
			});
		}

		function closePanel() {
			$(".cm").removeClass("-locked");
			$(".cm-panel.-privacy-policy").removeClass("-open");
		}
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('AchievementController', AchievementController);

	AchievementController.$inject = ['AchievementService','$state','facebookFactory','modalFactory', '$filter'];
	function AchievementController(AchievementService,$state,facebookFactory,modalFactory,$filter) {
		var vm = this;

		var offset = 0;
		var height = 600;

		vm.badge = [];
		vm.searchStatus = false;
		vm.loadingMore = false;

		vm.options = [
			{
				title: $filter('translate')('$ascending(a-z)'),
				type: 'name',
				by: 'asc'
			},
			{
				title: $filter('translate')('$descending(z-a)'),
				type: 'name',
				by: 'desc'
			},
			{
				title: $filter('translate')('$highest.to.lowest'),
				type: 'score',
				by: 'desc'
			},
			{
				title: $filter('translate')('$lowest.to.high'),
				type: 'score',
				by: 'asc'
			}
		];
		vm.option = vm.options[0];
		vm.orderType = 'name';
		vm.orderBy = 'asc';

		vm.getData = getData;
		vm.changeOrder = changeOrder;
		vm.getDetail = getDetail;
		vm.closeDetail = closeDetail;
		vm.search = search;

		vm.openShare = openShare;
		vm.closeShare = closeShare;$state

		vm.shareFB = shareFB;

		function getData(url, offset) {
			if(!offset){
				vm.achievement = [];
				offset = 0;
				height = 600;
			}
			vm.noData = null;
			var offset = offset?offset:0;
			var data = {
				orderType: vm.orderType,
				orderBy: vm.orderBy,
				limit: 10,
				offset: offset,
				search: vm.keyword
			};
			AchievementService.getData(
				url,
				data,
				function(data){
					if(data.error){
						alert(data.message);
					} else {
						if(url == 'badge'){
							vm.badge = data.content.data;
						} else {
							vm.achievement = vm.achievement.concat(data.content.data);
							if(vm.achievement.length == 0){
								vm.noData = 'No Data';
							} else {
								vm.noData = null;
							}
							$('#load-more').hide();
							vm.loadingMore = false;
						}
					}
				}
			);
		}

		vm.getData('badge');
		vm.getData('achievement/all');

		function changeOrder(type, by) {
			vm.orderType = type;
			vm.orderBy = by;
			if(vm.tabs == 1){
				vm.getData('achievement/progress');
			} else if(vm.tabs == 2){
				vm.getData('achievement/completed');
			} else {
				vm.getData('achievement/all');
			}
		}

		function getDetail(id) {
			angular.element('body').addClass('-locked');
			vm.detail = null;
			var elem = angular.element('.cm-panel.cm-achievement');
			elem.addClass('-open');
			elem.attr('style', 'height: '+$(document).height());
			AchievementService.getDetail(id, function(data){
				if(data.error){
					alert(data.message);
				} else {
					vm.detail = data.content;
					console.log(vm.detail);
				}
			});
		}

		function closeDetail() {
			angular.element('body').removeClass('-locked');
			var elem = angular.element('.cm-panel.cm-achievement');
			elem.removeClass('-open');
			vm.detail = {};
		}

		vm.setTitle = setTitle;
		function setTitle(title) {
			AchievementService.setTitle(title, function(response){
				modalFactory.message(response.message);
			});
		}

		function search() {
			if(vm.tabs == 1){
				vm.getData('achievement/progress');
			} else if(vm.tabs == 2){
				vm.getData('achievement/completed');
			} else {
				vm.getData('achievement/all');
			}
		}

		function openShare() {
			$('.-archievement-share').addClass('-open');
		}

		function closeShare() {
			$('.-archievement-share').removeClass('-open');
		}

		function shareFB(id_achievement, id) {
			var access_token = '';
			var uid = '';
			if(!vm.isFB){
				vm.isFB = true;
				facebookFactory.getToken(function (data) {
					access_token = data.accessToken;
					uid = data.uid;
					AchievementService.shareFB(access_token, uid, id_achievement,id, function(data){
						modalFactory.message(data.message);
						vm.isFB = false;
						vm.closeShare();
					});
				});
			}
		}

		function loadMore() {
			offset += 10;
			height += 600;
			if(vm.tabs == 1){
				vm.getData('achievement/progress', offset);
			} else if(vm.tabs == 2){
				vm.getData('achievement/completed', offset);
			} else {
				vm.getData('achievement/all', offset);
			}
		}

		$(window).scroll(function(e){
			var winTop = $(this).scrollTop();
			if(winTop > height && vm.loadingMore == false){
				vm.loadingMore = true;
				$('#load-more').show();
				loadMore();
			}
		})
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('AchievementSearchController', AchievementSearchController);

	AchievementSearchController.$inject = ['AchievementService'];
	function AchievementSearchController(AchievementService) {
		var vm = this;
		
		vm.achievement = [];
		vm.all = [];
		vm.onProgress = [];
		vm.completed = [];
		vm.detail = {};

		vm.orderType = 'name';
		vm.orderBy = 'asc';

		vm.getData = getData;
		vm.search = search;
		vm.changeOrder = changeOrder;
		vm.getDetail = getDetail;
		vm.closeDetail = closeDetail;

		function getData(url) {
			var data = {
				orderType: vm.orderBy,
				orderBy: vm.orderBy,
				limit: 10,
				offset: 0,
				search: vm.keyword
			};
			AchievementService.getData(
				url,
				data,
				function(data){
					if(data.error){
						alert(data.message);
					} else {
						var arr = data.content.data;
						switch(url){
							case 'badge':
								vm.badge = arr;
							break;
							case 'achievement/all':
								vm.all = arr;
							break;
							case 'achievement/progress':
								vm.onProgress = arr;
							break;
							case 'achievement/completed':
								vm.completed = arr;
							break;
						}
					}
				}
			);
		}

		function search() {
			if(vm.keyword){
				vm.getData('achievement/all');
			} else {
				alert('isi dulu keywrodnya');
			}
		}

		function changeOrder(type, by) {
			vm.orderType = type;
			vm.orderBy = by;
			console.log(type, by);
		}

		function getDetail(id) {
			var elem = angular.element('.cm-panel.cm-achievement');
			elem.addClass('-open');
			AchievementService.getDetail(id, function(data){
				if(data.error){
					alert(data.message);
				} else {
					vm.detail = data.content;
					console.log(vm.detail);
				}
			});
		}

		function closeDetail() {
			var elem = angular.element('.cm-panel.cm-achievement');
			elem.removeClass('-open');
			vm.detail = {};
		}
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('CreateAvatarController', CreateAvatarController);

	CreateAvatarController.$inject = ['CiayoService', 'AvatarService', '$state', '$cookieStore','TourService'];
	function CreateAvatarController(CiayoService, AvatarService, $state, $cookieStore,TourService) {
		var vm = this;
		
		vm.errMsg = '';

		vm.mascot = [];
		vm.avatarBgColor = '#fff';
		vm.avatarInit = [];
		vm.avatarDefault = [];
		vm.avatarBackHair = '';
		vm.avatarBackground = {
			required: true,
			element_id: '0',
			element_name: 'Background',
			element_image_url: 'https://s3-ap-southeast-1.amazonaws.com/ciayo/avatar_elements/elemen-avatar_background-color.png',
			element_type: [
				{
					element_type_id: '00',
					element_type_name: 'Background Color',
					element_variation: [
						"#FCB64E",
						"#FFE081",
						"#BCDFBF",
						"#AEDCF6",
						"#A5CBEC",
						"#C5C9E6",
						"#F8C2D3",
						"#D8DFE2"
					]
				}
			]
		};
		
		vm.element = {};
		vm.elementVariation = [];
		vm.defaultElementColor = {};

		vm.selectElement = selectElement;
		vm.selectElementVariation = selectElementVariation;
		vm.changeBackground = changeBackground;
		vm.changeElement = changeElement;
		vm.changeElementColor = changeElementColor;
		vm.getFilterValue = getFilterValue;
		vm.removeElement = removeElement;

		vm.saveUsername = saveUsername;
		vm.saveDOB = saveDOB;
		vm.saveGender = saveGender;
		vm.saveAvatar = saveAvatar;
		vm.saveMascot = saveMascot;

		function saveUsername() {
			if(!vm.username){
				// error username musti di isi
				vm.errMsg = 'Please, insert a username :)';
				setTimeout(function(){
					vm.errMsg = '';
				}, 3000);
			} else {
				vm.isLoading = true;
				AvatarService.setName(vm.username, function(data){
					vm.isLoading = false;
					if(data.error){
						vm.errMsg = data.message;
						setTimeout(function(){
							vm.errMsg = '';
						}, 3000);
					} else {
						$state.transitionTo('create-avatar.born');
					}
				});
			}
		}

		function saveDOB() {
			vm.dob = angular.element('#inputDateHidden').val();
			if(vm.dob) {
				$state.transitionTo('create-avatar.avatar');
				vm.showLoading = true;
				AvatarService.getAvatarInit(vm.gender, function(data){
					if(data.error) {
						alert('error men');
					} else {
						// vm.avatarBackground = data.content.background;
						vm.avatarInit = data.content.data;
						//vm.element = vm.avatarInit[1];
						//selectElementVariation(vm.element.element_type[0]);
						vm.showLoading = false;

						AvatarService.getAvatarDefault(vm.gender, function(data){
							if(data.error){
								alert('gagal defult avatar men');
							} else {
								vm.avatarBgColor = data.content.color;
								vm.avatarDefault = data.content.data;
								for(var i = 0; i < vm.avatarDefault.length; i++){
									if(vm.avatarDefault[i].image_back != ''){
										vm.avatarBackHair = vm.avatarDefault[i].image_back;
									}
									vm.defaultElementColor["element_"+vm.avatarDefault[i].filter_id] = getIndexColor(vm.avatarDefault[i].filter_id, vm.avatarDefault[i].color_id);

									vm.selectElement(vm.avatarInit[1]);
								}

								// Init scroll function
								initScroll();

								TourService.tourCreateAvatar(); // tour avatar

								// Get data mascot
								AvatarService.getMascot(function(data){
									if(data.error) {
										alert('error men');
									} else {
										vm.mascot = data.content.data;
									}
								});
							}
						});
					}
				});
			} else {
				vm.errMsg = 'Please, Insert your date of birth';
				setTimeout(function(){
					vm.errMsg = '';
				}, 3000);
			}
		}

		function saveGender() {
			if(vm.gender){
				$cookieStore.put('gender', vm.gender);
				vm.showLoading = true;
				AvatarService.setGender(vm.gender, function (data) {
					if(data.error){
						alert(data.message);
					} else {
						vm.showLoading = false;
						$state.transitionTo('create-avatar.name');
					}
				});
			} else {
				vm.errMsg = 'Please, select your gender';
				setTimeout(function(){
					vm.errMsg = '';
				}, 3000);
			}
		}

		function saveAvatar(){
			var bg = {
				data: {
					color_code: vm.avatarBgColor
				}
			};
			var ava = {
				data: {
					updated_filter: [
						{
							filter_id: 6,
							filter_value: vm.dob
						},
						{
							filter_id: 16,
							filter_value: getFilterValue('16')
						},
						{
							filter_id: 9,
							filter_value: getFilterValue('9')
						},
						{
							filter_id: 14,
							filter_value: getFilterValue('14')
						},
						{
							filter_id: 15,
							filter_value: getFilterValue('15')
						},
						{
							filter_id: 11,
							filter_value: getFilterValue('11')
						},
						{
							filter_id: 12,
							filter_value: getFilterValue('12')
						},
						{
							filter_id: 13,
							filter_value: getFilterValue('13')
						},
						{
							filter_id: 10,
							filter_value: getFilterValue('10')
						},
						{
							filter_id: 23,
							filter_value: getFilterValue('23')
						}
					],
					type: 3
				}
			}
			vm.showLoading = true;
			AvatarService.setAvatar(bg, ava, function(data){
				if(data.error){
					alert(data.message);
				} else {
					$cookieStore.put('profile', true);
					$state.transitionTo('timeline');
				}
			});
		}

		function saveMascot() {
			if(vm.selectedMascot){
				vm.showLoading = true;
				var ava = {
					data: {
						updated_filter: [
							{
								filter_id: 6,
								filter_value: vm.dob
							}
						],
						type: 2
					}
				}
				CiayoService.Api(AVATAR_API_SERVER+'users/filter/update', ava, function(response){
					AvatarService.setMascot(vm.selectedMascot, function(data) {
						if(data.error){
								alert(data.message);
								if(data.message == 'notifications.user_alrady_have_avatar') {
									vm.showLoading = false;
									$state.transitionTo('timeline');
								}
						} else {
							$cookieStore.put('profile', true);
							$state.transitionTo('timeline');
						}
					});
				}, true);
			} else {
				alert('pilih dulu mascot nya');
			}
		}

		// Avatar Editor Function
		function selectElement(element) {
			vm.element = element;
			//selectElementVariation(element.element_type[0]);
			if(vm.element.element_id == 0){
				selectElementVariation(element.element_type[0]);
			} else if(vm.element.element_id == 23){
				selectElementVariation(element.element_type[2]);
			} else {
				for(var i = 0; i < vm.avatarDefault.length; i++){
					if(vm.avatarDefault[i].filter_id == element.element_id){
						for(var j = 0; j < element.element_type.length; j++){
							var element_id = vm.getElementId()?vm.getElementId():vm.avatarDefault[i].element_type_id;
							if(element_id == element.element_type[j].element_type_id){
								selectElementVariation(element.element_type[j]);
							}
						}
					}
				}
			}
		}

		function selectElementVariation(type, change) {
			vm.selectedElementId = type.element_type_id;
			vm.typeIndex = 0;
			vm.elementVariation = type.element_variation;
			if(change){
				vm.changeElement(vm.elementVariation[0], vm.element.element_id);
			}
		}

		function changeBackground(color) {
			vm.avatarBgColor = color;
		}

		function changeElement(variant, id) {
			var img = variant.assets[vm.defaultElementColor['element_'+id]].asset_image_url;
			if(id == 10){
				vm.avatarBackHair = variant.assets[vm.defaultElementColor['element_'+id]].asset_image_back;
			}

			var elem = angular.element('#layer_'+id);
			elem.attr('element-id', vm.selectedElementId);
			elem.attr('variant-id', variant.variant_id);
			elem.attr('filter-value', variant.assets[vm.defaultElementColor['element_'+id]].asset_id);
			elem.css('background-image', 'url('+img+')');

			var skin_color = vm.element.skin_color;
			if(skin_color){
				changeAllSkin(variant.assets[vm.defaultElementColor['element_'+id]].asset_color_id);
			}
		}

		function changeElementColor(id, index) {
			vm.defaultElementColor['element_'+vm.element.element_id] = index;
			var elem = angular.element('#layer_'+vm.element.element_id);
			var url = '';
			var filter_value = '';
			var element_id = elem.attr('element-id');
			var variant_id = elem.attr('variant-id');
			var element_type = vm.element.element_type;
			var skin_color = vm.element.skin_color;
			for(var i = 0; i < element_type.length; i++){
				if(element_id == element_type[i].element_type_id){
					for(var j = 0; j < element_type[i].element_variation.length; j++){
						if(variant_id == element_type[i].element_variation[j].variant_id){
							for(var k = 0; k < element_type[i].element_variation[j].assets.length; k++){
								if(id == element_type[i].element_variation[j].assets[k].asset_color_id){
									if(vm.element.element_id == 10){
										vm.avatarBackHair = element_type[i].element_variation[j].assets[k].asset_image_back;
									}
									url = element_type[i].element_variation[j].assets[k].asset_image_url;
									filter_value = element_type[i].element_variation[j].assets[k].asset_id;
								}
							}
						}
					}
				}
			}

			elem.attr('filter-value', filter_value);
			elem.css('background-image', 'url('+url+')');

			if(skin_color){
				changeAllSkin(id);
			}
		}

		function changeAllSkin(id) {
			// change body
			var elem = angular.element('#layer_16');
			var assets = vm.avatarInit[0].element_type[0].element_variation[0].assets;
			var url = '';
			var filter_value = '';
			for(var i = 0; i < assets.length; i++){
				if(assets[i].asset_color_id == id){
					url = assets[i].asset_image_url;
					filter_value = assets[i].asset_id;
				}
			}
			elem.css('background-image', 'url('+url+')');
			elem.attr('filter-value', filter_value);

			// change face
			var elem = angular.element('#layer_9');
			for(var i = 0; i < vm.avatarInit.length; i++){
				if(elem.attr('filter-id') == vm.avatarInit[i].element_id){
					var element_type = vm.avatarInit[i].element_type;
				}
			}
			var url = '';
			var filter_value = elem.attr('filter-value');
			var element_id = elem.attr('element-id');
			var variant_id = elem.attr('variant-id');
			if(filter_value != id) {
				for(var i = 0; i < element_type.length; i++){
					if(element_id == element_type[i].element_type_id){
						var variant = element_type[i].element_variation;
						for(var j = 0; j < variant.length; j++){
							if(variant_id == variant[j].variant_id){
								var assets = variant[j].assets;
								for(var k = 0; k < assets.length; k++){
									if(id == assets[k].asset_color_id){
										url = assets[k].asset_image_url;
										filter_value = assets[k].asset_id;
									}
								}
							}
						}
					}
				}
				elem.css('background-image', 'url('+url+')');
				elem.attr('filter-value', filter_value);
			}

			// change nose
			var elem = angular.element('#layer_13');
			for(var i = 0; i < vm.avatarInit.length; i++){
				if(elem.attr('filter-id') == vm.avatarInit[i].element_id){
					var element_type = vm.avatarInit[i].element_type;
				}
			}
			var url = '';
			var filter_value = elem.attr('filter-value');
			var element_id = elem.attr('element-id');
			var variant_id = elem.attr('variant-id');
			if(filter_value != id) {
				for(var i = 0; i < element_type.length; i++){
					if(element_id == element_type[i].element_type_id){
						var variant = element_type[i].element_variation;
						for(var j = 0; j < variant.length; j++){
							if(variant_id == variant[j].variant_id){
								var assets = variant[j].assets;
								for(var k = 0; k < assets.length; k++){
									if(id == assets[k].asset_color_id){
										url = assets[k].asset_image_url;
										filter_value = assets[k].asset_id;
									}
								}
							}
						}
					}
				}
				elem.css('background-image', 'url('+url+')');
				elem.attr('filter-value', filter_value);
			}
		}

		function getFilterValue(id) {
			var elem = angular.element('#layer_'+id);
			var val = elem.attr('filter-value');
			return val;
		}

		vm.getElementId = getElementId;
		function getElementId() {
			var elem = angular.element('#layer_'+vm.element.element_id);
			var val = elem.attr('element-id');
			return val;
		}

		vm.getVariantId = getVariantId;
		function getVariantId() {
			var elem = angular.element('#layer_'+vm.element.element_id);
			var val = elem.attr('variant-id') || 'huhu';
			return val;
		}

		function removeElement(id) {
			var elem = angular.element('#layer_'+id);
			elem.css('background-image', 'url()');
			elem.attr('filter-value', '');
			if(id == 10){
				vm.avatarBackHair = '';
			}
		}

		function getIndexColor(element, color) {
			var idn = 0;
			for(var i = 0; i < vm.avatarInit.length; i++){
				if(vm.avatarInit[i].element_id == element){
					for(var j = 0; j < vm.avatarInit[i].color_variant.length; j++){
						if(vm.avatarInit[i].color_variant[j].color_id == color){
							idn = j;
						}
					}
				}
			}

			return idn;
		}

		function initScroll() {
			// control color
			var nextColor = $('._color-control.-next');
			var prevColor = $('._color-control.-prev');
			var viewportColor = $('._color-viewport');
			var pos = viewportColor.height();
			// next
			nextColor.on('click', function(e){
				e.preventDefault();
				if(pos <= 103){
					pos+=40;
					viewportColor.animate({
						scrollTop: pos
					},250);
				}
			});
			// prev
			prevColor.on('click', function(e){
				e.preventDefault();
				if(pos > 0) {
					pos-=80;
					viewportColor.animate({
						scrollTop: pos
					},250);
				}
			});
			// avatar color
			var nextType = $('._type-control.-next');
			var prevType = $('._type-control.-prev');
			var viewportType = $('._type-viewport');
			var pos = 0;
			// next
			nextType.on('click', function(e){
				if(pos <= viewportType.width()){
					pos+=50;
					viewportType.animate({
						scrollLeft: pos
					},250);
				}
			});
			// prev
			prevType.on('click', function(e){
				e.preventDefault();
				if(pos > 0) {
					pos-=50;
					viewportType.animate({
						scrollLeft: pos
					},250);
				}
			});
		}
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('DetailPageController', DetailPageController);

	DetailPageController.$inject = ['CiayoService','$cookieStore','detailPageFactory'];
	function DetailPageController(CiayoService, $cookieStore,detailPageFactory) {
		var vm = this;
		angular.extend(vm,{
			detailPageFactory:detailPageFactory
		});
		function init(){
			detailPageFactory.init();
		}
		init();
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('DownloadAvatarController', DownloadAvatarController);

	DownloadAvatarController.$inject = ['AvatarService','$cookieStore', '$sce'];
	function DownloadAvatarController(AvatarService, $cookieStore, $sce) {
		var vm = this;

		vm.getAvatar = getAvatar();
		vm.urlDownload = '';

		function getAvatar() {
			AvatarService.getAvatarUser(function(data){
				if(data.error){
					alert(data.message);
				} else {
					vm.urlDownload = $sce.trustAsResourceUrl(AVATAR_API_SERVER+'users/avatar');
					vm.showLoading = false;
					vm.avaUserImg = data.content.url;
					vm.avaUserBg = data.content.background_avatar;
					var token = $cookieStore.get('token');
					vm.avaData = '{"data":{"token":"'+token+'"},"timestamp":1468376374025,"app":"Web","screen_type":"Web","image_type":"","latitude":"-6.225652","longitude":"106.74576","language":1}';
				}
			});
		}
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('DownloadAvatar', DownloadAvatar);

	DownloadAvatar.$inject = ['CiayoService','$state'];
	function DownloadAvatar(CiayoService, $state) {
		var vm = this;
		vm.getAvatar = getAvatar;
		
		function getAvatar(){
			var c = {
				data: {
					avatar_type: 'avatar_3'
				}
			};
			CiayoService.Api('users/avatars', c, function(response){
				console.log(response);
			});
		}
		
		vm.getAvatar();
		
		vm.next = next;
		
		function next() {
			$state.transitionTo('timeline');
		}
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('EditAvatar', EditAvatar);

	EditAvatar.$inject = ['CiayoService', 'AvatarService', '$state', '$cookieStore', '$rootScope'];
	function EditAvatar(CiayoService, AvatarService, $state, $cookieStore, $rootScope) {
		var vm = this;
		
		vm.errMsg = '';
		
		vm.mascot = [];
		vm.avatarBgColor = '#fff';
		vm.avatarInit = [];
		vm.avatarDefault = [];
		vm.avatarBackHair = '';
		vm.avatarBackground = {
			required: true,
			element_id: '0',
			element_name: 'Background',
			element_image_url: 'https://s3-ap-southeast-1.amazonaws.com/ciayo/avatar_elements/elemen-avatar_background-color.png',
			element_type: [
				{
					element_type_id: '00',
					element_type_name: 'Background Color',
					element_variation: [
						"#FCB64E",
						"#FFE081",
						"#BCDFBF",
						"#AEDCF6",
						"#A5CBEC",
						"#C5C9E6",
						"#F8C2D3",
						"#D8DFE2"
					]
				}
			]
		};

		vm.element = {};
		vm.elementVariation = [];
		vm.defaultElementColor = {};

		vm.selectElement = selectElement;
		vm.selectElementVariation = selectElementVariation;
		vm.changeBackground = changeBackground;
		vm.changeElement = changeElement;
		vm.changeElementColor = changeElementColor;
		vm.getFilterValue = getFilterValue;
		vm.removeElement = removeElement;

		vm.saveAvatar = saveAvatar;
		vm.cancelAvatar = cancelAvatar;

		getAvatar();

		function getAvatar() {
			vm.showLoading = true;
			AvatarService.getAvatarInit(vm.gender, function(data){
				if(data.error) {
					alert('error men');
				} else {
					// vm.avatarBackground = data.content.background;
					vm.avatarInit = data.content.data;
					//vm.element = vm.avatarInit[1];
					//selectElementVariation(vm.element.element_type[0]);
					vm.showLoading = false;

					AvatarService.getAvatarDefault(vm.gender, function(data){
						if(data.error){
							alert('gagal defult avatar men');
						} else {
							vm.avatarBgColor = data.content.color;
							vm.avatarDefault = data.content.data;
							for(var i = 0; i < vm.avatarDefault.length; i++){
								if(vm.avatarDefault[i].image_back != ''){
									vm.avatarBackHair = vm.avatarDefault[i].image_back;
								}
								vm.defaultElementColor["element_"+vm.avatarDefault[i].filter_id] = getIndexColor(vm.avatarDefault[i].filter_id, vm.avatarDefault[i].color_id);
							}

							vm.selectElement(vm.avatarInit[1]);
						}

						// init scroll
						initScroll();
					});
				}
			});
		}

		function saveAvatar() {
			var bg = {
				data: {
					color_code: vm.avatarBgColor
				}
			};
			var ava = {
				data: {
					updated_filter: [
						{
							filter_id: 16,
							filter_value: getFilterValue('16')
						},
						{
							filter_id: 9,
							filter_value: getFilterValue('9')
						},
						{
							filter_id: 14,
							filter_value: getFilterValue('14')
						},
						{
							filter_id: 15,
							filter_value: getFilterValue('15')
						},
						{
							filter_id: 11,
							filter_value: getFilterValue('11')
						},
						{
							filter_id: 12,
							filter_value: getFilterValue('12')
						},
						{
							filter_id: 13,
							filter_value: getFilterValue('13')
						},
						{
							filter_id: 10,
							filter_value: getFilterValue('10')
						},
						{
							filter_id: 23,
							filter_value: getFilterValue('23')
						}
					],
					type: 3
				}
			}
			vm.showLoading = true;
			AvatarService.setAvatar(bg, ava, function(data){
				if(data.error){
					alert(data.message);
				} else {
					AvatarService.getAvatarUser(function(data){
						if(data.error){
							alert(data.message);
						} else {
							vm.showLoading = false;
							vm.avaUserImg = data.content.avatar;
							vm.avaUserBg = data.content.background_avatar;
							$rootScope.backState = 'avatar';
							$('body').removeClass('-locked');
							$state.transitionTo('profile');
						}
					});
				}
			});
		}

		function cancelAvatar() {
			$rootScope.backState = 'avatar';
			$('body').removeClass('-locked');
			$state.transitionTo('profile');
		}

		// Avatar Editor Function
		function selectElement(element) {
			vm.element = element;
			if(vm.element.element_id == 0){
				selectElementVariation(element.element_type[0]);
			} else if(vm.element.element_id == 23){
				selectElementVariation(element.element_type[2]);
			} else {
				for(var i = 0; i < vm.avatarDefault.length; i++){
					if(vm.avatarDefault[i].filter_id == element.element_id){
						for(var j = 0; j < element.element_type.length; j++){
							var element_id = vm.getElementId()?vm.getElementId():vm.avatarDefault[i].element_type_id;
							if(element_id == element.element_type[j].element_type_id){
								selectElementVariation(element.element_type[j]);
							}
						}
					}
				}
			}

			initScroll();
		}

		function selectElementVariation(type, change) {
			vm.selectedElementId = type.element_type_id;
			vm.typeIndex = 0;
			vm.elementVariation = type.element_variation;
			if(change){
				vm.changeElement(vm.elementVariation[0], vm.element.element_id);
			}
		}

		function changeBackground(color) {
			vm.avatarBgColor = color;
		}

		function changeElement(variant, id) {
			var img = variant.assets[vm.defaultElementColor['element_'+id]].asset_image_url;
			if(id == 10){
				vm.avatarBackHair = variant.assets[vm.defaultElementColor['element_'+id]].asset_image_back;
			}

			var elem = angular.element('#layer_'+id);
			elem.attr('element-id', vm.selectedElementId);
			elem.attr('variant-id', variant.variant_id);
			elem.attr('filter-value', variant.assets[vm.defaultElementColor['element_'+id]].asset_id);
			elem.css('background-image', 'url('+img+')');

			var skin_color = vm.element.skin_color;
			if(skin_color){
				changeAllSkin(variant.assets[vm.defaultElementColor['element_'+id]].asset_color_id);
			}
		}

		function changeElementColor(id, index) {
			vm.defaultElementColor['element_'+vm.element.element_id] = index;
			var elem = angular.element('#layer_'+vm.element.element_id);
			var url = '';
			var filter_value = '';
			var element_id = elem.attr('element-id');
			var variant_id = elem.attr('variant-id');
			var element_type = vm.element.element_type;
			var skin_color = vm.element.skin_color;
			for(var i = 0; i < element_type.length; i++){
				if(element_id == element_type[i].element_type_id){
					for(var j = 0; j < element_type[i].element_variation.length; j++){
						if(variant_id == element_type[i].element_variation[j].variant_id){
							for(var k = 0; k < element_type[i].element_variation[j].assets.length; k++){
								if(id == element_type[i].element_variation[j].assets[k].asset_color_id){
									if(vm.element.element_id == 10){
										vm.avatarBackHair = element_type[i].element_variation[j].assets[k].asset_image_back;
									}
									url = element_type[i].element_variation[j].assets[k].asset_image_url;
									filter_value = element_type[i].element_variation[j].assets[k].asset_id;
								}
							}
						}
					}
				}
			}

			elem.attr('filter-value', filter_value);
			elem.css('background-image', 'url('+url+')');

			if(skin_color){
				changeAllSkin(id);
			}
		}

		function changeAllSkin(id) {
			// change body
			var elem = angular.element('#layer_16');
			var assets = vm.avatarInit[0].element_type[0].element_variation[0].assets;
			var url = '';
			var filter_value = '';
			for(var i = 0; i < assets.length; i++){
				if(assets[i].asset_color_id == id){
					url = assets[i].asset_image_url;
					filter_value = assets[i].asset_id;
				}
			}
			elem.css('background-image', 'url('+url+')');
			elem.attr('filter-value', filter_value);

			// change face
			var elem = angular.element('#layer_9');
			for(var i = 0; i < vm.avatarInit.length; i++){
				if(elem.attr('filter-id') == vm.avatarInit[i].element_id){
					var element_type = vm.avatarInit[i].element_type;
				}
			}
			var url = '';
			var filter_value = elem.attr('filter-value');
			var element_id = elem.attr('element-id');
			var variant_id = elem.attr('variant-id');
			if(filter_value != id) {
				for(var i = 0; i < element_type.length; i++){
					if(element_id == element_type[i].element_type_id){
						var variant = element_type[i].element_variation;
						for(var j = 0; j < variant.length; j++){
							if(variant_id == variant[j].variant_id){
								var assets = variant[j].assets;
								for(var k = 0; k < assets.length; k++){
									if(id == assets[k].asset_color_id){
										url = assets[k].asset_image_url;
										filter_value = assets[k].asset_id;
									}
								}
							}
						}
					}
				}
				elem.css('background-image', 'url('+url+')');
				elem.attr('filter-value', filter_value);
			}

			// change nose
			var elem = angular.element('#layer_13');
			for(var i = 0; i < vm.avatarInit.length; i++){
				if(elem.attr('filter-id') == vm.avatarInit[i].element_id){
					var element_type = vm.avatarInit[i].element_type;
				}
			}
			var url = '';
			var filter_value = elem.attr('filter-value');
			var element_id = elem.attr('element-id');
			var variant_id = elem.attr('variant-id');
			if(filter_value != id) {
				for(var i = 0; i < element_type.length; i++){
					if(element_id == element_type[i].element_type_id){
						var variant = element_type[i].element_variation;
						for(var j = 0; j < variant.length; j++){
							if(variant_id == variant[j].variant_id){
								var assets = variant[j].assets;
								for(var k = 0; k < assets.length; k++){
									if(id == assets[k].asset_color_id){
										url = assets[k].asset_image_url;
										filter_value = assets[k].asset_id;
									}
								}
							}
						}
					}
				}
				elem.css('background-image', 'url('+url+')');
				elem.attr('filter-value', filter_value);
			}
		}

		function getFilterValue(id) {
			var elem = angular.element('#layer_'+id);
			var val = elem.attr('filter-value');
			return val;
		}

		vm.getElementId = getElementId;
		function getElementId() {
			var elem = angular.element('#layer_'+vm.element.element_id);
			var val = elem.attr('element-id');
			return val;
		}

		vm.getVariantId = getVariantId;
		function getVariantId() {
			var elem = angular.element('#layer_'+vm.element.element_id);
			var val = elem.attr('variant-id') || 'huhu';
			return val;
		}

		function removeElement(id) {
			var elem = angular.element('#layer_'+id);
			elem.css('background-image', 'url()');
			elem.attr('filter-value', '');
			if(id == 10){
				vm.avatarBackHair = '';
			}
		}

		function getIndexColor(element, color) {
			var idn = 0;
			for(var i = 0; i < vm.avatarInit.length; i++){
				if(vm.avatarInit[i].element_id == element){
					for(var j = 0; j < vm.avatarInit[i].color_variant.length; j++){
						if(vm.avatarInit[i].color_variant[j].color_id == color){
							idn = j;
						}
					}
				}
			}

			return idn;
		}

		function initScroll() {
			// control color
			var nextColor = $('._color-control.-next');
			var prevColor = $('._color-control.-prev');
			var viewportColor = $('._color-viewport');
			var pos = 0;
			// next
			nextColor.on('click', function(e){
				e.preventDefault();
				if(pos <= 103){
					pos+=40;
					viewportColor.animate({
						scrollTop: pos
					},250);
				}
			});
			// prev
			prevColor.on('click', function(e){
				e.preventDefault();
				if(pos > 0) {
					pos-=80;
					viewportColor.animate({
						scrollTop: pos
					},250);
				}
			});
			// avatar color
			var nextType = $('._type-control.-next');
			var prevType = $('._type-control.-prev');
			var viewportType = $('._type-viewport');
			var pos = 0;
			// next
			nextType.on('click', function(e){
				if(pos <= (viewportType.children().length*85)){
					pos+=55;
					viewportType.animate({
						scrollLeft: pos
					},100);
				}
			});
			// prev
			prevType.on('click', function(e){
				e.preventDefault();
				if(pos > 0) {
					pos-=55;
					viewportType.animate({
						scrollLeft: pos
					},100);
				}
			});
		}
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('FriendRequestAllController', FriendRequestAllController);
		
	FriendRequestAllController.$inject = ['CiayoService','modalFactory','friendRequestAllFactory', '$scope'];
	function FriendRequestAllController(CiayoService,modalFactory,friendRequestAllFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			fr:friendRequestAllFactory
		});

		function init(){
			vm.fr.init();
			vm.fr.getFrList(true);
			vm.fr.fr_start = false;
			vm.fr.load_more = false;
		}

		init();
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('FriendRequestController', FriendRequestController);
		
	FriendRequestController.$inject = ['CiayoService','modalFactory','friendRequestFactory', '$scope'];
	function FriendRequestController(CiayoService,modalFactory,friendRequestFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			fr:friendRequestFactory
		});

		function init(){
			vm.fr.getFrList(true);
			vm.fr.fr_start = false;
			vm.fr.load_more = false;
			vm.fr.countFr=0;
		}

		init();
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('InventoryController', InventoryController);

	InventoryController.$inject = ['CiayoService','$rootScope'];
	function InventoryController(CiayoService, $rootScope) {
		var vm = this;

		$rootScope.$on('$stateChangeStart', function(){ 
			vm.initScroll = false;
			vm.isSortable = false;
		});


		vm.getCollection = getCollection;
		vm.deleteSticker = deleteSticker;

		vm.getEmoji = getEmoji;

		vm.getTransaction = getTransaction;
		vm.searchHistory = searchHistory;
		vm.clearHistory = clearHistory;

		vm.initScroll = false;
		vm.sortable = sortable;
		vm.disSortable = disSortable;

		vm.previewSticker = previewSticker;

		var el, foo;

		function getCollection() {
			$('.cm-inventory-item').remove();

			var c = {
				data: {
					offset: '0',
					limit: '18'
				}
			};

			vm.collection = [];
			vm.noData = null;
			CiayoService.Api('user/sticker', c, function(response){
				var data = response.data.c.data.content;
				vm.collection = data.sticker_collection;

				if(vm.collection.length){
					vm.noData = null;
				} else {
					vm.noData = 'No Data';
				}
			});
		}
		
		vm.getCollection();

		function deleteSticker(id, ind) {
			var c = {
				data: {
					sticker_collection_id: id
				}
			};

			CiayoService.Api('user/sticker/delete', c, function(response){
				vm.collection.splice(ind, 1);
				alert(response.data.c.data.message);
			});
		}

		function getEmoji() {
			var c = {
				data: {
					offset: '0',
					limit: '18'
				}
			};

			vm.collection = [];
			vm.noData = null;
			CiayoService.Api('user/emoji', c, function(response){
				var data = response.data.c.data.content;
				vm.emoji = data.emoji_collection;

				if(vm.collection.length){
					vm.noData = null;
				} else {
					vm.noData = 'No Data';
				}
			});
		}

		vm.getEmoji();

		function getTransaction() {
			vm.transaction = [];
			vm.noDatas = null;
			var today = new Date();
			var date_to = vm.endDate?vm.endDate:today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
			today.setDate(today.getDate()-7);
			var date_from = vm.startDate?vm.startDate:today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();

			var c = {
				data: {
					date_from: date_from,
					date_to: date_to,
					offset: '0',
					limit: '18'
				}
			};

			vm.transaction = [];
			CiayoService.Api('user/order/history', c, function(response){
				var data = response.data.c.data.content;
				vm.transaction = data.list_order_history;
				if(vm.transaction.length == 0){
					vm.noDatas = true;
				}
			});
		}

		vm.getTransaction();

		function sortable() {
			if(!vm.initScroll){
				el = document.getElementById('sort');
				foo = Sortable.create(el, {
					animation: 150, 
					disabled: true, 
					onEnd: function (evt) {
						$('#sort .cm-inventory-item').each(function(e){
							if(evt.item.id === $(this).attr('id')){
								var order = parseInt($(this).prev().attr('data-order')) + 1;
								if(!order) {
									order = parseInt($(this).next().attr('data-order')) - 1;
								}
								changeOrder(order, evt.item.id);
							}
						});
					}
				});
				vm.initScroll = true;
			}
			vm.isSortable = true; var state = foo.option("disabled");
			foo.option("disabled", !state);
		}

		function disSortable() {
			vm.isSortable = false;
			vm.initScroll = false;
			var state = foo.option("disabled");
			foo.option("disabled", !state);
			getCollection();
		}

		function changeOrder(pos, id) {
			var c = {
				data: {
					sticker_collection_id: id,
					order: pos
				}
			}
			CiayoService.Api('ciayoproducts/priority', c, function(response){
			});
		}

		function searchHistory() {
			vm.startDate = angular.element('#startDateHidden').val();
			vm.endDate = angular.element('#endDateHidden').val();
			if(vm.startDate && vm.endDate){
				getTransaction();
			} else {
				alert('tanggal nya di isi dulu');
			}
		}

		function clearHistory() {
			vm.startDate = null;
			vm.endDate = null;
			angular.element('#startDateHidden').val('');
			angular.element('#endDateHidden').val('');
			angular.element('#startDate').val('');
			angular.element('#endDate').val('');

			vm.getTransaction();
		}

		function previewSticker(id) {
			vm.item_detail_load = false;
			$('.loader-wrp').show();
			$(".-sticker-detail").addClass("-open");
			var c = {
				data: {
					collection_id: id
				}
			};
			CiayoService.Api('user/sticker/collection/detail', c, function(response){
				var ok = false;
				var data = null;
				if(response.status==200) {
					data = response.data.c.data;
					var title=[];
					if(data.error == false) {
						ok = true;
					}
				}
				if(ok) {
					vm.itemDetail = response.data.c.data.content.sticker_collection;
					vm.item_detail_load = true;
				}
			});
		}

		vm.closePreview = closePreview;
		function closePreview() {
			$(".-sticker-detail").removeClass("-open");
		}
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('MenuController', MenuController);
		
	MenuController.$inject = ['CiayoService','modalFactory','menuFactory', '$scope'];
	function MenuController(CiayoService,modalFactory,menuFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			menu:menuFactory
		});
		init();
		function init(){
			vm.menu.userBasicInfo();
		}
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('MutualFriendController', MutualFriendController);
		
	MutualFriendController.$inject = ['CiayoService','modalFactory','mutualFriendFactory', '$scope'];
	function MutualFriendController(CiayoService,modalFactory,mutualFriendFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			mutual:mutualFriendFactory
		});

		function init(){
			vm.mutual.user_id = $stateParams.user_id;
			vm.mutual.username = $stateParams.username;
			vm.mutual.init();
			vm.mutual.getMutualFriendList(true);
		}

		init();
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('NotificationController', NotificationController);
		
	NotificationController.$inject = ['CiayoService','modalFactory','notificationFactory', '$scope'];
	function NotificationController(CiayoService,modalFactory,notificationFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			notification:notificationFactory
		});

		function init(){
			vm.notification.mark_all_notification();
			vm.notification.getNotificationList(true);
			vm.notification.notification_start = false;
			vm.notification.load_more = false;
			vm.notification.init();
			
		}

		init();
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('ProfileConnectionController', ProfileConnectionController);
		
	ProfileConnectionController.$inject = ['CiayoService','modalFactory','profileConnectionFactory', '$scope', '$stateParams'];
	function ProfileConnectionController(CiayoService,modalFactory,profileConnectionFactory, $scope, $stateParams) {
		var vm = this;
		angular.extend(vm,{
			search:profileConnectionFactory
		});
		init();
		function init(){
			vm.search.user_list=[];
			vm.search.mutual_list=[];
			vm.search.count_friend_list = '';
			vm.search.count_mutual_list = '';

			vm.search.type='user';
			vm.search.get_profile();

		}
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.directive("profileConnection", function(){
      		return {
      			restrict: "E",
      			scope: {},
				replace:true,
				templateUrl: 'profile-connection.html'
      		}
      	})
		.controller('ProfileController', ProfileController);

	ProfileController.$inject = ['profileFactory','modalFactory', 'CiayoService', 'timelineFactory', '$cookieStore'];
	function ProfileController(profileFactory, modalFactory, CiayoService, timelineFactory, $cookieStore) {

		var vm = this;
		angular.extend(vm,{
			pr:profileFactory,
			timeline:timelineFactory,
			profile_url:"profile.html"
		});

		function init(){
			profileFactory.reset();
			profileFactory.userBasicInfo();
			profileFactory.listTitle();
			profileFactory.listPrefix();
			profileFactory.listChoiceBadge();
			profileFactory.listChoiceAchievement();
			profileFactory.listSocialMedia();
			profileFactory.select_tab = 1;
			profileFactory.getBanner();
			profileFactory.language_id = parseInt($cookieStore.get('language'));

			vm.pr.state = 1;

			vm.pr.user_list=[];
			vm.pr.mutual_list=[];
			vm.pr.count_friend_list = '';
			vm.pr.count_mutual_list = '';

			vm.pr.type='user';
			//vm.pr.get_profile();

			vm.timeline.type='profile';
			vm.timeline.init();
		}

		init();
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.directive("profileConnection", function(){
      		return {
      			restrict: "E",
      			scope: {},
				replace:true,
				templateUrl: 'profile-connection.html'
      		}
      	})
		.controller('ProfilePublicController', ProfilePublicController);

	ProfilePublicController.$inject = ['profilePublicFactory','modalFactory', 'CiayoService', 'timelineFactory'];
	function ProfilePublicController(profilePublicFactory, modalFactory, CiayoService, timelineFactory) {

		var vm = this;
		angular.extend(vm,{
			pr:profilePublicFactory,
			//timeline:timelineFactory,
			profile_url:"profile-public.html"
		});

		function init(){
			profilePublicFactory.state = 1;
			profilePublicFactory.email = null;
			profilePublicFactory.phone = null;
			profilePublicFactory.userBasicInfo();
			//profilePublicFactory.listPrefix();
			//profilePublicFactory.listChoiceBadge();
			// profilePublicFactory.listChoiceAchievement();
			// profilePublicFactory.listSocialMedia();
			// profilePublicFactory.select_tab = 1;
			// profilePublicFactory.getBanner();

			// vm.pr.state = 1;

			// vm.pr.user_list=[];
			// vm.pr.mutual_list=[];
			// vm.pr.count_friend_list = '';
			// vm.pr.count_mutual_list = '';

			// vm.pr.type='user';

			// vm.timeline.type='profile';
			// vm.timeline.init();
		}

		init();
	}
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('SampleController', SampleController);

	SampleController.$inject = ['CiayoService','$state','cardFactory'];
	function SampleController(CiayoService, $state,cardFactory) {
		var vm = this;
		angular.extend(vm,{
			js_timeline:[]
			
		});
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('SearchController', SearchController);
		
	SearchController.$inject = ['CiayoService','modalFactory','searchFactory', '$scope'];
	function SearchController(CiayoService,modalFactory,searchFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			search:searchFactory
		});
		init();
		function init(){
			vm.search.type='user';
		}
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.controller('SettingController', SettingController)
		.directive("limitTo", [function() {
		    return {
		        restrict: "A",
		        link: function(scope, elem, attrs) {
		            var limit = parseInt(attrs.limitTo);
		            angular.element(elem).on("keypress", function(e) {
		                if (this.value.length == limit) e.preventDefault();
		            });
		        }
		    }
		}])

	SettingController.$inject = ['settingFactory','modalFactory','CiayoService'];
	function SettingController(settingFactory, modalFactory, CiayoService) {

		var vm = this;
		angular.extend(vm,{
			st: new settingFactory()
		});

		function init(){
			//settingFactory.userBasicInfo();
			//settingFactory.generalSettings();
			//settingFactory.listPrefixPhone();
		}

		init();
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.controller('StoreController', StoreController);

	StoreController.$inject = ['storeFactory','modalFactory','CiayoService', '$rootScope'];
	function StoreController(storeFactory, modalFactory, CiayoService, $rootScope) {

		var vm = this;
		angular.extend(vm,{
			st:storeFactory
		});

		function renderBanner(){
			setTimeout(function(){
				$(".cm-store-slide").owlCarousel({
					items: 1,
					nav: true,
					loop: true,
					autoplay: true,
					navText: ["<i class='ci-prev'></i>","<i class='ci-next'></i>"]
				});
			}, 500);
		}
		function init() {
			storeFactory.bannerHome( function(){renderBanner()} );
			storeFactory.loadList('popular', '1','0','0','5','0','');
			storeFactory.bannerPremium( function(){renderBanner()} );
			storeFactory.loadList('premium','0','1','0','5','0','');
			storeFactory.bannerContributor( function(){renderBanner()} );
			storeFactory.loadList('contributor','2','0','0','5','0','');
			storeFactory.bannerFree( function(){renderBanner()} );
			storeFactory.loadList('free','0','2','0','5','0','');
			storeFactory.loadList('all','0','0','0','5','0','');
			storeFactory.loadEmoji(0,5);
			storeFactory.loadBalance();
			storeFactory.menu=1;
		}

		vm.loadMoreAll = loadMoreAll;
		vm.offsetAll = 12;
		function loadMoreAll() {
			vm.offsetAll += 12;
			storeFactory.loadList('all','0','0',vm.offsetAll,'12','0','');
		}

		$rootScope.$on('$stateChangeSuccess', function(){ 
			renderBanner();
		});

		init();
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('TimelineController', TimelineController);
		
	TimelineController.$inject = ['CiayoService','modalFactory','postFactory','timelineFactory'];
	function TimelineController(CiayoService,modalFactory,postFactory,timelineFactory,$scope) {
		var vm = this;
		angular.extend(vm,{
			//FACTORY
			post:postFactory,
			timeline:timelineFactory,
			//POST
			setStatePost:setStatePost,
			//TIMELINE
			loadCard:loadCard,
			newPostLoad:newPostLoad
		});
		init();
		function init(){
			postFactory.init();
			vm.timeline.type='timeline';
			vm.timeline.init();
		}
		function setStatePost(value){
			var scrollPos = 0;
			if(value=='open'){
				scrollPos = $(window).scrollTop();
				$("html, body").css({"height": $(window).height(), "overflow": "hidden"});
				$(".cm").addClass("-locked")
				vm.post.init();
				vm.post.setState('post');
				$('.cm-timeline').css('visibility','hidden');
			} 
			else
			{
				if(value=='save'){
					if(savePost()==false){return;}
					timelineFactory.loading_count.push({});
				}
				$(".cm").removeClass("-locked")
				vm.post.setState('none')
				$("html, body").removeAttr("style");
				$(window).scrollTop(scrollPos);
				$('.cm-timeline').css('visibility','visible');
			}
		}
		function savePost(){
			return vm.post.save(function(data){
				if(data){
					timelineFactory.loading_count.pop();
					vm.timeline.insert(data);
				}
			})
		}
		function loadCard(){
			timelineFactory.getCardList();
		}
		function newPostLoad(){
			$('body').animate({'scrollTop':125});
			vm.timeline.newPostLoad();
		}
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('TrendingActivityController', TrendingActivityController);
		
	TrendingActivityController.$inject = ['CiayoService','modalFactory','trendingActivityFactory', '$scope'];
	function TrendingActivityController(CiayoService,modalFactory,trendingActivityFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			trending_activity:trendingActivityFactory
		});

		function init(){
			vm.trending_activity.getTrendingActivityList(true);
		}

		init();
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('TrendingController', TrendingController);
		
	TrendingController.$inject = ['CiayoService','modalFactory','timelineFactory'];
	function TrendingController(CiayoService,modalFactory,timelineFactory) {
		var vm = this;
		angular.extend(vm,{
			timeline:timelineFactory
		});
		init();
		function init(){
			vm.timeline.type='trending';
			vm.timeline.init();
		}
		
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('TrendingPeopleController', TrendingPeopleController);
		
	TrendingPeopleController.$inject = ['CiayoService','modalFactory','trendingPeopleFactory', '$scope'];
	function TrendingPeopleController(CiayoService,modalFactory,trendingPeopleFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			search:trendingPeopleFactory
		});

		function init(){
			vm.search.type='trending';
			vm.search.getTrendingPeopleList();
		}

		init();
	}
})();;
(function () {
	'use strict';
	angular
		.module('app')
		.controller('TrendingPlaceController', TrendingPlaceController);
		
	TrendingPlaceController.$inject = ['CiayoService','modalFactory','trendingPlaceFactory', '$scope'];
	function TrendingPlaceController(CiayoService,modalFactory,trendingPlaceFactory, $scope) {
		var vm = this;
		angular.extend(vm,{
			trending_place:trendingPlaceFactory
		});

		function init(){
			vm.trending_place.getTrendingPlaceList(true);
		}

		init();
	}
})();;
(function() {
'use strict';

  angular
    .module('app')
    .controller('UpdateController', UpdateController);

  UpdateController.$inject = ['CiayoService','$cookieStore'];
  function UpdateController(CiayoService, $cookieStore) {
    var vm = this;

    vm.getUpdate = getUpdate;
    function getUpdate() {
      var lang = $cookieStore.get('language');
      var c={
          data:{
              page_id:10,
              language_id:lang
          }
      }
      CiayoService.Api('page/detail', c, function(response) {
          if(response.status == 200) {
              vm.content = response.data.c.data.content.content;
          } else {
              window.alert('error');
          }
      });
    }

    vm.getUpdate();
  }
})();;
(function() {
'use strict';

	angular
		.module('app')
		.controller('WelcomeController', WelcomeController);

	WelcomeController.$inject = ['CiayoService', 'AuthService', '$state', '$cookieStore', '$stateParams','languageFactory'];
	function WelcomeController(CiayoService, AuthService, $state, $cookieStore, $stateParams, languageFactory) {
		var vm = this;

		vm.registerType = 'email';
		vm.loginType = 'email';
		vm.forPassType = 'email';

		vm.validateEmail = validateEmail;
		vm.validatePassword = validatePassword;
		vm.checkPass = checkPass;
		vm.checkRePass = checkRePass;
		vm.validatePhone = validatePhone;

		vm.register = register;
		vm.login = login;
		vm.forgotPassword = forgotPassword;
		vm.resetPassword = resetPassword;
		
		function validateEmail(name, val) {
			var email = val || '';
			var elem = selectElement('input[name='+name+']');
			
			if(email && email.match(/(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/g)) {
				elem.removeClass('error');
				elem.addClass('success');
				vm.isEmailValidated = true;
			} else if(email){
				elem.removeClass('success');
				elem.removeClass('error');
				setTimeout(function(){
					elem.addClass('error');
				}, 1);
				
				vm.isEmailValidated = false;
			} else {
				elem.removeClass('success');
				elem.removeClass('error');
			}
		}

		function validatePassword(name, val){
			var pass = val || '';
			var elem = selectElement('input[name='+name+']');
			
			if(pass){
				if(pass.length > 7){
					$('#'+name+' div:nth-child(2)').addClass('active');
					if(pass.match(/^[A-Za-z\d\!\@\#\$\%\^\*\{\[\}\}\:\;\,\.\?\+\-\_\=\~\']{8,}$/)){
						$('#'+name+' div:nth-child(3)').addClass('active');
						vm.isPassValidated = true;
					} else {
						$('#'+name+' div:nth-child(3)').removeClass('active');
						vm.isPassValidated = false;
					}
				} else {
					$('#'+name+' div:nth-child(3)').removeClass('active');
					$('#'+name+' div:nth-child(2)').removeClass('active');
					vm.isPassValidated = false;
				}
			}
		}

		function checkPass(name, val){
			var pass = val || '';
			var elem = selectElement('input[name='+name+']');
			
			if(pass && pass.match(/^[A-Za-z\d\!\@\#\$\%\^\*\{\[\}\}\:\;\,\.\?\+\-\_\=\~\']{8,}$/)) {
				elem.removeClass('error');
				elem.addClass('success');
				vm.isPassValidated = true;
			} else if(pass){
				elem.removeClass('success');
				elem.removeClass('error');
				setTimeout(function(){
					elem.addClass('error');
				}, 1);
				
				vm.isPassValidated = false;
			} else {
				elem.removeClass('success');
				elem.removeClass('error');
			}
		}
		
		function checkRePass() {
			var elem = selectElement('input[name=rePass]');
			if((vm.newPass == vm.rePass) && vm.rePass) {
				elem.removeClass('error');
				elem.addClass('success');
				vm.isRePassValidated = true;
			} else {
				elem.removeClass('success');
				elem.removeClass('error');
				setTimeout(function(){
					elem.addClass('error');
				}, 1);
				vm.isRePassValidated = false;
			}
		}

		function validatePhone(name, val) {
			var phone = val;
			var elem = selectElement('input[name='+name+']');
			
			if(!isNaN(phone)) {
				elem.removeClass('error');
				elem.addClass('success');
				
				vm.isPhoneValidated = true;
			} else if(phone){
				elem.removeClass('success');
				elem.removeClass('error');
				setTimeout(function(){
					elem.addClass('error');
				}, 1);
				
				vm.isPhoneValidated = false;
			} else {
				elem.removeClass('success');
				elem.removeClass('error');
			}
		}

		function register() {
			var ref = $stateParams.ref;
			var info = $state.current.name=='popcon'?1:0;
			var email = vm.regEmail;
			var phone = '';
			if(vm.regPhone){
				var pclen = vm.regPC.length;
				phone = String(vm.regPhone);
				if(phone.charAt(0) == '0'){
					phone = vm.regPC + '-' +phone.substr(1);
				} else if(phone.substring(0,pclen) == vm.regPC){
					phone = vm.regPC + '-' +phone.substr(pclen);
				} else {
					phone = vm.regPC + '-' +phone;
				}
			}
			if(vm.registerType === 'email') {
				var pass = vm.regEPass;
			} else {
				var pass = vm.regPPass;
			}
			if(vm.registerType == 'email' && !vm.isEmailValidated) {
				vm.errMsg = 'Email tidak valid';
			} else if(vm.registerType == 'phone' && !vm.isPhoneValidated) {
				vm.errMsg = 'Phone tidak valid';
			} else if(!vm.isPassValidated) {
				vm.errMsg = 'Password tidak valid';
			} else {
				vm.showLoading = true;
				AuthService.Register(
					vm.registerType,
					email,
					phone,
					pass,
					info,
					ref
				).then(
					function(data){
						vm.showLoading = false;
						if(data.status!=-1){
							if(data.error) {
								if(vm.registerType == 'email') {
									vm.errMsg = data.message;
								} else {
									vm.errMsg = data.message;
								}
								setTimeout(function(){
									vm.errMsg = '';
								}, 2000);
								vm.inputFocus(vm.registerType=='email'?'regEmail':'regPhone');
							} else {
								$state.go('create-avatar.gender');
							}
						} else {
							vm.errMsg = 'Network Error';
							setTimeout(function(){
								vm.errMsg = '';
							}, 2000);
						}
					}
				);
			}
			setTimeout(function(){
				vm.errMsg = '';
			}, 3000);
			vm.inputFocus(vm.registerType=='email'?'regEmail':'regPhone');
		}

		function login() {
			$cookieStore.remove('token');
			var email = vm.logEmail;
			var pass = vm.loginType==='email'?vm.logEPass:vm.logPPass;
			var phone = '';
			if(vm.logPhone){
				var pclen = vm.logPC.length;
				phone = String(vm.logPhone);
				if(phone.charAt(0) == '0'){
					phone = vm.logPC + '-' +phone.substr(1);
				} else if(phone.substring(0,pclen) == vm.logPC){
					phone = vm.logPC + '-' +phone.substr(pclen);
				} else {
					phone = vm.logPC + '-' +phone;
				}
			}
			vm.showLoading = true;
			AuthService.Login(
				vm.loginType,
				email,
				phone,
				pass
			).then(
				function(data){
					vm.showLoading = false;
					if(!data.error && data.content) {
						languageFactory.getLanguage();

						if(data.content.profile_completed){
							$state.go('timeline');
						} else {
							$state.go('create-avatar.name');
						}
					} else {
						vm.errMsg = data.message || 'Network Error';
						
						vm.inputFocus(vm.loginType=='email'?'logEPass':'logPPass');
					}
				}
			);
			// AuthService.Login(c, function(response) {
			// 	vm.showLoading = false;
			// 	if(!response.error && response.content) {
			// 		languageFactory.getLanguage();

			// 		if(response.content.profile_completed){
			// 			$state.go('timeline');
			// 		} else {
			// 			$state.go('create-avatar.name');
			// 		}
			// 	} else {
			// 		vm.errMsg = response.message || 'Unknown Error';
					
			// 		vm.inputFocus(vm.loginType=='email'?'logEPass':'logPPass');
			// 	}
			// });
		}

		function forgotPassword() {
			if(vm.forPassType == 'email') {
				var email = vm.fpEmail;
				if(email){
					email = email.toLowerCase();
				}
			} else {
				var phone = '';
				if(vm.fpPhone){
					var pclen = vm.fpPC.length;
					phone = vm.fpPhone+'';
					if(phone.charAt(0) == '0'){
						phone = vm.fpPC+'-'+phone.substr(1);
					} else if(phone.substring(0,pclen) == vm.fpPC){
						phone = vm.fpPC+'-'+phone.substr(pclen);
					} else {
						phone = vm.fpPC+'-'+phone;
					}
				}
			}
			vm.showLoading = true;
			AuthService.ForgotPassword(
				vm.forPassType,
				email,
				phone
			).then(
				function(data){
					console.log(data);
					if(!data.error){
						$state.transitionTo('forgot-password-success');
					} else {
						vm.errMsg = data.message || 'Unknown Error';
						setTimeout(function(){
							vm.errMsg = null;
						}, 3000);
						vm.inputFocus(vm.forPassType=='email'?'fpEmail':'fpPhone');
					}
				}
			);
			// CiayoService.Api('password', c, function(response){
			// 	vm.showLoading = false;
			// 	if(response.data.c.data.error){
			// 		vm.errMsg = response.data.c.data.message.email?response.data.c.data.message.email[0]:response.data.c.data.message.phone[0];
			// 		setTimeout(function(){
			// 			vm.errMsg = null;
			// 		}, 3000);
			// 		vm.inputFocus(vm.forPassType=='email'?'fpEmail':'fpPhone');
			// 	} else {
			// 		$state.transitionTo('forgot-password-success');
			// 	}
			// });
		}
		
		function resetPassword() {
			var token = $stateParams.token;
			if(vm.isRePassValidated && vm.isPassValidated){
				var c = {
					data: {
						password: vm.newPass,
						confirm_password: vm.rePass,
						password_token: token
					}
				};
				
				CiayoService.Api('password/change', c, function(response){
					if(response.status == 200){
						var data = response.data.c.data;
						if(data.error){
							vm.errMsg = data.message;
							setTimeout(function(){
								vm.errMsg = null;
							}, 3000);
						} else {
							$state.transitionTo('welcome');
						}
					} else {
						alert(response.status+': '+response.statusText);
					}
				});
			} else if(!vm.isPassValidated){
				vm.errMsg = "Password Min 8 Character";
				setTimeout(function(){
					vm.errMsg = null;
				}, 3000);
				vm.inputFocus('newPass');
			} else {
				vm.errMsg = "Password Not Match";
				setTimeout(function(){
					vm.errMsg = null;
				}, 3000);
				vm.inputFocus('rePass');
			}
		}

		// Init Function
		function getPhoneCode() {
			var c = {
				data: {
				}
			};
			
			CiayoService.Api('users/setting/prefix_phone_number', c, function(response){
				vm.listPhoneCode =	response.data.c.data.content.list_prefix_phone_number;
			});
		}
		
		getPhoneCode();

		// Addtional Function
		function selectElement(el) {
			return angular.element(document.querySelectorAll(el));
		}

		vm.inputFocus = inputFocus;
		function inputFocus(el) {
			$('input[name='+el+']').removeClass('error');
			setTimeout(function(){
				$('input[name='+el+']').focus();
			},250);
		}

		if($cookieStore.get('language')) {
			vm.language = String($cookieStore.get('language'));
		} else {
			vm.language = String(2);
		}

		vm.changeLanguage = changeLanguage;
		function changeLanguage(){
        	var language = vm.language;
        	$cookieStore.put('language', language);
        	vm.language = null;
        	languageFactory.changeLanguage(parseInt(language), function(language) {
        		vm.language = String(language);
        	});
        }

  	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('calendarDrawer', calendarDrawer);
	calendarDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory' , '$filter'];

	function calendarDrawer($rootScope, CiayoService, drawerFactory, $filter) {
		var default_options={
			firstDay: 1,
			format: 'DD/MM/YYYY',
			bound: false
		};
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			old_date:null,
			date:'',
		};
		function open(type,date,options,callback){
			var _options = default_options;
			angular.extend(_options,options);
			factory.options=_options;
			factory.back_text=$filter('translate')('$back');
			factory.save_text=$filter('translate')('$save');
			date = moment(date).format(factory.options.format);
			factory.callback=callback;
			factory.old_date=factory.date=date;
			drawerFactory.title=$filter('translate')('$pick.a.date');
			drawerFactory.drawer_class='-timeline-post-date';
			drawerFactory.template = DRAWER_VIEW+'calendar.html';
			drawerFactory.data = factory;
			factory.old_date=date;
			factory.date=date;
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
			var data={'date':factory.old_date};
			factory.callback(data);
		}
		function save(){
			drawerFactory.setState();
			var data={'date':factory.date}
			factory.callback(data);
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardCaptionDrawer', cardCaptionDrawer);
	cardCaptionDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory', '$filter'];

	function cardCaptionDrawer($rootScope, CiayoService, drawerFactory, $filter) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			old_caption:null,
			caption:'',
			activity:null,
			
		};
		function open(type,caption,parallax,callback){
			factory.callback=callback;
			factory.old_caption=factory.caption=caption;
			factory.parallax =parallax;
			factory.back_text=$filter('translate')('$back');
			factory.save_text=$filter('translate')('$save');
			if(type=='ADD'){
				drawerFactory.title=$filter('translate')('$add.a.caption');
			}else{
				drawerFactory.title=$filter('translate')('$edit.caption');
			}
			drawerFactory.drawer_class='-timeline-post-caption';
			drawerFactory.template = DRAWER_VIEW+'card-caption.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
			var data={'caption':factory.old_caption};
			factory.callback(data);
		}
		function save(){
			drawerFactory.setState();
			var data={'caption':factory.caption}
			factory.callback(data);
		}
		return factory;
	}
})();;
//-card-comment-edit
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardCommentEditDrawer', cardCommentEditDrawer);
	cardCommentEditDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory', '$filter'];

	function cardCommentEditDrawer($rootScope, CiayoService, drawerFactory, $filter) {
		var scrollPos = 0;
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			old_message:null,
			message:'',
			card:null
		};
		function open(message,card,callback){
			factory.callback=callback;
			factory.card = card;
			factory.old_message=factory.message=message;
			factory.back_text=$filter('translate')('$back');
			factory.save_text=$filter('translate')('$save');
			drawerFactory.title=$filter('translate')('$edit.comment');
			drawerFactory.drawer_class='-card-comment-edit';
			drawerFactory.template = DRAWER_VIEW+'card-comment-edit.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
			scrollPos = $(window).scrollTop();
			$("html, body").css({"height": $(window).height(), "overflow": "hidden"});
		}
		function unlock(){
			$("html, body").removeAttr("style");
			$(window).scrollTop(scrollPos)
		}
		function back(){
			drawerFactory.setState();
			var data={'message':factory.old_message};
			factory.callback(data);
			unlock();
		}
		function save(){
			drawerFactory.setState();
			var data={'message':factory.message}
			factory.callback(data);
			unlock();
		}
		return factory;
	}
})();;
//-card-comment-edit
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardCommentReplyDrawer', cardCommentReplyDrawer);
	cardCommentReplyDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory', '$filter'];

	function cardCommentReplyDrawer($rootScope, CiayoService, drawerFactory, $filter) {
		var scrollPos = 0;
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			onLoad:angular.noop(),
			old_message:null,
			message:'',
			card:null
		};
		function open(message,card,callback){
			factory.callback=callback;
			factory.onLoad=onLoad;
			factory.old_message=factory.message=message;
			factory.back_text=$filter('translate')('$back');
			factory.card = card;
			drawerFactory.title=$filter('translate')('$reply.comment');
			drawerFactory.drawer_class='-card-comment-reply';
			drawerFactory.template = DRAWER_VIEW+'card-comment-reply.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
			scrollPos = $(window).scrollTop();
			$("html, body").css({"height": $(window).height(), "overflow": "hidden"});
		}
		function onLoad(){
			setTimeout(function(){
				$(".-card-comment-reply .cm-card-comment ._input").on({
					"focus": function(){
						$(this).parent().addClass("-focus")
					},
					"blur": function(){
						$(this).parent().removeClass("-focus")
					}
				})
			}, 0)
		}
		function unlock(){
			$("html, body").removeAttr("style");
			$(window).scrollTop(scrollPos)
		}
		function back(){
			drawerFactory.setState();
			var data={'message':factory.old_message};
			factory.callback(data);
			unlock();
		}
		function save(){
			drawerFactory.setState();
			var data={'message':factory.message}
			factory.callback(data);
			unlock();
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardDetailDrawer', cardDetailDrawer);
		cardDetailDrawer.$inject = ['$rootScope','$filter', 'CiayoService', 'drawerFactory'];

	var scrollPos = 0;
	function cardDetailDrawer($rootScope,$filter, CiayoService, drawerFactory) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			onLoad:angular.noop(),
			card:null,
			
		};
		function onLoad(){
			setTimeout(function(){
				$(".-card-detail .cm-card-comment ._input").on({
					"focus": function(){
						$(this).parent().addClass("-focus")
					},
					"blur": function(){
						$(this).parent().removeClass("-focus")
					}
				})
			}, 0)
		}
		function open(card,callback){
			factory.callback=callback;
			factory.onLoad=onLoad;
			factory.card=card;
			factory.back_text=$filter('translate')('$back');
			drawerFactory.title='Card Detail';
			drawerFactory.drawer_class='-card-detail';
			drawerFactory.template = DRAWER_VIEW+'card-detail.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
			scrollPos = $(window).scrollTop();
			$("html, body").css({"height": $(window).height(), "overflow": "hidden"});
		}
		function back(){
			drawerFactory.setState();
			var data={'caption':factory.old_caption};
			factory.callback(data);
			$("html, body").removeAttr("style");
			$(window).scrollTop(scrollPos)
		}
		function save(){
			drawerFactory.setState();
			var data={'caption':factory.caption}
			factory.callback(data);
			$("html, body").removeAttr("style");
			$(window).scrollTop(scrollPos)
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardItemDrawer', cardItemDrawer);
	cardItemDrawer.$inject = ['$rootScope','modalFactory','CiayoService', 'drawerFactory', '$filter'];

	function cardItemDrawer($rootScope,modalFactory, CiayoService, drawerFactory, $filter) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			onLoad:angular.noop(),
			old_items:null,
			items:null,
			search:'',
			list:[],
			index:0,
			max_item:4,
			isEdit:false,
			isEmpty:false,
			getInitData:getInitData,
			deleteSearch:deleteSearch,
			selectIndex:selectIndex,
			resetItem:resetItem,
			setEdit:setEdit,
			isSearch:isSearch,
			selectItem:selectItem,
			searchItem:searchItem,
			deleteItem:deleteItem
		};
		function onLoad(){
			setTimeout(function(){
				var scrollPos = 0;
				$(".-timeline-post-item ._search-input input").on({
					"focus": function(){
						// get last scroll position
						scrollPos = $(window).scrollTop();
						// add focus behaviour
						$(this).parent().addClass("-focus")
						// lock html & body
						$("html, body").css({"height": $(window).height(), "overflow": "hidden"});
					},
					"blur": function(){
						// remove focus behaviour
						$(this).parent().removeClass("-focus")
						// unlock html & body
						$("html, body").removeAttr("style");
						// restore last scroll position
						$(window).scrollTop(scrollPos)
					}
				})
			}, 0)
		}
		function open(type,items,index,callback){
			factory.callback=callback;
			factory.onLoad=onLoad;
			factory.old_items=items.slice();
			factory.items = items.slice();
			selectIndex(index);
			factory.back_text=$filter('translate')('$back');
			factory.save_text=$filter('translate')('$save');
			if(type=='ADD'){
				drawerFactory.title=$filter('translate')('$add.item');
			}else{
				drawerFactory.title=$filter('translate')('$edit.item');
			}
			drawerFactory.drawer_class='-timeline-post-item -topbar';
			drawerFactory.template = DRAWER_VIEW+'card-item.html';
			drawerFactory.data = factory;
//			factory.old_items=items;
//			factory.items=items;
			factory.search='';
			factory.list=[];
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
			var data={'items':factory.old_items};
			factory.callback(data);
		}
		function save(){
			drawerFactory.setState();
			var data={'items':factory.items}
			factory.callback(data);
		}
		//FUNCTION
		function getInitData(){
			var _result = [];
			for(var i=0;i<factory.max_item;i++){
				_result.push(null);
			}
			return _result;
		}
		function deleteSearch(){
			factory.search='';
			factory.list=[];
			factory.isEmpty=false;
		}
		function selectIndex(index){
			factory.search='';
			factory.isEdit=false;
			factory.isEmpty=false;
			factory.list=[];
			factory.index = index;
			adjustHeight();
		}
		function resetItem(){
			factory.items=getInitData();
		}
		function setEdit(value){
			factory.isEdit=value;
		}
		function isSearch($index){
			return factory.items[$index]==undefined || factory.isEdit==true
		}
		
		function searchItem(){
			factory.isEmpty=false;
			var keyword=factory.search,item_category_id=null,limit=20,offset=0;
			var ok = false;
			var c = {
				data: {
					"keyword": keyword,
					"item_category_id": item_category_id,
					"limit": limit,
					"offset": offset
				}
			};
			CiayoService.Api('item', c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					var _tmp = [];
					var _list = [];
					angular.forEach(factory.items,function(value,key){
						if(value)
							_list.push(value.item_id);
					});
					angular.forEach(data.content.list_item,function(value,key){
						if(_list.indexOf(value.item_id)==-1){
							_tmp.push(value);
						}
					});
					factory.list=[];
					if(_tmp.length>0){
						factory.list=_tmp;
					}
					factory.isEmpty=_tmp.length==0;
					adjustHeight();
				}else{
					//...
				}
			});
		}
		function selectItem(item){
			factory.items[factory.index]=item;
			factory.list=[];
			factory.search=item.item_name;
			factory.search='';
			factory.isEdit=false;
			factory.isEmpty=false;
		}
		function deleteItem(){
			deleteSearch();
			factory.items[factory.index]=null;
		}
		function adjustHeight(){
			$(window).trigger("resize.post_item");
			setTimeout(function(){
					$('.cm-panel-global .cm-wrapper').css('min-height',$('.cm-panel-global .cm-wrapper ._pane.-open').outerHeight()+20)
				,1});
		}
		
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardPlaceDrawer', cardPlaceDrawer);
	cardPlaceDrawer.$inject = ['$rootScope','CiayoService', 'drawerFactory','modalFactory','$filter','timelineConnector'];

	function cardPlaceDrawer($rootScope,CiayoService, drawerFactory,modalFactory,$filter,timelineConnector) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			old_place:null,
			place:null,
			search:'',
			list:[],
			suggest:[],
			isEmpty:false,
			deleteSearch:deleteSearch,
			selectPlace:selectPlace,
			searchPlace:searchPlace,
			deletePlace:deletePlace
		};
		function open(type,place,callback){
			factory.callback=callback;
			factory.old_place=place;
			factory.place = place;
			factory.isEmpty=false;
			factory.back_text=$filter('translate')('$back');
			factory.save_text=$filter('translate')('$save');
			if(type=='ADD'){
				drawerFactory.title=$filter('translate')('$add.a.place');
			}else{
				drawerFactory.title=$filter('translate')('$edit.a.place');
			}
			drawerFactory.drawer_class='-timeline-post-place';
			drawerFactory.template = DRAWER_VIEW+'card-place.html';
			drawerFactory.data = factory;
			factory.old_place=place;
			factory.place=place;
			factory.search='';
			factory.list=[];
			getPosition();
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
			var data={'place':factory.old_place};
			factory.callback(data);
		}
		function save(){
			drawerFactory.setState();
			var data={'place':factory.place}
			factory.callback(data);
		}
		//FUNCTION
		
		function deleteSearch(){
			factory.search='';
			factory.list=[];
			factory.isEmpty=false;
		}
		function getPosition(){
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(loadSuggest);
			} else {
					
			}
		}
		function loadSuggest(position){
			var ok=false;
			var c = {
				data: {
					latitude: position.coords.latitude,
					longitude: position.coords.longitude
				}
			};
			CiayoService.Api('place/nearby', c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					factory.suggest=data.content.list_nearby_place;
				}else{
					//...
				}
			});
		}
		function searchPlace(){
			factory.isEmpty=false;
			timelineConnector.placeGet(factory.search).then(function(data){
				factory.isEmpty=data.content.data.length==0;
				factory.list=data.content.data;
			});
		}
		function selectPlace(_place){
			factory.place=_place;
			factory.deleteSearch();
			factory.isEmpty=false;
		}
		function deletePlace(){
			factory.place=null;
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardReactionDrawer', cardReactionDrawer);
	cardReactionDrawer.$inject = ['$rootScope','$filter', 'CiayoService', 'drawerFactory'];

	function cardReactionDrawer($rootScope,$filter, CiayoService, drawerFactory) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			reaction:{},
			
		};
		function open(reaction,callback){
			factory.callback=callback;
			factory.reaction=reaction;
			factory.back_text=$filter('translate')('$back');
			drawerFactory.title='Cimotion';
			drawerFactory.drawer_class='-card-cimotion';
			drawerFactory.template = DRAWER_VIEW+'card-reaction.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
		}
		function save(){
			drawerFactory.setState()
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardResponsePlace', cardResponsePlace);
	cardResponsePlace.$inject = ['$rootScope','$filter','modalFactory', 'drawerFactory','cardFactory','cardPlaceDrawer','timelineConnector'];

	function cardResponsePlace($rootScope,$filter,modalFactory,drawerFactory,cardFactory,cardPlaceDrawer,timelineConnector) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			card:null,
			activity:null,
			response:response
		};
		function open(post_code,from_name,caption,callback){
			factory.callback=callback;
			factory.from_name = from_name;
//			factory.card=new cardFactory();
			factory.back_text=$filter('translate')('$back');
			drawerFactory.title=$filter('translate')('$response.to.question');
			drawerFactory.drawer_class='-card-ask';
			drawerFactory.template = DRAWER_VIEW+'card-response-place.html';
			load(post_code);
		}
		function load(post_code){
			var c = {
				data: {
					"post_code": post_code,
				}
			}
			timelineConnector.cardGet(post_code).then(function(data){
						var data = data.content;
						if(data.place_detail.place_status.value!=-1){modalFactory.message('Kamu sudah pernah respons');return;}
						//user_info
						factory.user={};
						factory.id = data.post_id;
						factory.created_at = data.created_at;
						factory.user.id = data.user_id;
						factory.user.username = data.username;
						factory.user.user_display_name = data.user_display_name;
						//mood_id
						factory.user.mood={};
						if (data.activity_detail.mood) {
							factory.user.mood.id = data.activity_detail.mood.id;
							factory.user.mood.text = data.activity_detail.mood.text;
						}
						factory.image_preview = data.activity_detail.preview;
						factory.created_at = data.created_at;
						factory.title = data.activity_detail.activity_title;
						factory.caption = data.activity_detail.caption;
						if (factory.title == undefined) {
							factory.title = '';
						} else {
							factory.title = factory.title
								.replace('[USERNAME]', '<span class="name">' + factory.user.user_display_name + '</span>')
								.replace('[MOOD_TEXT]',
								factory.user.mood.id ?
									(factory.user.mood.text + ' ' +
										(factory.user.mood.id == 2 ? '<i class="ci-mood-happy"></i>' :
											factory.user.mood.id == 3 ? '<i class="ci-mood-sad"></i>' : '')
									) : '');
						}
						
						
						drawerFactory.data = factory;
						$rootScope.$broadcast('drawer.open',{});
					
			},function(response){
				
			});
		}
		function response(value){
			if(value==0){//tag
					cardPlaceDrawer.open(
						'EDIT',
						null,
						function (data) {
							if (null != data.place) {
								savePlace(data.place);
							}
						}
					);
			}else
			if(value==1 || value==2){//secret
				timelineConnector.cardAsk(factory.id,'response_place',value)
				.then(function(data){
					drawerFactory.setState();
				},function(response){});
			}
		}
		function savePlace(place) {
			timelineConnector.placeUpdate(factory.id,place.id)
				.then(function(data){
					if(data.error==false){
						timelineConnector.cardResponse(factory.id,'response_place',0)
						.then(function(data){
							drawerFactory.setState();
						},function(response){});
					}else{
						modalFactory.message(data.message);
					}
					drawerFactory.setState();
				},function(response){});
			}
		function back(){
			drawerFactory.setState();
		}
		function save(){
			drawerFactory.setState();
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardResponseWith', cardResponseWith);
	cardResponseWith.$inject = ['$rootScope','modalFactory', 'drawerFactory','cardFactory','cardWithDrawer','timelineConnector'];

	function cardResponseWith($rootScope, modalFactory,drawerFactory,cardFactory,cardWithDrawer,timelineConnector) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			card:null,
			activity:null,
			response:response
		};
		function open(post_code,from_name,caption,callback){
			factory.callback=callback;
			factory.from_name = from_name;
//			factory.card=new cardFactory();
			factory.back_text='back';
			drawerFactory.title='Response to a question';
			drawerFactory.drawer_class='-card-ask';
			drawerFactory.template = DRAWER_VIEW+'card-response-with.html';
			load(post_code);
		}
		function load(post_code){
			var c = {
				data: {
					"post_code": post_code,
				}
			}
			timelineConnector.cardGet(post_code).then(function(data){
						var data = data.content;
						if(data.with_detail.with_status.value!=-1){modalFactory.message('Kamu sudah pernah respons');return;}
						//user_info
						factory.user={};
						factory.id = data.post_id;
						factory.created_at = data.created_at;
						factory.user.id = data.user_id;
						factory.user.username = data.username;
						factory.user.user_display_name = data.user_display_name;
						//mood_id
						factory.user.mood={};
						if (data.activity_detail.mood) {
							factory.user.mood.id = data.activity_detail.mood.id;
							factory.user.mood.text = data.activity_detail.mood.text;
						}
						factory.image_preview = data.activity_detail.preview;
						factory.created_at = data.created_at;
						factory.title = data.activity_detail.activity_title;
						factory.caption = data.activity_detail.caption;
						if (factory.title == undefined) {
							factory.title = '';
						} else {
							factory.title = factory.title
								.replace('[USERNAME]', '<span class="name">' + factory.user.user_display_name + '</span>')
								.replace('[MOOD_TEXT]',
								factory.user.mood.id ?
									(factory.user.mood.text + ' ' +
										(factory.user.mood.id == 2 ? '<i class="ci-mood-happy"></i>' :
											factory.user.mood.id == 3 ? '<i class="ci-mood-sad"></i>' : '')
									) : '');
						}
						
						
						drawerFactory.data = factory;
						$rootScope.$broadcast('drawer.open',{});
					
			},function(response){
				
			});
		}
		function response(value){
			if(value==0){//tag
					cardWithDrawer.open(
						'EDIT',
						[],
						function (data) {
							if ([] != data.withs) {
								saveWith(data.withs);
							}
						}
					);
			}else
			if(value==1 || value==2){//secret
				timelineConnector.cardResponse(factory.id,'response_with',value)
					.then(function(data){
						drawerFactory.setState();
					},function(response){});
			}
		}
		function saveWith(_list) {
			var list = [];
				angular.forEach(_list, function (value, key) {
					list.push({
						id: value.id,
						username: value.user.username
					});
				});
				timelineConnector.withUpdate(factory.id,list).then(function(data){
						if (data.error == false) {
							vm.with.list = _list;
							modalFactory.message(data.message);
							timelineConnector.cardResponse(factory.id,'response_with',0)
							.then(function(data){
								drawerFactory.setState();
							},function(response){});
						} else {
							modalFactory.message(data.message);
						}
				},function(response){
					
				});
			}
		function back(){
			drawerFactory.setState();
		}
		function save(){
			drawerFactory.setState();
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('cardWithDrawer', cardWithDrawer);
	cardWithDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory','$filter'];

	function cardWithDrawer($rootScope, CiayoService, drawerFactory,$filter) {
		var factory = {
			open:open,
			back:back,
			save:save,
			callback:angular.noop(),
			old_withs:null,
			withs:null,
			search:'',
			list:[],
			isEmpty:false,
			deleteSearch:deleteSearch,
			selectWith:selectWith,
			searchWith:searchWith,
			deleteWith:deleteWith,
			isExist:isExist
		};
		function open(type,withs,callback){
			factory.callback=callback;
			factory.old_withs=withs.slice();
			factory.withs = withs.slice();
			factory.isEmpty=false;
			factory.back_text='back';
			factory.save_text='save';
			if(type=='ADD'){
				drawerFactory.title=$filter('translate')('$tag.people');
			}else{
				drawerFactory.title=$filter('translate')('$tag.people');
			}
			drawerFactory.drawer_class='-timeline-post-with';
			drawerFactory.template = DRAWER_VIEW+'card-with.html';
			drawerFactory.data = factory;
//			factory.old_withs=withs;
//			factory.withs=withs;
			factory.search='';
			factory.list=[];
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
			var data={'withs':factory.old_withs};
			factory.callback(data,false);
		}
		function save(){
			drawerFactory.setState();
			var data={'withs':factory.withs}
			factory.callback(data,true);
		}
		//FUNCTION
		
		function deleteSearch(){
			factory.search='';
			factory.list=[];
			factory.isEmpty=false;
			factory.withs=[];
		}
		
		function searchWith(){
			factory.isEmpty=false;
			var keyword=factory.search,limit=20,offset=0;
			var ok = false;
			var c = {
				data: {
					"keyword": keyword,
					"limit": limit,
					"offset": offset
				}
			};
			CiayoService.Api('search/friend/name', c, function(response) {
				if(response.status==200){
					var data = response.data.c.data;
					if (data.error == false) {
						ok = true;
					}
				}
				if(ok){
					factory.list=[];
					var tmp = data.content.list_user;
					angular.forEach(tmp,function(value,key){
						factory.list.push({
							id:value.user_id,
							user_name:value.username,
							user_display_name:value.user_display_name,
							avatar: {
								background: value.user_avatar_detail.background_avatar,
								full_body: value.user_avatar_detail.avatar,
								face: '',
								cropped: value.user_avatar_cropped.avatar
							},
						})
					});
					factory.isEmpty = factory.list.length==0;
				}else{
					//...
				}
			});
		}
		function selectWith(_with){
			if(isExist(_with)){
				deleteWith(_with);
			}else{
				factory.withs.push(_with);
				factory.search='';
			}
			
			// factory.list=[];
			// factory.search=_with.with_name;
		}
		function deleteWith(_with){
			factory.withs.splice(factory.withs.indexOf(_with),1);
		}
		function isExist(_with){
			var _return = false;
			angular.forEach(factory.withs,function(value,key){
				if(value.id==_with.id){
					_return  = true;
				}
			})
			return _return;
		}
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('mutualFriendDrawer', mutualFriendDrawer);
	mutualFriendDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory','mutualFriendFactory'];

	function mutualFriendDrawer($rootScope, CiayoService, drawerFactory,mutualFriendFactory) {
		var factory = {
			open:open,
			back:back,
			callback:angular.noop(),
			mutualFriend:mutualFriendFactory,
			load_drawer:load_drawer
		};
		function open(user_id, username){
			factory.back_text='back';
			mutualFriendFactory.loader_drawer = true;

			load_drawer(user_id, username);
			drawerFactory.title='Mutual Friends';
			
			drawerFactory.drawer_class='-mutual-friend-drawer';
			drawerFactory.template = DRAWER_VIEW+'mutual-friend.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
		}

		function load_drawer(user_id, username){
			mutualFriendFactory.user_id=user_id;
			mutualFriendFactory.username=username;
			mutualFriendFactory.getMutualFriendList(true);
			
		}


		
		return factory;
	}
})();;
(function () {
	'use strict';

	angular
		.module('app')
		.factory('searchFriendDrawer', searchFriendDrawer);
	searchFriendDrawer.$inject = ['$rootScope', 'CiayoService', 'drawerFactory','searchFriendFactory'];

	function searchFriendDrawer($rootScope, CiayoService, drawerFactory,searchFriendFactory) {
		var factory = {
			open:open,
			back:back,
			callback:angular.noop(),
			searchFriend:searchFriendFactory,
			load_drawer:load_drawer
		};
		function open(user_id){
			factory.back_text='back';
			searchFriendFactory.loader_drawer = true;
			searchFriendFactory.user_list=[];
			searchFriendFactory.count_friend_list='';
			
			load_drawer(user_id);
			searchFriendFactory.user_id=user_id;
			drawerFactory.title='Search Friends';
			
			drawerFactory.drawer_class='-search-friend-drawer';
			drawerFactory.template = DRAWER_VIEW+'search-friend.html';
			drawerFactory.data = factory;
			$rootScope.$broadcast('drawer.open',{});
		}
		function back(){
			drawerFactory.setState();
		}

		function load_drawer(user_id){
			searchFriendFactory.init();
			searchFriendFactory.user_id=user_id;
			searchFriendFactory.get_profile();
			
		}


		
		return factory;
	}
})();;
(function() {
	'use strict';

	angular
		.module('app')
		.directive('achievementItem', achievementItem);

	achievementItem.$inject = [];
	function achievementItem() {
		var directive = {
				//bindToController: true,
				//controller: ControllerController,
				//controllerAs: 'vm',
				link: link,
				restrict: 'A',
				scope: {
				}
		};
		return directive;
		
		function link(scope, element, attrs) {
			angular.element(document).ready(function(){
				setTimeout(function(){
					drawRing(attrs.$$element.context);
				},1);
			});
		}

		function drawRing(el,radius,txt,pct,end){
			var ctx=el.getContext('2d');
			radius = radius || parseInt(el.getAttribute('data-radius')) || 50;
			pct = pct || parseInt(el.getAttribute('data-pct-start')) || 0;
			end = end || parseInt(el.getAttribute('data-pct-end')) || 0;
			txt = txt || el.getAttribute('data-show-text') || false;
			var r=radius*0.8,
					left=radius,
					top=radius*55/50,
					line_width=radius*3/50,
					tw=radius*35/50,th=radius*16/50,
					tx=left-r+radius*22/50,ty=top-r-th/2,
					tr=radius*2/50,
					box_line_width=radius*3/50,
					text=pct+'%',
					font_size=radius*12/50;
			ctx.clearRect(0,0,500,500);
			ctx.lineWidth = line_width;
			ctx.strokeStyle = '#CCE1EC';
			ctx.beginPath();
			ctx.arc(left, top, r,	0, 2 * Math.PI);//x,y ada di tengah lingkaran
			ctx.stroke();
			ctx.strokeStyle = '#49A8DC';
			ctx.beginPath();
			ctx.arc(left, top, r,	-0.5*Math.PI, ((pct/100)*2-0.5) * Math.PI);
			ctx.stroke();
			if(txt){
				ctx.save();
				ctx.beginPath();
				ctx.fillStyle = "white";
				ctx.lineWidth=box_line_width;
				ctx.moveTo(tx+tr, ty);//20,10 tx+tr,
				ctx.lineTo(tx+tw-tr, ty);//80,10
				ctx.quadraticCurveTo(tx+tw, ty, tx+tw, ty+tr);//90,10,90,20
				ctx.lineTo(tx+tw, ty+th-tr);//90,80
				ctx.quadraticCurveTo(tx+tw, ty+th, tx+tw-tr, ty+th);//90,90,80,90
				ctx.lineTo(tx+tr, ty+th);//20,90
				ctx.quadraticCurveTo(tx, ty+th, tx, ty+th-tr);//10,90,10,80
				ctx.lineTo(tx, ty+tr);//10,20
				ctx.quadraticCurveTo(tx, ty, tx+tr, ty);//10,10,20,10
				ctx.stroke();
				ctx.fill();
				ctx.restore();
				
				ctx.fillStyle = '#02679E';
				ctx.font = font_size+"px Arial";
				ctx.textAlign = "center";
				ctx.fillText(text,left,top-r+th/2-tr*2);
			}
			pct+=1;
			if(pct<=end){
				setTimeout(function(){drawRing(el,radius,txt,pct,end);},20);
			}
		}
		
	}
})();;
+function(){
	"use strict";
	angular
		.module("CiayoCard", [])
		.directive('cCard',cCard)
		.directive("cCardParallax", cCardParallax)
	;
	cCard.$inject=['modalFactory'];
	cCardParallax.$inject=['modalFactory'];
	function cCard(modalFactory){
		return {
			restrict: "E",
			scope: {'card':'=','index':'='},
			replace:true,
			templateUrl: function(elem,attr){
				return DIRECTIVES_VIEW+'card.html'
			},
			link:function(scope,element,attrs,controller,transcludeFn){
				scope.type = attrs.type;
				setTimeout(function(){$(window).trigger("resize.card-tab")},1);
			}
		}
	}
	function cCardParallax(modalFactory){
		return {
			restrict: "E",
			scope: {'parallax':'='},
			replace:true,
			template: '<div style="position:absolute;width:100%"></div>',
			link:function(scope, element, attrs, controller, transcludeFn){
				scope.$watch(
					'parallax.should_update',
					function (newValue, oldValue, scope) {
						ReactDOM.render(
							React.createElement(cCardParallaxComponent, {'parallax':scope.parallax}),
							element[0]
						);
					}
				);

			}
		}
	}
	
}();;
(function() {
	'use strict';

	angular
		.module('app')
		.directive('cavCarousel', function(){
			return {
				restrict: "A",
				scope: {},
				link: function(scope, elem, attr){
				 	$(document).ready(function(){
						var getCenterIndex = function(){
							return Math.ceil(($(elem).children().length / 2)-1);
						}
						
						setTimeout(function(){
							$(elem).flickity({
								cellAlign: 'center',
								initialIndex: getCenterIndex(),
								pageDots: false
							});
							$(elem).on('staticClick', function(event, pointer, cellElement, cellIndex){
								$(this).flickity('select', cellIndex)
								console.log(cellIndex)
							});
						},1);
					});
				}
			}
		})
		
		.directive('toggleZoom', function(){
			return {
				restrict: "A",
				link: function(scope, elem, attr){
					elem.on('click', function(e){
						e.preventDefault();
						if(elem.children().text() === 'zoom_in'){
							elem.parent().addClass('zoom-out');
							elem.children().text('zoom_out');
						} else{
							elem.parent().removeClass('zoom-out');
							elem.children().text('zoom_in');
						}
					});
				}
			}
		})
})();;
+function(){
	"use strict";
	angular
		.module("CiayoDrawer", [])
		.directive("cDrawer", cDrawer	)
	;
	cDrawer.$inject=['drawerFactory']
	function cDrawer(drawerFactory){
		return {
			restrict: "E",
			replace:true,
			templateUrl: DIRECTIVES_VIEW+'drawer_template.html',
			controller:cDrawerCtrl,
			controllerAs:'vm'
		}
	}
	cDrawerCtrl.$inject=['$scope','drawerFactory'];
	function cDrawerCtrl($scope,drawerFactory){
		var vm = this;
		
		angular.extend(vm,{
			drawer:drawerFactory
		});
		$scope.$on('drawer.open', function(event, args) {
			vm.drawer.setState(true);
		});
		
	}
	
}();;
+function(){
	"use strict";
	angular
		.module("CiayoFriendConnection", [])
		.directive("cFriendConnection", cFriendConnection)
	;
	function cFriendConnection(){
		return {
			restrict: "E",
			scope: {'user':'=','type':'='},
			replace:true,
			templateUrl: DIRECTIVES_VIEW+'friend-connection.html'
		}
	}
}();;
+function(){
	"use strict";
	angular
		.module("CiayoModal", [])
		.directive("cModal", cModal)
	;
	function cModal(){
		return {
			restrict: "E",
			replace:true,
			templateUrl: DIRECTIVES_VIEW+'modal-template.html',
			controller:cModalCtrl,
			controllerAs:'mdl'
		}
	}
	cModalCtrl.$inject=['$scope','modalFactory'];
	function cModalCtrl($scope,modalFactory){
		var mdl = this;
		
		angular.extend(mdl,{
			modal:modalFactory
		});
		$scope.$on('modal.open', function(event, args) {
			mdl.modal.setState(true);
		});
		
	}
}();;
+function(){
	"use strict";
	angular
		.module("CiayoNavbar", [])
		.directive("cNavbar", cNavbar)
	;
	/*
	attr = active  ['timeline','friend-request','notification','search','menu']
	*/
	function cNavbar(){
		return {
			restrict: "E",
			scope: {},
			replace:true,
			templateUrl: DIRECTIVES_VIEW+'navbar.html',
			link:function(scope, element, attrs, controller, transcludeFn){
				scope.active = attrs.active;
			},
			controller:function ($cookieStore, $state, $scope, navbarFactory, $rootScope, CiayoService, modalFactory) {
				
				// get data count notification
				$scope.list_notification_count=[];

				$scope.mark_all_notification = mark_all_notification;

				function mark_all_notification(){
					
					    
					$scope.notification_count=0;

					
				}

				function get_notification_count(type, limit, offset){
		
					navbarFactory.listNotification ( 
						type, limit, offset,
						function(response){//callback sucess
							//console.log(response.data.c.data.content);
							$scope.notification_count = response.data.c.data.content.count_notif;
							if($scope.notification_count>99){
								$scope.notification_count = '99+';
							}
							
							//console.log($scope.notification_count);

						},
						function(response){//err callback
							console.log(response);
						}
					);
				}
				get_notification_count("null", '1', 0);

				// get data count friend request
				$scope.list_friend_request_count=[];
				//$scope.friend_request_count=0;

				function get_friend_request_count(limit, offset){
					
					navbarFactory.listFriendRequest ( 
						limit, offset,
						function(response){//callback sucess
							
							$scope.friend_request_count = response.data.c.data.meta.total;
							if($scope.friend_request_count>99){
								$scope.friend_request_count='99+';
							}
							//console.log($scope.friend_request_count);
							
						},
						function(response){//err callback
							console.log(response);
						}
					);
				}
				get_friend_request_count('1', 0);

				function init(){

						var c={
			                data:{
			                    username:''
			                }
			            };
			            CiayoService.Api('users/info', c, function(response) {
			                var data=response.data.c.data;
							$scope.token_user_id = data.content.user_id;
							run_socket();
			            });
					 
				}

				init();

				function show_popup_achievement(data){
					// if(data){
					// 	modalFactory.popup_achievement(data);
					// }
					//var data = ['66'];
					for(var i=0; i<data.length; i++){
						modalFactory.popup_achievement(data[i]);
					}

					//console.log(data);
				}

				//show_popup_achievement('');


				function run_socket(){
					// socket commend				
					var socket = navbarFactory.Socket();
					//console.log(socket);
					socket.emit('set_userid', $scope.token_user_id);
					socket.on('nf004', function(data){  
			         	get_notification_count("null", '1', 0);
			        });

			        //socket popup achievement
					socket.on('ach001', function(data){	
						
						//console.log(data)
						show_popup_achievement(data);
						
					});

			        //socket like
			        socket.on('nf005', function(data){  
			         	get_notification_count("null", '1', 0);
			        });

			        //socket confirm request friend
			        socket.on('nf003', function(data){ 
			         	get_friend_request_count('1', 0);
			         	get_notification_count("null", '1', 0);
			        });

			        //socket add friend
			        socket.on('nf002', function(data){ 
			         	get_friend_request_count('1', 0);
			         	get_notification_count("null", '1', 0);
			        });


				 	var user_notification = $rootScope.$on(
	                    "user.notification",
	                    function(event, data) {
	                       
	                        get_notification_count("null", '1', 0);
	                    }
	                );

	                var user_friend_request = $rootScope.$on(
	                    "user.friend_request",
	                    function(event, data) {
	                        get_friend_request_count('1', 0);
	                        
	                    }
	                );
	            }

			}
		}
	}
}();;
+function(){
	"use strict";
	angular
		.module("CiayoTimeline", [])
		.directive("cTimeline", cTimeline)
	;
	function cTimeline(){
		return {
			restrict: "E",
			scope: {'type':'='},
			replace:true,
			templateUrl: DIRECTIVES_VIEW+'timeline.html',
			controller:'TimelineController',
			controllerAs:'vm'
		}
	}
}();;
+function(){
	"use strict";
	angular
		.module("TrendingNavbar", [])
		.directive("cTrendingNavbar", cTrendingNavbar)
	;
	/*
	attr = active  ['timeline','friend-request','notification','search','menu']
	*/
	function cTrendingNavbar(){
		return {
			restrict: "E",
			scope: {},
			replace:true,
			templateUrl: DIRECTIVES_VIEW+'trending-navbar.html',
			link:function(scope, element, attrs, controller, transcludeFn){
				scope.active = attrs.active;
			}
		}
	}
}();;
+function(){ "use strict";
	angular
		.module("CiayoUtil", [])
//		.directive('a', function() {
//		return {
//			restrict: 'E',
//			link: function(scope, elem, attrs) {
//				if(attrs.ngClick || attrs.href === '' || attrs.href === '#'){
//					elem.on('click', function(e){
////						e.preventDefault();
//					});
//				}
//			}
//		}
//	 })
	.directive('ngEnter',function() {
		return {
			link:function(scope,element,attrs) {
				element.bind("keypress", function(event) {
					if(event.which === 13) {
						scope.$apply(function() {
							scope.$eval(attrs.ngEnter);
						});
					event.preventDefault();
					}
				});
			}
		};
	})
	.directive("limitTo", ['$rootScope',function($rootScope) {
		return {
				scope:{'ngModel':'='},
				restrict: "A",
				link: function(scope, elem, attrs) {
						var limit = parseInt(attrs.limitTo);
						angular.element(elem).on("keypress", function(e) {
							var me=this;
								if(e.keyCode==8) return;
								if (this.value.length >= limit) e.preventDefault();
								$rootScope.$apply(function(){
									scope.ngModel = me.value.substring(0,limit);
								});
						}).on('paste',function(e){
							if (this.value.length >= limit) {
								e.preventDefault();
								var me = this;
								$rootScope.$apply(function(){
									scope.ngModel = me.value.substring(0,limit);
								});
							}
						});
				}
		}
	}])
	.filter('formatdate', function($filter,$cookieStore) {

		function timeConverter(UNIX_timestamp){
		  	 		var a = new Date(UNIX_timestamp);
				  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
				  var year = a.getFullYear();
				  var month = months[a.getMonth()];
				  var date = a.getDate();
				  var time = date + ' ' + month + ' ' + year;
				  return time;
		}

	function format_filter(date) {
		date = date * 1000;
		if (typeof date !== 'object') {
					date = new Date(date);
			}

			var seconds = Math.floor((new Date() - date) / 1000);
			//seconds = seconds + 240;

			var intervalType;
			var type = 'false';

			var interval = Math.floor(seconds / 31536000);
			if (interval >= 1) {
					intervalType = $filter('translate')('$year');
					type = 'true';
			} else {
					interval = Math.floor(seconds / 2592000);
					if (interval >= 1) {
							intervalType = $filter('translate')('$month');
							type = 'true';
					} else {
							interval = Math.floor(seconds / 86400);
							if (interval >= 1) {
									intervalType = $filter('translate')('$day');
							} else {
									interval = Math.floor(seconds / 3600);
									if (interval >= 1) {
											intervalType = $filter('translate')('$hour');
									} else {
											interval = Math.floor(seconds / 60);
											if (interval >= 1) {
													intervalType = $filter('translate')('$minute');
											} else {
													// interval = seconds;
													// intervalType = "second";
													interval = $filter('translate')('$just.now');
													intervalType = ''; 
													var typelang = 1; 
											}
									}
							}
					}
			}

			if(type=='false'){
				if(typelang==1){
					return interval;
				}else{
					if($cookieStore.get('language')==1){
						if (interval > 1 || interval === 0) {
							intervalType += 's';
						}
					}
					return interval + ' ' + intervalType + " "+$filter('translate')('$ago');
				}
			}else{
				return timeConverter(date);
			}
	}

	return format_filter;
	})
	.directive("contenteditable", function() {
  return {
    restrict: "A",
    require: "ngModel",
    link: function(scope, element, attrs, ngModel) {

      function read() {
        ngModel.$setViewValue(element.html());
      }

      ngModel.$render = function() {
        element.html(ngModel.$viewValue || "");
      };

      element.bind("blur keyup change", function() {
        scope.$apply(read);
      });
    }
  };
})
	.directive('includeReplace', function () {
    return {
        require: 'ngInclude',
        restrict: 'A', /* optional */
        link: function (scope, el, attrs) {
            el.replaceWith(el.children());
        }
    };
})
	.directive('lazyLoad', function() {
		return {
			restrict: "A",
			link: function(scope, element, attrs) {
				var el = window;
				var el2 = 'body';
				if(attrs.lazyLoadElement){
					el = angular.element(attrs.lazyLoadElement)
					el2 = el;
				}
				angular.element(el).scroll(function(){
					var scroll_height = angular.element(el2).prop('scrollHeight');
					var scroll_top = angular.element(el2).scrollTop();
					var height = angular.element(el).height();
					if(scroll_height - (height + scroll_top) <=300){
						scope.$apply(attrs.lazyLoad);
					}
				});
				scope.$on('$destroy',function(){
					angular.element(window).off('scroll');
				})
			}
		};
	})
}();
