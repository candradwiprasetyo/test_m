/*
 * jQuery itour v 2.0.0
 *
 * Copyright 2016, Linnik Yura | LI MASS CODE | http://masscode.ru
 *
 * Last Update 12.07.2016
 */

!function(a){"use strict";var b={init:function(b){var c={CSSClass:"anyClassName",startStep:1,tourMapPos:"right",tourTitle:"Tour Title Default",tourMapVisible:!1,spacing:10,overlayClickable:!0,stepNumbersVisible:!0,steps:[{image:"",title:"New Step Title",content:"New Step Description",contentPosition:"auto",name:"uniqueName",disable:!1,overlayOpacity:.5,event:"next",nextText:"Next",prevText:"Prev",trigger:!1,before:function(){},during:function(){},after:function(){}}],create:function(){},end:function(){},lang:{cancelText:"Cancel Tour",hideText:"Hide Tour Map",tourMapText:"•••",tourMapTitle:"Tour Map",nextTextDefault:"Next",prevTextDefault:"Prev",endText:"End Tour"}};return b&&a.extend(c,b),this.each(function(d){var e=document.documentMode;e&&a("html").addClass("bms");var f=a("body");if(f.data().itour||(f.data().itour={}),f.data().itour.ini)console.log("Warning! \nDetected re-initialization of plugin. Check the code calling the plugin!");else{f.addClass("hWrap");var g=f.data().itour;g.opt={},a.extend(g.opt,c),f.data().itourLang&&a.extend(g.opt.lang,f.data().itourLang),g.userOpt={},a.extend(g.userOpt,b),g.v={},g.ini=!0,g.v.startStyle=f.attr("style")||!1,g.opt.spacing=parseFloat(g.opt.spacing);var h="mousemove."+g.hName,i="mousedown."+g.hName,j="mouseup."+g.hName;"ontouchstart"in window&&(h="touchmove."+g.hName,i="touchstart."+g.hName,j="touchend."+g.hName),g.v.mousemoveEvent=h,g.v.mouseupEvent=j,g.v.mousedownEvent=i,g.opt.CSSClass&&a("html").addClass(g.opt.CSSClass);var k=a('<div class="hOverlayDisable"></div>'),l=a('<div class="hOverlay hOverlayBottom"></div>'),m=a('<div class="hOverlay hOverlayTop"></div>'),n=a('<div class="hOverlay hOverlayRight"></div>'),o=a('<div class="hOverlay hOverlayLeft"></div>');g.v.overlays=o.add(n).add(m).add(l).appendTo("body"),g.v.hOverlayDisable=k.appendTo("body");var p=function(b){if(b&&b.length){var c=b.outerWidth(),d=b.outerHeight(),e=b.offset().top,h=b.offset().left;b.is("body")?(l.css({left:a(window).width()/2,top:a(window).height()/2,width:a(window).width()/2,height:a(window).height()/2}),m.css({left:0,top:0,width:a(window).width()/2,height:a(window).height()/2}),n.css({left:a(window).width()/2,top:0,width:a(window).width()/2,height:a(window).height()/2}),o.css({left:0,top:a(window).height()/2,width:a(window).width()/2,height:a(window).height()/2})):(a(".itour-highlight").removeClass("itour-highlight"),b.addClass("itour-highlight"),l.css({left:h-g.opt.spacing+"px",top:e+g.opt.spacing+d-a(window).scrollTop()+"px",width:a(window).width()-(h-g.opt.spacing)+"px",height:a(window).height()-(e+g.opt.spacing+d)+a(window).scrollTop()+"px"}),m.css({left:0,top:0,width:h+c+g.opt.spacing+"px",height:e-g.opt.spacing-a(window).scrollTop()+"px"}),n.css({left:h+g.opt.spacing+c+"px",top:0,width:a(window).width()-(h+g.opt.spacing+c)+"px",height:e+g.opt.spacing+d-a(window).scrollTop()+"px"}),o.css({left:0,top:e-g.opt.spacing-a(window).scrollTop()+"px",width:h-g.opt.spacing+"px",height:a(window).height()-(e-g.opt.spacing)+a(window).scrollTop()+"px"})),setTimeout(function(){g.v.overlays.addClass("noTransition")},310);var p,q,t,u,i=g.opt.steps[g.v.startIndex],j=a.trim(i.contentPosition).split(""),r="0",s="0",v=.5;if(g.opt.steps){if(g.opt.steps[g.v.startIndex].disable?k.addClass("hOverlayDisableTrue"):k.removeClass("hOverlayDisableTrue"),g.opt.steps[g.v.startIndex].overlayOpacity>=0&&(v=g.opt.steps[g.v.startIndex].overlayOpacity),a(document).on("keyup.itour",function(a){27==parseFloat(a.keyCode)&&(f.itour("destroy"),void 0!==g.opt.end&&g.opt.end())}),g.v.overlays.css({opacity:v}),"center"==g.opt.steps[g.v.startIndex].contentPosition)j=["c","c","c"],q="50%",p="50%";else if((3!=j.length||"t"!=j[0]&&"r"!=j[0]&&"b"!=j[0]&&"l"!=j[0])&&(g.opt.steps[g.v.startIndex].contentPosition="auto"),"auto"==g.opt.steps[g.v.startIndex].contentPosition){var x=e-a(window).scrollTop(),y=x;j=["t","c","c"],p=e-(g.opt.spacing+15),q=h+c/2;var z=a(window).height()-(x+d);z>y&&(y=z,j=["b","c","c"],p=e+g.opt.spacing+d+15);var A=h-a(window).scrollLeft();A>y&&(y=A,j=["l","c","c"],q=h-(g.opt.spacing+15),p=e+d/2);var B=a(window).width()-(A+c);B>y&&(y=B,j=["r","c","c"],q=h+g.opt.spacing+c+15,p=e+d/2),"l"!=j[0]&&"r"!=j[0]||(x-z>100||x-z<-100?(x>z&&(j[1]="c",j[2]="t",p=e+d/2,p+50>a(window).scrollTop()+a(window).height()&&(j[1]="t",p=e-g.opt.spacing)),x<z&&(j[1]="c",j[2]="b",p=e+d/2,p-50<a(window).scrollTop()&&(j[1]="b",p=e+d+g.opt.spacing))):(j[1]="c",j[2]="c",p=e+d/2)),"t"!=j[0]&&"b"!=j[0]||(A-B>100||A-B<-100?(A>B&&(j[1]="c",j[2]="l",q=h+c/2),A<B&&(j[1]="c",j[2]="r",q=h+c/2)):(j[1]="c",j[2]="c",q=h+c/2))}else"r"==j[0]&&(q=h+g.opt.spacing+c+15,r="0",t="0"),"l"==j[0]&&(q=h-(g.opt.spacing+15),r="-100%",t="0"),"b"==j[0]&&(p=e+g.opt.spacing+d+15,s="0",u="0"),"t"==j[0]&&(p=e-(g.opt.spacing+15),s="-100%",u="0"),("c"==j[1]&&"r"==j[0]||"c"==j[1]&&"l"==j[0])&&(p=e+d/2),"b"==j[1]&&(p=e+d+g.opt.spacing),"t"==j[1]&&(p=e-g.opt.spacing),("c"==j[1]&&"b"==j[0]||"c"==j[1]&&"t"==j[0])&&(q=h+c/2),"l"==j[1]&&(q=h-g.opt.spacing),"r"==j[1]&&(q=h+c+g.opt.spacing);g.v.hContPos.css({left:q,top:p}).attr({"data-pos":j[0],"data-cone":j[1],"data-cont":j[2]}),g.v.hContPos.stop(!0).delay(500).fadeIn(200)}else console.log('Parameter "steps" is undefined or empty')}};g.v.overlayPos=p,g.v.hContPos=a('<div class="hContPos"></div>').appendTo("body"),g.v.hContBlock=a('<div class="hContBlock"></div>').appendTo(g.v.hContPos),g.v.hContBody=a('<div class="hContBody"><div>').appendTo(g.v.hContBlock),g.v.hContFooter=a('<div class="hContFooter"><div>').appendTo(g.v.hContBlock),g.v.hContHeader=a('<div class="hContHeader"><div>').prependTo(g.v.hContBlock),g.v.hNavBtn=a('<span class="hNavBtn" title="'+g.opt.lang.tourMapTitle+'">'+g.opt.lang.tourMapText+"</span>").prependTo(g.v.hContBlock),g.v.hContImage=a('<div class="hContImage"></div>').prependTo(g.v.hContBlock),g.v.stepNumbersVisible=a('<div class="hStepNumbers"></div>'),a('<div class="hStepNumber"></div>').appendTo(g.v.stepNumbersVisible),a('<div class="hStepTotal">'+g.opt.steps.length+"</div>").appendTo(g.v.stepNumbersVisible),g.opt.tourMapVisible!==!0&&"true"!==g.opt.tourMapVisible||a("html").addClass("hNavOpen"),g.v.hNavPos=a('<div class="hNavPos hNavPos-'+g.opt.tourMapPos+'"></div>').appendTo("body"),g.opt.tourTitle&&(g.v.hNavHeader=a('<div class="hNavHeader">'+g.opt.tourTitle+"</div>").prependTo(g.v.hNavPos)),g.v.hNavWrap=a('<div class="hNavWrap"></div>').appendTo(g.v.hNavPos),g.v.hNavAction=a('<div class="hNavAction"></div>').appendTo(g.v.hNavPos);for(var q=0;q<g.opt.steps.length;q++){var r=g.opt.steps[q],s=r.title?r.title:"№"+(q+1);a('<div data-hindex="'+q+'" class="hStepItem">'+s+"</div>").appendTo(g.v.hNavWrap)}g.v.hClose=a('<span class="hClose hBtn">'+g.opt.lang.cancelText+"</span>").appendTo(g.v.hNavAction),g.v.hHide=a('<span class="hHide hBtn">'+g.opt.lang.hideText+"</span>").appendTo(g.v.hNavAction),g.opt.startStep=parseFloat(g.opt.startStep),g.opt.startStep<1&&1==g.opt.startStep,g.v.startIndex=g.opt.startStep-1;var t=function(){g.v.overlays&&g.v.overlays.removeClass("noTransition"),g.v.overlayEnable=!1,setTimeout(function(){g.v.overlayEnable=!0},1e3),g.v.hContPos.stop(!0).fadeOut(100,function(){var b=300;setTimeout(function(){if(g.v.hContPos.hide(),g.v.hContHeader.empty(),g.v.hContBody.empty(),g.v.hContFooter.empty(),g.opt.steps){var c=g.opt.steps[g.v.startIndex];if(c){var d;if(d=a(a(c.name).length?c.name:'[data-name *="'+c.name+'"]'),g.v.targetEl=d,"center"==c.contentPosition&&(g.v.targetEl=a("body")),g.v.targetEl.length)if(g.v.targetEl.is(":visible")){void 0!==c.before&&c.before();var e=function(){g.v.overlayPos(g.v.targetEl);var b=c.title?c.title:"№"+(parseFloat(g.v.startIndex)+1);c.image&&""!=a.trim(c.image)?a('<img src="'+c.image+'">').load(function(){g.v.hContImage.html('<img src="'+c.image+'">')}):g.v.hContImage.empty(),c.title?g.v.hContHeader.html(b):g.v.hContHeader.html(""),g.v.hContBody.html(c.content),g.opt.steps[g.v.startIndex].prevText||(g.opt.steps[g.v.startIndex].prevText=g.opt.lang.prevTextDefault),g.opt.steps[g.v.startIndex].nextText||(g.opt.steps[g.v.startIndex].nextText=parseFloat(g.v.startIndex)+1==g.opt.steps.length?g.opt.lang.endText:g.opt.lang.nextTextDefault),a(".hStepNumber",g.v.stepNumbersVisible).html(parseFloat(g.v.startIndex)+1),g.opt.stepNumbersVisible&&g.v.stepNumbersVisible.appendTo(g.v.hContFooter);var d=g.v.startIndex-1;if(g.opt.steps[d]){a('<span class="hBtn hPrev">'+g.opt.steps[g.v.startIndex].prevText+"</span>").appendTo(g.v.hContFooter)}var f;g.opt.steps[g.v.startIndex]&&g.opt.steps[g.v.startIndex].ready&&(f=a('<span class="hBtn hNext">'+g.opt.steps[g.v.startIndex].nextText+"</span>").appendTo(g.v.hContFooter)),g.opt.steps[g.v.startIndex].event||(g.opt.steps[g.v.startIndex].event="next"),"next"==g.opt.steps[g.v.startIndex].event?a(f).length||(f=a('<span class="hBtn hNext">'+g.opt.steps[g.v.startIndex].nextText+"</span>").appendTo(g.v.hContFooter)):g.v.targetEl.on(g.opt.steps[g.v.startIndex].event+".itour",function(){return g.v.targetEl.off(g.opt.steps[g.v.startIndex].event+".itour"),c.ready=!0,a('[data-hindex="'+g.v.startIndex+'"]').addClass("hSuccess"),void 0!==c.after&&c.after(),g.v.startIndex++,t(),!0}),a("[data-hindex]").removeClass("hCur").filter('[data-hindex="'+g.v.startIndex+'"]').addClass("hCur"),g.opt.steps[g.v.startIndex].trigger&&0!=g.opt.steps[g.v.startIndex].trigger&&"false"!=g.opt.steps[g.v.startIndex].trigger&&g.v.targetEl.trigger(g.opt.steps[g.v.startIndex].trigger),void 0!==c.during&&c.during()};"center"==c.contentPosition?e():g.v.targetEl.offset().top<a(window).scrollTop()?(g.v.scrolling=!0,a("html,body").animate({scrollTop:g.v.targetEl.offset().top-a(window).height()/2},b).promise().then(function(){setTimeout(function(){g.v.scrolling=!1,e()},1)})):g.v.targetEl.offset().top+g.v.targetEl.outerHeight()>a(window).scrollTop()+a(window).height()?(g.v.scrolling=!0,a("html,body").animate({scrollTop:g.v.targetEl.offset().top-a(window).height()/2},b).promise().then(function(){setTimeout(function(){g.v.scrolling=!1,e()},1)})):e()}else console.log("target element is hidden");else console.log("Target is Absent"),f.itour("destroy")}else g.v.startIndex--,f.itour("destroy"),void 0!==g.opt.end&&g.opt.end()}else console.log("step data is missing")},b)})};t(),a(window).on("resize scroll",function(){g.ini&&(g.v.scrolling||g.v.overlayPos(g.v.targetEl))}),a(document).on("click",".hNext",function(){g.v.targetEl.off(g.opt.steps[g.v.startIndex].event+".itour"),"next"==g.opt.steps[g.v.startIndex].event&&(g.opt.steps[g.v.startIndex].ready=!0,a('[data-hindex="'+g.v.startIndex+'"]').addClass("hSuccess")),void 0!==g.opt.steps[g.v.startIndex].after&&g.opt.steps[g.v.startIndex].after(),g.v.startIndex++,t()}),a(document).on("click",".hPrev",function(){g.v.targetEl.off(g.opt.steps[g.v.startIndex].event+".itour"),"prev"==g.opt.steps[g.v.startIndex].event&&(g.opt.steps[g.v.startIndex].ready=!0,a('[data-hindex="'+g.v.startIndex+'"]').addClass("hSuccess")),void 0!==g.opt.steps[g.v.startIndex].after&&g.opt.steps[g.v.startIndex].after(),g.v.startIndex--,t()}),a(document).on("click",".hClose",function(){f.itour("destroy"),void 0!==g.opt.end&&g.opt.end()}),a(document).on("click","[data-hindex]",function(){var b=a(this),c=b.attr("data-hindex");parseFloat(g.v.startIndex)!==parseFloat(c)&&(g.v.targetEl.off(g.opt.steps[g.v.startIndex].event+".itour"),void 0!==g.opt.steps[g.v.startIndex].after&&g.opt.steps[g.v.startIndex].after(),g.v.startIndex=c,t())}),g.opt.overlayClickable&&a(document).on("click",".hOverlay",function(b){a(b.target).is(".hContPos")||a(".hContPos").find(a(b.target)).length||!g.v.overlayEnable||(f.itour("destroy"),void 0!==g.opt.end&&g.opt.end())}),g.v.hNavBtn.on("click",function(){a(this);a("html").is(".hNavOpen")?a("html").removeClass("hNavOpen"):a("html").addClass("hNavOpen")}),g.v.hHide.on("click",function(){a(this);a("html").is(".hNavOpen")?a("html").removeClass("hNavOpen"):a("html").addClass("hNavOpen")}),f.addClass("hCreate"),void 0!==g.opt.create&&g.opt.create()}})},destroy:function(b){return this.each(function(c){var d=a("body"),e=d.data().itour;e.ini?(a(".itour-highlight").removeClass("itour-highlight"),d.removeClass("hWrap hCreate"),e.v.startStyle?d.attr({style:e.v.startStyle}):d.removeAttr("style"),a("html").removeClass("hNavOpen"),e.opt.CSSClass&&a("html").removeClass(e.opt.CSSClass),e.v.hContPos.remove(),e.v.overlays.remove(),e.v.hOverlayDisable.remove(),e.v.hNavWrap.remove(),e.v.hNavPos.remove(),a(document).off("click",".hNext"),a(document).off("click",".hPrev"),e.opt.steps[e.v.startIndex]&&e.v.targetEl.off(e.opt.steps[e.v.startIndex].event+".itour"),a(document).off("click",".hClose"),e.v.hHide.off("click"),a(document).off("click",".hOverlay"),a(document).off("click","[data-hindex]"),a(document).off("keyup.itour"),e.v.hNavBtn.off("click"),e.ini=!1,b||delete d.data().itour):console.log("Warning! \nDetected call of method Destroy for an element that is not associated with plugin. Check the code!")})}};a.fn.itour=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" in jQuery.itour doesn't exist"):b.init.apply(this,arguments)}}(jQuery);